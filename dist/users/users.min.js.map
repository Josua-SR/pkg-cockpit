{"version":3,"sources":["webpack:///users/users.min.js","webpack:///webpack/bootstrap fb96d86ff07998024dd6","webpack:///../pkg/users/local.js","webpack:///external \"jQuery\"","webpack:///external \"cockpit\"","webpack:///../bower_components/mustache/mustache.js","webpack:///../pkg/users/authorized-keys.js","webpack:///../pkg/users/ssh-list-public-keys.sh","webpack:///../pkg/users/ssh-add-public-key.sh","webpack:///../pkg/lib/patterns.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","update_accounts_privileged","$","addClass","update_privileged","permission","cockpit","format","_","user","name","find","attr","allowed","text","passwd_self","old_pass","new_pass","i","old_exps","new_exps","bad_exps","dfd","Deferred","buffer","sent_new","failure","timeout","window","setTimeout","proc","close","spawn","pty","environ","err","always","clearInterval","done","resolve","fail","ex","constructor","Error","reject","stream","data","length","test","input","promise","passwd_change","superuser","response","console","log","chain","functions","step","arguments","parse_passwd_content","content","warn","column","ret","lines","split","push","password","uid","parseInt","gid","gecos","replace","home","shell","parse_group_content","trim","userlist","password_quality","quality","message","is_user_in_group","group","log_unexpected_error","error","PageAccounts","this","_init","PageAccountsCreate","PageAccount","PageAccountConfirmDelete","PageAccountSetPassword","show_error_dialog","title","modal","show_unexpected_error","dialog_setup","d","setup","on","enter","show","leave","page_show","arg","_entered_","page_hide","hide","init","overview_page","account_page","navigate","path","location","translate","Mustache","authorized_keys","gettext","C_","admin","prototype","getTitle","proxy","parse_accounts","self","accounts","update","handle_passwd","file","read","watch","list","sort","a","b","localeCompare","empty","match","img","class","div","append","create","go","username_dirty","val","prop","removeClass","dialog","validate","fails","pw","target","promise_password","strength","state","meter","promise_username","check_username","all","cancel","tasks","prog","is_valid_char_username","username","k","suggest_username","remove_diacritics","str","translate_table","ae","e","l","n","o","oe","r","s","t","u","y","z","RegExp","substr","make_username","realname","result","toLowerCase","section_id","roles","role_template","html","parse","keys_template","toggle","account_id","setup_keys","user_name","home_dir","instance","remove_key","ev","key","add_key","get_user","parse_user","account","get_roles","parse_groups","groups","pop","role_groups","desc","member","triggerHandler","wheel","sudo","docker","handle_groups","get_last_login","parse_last_login","indexOf","Date","lastLogin","get_locked","update_display","parse_locked","status","locked","get_logged","parse_logged","logged","removeAttr","off","title_name","toLocaleString","parents","keys","keys_html","render","denied","failed","toggleClass","change_role","real_name_edited","check_role_for_self_mod","change_real_name","value","change_locked","verify_status","desired_lock_state","set_password","delete_account","logout_account","apply","focus","jQuery","__WEBPACK_AMD_DEFINE_FACTORY__","__WEBPACK_AMD_DEFINE_RESULT__","root","factory","mustache","undefined","testRegExp","re","string","RegExp_test","isWhitespace","nonSpaceRe","isFunction","object","escapeRegExp","escapeHtml","String","entityMap","escapeTags","tags","isArray","parseTemplate","template","stripSpace","hasTag","nonSpace","spaces","tokens","spaceRe","start","type","chr","token","openSection","tagRes","scanner","Scanner","sections","eos","pos","scanUntil","len","charAt","scan","tagRe","whiteRe","eqRe","curlyRe","nestTokens","squashTokens","lastToken","squashedTokens","section","nestedTokens","collector","tail","Context","view","parentContext","cache",".","parent","Writer","Object_toString","Object","toString","Array","&","<",">","\"","'","/","index","substring","search","lookup","context","names","clearCache","partials","renderTokens","originalTemplate","subRender","j","jlen","slice","escape","version","defaultWriter","to_html","send","AuthorizedKeys","process_failure","problem","update_keys","tag","last_tag","parse_pubkeys","df","script","lister","output","obj","line","raw","PUBKEY_RE","valid","size","fp","comment","algorithm","splice","join","parse_keys","dir","filename","notify","adder","modify","new_lines","remove","unique","unique_number","clear_errors","sel","field_error","next","refresh","wrapper","is","insertBefore","selectpicker","appendTo","hasClass","css","global_error","alert","prependTo","footer","display_errors","errors","any","forEach","DialogWait","handle","disabled","clear_wait","ctl","display_wait","restore","cancelled","wait","first","before","cancellation","controls","add","not","each","progress","onoff_refresh","x","andSelf","filter","el","onoff","buttons","document","createTextNode","onoff_change","onoff_value","last","resize_flex","slider","flex","total","part","isNaN","update_value","children","check_overflow","offsetWidth","scrollWidth","setup_slider","defineProperty","get","parseFloat","getAttribute","set","v","setAttribute","hasAttribute","offset","left","hitx","offsetX","clientX","outerWidth","width","pageX","trigger","setup_sliders","fn","action","addEventListener","ready","perm","denied_message","placement","selector","allowed_key","options","tooltip"],"mappings":"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","file":"users/users.min.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(1);\n\tmodule.exports = __webpack_require__(9);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\t/*\n\t * This file is part of Cockpit.\n\t *\n\t * Copyright (C) 2013 Red Hat, Inc.\n\t *\n\t * Cockpit is free software; you can redistribute it and/or modify it\n\t * under the terms of the GNU Lesser General Public License as published by\n\t * the Free Software Foundation; either version 2.1 of the License, or\n\t * (at your option) any later version.\n\t *\n\t * Cockpit is distributed in the hope that it will be useful, but\n\t * WITHOUT ANY WARRANTY; without even the implied warranty of\n\t * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n\t * Lesser General Public License for more details.\n\t *\n\t * You should have received a copy of the GNU Lesser General Public License\n\t * along with Cockpit; If not, see <http://www.gnu.org/licenses/>.\n\t */\n\t\n\tvar $ = __webpack_require__(2);\n\tvar cockpit = __webpack_require__(3);\n\t\n\tvar Mustache = __webpack_require__(4);\n\tvar authorized_keys = __webpack_require__(5);\n\t\n\t__webpack_require__(8);\n\t\n\tcockpit.translate();\n\tvar _ = cockpit.gettext;\n\tvar C_ = cockpit.gettext;\n\t\n\tvar permission = cockpit.permission({ admin: true });\n\t$(permission).on(\"changed\", update_accounts_privileged);\n\t\n\tfunction update_accounts_privileged() {\n\t    $(\".accounts-self-privileged\").addClass(\"accounts-privileged\");\n\t\n\t    $(\".accounts-privileged:not('.accounts-current-account')\").update_privileged(\n\t        permission, cockpit.format(\n\t            _(\"The user <b>$0</b> is not permitted to modify accounts\"),\n\t            permission.user ? permission.user.name : ''),\n\t        \"right\"\n\t    );\n\t    $(\".accounts-privileged\").find(\"input\")\n\t        .attr('disabled', permission.allowed === false ||\n\t                          $('#account-user-name').text() === 'root');\n\t\n\t    // enable fields for current account.\n\t    $(\".accounts-current-account\").update_privileged(\n\t        {allowed: true}, \"\"\n\t    );\n\t    $(\".accounts-current-account\").find(\"input\")\n\t        .attr('disabled', false);\n\t\n\t    if ($('#account-user-name').text() === 'root' && permission.allowed) {\n\t        $(\"#account-delete\").update_privileged({allowed: false},\n\t                                      _(\"Unable to delete root account\"));\n\t        $(\"#account-real-name-wrapper\").update_privileged({allowed: false},\n\t                                      _(\"Unable to rename root account\"));\n\t    }\n\t}\n\t\n\tfunction passwd_self(old_pass, new_pass) {\n\t    var old_exps = [\n\t        /.*\\(current\\) UNIX password: $/,\n\t    ];\n\t    var new_exps = [\n\t        /.*New password: $/,\n\t        /.*Retype new password: $/\n\t    ];\n\t    var bad_exps = [\n\t        /.*BAD PASSWORD:.*/\n\t    ];\n\t\n\t    var dfd = $.Deferred();\n\t    var buffer = \"\";\n\t    var sent_new = false;\n\t    var failure = _(\"Old password not accepted\");\n\t    var i;\n\t\n\t    var timeout = window.setTimeout(function() {\n\t        failure = _(\"Prompting via passwd timed out\");\n\t        proc.close(\"terminated\");\n\t    }, 10 * 1000);\n\t\n\t    var proc = cockpit.spawn([\"/usr/bin/passwd\"], { pty: true, environ: [ \"LC_ALL=C\" ], err: \"out\" })\n\t        .always(function() {\n\t            window.clearInterval(timeout);\n\t        })\n\t        .done(function() {\n\t            dfd.resolve();\n\t        })\n\t        .fail(function(ex) {\n\t            if (ex.constructor.name == \"ProcessError\")\n\t                ex = new Error(failure);\n\t            dfd.reject(ex);\n\t        })\n\t        .stream(function(data) {\n\t            buffer += data;\n\t            for (i = 0; i < old_exps.length; i++) {\n\t                if (old_exps[i].test(buffer)) {\n\t                    buffer = \"\";\n\t                    proc.input(old_pass + \"\\n\", true);\n\t                    return;\n\t                }\n\t            }\n\t\n\t            for (i = 0; i < new_exps.length; i++) {\n\t                if (new_exps[i].test(buffer)) {\n\t                    buffer = \"\";\n\t                    proc.input(new_pass + \"\\n\", true);\n\t                    failure = _(\"Failed to change password\");\n\t                    sent_new = true;\n\t                    return;\n\t                }\n\t            }\n\t\n\t            for (i = 0; sent_new && i < bad_exps.length; i++) {\n\t                if (bad_exps[i].test(buffer)) {\n\t                    failure = _(\"New password was not accepted\");\n\t                    return;\n\t                }\n\t            }\n\t        });\n\t\n\t    return dfd.promise();\n\t}\n\t\n\tfunction passwd_change(user, new_pass) {\n\t    var dfd = $.Deferred();\n\t\n\t    var buffer = \"\";\n\t    cockpit.spawn([ \"chpasswd\" ], {superuser: \"require\", err: \"out\" })\n\t        .input(user + \":\" + new_pass)\n\t        .done(function() {\n\t            dfd.resolve();\n\t        })\n\t        .fail(function(ex, response) {\n\t            if (ex.constructor.name == \"ProcessError\") {\n\t                console.log(ex);\n\t                if (response)\n\t                    ex = new Error(response);\n\t                else\n\t                    ex = new Error(_(\"Failed to change password\"));\n\t            }\n\t            dfd.reject(ex);\n\t        });\n\t\n\t    return dfd.promise();\n\t}\n\t\n\t/*\n\t * Similar to $.when() but serializes, and accepts functions\n\t * that return promises\n\t */\n\tfunction chain(functions) {\n\t    var dfd = $.Deferred();\n\t    var i = 0;\n\t\n\t    /* Either an array or functions passed */\n\t    if (typeof functions == \"function\")\n\t        functions = arguments;\n\t\n\t    function step() {\n\t        if (i == functions.length) {\n\t            dfd.resolve();\n\t            return;\n\t        }\n\t\n\t        (functions[i])()\n\t            .done(function() {\n\t                step();\n\t            })\n\t            .fail(function(ex) {\n\t                dfd.reject(ex);\n\t            });\n\t\n\t        i += 1;\n\t    }\n\t\n\t    step();\n\t    return dfd.promise();\n\t}\n\t\n\tfunction parse_passwd_content(content) {\n\t    if (!content) {\n\t        console.warn(\"Couldn't read /etc/passwd\");\n\t        return [ ];\n\t    }\n\t\n\t    var ret = [ ];\n\t    var lines = content.split('\\n');\n\t    var column;\n\t\n\t    for (var i = 0; i < lines.length; i++) {\n\t        if (! lines[i])\n\t            continue;\n\t        column = lines[i].split(':');\n\t        ret.push({\n\t            name: column[0],\n\t            password: column[1],\n\t            uid: parseInt(column[2], 10),\n\t            gid: parseInt(column[3], 10),\n\t            gecos: column[4].replace(/,*$/, ''),\n\t            home: column[5],\n\t            shell: column[6],\n\t        });\n\t    }\n\t\n\t    return ret;\n\t}\n\t\n\tfunction parse_group_content(content) {\n\t    content = (content || \"\").trim();\n\t    if (!content) {\n\t        console.warn(\"Couldn't read /etc/group\");\n\t        return [ ];\n\t    }\n\t\n\t    var ret = [ ];\n\t    var lines = content.split('\\n');\n\t    var column;\n\t\n\t    for (var i = 0; i < lines.length; i++) {\n\t        if (! lines[i])\n\t            continue;\n\t        column = lines[i].split(':');\n\t        ret.push({\n\t            name: column[0],\n\t            password: column[1],\n\t            gid: parseInt(column[2], 10),\n\t            userlist: column[3].split(','),\n\t        });\n\t    }\n\t\n\t    return ret;\n\t}\n\t\n\tfunction password_quality(password) {\n\t    var dfd = $.Deferred();\n\t\n\t    cockpit.spawn('/usr/bin/pwscore', { \"err\": \"message\" })\n\t       .input(password)\n\t       .done(function(content) {\n\t           var quality = parseInt(content, 10);\n\t           if (quality === 0) {\n\t               dfd.reject(new Error(_(\"Password is too weak\")));\n\t           } else if (quality <= 33) {\n\t               dfd.resolve(\"weak\");\n\t           } else if (quality <= 66) {\n\t               dfd.resolve(\"okay\");\n\t           } else if (quality <= 99) {\n\t               dfd.resolve(\"good\");\n\t           } else {\n\t               dfd.resolve(\"excellent\");\n\t           }\n\t       })\n\t       .fail(function(ex) {\n\t           dfd.reject(new Error(ex.message || _(\"Password is not acceptable\")));\n\t       });\n\t\n\t    return dfd.promise();\n\t}\n\t\n\tfunction is_user_in_group(user, group) {\n\t    for (var i = 0; group[\"userlist\"] && i < group[\"userlist\"].length; i++) {\n\t        if (group[\"userlist\"][i] === user)\n\t            return true;\n\t    }\n\t\n\t    return false;\n\t}\n\t\n\tfunction log_unexpected_error(error) {\n\t    console.warn(\"Unexpected error\", error);\n\t}\n\t\n\tPageAccounts.prototype = {\n\t    _init: function() {\n\t        this.id = \"accounts\";\n\t    },\n\t\n\t    getTitle: function() {\n\t        return C_(\"page-title\", \"Accounts\");\n\t    },\n\t\n\t    show: function() {\n\t    },\n\t\n\t    setup: function() {\n\t        $('#accounts-create').on('click', $.proxy (this, \"create\"));\n\t    },\n\t\n\t    enter: function() {\n\t        var self = this;\n\t\n\t        function parse_accounts(content) {\n\t            self.accounts = parse_passwd_content(content);\n\t            self.update();\n\t        }\n\t\n\t        this.handle_passwd =  cockpit.file('/etc/passwd');\n\t\n\t        this.handle_passwd.read()\n\t           .done(parse_accounts)\n\t           .fail(log_unexpected_error);\n\t\n\t        this.handle_passwd.watch(parse_accounts);\n\t    },\n\t\n\t    leave: function() {\n\t        if (this.handle_passwd) {\n\t            this.handle_passwd.close();\n\t            this.handle_passwd = null;\n\t        }\n\t    },\n\t\n\t    update: function() {\n\t        var list = $(\"#accounts-list\");\n\t\n\t        this.accounts.sort (function (a, b) {\n\t                                if (! a[\"gecos\"]) return -1;\n\t                                else if (! b[\"gecos\"]) return 1;\n\t                                else return a[\"gecos\"].localeCompare(b[\"gecos\"]);\n\t                            });\n\t\n\t        list.empty();\n\t        for (var i = 0; i < this.accounts.length; i++) {\n\t            if ((this.accounts[i][\"uid\"] < 1000 && this.accounts[i][\"uid\"] !== 0) ||\n\t                  this.accounts[i][\"shell\"].match(/^(\\/usr)?\\/sbin\\/nologin/) ||\n\t                  this.accounts[i][\"shell\"] === '/bin/false')\n\t                continue;\n\t            var img =\n\t                $('<div/>', { 'class': \"cockpit-account-pic pficon pficon-user\" });\n\t            var div =\n\t                $('<div/>', { 'class': \"cockpit-account\" }).append(\n\t                    img,\n\t                    $('<div/>', { 'class': \"cockpit-account-real-name\" }).text(this.accounts[i][\"gecos\"]),\n\t                    $('<div/>', { 'class': \"cockpit-account-user-name\" }).text(this.accounts[i][\"name\"]));\n\t            div.on('click', $.proxy(this, \"go\", this.accounts[i][\"name\"]));\n\t            list.append(div);\n\t        }\n\t    },\n\t\n\t    create: function () {\n\t        PageAccountsCreate.accounts = this.accounts;\n\t        $('#accounts-create-dialog').modal('show');\n\t    },\n\t\n\t    go: function (user) {\n\t        cockpit.location.go([ user ]);\n\t    }\n\t};\n\t\n\tfunction PageAccounts() {\n\t    this._init();\n\t}\n\t\n\tPageAccountsCreate.prototype = {\n\t    _init: function() {\n\t        this.id = \"accounts-create-dialog\";\n\t        this.username_dirty = false;\n\t    },\n\t\n\t    show: function() {\n\t    },\n\t\n\t    setup: function() {\n\t        var self = this;\n\t        $('#accounts-create-cancel').on('click', $.proxy(this, \"cancel\"));\n\t        $('#accounts-create-create').on('click', $.proxy(this, \"create\"));\n\t        $('#accounts-create-dialog .check-passwords').on('keydown change', $.proxy(this, \"validate\"));\n\t        $('#accounts-create-real-name').on('input', $.proxy(this, \"suggest_username\"));\n\t        $('#accounts-create-user-name').on('input', function() { self.username_dirty = true; });\n\t    },\n\t\n\t    enter: function() {\n\t        $('#accounts-create-user-name').val(\"\");\n\t        $('#accounts-create-real-name').val(\"\");\n\t        $('#accounts-create-pw1').val(\"\");\n\t        $('#accounts-create-pw2').val(\"\");\n\t        $('#accounts-create-locked').prop('checked', false);\n\t        $('#accounts-create-password-meter').removeClass(\"weak okay good excellent\");\n\t        $(\"#accounts-create-dialog\").dialog(\"failure\", null);\n\t        this.username_dirty = false;\n\t    },\n\t\n\t    leave: function() {\n\t    },\n\t\n\t    validate: function() {\n\t        var ex, fails = [];\n\t        var pw = $('#accounts-create-pw1').val();\n\t        if ($('#accounts-create-pw2').val() != pw) {\n\t            ex = new Error(_(\"The passwords do not match\"));\n\t            ex.target = \"#accounts-create-pw2\";\n\t            fails.push(ex);\n\t        }\n\t        if (!$('#accounts-create-user-name').val()) {\n\t            ex = new Error(_(\"No user name specified\"));\n\t            ex.target = '#accounts-create-user-name';\n\t            fails.push(ex);\n\t        }\n\t        if (!$('#accounts-create-real-name').val()) {\n\t            ex = new Error(_(\"No real name specified\"));\n\t            ex.target = '#accounts-create-real-name';\n\t            fails.push(ex);\n\t        }\n\t\n\t        /* The first check is immediately complete */\n\t        var dfd = $.Deferred();\n\t        if (fails.length)\n\t            dfd.reject(fails);\n\t        else\n\t            dfd.resolve();\n\t\n\t        var promise_password = password_quality(pw)\n\t            .fail(function(ex) {\n\t                ex.target = \"#accounts-create-pw2\";\n\t            })\n\t            .always(function(arg) {\n\t                var strength = this.state() == \"resolved\" ? arg : \"weak\";\n\t                var meter = $(\"#accounts-create-password-meter\")\n\t                    .removeClass(\"weak okay good excellent\");\n\t                if (pw)\n\t                    meter.addClass(strength);\n\t                var message = $(\"#accounts-create-password-meter-message\");\n\t                if (strength == \"excellent\") {\n\t                    message.text(_(\"Excellent password\"));\n\t                } else {\n\t                    message.text(\"\");\n\t                }\n\t            });\n\t\n\t        var promise_username = this.check_username()\n\t            .fail(function(ex) {\n\t                ex.target = \"#accounts-create-user-name\";\n\t            });\n\t\n\t        return cockpit.all(dfd, promise_password, promise_username);\n\t    },\n\t\n\t    cancel: function() {\n\t        $('#accounts-create-dialog').modal('hide');\n\t    },\n\t\n\t    create: function() {\n\t        var tasks = [\n\t            function create_user() {\n\t                var prog = [\"/usr/sbin/useradd\"];\n\t                if ($('#accounts-create-real-name').val()) {\n\t                    prog.push('-c');\n\t                    prog.push($('#accounts-create-real-name').val());\n\t                }\n\t                prog.push($('#accounts-create-user-name').val());\n\t                return cockpit.spawn(prog, { \"superuser\": \"require\", err: \"message\" });\n\t            }\n\t        ];\n\t\n\t        if ($('#accounts-create-locked').prop('checked')) {\n\t            tasks.push(function adjust_locked() {\n\t                return cockpit.spawn([\n\t                    \"/usr/sbin/usermod\",\n\t                    $('#accounts-create-user-name').val(),\n\t                    \"--lock\"\n\t                ], { superuser: \"require\", err: \"message\" });\n\t            });\n\t        }\n\t\n\t        tasks.push(function change_passwd() {\n\t            return passwd_change($('#accounts-create-user-name').val(), $('#accounts-create-pw1').val());\n\t        });\n\t\n\t        var promise = this.validate()\n\t            .fail(function(ex) {\n\t                $(\"#accounts-create-password-meter-message\").hide();\n\t                $(\"#accounts-create-dialog\").dialog(\"failure\", ex);\n\t            })\n\t            .done(function() {\n\t                promise = chain(tasks);\n\t                $(\"#accounts-create-dialog\").dialog(\"promise\", promise);\n\t            });\n\t\n\t        $(\"#accounts-create-dialog\").dialog(\"wait\", promise);\n\t    },\n\t\n\t    is_valid_char_username: function(c) {\n\t        return (c >= 'a' && c <= 'z') ||\n\t               (c >= 'A' && c <= 'Z') ||\n\t               (c >= '0' && c <= '9') ||\n\t               c == '.' || c == '_' || c == '-';\n\t    },\n\t\n\t    check_username: function() {\n\t        var dfd = $.Deferred();\n\t        var username = $('#accounts-create-user-name').val();\n\t\n\t        for (var i = 0; i < username.length; i++) {\n\t            if (! this.is_valid_char_username(username[i])) {\n\t                dfd.reject(new Error(\n\t                  _(\"The user name can only consist of letters from a-z, digits, dots, dashes and underscores.\")\n\t                ));\n\t                return dfd.promise();\n\t            }\n\t        }\n\t\n\t        for (var k = 0; k < PageAccountsCreate.accounts.length; k++) {\n\t            if (PageAccountsCreate.accounts[k]['name'] == username) {\n\t                dfd.reject(new Error(_(\"This user name already exists\")));\n\t                return dfd.promise();\n\t            }\n\t        }\n\t\n\t        dfd.resolve();\n\t        return dfd.promise();\n\t    },\n\t\n\t    suggest_username: function() {\n\t        var self = this;\n\t\n\t        function remove_diacritics(str) {\n\t            var translate_table = {\n\t               'a' :  '[]',\n\t               'ae':  '',\n\t               'c' :  '',\n\t               'd' :  '',\n\t               'e' :  '[]',\n\t               'i' :  '[]',\n\t               'l' :  '[]',\n\t               'n' :  '[]',\n\t               'o' :  '[]',\n\t               'oe':  '',\n\t               'r' :  '[]',\n\t               's' :  '',\n\t               't' :  '',\n\t               'u' :  '[]',\n\t               'y' :  '[]',\n\t               'z' :  '',\n\t            };\n\t            for (var i in translate_table)\n\t                str = str.replace(new RegExp(translate_table[i], 'g'), i);\n\t\n\t            for (var k = 0; k < str.length; ) {\n\t                if (! self.is_valid_char_username(str[k]))\n\t                    str = str.substr(0, k) + str.substr(k + 1);\n\t                else\n\t                   k++;\n\t            }\n\t\n\t            return str;\n\t        }\n\t\n\t        function make_username(realname) {\n\t            var result = \"\";\n\t            var name = realname.split(' ');\n\t\n\t            if (name.length === 1)\n\t                result = name[0].toLowerCase();\n\t            else if (name.length > 1)\n\t                result = name[0][0].toLowerCase() + name[name.length - 1].toLowerCase();\n\t\n\t            return remove_diacritics(result);\n\t        }\n\t\n\t        if (this.username_dirty)\n\t           return;\n\t\n\t        var username = make_username($('#accounts-create-real-name').val());\n\t        $('#accounts-create-user-name').val(username);\n\t    }\n\t\n\t};\n\t\n\tfunction PageAccountsCreate() {\n\t    this._init();\n\t}\n\t\n\tPageAccount.prototype = {\n\t    _init: function(user) {\n\t        this.id = \"account\";\n\t        this.section_id = \"accounts\";\n\t        this.roles = [];\n\t        this.role_template = $(\"#role-entry-tmpl\").html();\n\t        Mustache.parse(this.role_template);\n\t\n\t        this.keys_template = $(\"#authorized-keys-tmpl\").html();\n\t        Mustache.parse(this.keys_template);\n\t        this.authorized_keys = null;\n\t\n\t        this.user = user;\n\t    },\n\t\n\t    getTitle: function() {\n\t        return C_(\"page-title\", \"Accounts\");\n\t    },\n\t\n\t    show: function() {\n\t        var self = this;\n\t        $(\"#account\").toggle(!!self.account_id);\n\t        $(\"#account-failure\").toggle(!self.account_id);\n\t    },\n\t\n\t    setup: function() {\n\t        $('#account .breadcrumb a').on(\"click\", function() {\n\t            cockpit.location.go('/');\n\t        });\n\t\n\t        $('#account-real-name').on('change', $.proxy (this, \"change_real_name\"));\n\t        $('#account-real-name').on('keydown', $.proxy (this, \"real_name_edited\"));\n\t        $('#account-set-password').on('click', $.proxy (this, \"set_password\"));\n\t        $('#account-delete').on('click', $.proxy (this, \"delete_account\"));\n\t        $('#account-logout').on('click', $.proxy (this, \"logout_account\"));\n\t        $('#account-locked').on('change', $.proxy (this, \"change_locked\", true, null));\n\t        $('#add-authorized-key').on('click', $.proxy (this, \"add_key\"));\n\t        $('#add-authorized-key-dialog').on('hidden.bs.modal', function () {\n\t            $(\"#authorized-keys-text\").val(\"\");\n\t        });\n\t    },\n\t\n\t    setup_keys: function (user_name, home_dir) {\n\t        var self = this;\n\t        if (!self.authorized_keys) {\n\t            self.authorized_keys = authorized_keys.instance(user_name, home_dir);\n\t            $(self.authorized_keys).on(\"changed\", function () {\n\t                self.update();\n\t            });\n\t        }\n\t    },\n\t\n\t    remove_key: function (ev) {\n\t        if (!this.authorized_keys)\n\t            return;\n\t\n\t        var key = $(ev.target).data(\"raw\");\n\t        $(\".account-remove-key\").prop('disabled', true);\n\t        this.authorized_keys.remove_key(key)\n\t            .fail(show_unexpected_error)\n\t            .always(function () {\n\t                $(\".account-remove-key\").prop('disabled', false);\n\t            });\n\t    },\n\t\n\t    add_key: function () {\n\t        if (!this.authorized_keys) {\n\t            $(\"#add-authorized-key-dialog\").modal('hide');\n\t            return;\n\t        }\n\t\n\t        var key = $(\"#authorized-keys-text\").val();\n\t        var promise = this.authorized_keys.add_key(key);\n\t        $(\"#add-authorized-key-dialog\").dialog(\"promise\", promise);\n\t    },\n\t\n\t    get_user: function() {\n\t       var self = this;\n\t       function parse_user(content) {\n\t            var accounts = parse_passwd_content(content);\n\t\n\t            for (var i = 0; i < accounts.length; i++) {\n\t               if (accounts[i][\"name\"] !== self.account_id)\n\t                  continue;\n\t\n\t               self.account = accounts[i];\n\t               self.setup_keys(self.account.name, self.account.home);\n\t               self.update();\n\t            }\n\t        }\n\t\n\t        this.handle_passwd = cockpit.file('/etc/passwd');\n\t\n\t        this.handle_passwd.read()\n\t           .done(parse_user)\n\t           .fail(log_unexpected_error);\n\t\n\t        this.handle_passwd.watch(parse_user);\n\t    },\n\t\n\t    get_roles: function() {\n\t        var self = this;\n\t\n\t        var role_groups = {\n\t            \"wheel\":   _(\"Server Administrator\"),\n\t            \"sudo\":    _(\"Server Administrator\"),\n\t            \"docker\":  _(\"Container Administrator\")\n\t        };\n\t\n\t        function parse_groups(content) {\n\t            var groups = parse_group_content(content);\n\t            while (self.roles.length > 0)\n\t                self.roles.pop();\n\t            for (var i = 0; i < groups.length; i++) {\n\t                var name = groups[i][\"name\"];\n\t                if (role_groups[name]) {\n\t                    self.roles.push({\n\t                        name: name,\n\t                        desc: role_groups[name],\n\t                        id: groups[i][\"gid\"],\n\t                        member: is_user_in_group(self.account_id, groups[i]),\n\t                    });\n\t                }\n\t            }\n\t            $(self).triggerHandler(\"roles\");\n\t            self.update();\n\t        }\n\t\n\t        this.handle_groups = cockpit.file('/etc/group');\n\t\n\t        this.handle_groups.read()\n\t           .done(parse_groups)\n\t           .fail(log_unexpected_error);\n\t\n\t        this.handle_groups.watch(parse_groups);\n\t    },\n\t\n\t    get_last_login: function() {\n\t        var self = this;\n\t\n\t        function parse_last_login(data) {\n\t           data = data.split('\\n')[1]; // throw away header\n\t           if (data.length === 0) return null;\n\t           data =  data.split('   '); // get last column - separated by spaces\n\t\n\t           if (data[data.length - 1].indexOf('**Never logged in**') > -1)\n\t               return null;\n\t           else\n\t               return new Date(data[data.length - 1]);\n\t        }\n\t\n\t        cockpit.spawn([\"/usr/bin/lastlog\", \"-u\", self.account_id],\n\t                      { \"environ\": [\"LC_ALL=C\"] })\n\t           .done(function (data) {\n\t               self.lastLogin = parse_last_login(data);\n\t               self.update();\n\t           })\n\t           .fail(function() {\n\t               self.lastLogin = null;\n\t               self.update();\n\t           });\n\t    },\n\t\n\t    get_locked: function(update_display) {\n\t        update_display = typeof update_display !== 'undefined' ? update_display : true;\n\t        var dfd = $.Deferred();\n\t        var self = this;\n\t\n\t        function parse_locked(content) {\n\t            var status = content.split(\" \")[1];\n\t            // libuser uses \"LK\", shadow-utils use \"L\".\n\t            return status && (status == \"LK\" || status == \"L\");\n\t        }\n\t\n\t        cockpit.spawn([\"/usr/bin/passwd\", \"-S\", self.account_id],\n\t                      { \"environ\": [ \"LC_ALL=C\" ], \"superuser\": \"require\" })\n\t            .done(function(content) {\n\t                    self.locked = parse_locked(content);\n\t                    if (update_display)\n\t                        self.update();\n\t                    dfd.resolve(self.locked);\n\t                })\n\t            .fail(function(error) {\n\t                    dfd.reject(error);\n\t                });\n\t\n\t        return dfd.promise();\n\t    },\n\t\n\t    get_logged: function() {\n\t        var self = this;\n\t        if (!self.account_id) {\n\t            self.logged = false;\n\t            self.update();\n\t            return;\n\t        }\n\t\n\t        function parse_logged(content) {\n\t            self.logged = content.length > 0;\n\t            if (! self.logged)\n\t               self.get_last_login();\n\t            else\n\t               self.update();\n\t        }\n\t\n\t        cockpit.spawn([\"/usr/bin/w\", \"-sh\", self.account_id])\n\t           .done(parse_logged)\n\t           .fail(log_unexpected_error);\n\t    },\n\t\n\t    enter: function(account_id) {\n\t        this.account_id = account_id;\n\t\n\t        $(\"#account-real-name\").removeAttr(\"data-dirty\");\n\t\n\t        this.get_user();\n\t        this.get_roles();\n\t        this.get_locked();\n\t        this.get_logged();\n\t    },\n\t\n\t    leave: function() {\n\t        if (this.handle_passwd) {\n\t           this.handle_passwd.close();\n\t           this.handle_passwd = null;\n\t        }\n\t\n\t        if (this.handle_groups) {\n\t           this.handle_groups.close();\n\t           this.handle_groups = null;\n\t        }\n\t\n\t        if (this.authorized_keys) {\n\t           $(this.authorized_keys).off();\n\t           this.authorized_keys.close();\n\t           this.authorized_keys = null;\n\t        }\n\t\n\t        $('#account-failure').hide();\n\t    },\n\t\n\t    update: function() {\n\t\n\t        if (this.account) {\n\t            $('#account').show();\n\t            $('#account-failure').hide();\n\t            var name = $(\"#account-real-name\");\n\t\n\t            var title_name = this.account[\"gecos\"];\n\t            if (!title_name)\n\t                title_name = this.account[\"name\"];\n\t\n\t            $('#account-logout').attr('disabled', !this.logged);\n\t\n\t            $(\"#account-title\").text(title_name);\n\t            if (!name.attr(\"data-dirty\"))\n\t                $('#account-real-name').val(this.account[\"gecos\"]);\n\t\n\t            $('#account-user-name').text(this.account[\"name\"]);\n\t\n\t            if (this.logged)\n\t                $('#account-last-login').text(_(\"Logged In\"));\n\t            else if (! this.lastLogin)\n\t                $('#account-last-login').text(_(\"Never\"));\n\t            else\n\t                $('#account-last-login').text(this.lastLogin.toLocaleString());\n\t\n\t            if (typeof this.locked != 'undefined' && this.account[\"uid\"] !== 0) {\n\t                $('#account-locked').prop('checked', this.locked);\n\t                $('#account-locked').parents('tr').show();\n\t            } else {\n\t                $('#account-locked').parents('tr').hide();\n\t            }\n\t\n\t            if (this.authorized_keys) {\n\t                var keys = this.authorized_keys.keys;\n\t                var state = this.authorized_keys.state;\n\t                var keys_html = Mustache.render(this.keys_template, {\n\t                    \"keys\": keys,\n\t                    \"empty\": keys.length === 0 && state == \"ready\",\n\t                    \"denied\": state == \"access-denied\",\n\t                    \"failed\": state == \"failed\",\n\t                });\n\t                $('#account-authorized-keys-list').html(keys_html);\n\t                $(\".account-remove-key\")\n\t                    .on(\"click\", $.proxy (this, \"remove_key\"));\n\t                $('#account-authorized-keys').show();\n\t            } else {\n\t                $('#account-authorized-keys').hide();\n\t            }\n\t\n\t            if (this.account[\"uid\"] !== 0) {\n\t                var html = Mustache.render(this.role_template,\n\t                                           { \"roles\": this.roles});\n\t                $('#account-change-roles-roles').html(html);\n\t                $('#account-roles').parents('tr').show();\n\t                $(\"#account-change-roles-roles :input\")\n\t                    .on(\"change\", $.proxy (this, \"change_role\"));\n\t            } else {\n\t                $('#account-roles').parents('tr').hide();\n\t            }\n\t            $('#account .breadcrumb .active').text(title_name);\n\t\n\t            // check accounts-self-privileged whether account is the same as currently logged in user\n\t            $(\".accounts-self-privileged\").\n\t                toggleClass(\"accounts-current-account\",\n\t                            this.user.id == this.account[\"uid\"]);\n\t\n\t        } else {\n\t            $('#account').hide();\n\t            $('#account-failure').show();\n\t            $('#account-real-name').val(\"\");\n\t            $('#account-user-name').text(\"\");\n\t            $('#account-last-login').text(\"\");\n\t            $('#account-locked').prop('checked', false);\n\t            $('#account-roles').text(\"\");\n\t            $('#account .breadcrumb .active').text(\"?\");\n\t        }\n\t        update_accounts_privileged();\n\t    },\n\t\n\t    change_role: function(ev) {\n\t        var name = $(ev.target).data(\"name\");\n\t        var id = $(ev.target).data(\"gid\");\n\t        if (!name || !id || !this.account[\"name\"])\n\t            return;\n\t\n\t        if ($(ev.target).prop('checked')) {\n\t            cockpit.spawn([\"/usr/sbin/usermod\", this.account[\"name\"],\n\t                           \"-G\", id, \"-a\"], { \"superuser\": \"require\", err: \"message\" })\n\t               .fail(show_unexpected_error);\n\t        } else {\n\t            cockpit.spawn([\"/usr/bin/gpasswd\", \"-d\", this.account[\"name\"],\n\t                           name], { \"superuser\": \"require\", err: \"message\" })\n\t                   .fail(show_unexpected_error);\n\t        }\n\t    },\n\t\n\t    real_name_edited: function() {\n\t        $(\"#account-real-name\").attr(\"data-dirty\", \"true\");\n\t    },\n\t\n\t    check_role_for_self_mod: function () {\n\t        return (this.account[\"name\"] == this.user.name ||\n\t                permission.allowed !== false);\n\t    },\n\t\n\t    change_real_name: function() {\n\t        var self = this;\n\t\n\t        var name = $(\"#account-real-name\");\n\t        name.attr(\"data-dirty\", \"true\");\n\t\n\t        if (!self.check_role_for_self_mod ()) {\n\t            self.update ();\n\t            return;\n\t        }\n\t\n\t        // TODO: unwanted chars check\n\t        var value = name.val();\n\t\n\t        cockpit.spawn([\"/usr/sbin/usermod\", self.account[\"name\"], \"--comment\", value],\n\t                      { \"superuser\": \"try\", err: \"message\"})\n\t           .done(function(data) {\n\t               self.account[\"gecos\"] = value;\n\t               self.update();\n\t               name.removeAttr(\"data-dirty\");\n\t           })\n\t           .fail(show_unexpected_error);\n\t    },\n\t\n\t    change_locked: function(verify_status, desired_lock_state) {\n\t        desired_lock_state = desired_lock_state !== null ?\n\t            desired_lock_state : $('#account-locked').prop('checked');\n\t        var self = this;\n\t        cockpit.spawn([\"/usr/sbin/usermod\",\n\t                       this.account[\"name\"],\n\t                       desired_lock_state ? \"--lock\" : \"--unlock\"], { \"superuser\": \"require\", err: \"message\"})\n\t            .done(function() {\n\t                self.get_locked(false)\n\t                    .done(function(locked) {\n\t                        /* if we care about what the lock state should be and it doesn't match, try to change again\n\t                           this is a workaround for different ways of handling a locked account\n\t                           https://github.com/cockpit-project/cockpit/issues/1216\n\t                           https://bugzilla.redhat.com/show_bug.cgi?id=853153\n\t                           This seems to be fixed in fedora 23 (usermod catches the different locking behavior)\n\t                        */\n\t                        if (verify_status && desired_lock_state !== locked) {\n\t                            console.log(\"Account locked state doesn't match desired value, trying again.\");\n\t                            // only retry once to avoid uncontrolled recursion\n\t                            self.change_locked(false, desired_lock_state);\n\t                        } else {\n\t                            self.update();\n\t                        }\n\t                    });\n\t                })\n\t           .fail(show_unexpected_error);\n\t    },\n\t\n\t    set_password: function() {\n\t        if (!this.check_role_for_self_mod ())\n\t            return;\n\t\n\t        PageAccountSetPassword.user_name = this.account[\"name\"];\n\t        $('#account-set-password-dialog').modal('show');\n\t    },\n\t\n\t    delete_account: function() {\n\t        PageAccountConfirmDelete.user_name = this.account[\"name\"];\n\t        $('#account-confirm-delete-dialog').modal('show');\n\t    },\n\t\n\t    logout_account: function() {\n\t        cockpit.spawn([\"/usr/bin/loginctl\", \"terminate-user\", this.account[\"name\"]],\n\t                      { \"superuser\": \"try\", err: \"message\"})\n\t           .done($.proxy (this, \"get_logged\"))\n\t           .fail(show_unexpected_error);\n\t\n\t    },\n\t};\n\t\n\tfunction PageAccount(user) {\n\t    this._init(user);\n\t}\n\t\n\tvar crop_handle_width = 20;\n\t\n\tPageAccountConfirmDelete.prototype = {\n\t    _init: function() {\n\t        this.id = \"account-confirm-delete-dialog\";\n\t    },\n\t\n\t    show: function() {\n\t    },\n\t\n\t    setup: function() {\n\t        $('#account-confirm-delete-apply').on('click', $.proxy(this, \"apply\"));\n\t    },\n\t\n\t    enter: function() {\n\t        $('#account-confirm-delete-files').prop('checked', false);\n\t        $('#account-confirm-delete-title').text(cockpit.format(_(\"Delete $0\"), PageAccountConfirmDelete.user_name));\n\t    },\n\t\n\t    leave: function() {\n\t    },\n\t\n\t    apply: function() {\n\t        var prog = [\"/usr/sbin/userdel\"];\n\t\n\t        if ($('#account-confirm-delete-files').prop('checked'))\n\t            prog.push(\"-r\");\n\t\n\t        prog.push(PageAccountConfirmDelete.user_name);\n\t\n\t        cockpit.spawn(prog, { \"superuser\": \"require\", err: \"message\" })\n\t           .done(function () {\n\t              $('#account-confirm-delete-dialog').modal('hide');\n\t               cockpit.location.go(\"/\");\n\t           })\n\t           .fail(show_unexpected_error);\n\t    }\n\t};\n\t\n\tfunction PageAccountConfirmDelete() {\n\t    this._init();\n\t}\n\t\n\tPageAccountSetPassword.prototype = {\n\t    _init: function(user) {\n\t        this.id = \"account-set-password-dialog\";\n\t        this.user = user;\n\t    },\n\t\n\t    show: function() {\n\t        if (this.user.name !== PageAccountSetPassword.user_name) {\n\t            $('#account-set-password-old').parents('tr').toggle(false);\n\t            $('#account-set-password-pw1').focus();\n\t        } else {\n\t            $('#account-set-password-old').parents('tr').toggle(true);\n\t            $('#account-set-password-old').focus();\n\t        }\n\t    },\n\t\n\t    setup: function() {\n\t        $('#account-set-password-apply').on('click', $.proxy(this, \"apply\"));\n\t        $('#account-set-password-dialog .check-passwords').on('keydown change', $.proxy(this, \"validate\"));\n\t    },\n\t\n\t    enter: function() {\n\t        $('#account-set-password-old').val(\"\");\n\t        $('#account-set-password-pw1').val(\"\");\n\t        $('#account-set-password-pw2').val(\"\");\n\t        $('#account-set-password-meter').removeClass(\"weak okay good excellent\");\n\t        $(\"#account-set-password-dialog\").dialog(\"failure\", null);\n\t    },\n\t\n\t    leave: function() {\n\t    },\n\t\n\t    validate: function() {\n\t        var ex;\n\t        var pw = $('#account-set-password-pw1').val();\n\t        if ($('#account-set-password-pw2').val() != pw) {\n\t            ex = new Error(_(\"The passwords do not match\"));\n\t            ex.target = \"#account-set-password-pw2\";\n\t        }\n\t\n\t        var dfd = $.Deferred();\n\t        if (ex)\n\t            dfd.reject(ex);\n\t        else\n\t            dfd.resolve();\n\t\n\t        var promise = password_quality(pw)\n\t            .fail(function(ex) {\n\t                ex.target = \"#account-set-password-pw2\";\n\t            })\n\t            .always(function(arg) {\n\t                var strength = (this.state() == \"resolved\") ? arg : \"weak\";\n\t                var meter = $(\"#account-set-password-meter\")\n\t                    .removeClass(\"weak okay good excellent\");\n\t                if (pw)\n\t                    meter.addClass(strength);\n\t                var message = $(\"#account-set-password-meter-message\");\n\t                if (strength == \"excellent\") {\n\t                    message.text(_(\"Excellent password\"));\n\t                } else {\n\t                    message.text(\"\");\n\t                }\n\t            });\n\t\n\t        return cockpit.all(dfd, promise);\n\t    },\n\t\n\t    apply: function() {\n\t        var self = this;\n\t\n\t        var promise = this.validate()\n\t            .done(function() {\n\t                var user = PageAccountSetPassword.user_name;\n\t                var password = $('#account-set-password-pw1').val();\n\t\n\t                if (self.user.name === user)\n\t                    promise = passwd_self($('#account-set-password-old').val(), password);\n\t                else\n\t                    promise = passwd_change(user, password);\n\t\n\t                $(\"#account-set-password-dialog\").dialog(\"promise\", promise);\n\t            })\n\t            .fail(function(ex) {\n\t                $(\"#account-set-password-meter-message\").hide();\n\t                $(\"#account-set-password-dialog\").dialog(\"failure\", ex);\n\t            });\n\t        $(\"#account-set-password-dialog\").dialog(\"wait\", promise);\n\t    }\n\t};\n\t\n\tfunction PageAccountSetPassword(user) {\n\t    this._init(user);\n\t}\n\t\n\t/* INITIALIZATION AND NAVIGATION\n\t *\n\t * The code above still uses the legacy 'Page' abstraction for both\n\t * pages and dialogs, and expects page.setup, page.enter, page.show,\n\t * and page.leave to be called at the right times.\n\t *\n\t * We cater to this with a little compatability shim consisting of\n\t * 'dialog_setup', 'page_show', and 'page_hide'.\n\t */\n\t\n\tfunction show_error_dialog(title, message) {\n\t    if (message) {\n\t        $(\"#error-popup-title\").text(title);\n\t        $(\"#error-popup-message\").text(message);\n\t    } else {\n\t        $(\"#error-popup-title\").text(_(\"Error\"));\n\t        $(\"#error-popup-message\").text(title);\n\t    }\n\t\n\t    $('.modal[role=\"dialog\"]').modal('hide');\n\t    $('#error-popup').modal('show');\n\t}\n\t\n\tfunction show_unexpected_error(error) {\n\t    show_error_dialog(_(\"Unexpected error\"), error.message || error);\n\t}\n\t\n\tfunction dialog_setup(d) {\n\t    d.setup();\n\t    $('#' + d.id).\n\t        on('show.bs.modal', function () { d.enter(); }).\n\t        on('shown.bs.modal', function () { d.show(); }).\n\t        on('hidden.bs.modal', function () { d.leave(); });\n\t}\n\t\n\tfunction page_show(p, arg) {\n\t    if (p._entered_)\n\t        p.leave();\n\t    p.enter(arg);\n\t    p._entered_ = true;\n\t    $('#' + p.id).show();\n\t    p.show();\n\t}\n\t\n\tfunction page_hide(p) {\n\t    $('#' + p.id).hide();\n\t    if (p._entered_) {\n\t        p.leave();\n\t        p._entered_ = false;\n\t    }\n\t}\n\t\n\tfunction init() {\n\t    var overview_page;\n\t    var account_page;\n\t\n\t    cockpit.user().done(function (user) {\n\t        function navigate() {\n\t            var path = cockpit.location.path;\n\t\n\t            if (path.length === 0) {\n\t                page_hide(account_page);\n\t                page_show(overview_page);\n\t            } else if (path.length === 1) {\n\t                page_hide(overview_page);\n\t                page_show(account_page, path[0]);\n\t            } else { /* redirect */\n\t                console.warn(\"not a users location: \" + path);\n\t                cockpit.location = '';\n\t            }\n\t\n\t            $(\"body\").show();\n\t        }\n\t\n\t        cockpit.translate();\n\t\n\t        overview_page = new PageAccounts();\n\t        overview_page.setup();\n\t\n\t        account_page = new PageAccount(user);\n\t        account_page.setup();\n\t\n\t        dialog_setup(new PageAccountsCreate());\n\t        dialog_setup(new PageAccountConfirmDelete());\n\t        dialog_setup(new PageAccountSetPassword(user));\n\t\n\t        $(cockpit).on(\"locationchanged\", navigate);\n\t        navigate();\n\t    });\n\t}\n\t\n\t$(init);\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\tmodule.exports = jQuery;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\tmodule.exports = cockpit;\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;/*!\n\t * mustache.js - Logic-less {{mustache}} templates with JavaScript\n\t * http://github.com/janl/mustache.js\n\t */\n\t\n\t/*global define: false*/\n\t\n\t(function (root, factory) {\n\t  if (typeof exports === \"object\" && exports) {\n\t    factory(exports); // CommonJS\n\t  } else {\n\t    var mustache = {};\n\t    factory(mustache);\n\t    if (true) {\n\t      !(__WEBPACK_AMD_DEFINE_FACTORY__ = (mustache), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)); // AMD\n\t    } else {\n\t      root.Mustache = mustache; // <script>\n\t    }\n\t  }\n\t}(this, function (mustache) {\n\t\n\t  var whiteRe = /\\s*/;\n\t  var spaceRe = /\\s+/;\n\t  var nonSpaceRe = /\\S/;\n\t  var eqRe = /\\s*=/;\n\t  var curlyRe = /\\s*\\}/;\n\t  var tagRe = /#|\\^|\\/|>|\\{|&|=|!/;\n\t\n\t  // Workaround for https://issues.apache.org/jira/browse/COUCHDB-577\n\t  // See https://github.com/janl/mustache.js/issues/189\n\t  var RegExp_test = RegExp.prototype.test;\n\t  function testRegExp(re, string) {\n\t    return RegExp_test.call(re, string);\n\t  }\n\t\n\t  function isWhitespace(string) {\n\t    return !testRegExp(nonSpaceRe, string);\n\t  }\n\t\n\t  var Object_toString = Object.prototype.toString;\n\t  var isArray = Array.isArray || function (object) {\n\t    return Object_toString.call(object) === '[object Array]';\n\t  };\n\t\n\t  function isFunction(object) {\n\t    return typeof object === 'function';\n\t  }\n\t\n\t  function escapeRegExp(string) {\n\t    return string.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, \"\\\\$&\");\n\t  }\n\t\n\t  var entityMap = {\n\t    \"&\": \"&amp;\",\n\t    \"<\": \"&lt;\",\n\t    \">\": \"&gt;\",\n\t    '\"': '&quot;',\n\t    \"'\": '&#39;',\n\t    \"/\": '&#x2F;'\n\t  };\n\t\n\t  function escapeHtml(string) {\n\t    return String(string).replace(/[&<>\"'\\/]/g, function (s) {\n\t      return entityMap[s];\n\t    });\n\t  }\n\t\n\t  function escapeTags(tags) {\n\t    if (!isArray(tags) || tags.length !== 2) {\n\t      throw new Error('Invalid tags: ' + tags);\n\t    }\n\t\n\t    return [\n\t      new RegExp(escapeRegExp(tags[0]) + \"\\\\s*\"),\n\t      new RegExp(\"\\\\s*\" + escapeRegExp(tags[1]))\n\t    ];\n\t  }\n\t\n\t  /**\n\t   * Breaks up the given `template` string into a tree of tokens. If the `tags`\n\t   * argument is given here it must be an array with two string values: the\n\t   * opening and closing tags used in the template (e.g. [ \"<%\", \"%>\" ]). Of\n\t   * course, the default is to use mustaches (i.e. mustache.tags).\n\t   *\n\t   * A token is an array with at least 4 elements. The first element is the\n\t   * mustache symbol that was used inside the tag, e.g. \"#\" or \"&\". If the tag\n\t   * did not contain a symbol (i.e. {{myValue}}) this element is \"name\". For\n\t   * all template text that appears outside a symbol this element is \"text\".\n\t   *\n\t   * The second element of a token is its \"value\". For mustache tags this is\n\t   * whatever else was inside the tag besides the opening symbol. For text tokens\n\t   * this is the text itself.\n\t   *\n\t   * The third and fourth elements of the token are the start and end indices\n\t   * in the original template of the token, respectively.\n\t   *\n\t   * Tokens that are the root node of a subtree contain two more elements: an\n\t   * array of tokens in the subtree and the index in the original template at which\n\t   * the closing tag for that section begins.\n\t   */\n\t  function parseTemplate(template, tags) {\n\t    tags = tags || mustache.tags;\n\t    template = template || '';\n\t\n\t    if (typeof tags === 'string') {\n\t      tags = tags.split(spaceRe);\n\t    }\n\t\n\t    var tagRes = escapeTags(tags);\n\t    var scanner = new Scanner(template);\n\t\n\t    var sections = [];     // Stack to hold section tokens\n\t    var tokens = [];       // Buffer to hold the tokens\n\t    var spaces = [];       // Indices of whitespace tokens on the current line\n\t    var hasTag = false;    // Is there a {{tag}} on the current line?\n\t    var nonSpace = false;  // Is there a non-space char on the current line?\n\t\n\t    // Strips all whitespace tokens array for the current line\n\t    // if there was a {{#tag}} on it and otherwise only space.\n\t    function stripSpace() {\n\t      if (hasTag && !nonSpace) {\n\t        while (spaces.length) {\n\t          delete tokens[spaces.pop()];\n\t        }\n\t      } else {\n\t        spaces = [];\n\t      }\n\t\n\t      hasTag = false;\n\t      nonSpace = false;\n\t    }\n\t\n\t    var start, type, value, chr, token, openSection;\n\t    while (!scanner.eos()) {\n\t      start = scanner.pos;\n\t\n\t      // Match any text between tags.\n\t      value = scanner.scanUntil(tagRes[0]);\n\t      if (value) {\n\t        for (var i = 0, len = value.length; i < len; ++i) {\n\t          chr = value.charAt(i);\n\t\n\t          if (isWhitespace(chr)) {\n\t            spaces.push(tokens.length);\n\t          } else {\n\t            nonSpace = true;\n\t          }\n\t\n\t          tokens.push(['text', chr, start, start + 1]);\n\t          start += 1;\n\t\n\t          // Check for whitespace on the current line.\n\t          if (chr === '\\n') {\n\t            stripSpace();\n\t          }\n\t        }\n\t      }\n\t\n\t      // Match the opening tag.\n\t      if (!scanner.scan(tagRes[0])) break;\n\t      hasTag = true;\n\t\n\t      // Get the tag type.\n\t      type = scanner.scan(tagRe) || 'name';\n\t      scanner.scan(whiteRe);\n\t\n\t      // Get the tag value.\n\t      if (type === '=') {\n\t        value = scanner.scanUntil(eqRe);\n\t        scanner.scan(eqRe);\n\t        scanner.scanUntil(tagRes[1]);\n\t      } else if (type === '{') {\n\t        value = scanner.scanUntil(new RegExp('\\\\s*' + escapeRegExp('}' + tags[1])));\n\t        scanner.scan(curlyRe);\n\t        scanner.scanUntil(tagRes[1]);\n\t        type = '&';\n\t      } else {\n\t        value = scanner.scanUntil(tagRes[1]);\n\t      }\n\t\n\t      // Match the closing tag.\n\t      if (!scanner.scan(tagRes[1])) {\n\t        throw new Error('Unclosed tag at ' + scanner.pos);\n\t      }\n\t\n\t      token = [ type, value, start, scanner.pos ];\n\t      tokens.push(token);\n\t\n\t      if (type === '#' || type === '^') {\n\t        sections.push(token);\n\t      } else if (type === '/') {\n\t        // Check section nesting.\n\t        openSection = sections.pop();\n\t\n\t        if (!openSection) {\n\t          throw new Error('Unopened section \"' + value + '\" at ' + start);\n\t        }\n\t        if (openSection[1] !== value) {\n\t          throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + start);\n\t        }\n\t      } else if (type === 'name' || type === '{' || type === '&') {\n\t        nonSpace = true;\n\t      } else if (type === '=') {\n\t        // Set the tags for the next time around.\n\t        tagRes = escapeTags(tags = value.split(spaceRe));\n\t      }\n\t    }\n\t\n\t    // Make sure there are no open sections when we're done.\n\t    openSection = sections.pop();\n\t    if (openSection) {\n\t      throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + scanner.pos);\n\t    }\n\t\n\t    return nestTokens(squashTokens(tokens));\n\t  }\n\t\n\t  /**\n\t   * Combines the values of consecutive text tokens in the given `tokens` array\n\t   * to a single token.\n\t   */\n\t  function squashTokens(tokens) {\n\t    var squashedTokens = [];\n\t\n\t    var token, lastToken;\n\t    for (var i = 0, len = tokens.length; i < len; ++i) {\n\t      token = tokens[i];\n\t\n\t      if (token) {\n\t        if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {\n\t          lastToken[1] += token[1];\n\t          lastToken[3] = token[3];\n\t        } else {\n\t          squashedTokens.push(token);\n\t          lastToken = token;\n\t        }\n\t      }\n\t    }\n\t\n\t    return squashedTokens;\n\t  }\n\t\n\t  /**\n\t   * Forms the given array of `tokens` into a nested tree structure where\n\t   * tokens that represent a section have two additional items: 1) an array of\n\t   * all tokens that appear in that section and 2) the index in the original\n\t   * template that represents the end of that section.\n\t   */\n\t  function nestTokens(tokens) {\n\t    var nestedTokens = [];\n\t    var collector = nestedTokens;\n\t    var sections = [];\n\t\n\t    var token, section;\n\t    for (var i = 0, len = tokens.length; i < len; ++i) {\n\t      token = tokens[i];\n\t\n\t      switch (token[0]) {\n\t      case '#':\n\t      case '^':\n\t        collector.push(token);\n\t        sections.push(token);\n\t        collector = token[4] = [];\n\t        break;\n\t      case '/':\n\t        section = sections.pop();\n\t        section[5] = token[2];\n\t        collector = sections.length > 0 ? sections[sections.length - 1][4] : nestedTokens;\n\t        break;\n\t      default:\n\t        collector.push(token);\n\t      }\n\t    }\n\t\n\t    return nestedTokens;\n\t  }\n\t\n\t  /**\n\t   * A simple string scanner that is used by the template parser to find\n\t   * tokens in template strings.\n\t   */\n\t  function Scanner(string) {\n\t    this.string = string;\n\t    this.tail = string;\n\t    this.pos = 0;\n\t  }\n\t\n\t  /**\n\t   * Returns `true` if the tail is empty (end of string).\n\t   */\n\t  Scanner.prototype.eos = function () {\n\t    return this.tail === \"\";\n\t  };\n\t\n\t  /**\n\t   * Tries to match the given regular expression at the current position.\n\t   * Returns the matched text if it can match, the empty string otherwise.\n\t   */\n\t  Scanner.prototype.scan = function (re) {\n\t    var match = this.tail.match(re);\n\t\n\t    if (match && match.index === 0) {\n\t      var string = match[0];\n\t      this.tail = this.tail.substring(string.length);\n\t      this.pos += string.length;\n\t      return string;\n\t    }\n\t\n\t    return \"\";\n\t  };\n\t\n\t  /**\n\t   * Skips all text until the given regular expression can be matched. Returns\n\t   * the skipped string, which is the entire tail if no match can be made.\n\t   */\n\t  Scanner.prototype.scanUntil = function (re) {\n\t    var index = this.tail.search(re), match;\n\t\n\t    switch (index) {\n\t    case -1:\n\t      match = this.tail;\n\t      this.tail = \"\";\n\t      break;\n\t    case 0:\n\t      match = \"\";\n\t      break;\n\t    default:\n\t      match = this.tail.substring(0, index);\n\t      this.tail = this.tail.substring(index);\n\t    }\n\t\n\t    this.pos += match.length;\n\t\n\t    return match;\n\t  };\n\t\n\t  /**\n\t   * Represents a rendering context by wrapping a view object and\n\t   * maintaining a reference to the parent context.\n\t   */\n\t  function Context(view, parentContext) {\n\t    this.view = view == null ? {} : view;\n\t    this.cache = { '.': this.view };\n\t    this.parent = parentContext;\n\t  }\n\t\n\t  /**\n\t   * Creates a new context using the given view with this context\n\t   * as the parent.\n\t   */\n\t  Context.prototype.push = function (view) {\n\t    return new Context(view, this);\n\t  };\n\t\n\t  /**\n\t   * Returns the value of the given name in this context, traversing\n\t   * up the context hierarchy if the value is absent in this context's view.\n\t   */\n\t  Context.prototype.lookup = function (name) {\n\t    var value;\n\t    if (name in this.cache) {\n\t      value = this.cache[name];\n\t    } else {\n\t      var context = this;\n\t\n\t      while (context) {\n\t        if (name.indexOf('.') > 0) {\n\t          value = context.view;\n\t\n\t          var names = name.split('.'), i = 0;\n\t          while (value != null && i < names.length) {\n\t            value = value[names[i++]];\n\t          }\n\t        } else {\n\t          value = context.view[name];\n\t        }\n\t\n\t        if (value != null) break;\n\t\n\t        context = context.parent;\n\t      }\n\t\n\t      this.cache[name] = value;\n\t    }\n\t\n\t    if (isFunction(value)) {\n\t      value = value.call(this.view);\n\t    }\n\t\n\t    return value;\n\t  };\n\t\n\t  /**\n\t   * A Writer knows how to take a stream of tokens and render them to a\n\t   * string, given a context. It also maintains a cache of templates to\n\t   * avoid the need to parse the same template twice.\n\t   */\n\t  function Writer() {\n\t    this.cache = {};\n\t  }\n\t\n\t  /**\n\t   * Clears all cached templates in this writer.\n\t   */\n\t  Writer.prototype.clearCache = function () {\n\t    this.cache = {};\n\t  };\n\t\n\t  /**\n\t   * Parses and caches the given `template` and returns the array of tokens\n\t   * that is generated from the parse.\n\t   */\n\t  Writer.prototype.parse = function (template, tags) {\n\t    var cache = this.cache;\n\t    var tokens = cache[template];\n\t\n\t    if (tokens == null) {\n\t      tokens = cache[template] = parseTemplate(template, tags);\n\t    }\n\t\n\t    return tokens;\n\t  };\n\t\n\t  /**\n\t   * High-level method that is used to render the given `template` with\n\t   * the given `view`.\n\t   *\n\t   * The optional `partials` argument may be an object that contains the\n\t   * names and templates of partials that are used in the template. It may\n\t   * also be a function that is used to load partial templates on the fly\n\t   * that takes a single argument: the name of the partial.\n\t   */\n\t  Writer.prototype.render = function (template, view, partials) {\n\t    var tokens = this.parse(template);\n\t    var context = (view instanceof Context) ? view : new Context(view);\n\t    return this.renderTokens(tokens, context, partials, template);\n\t  };\n\t\n\t  /**\n\t   * Low-level method that renders the given array of `tokens` using\n\t   * the given `context` and `partials`.\n\t   *\n\t   * Note: The `originalTemplate` is only ever used to extract the portion\n\t   * of the original template that was contained in a higher-order section.\n\t   * If the template doesn't use higher-order sections, this argument may\n\t   * be omitted.\n\t   */\n\t  Writer.prototype.renderTokens = function (tokens, context, partials, originalTemplate) {\n\t    var buffer = '';\n\t\n\t    // This function is used to render an arbitrary template\n\t    // in the current context by higher-order sections.\n\t    var self = this;\n\t    function subRender(template) {\n\t      return self.render(template, context, partials);\n\t    }\n\t\n\t    var token, value;\n\t    for (var i = 0, len = tokens.length; i < len; ++i) {\n\t      token = tokens[i];\n\t\n\t      switch (token[0]) {\n\t      case '#':\n\t        value = context.lookup(token[1]);\n\t        if (!value) continue;\n\t\n\t        if (isArray(value)) {\n\t          for (var j = 0, jlen = value.length; j < jlen; ++j) {\n\t            buffer += this.renderTokens(token[4], context.push(value[j]), partials, originalTemplate);\n\t          }\n\t        } else if (typeof value === 'object' || typeof value === 'string') {\n\t          buffer += this.renderTokens(token[4], context.push(value), partials, originalTemplate);\n\t        } else if (isFunction(value)) {\n\t          if (typeof originalTemplate !== 'string') {\n\t            throw new Error('Cannot use higher-order sections without the original template');\n\t          }\n\t\n\t          // Extract the portion of the original template that the section contains.\n\t          value = value.call(context.view, originalTemplate.slice(token[3], token[5]), subRender);\n\t\n\t          if (value != null) buffer += value;\n\t        } else {\n\t          buffer += this.renderTokens(token[4], context, partials, originalTemplate);\n\t        }\n\t\n\t        break;\n\t      case '^':\n\t        value = context.lookup(token[1]);\n\t\n\t        // Use JavaScript's definition of falsy. Include empty arrays.\n\t        // See https://github.com/janl/mustache.js/issues/186\n\t        if (!value || (isArray(value) && value.length === 0)) {\n\t          buffer += this.renderTokens(token[4], context, partials, originalTemplate);\n\t        }\n\t\n\t        break;\n\t      case '>':\n\t        if (!partials) continue;\n\t        value = isFunction(partials) ? partials(token[1]) : partials[token[1]];\n\t        if (value != null) buffer += this.renderTokens(this.parse(value), context, partials, value);\n\t        break;\n\t      case '&':\n\t        value = context.lookup(token[1]);\n\t        if (value != null) buffer += value;\n\t        break;\n\t      case 'name':\n\t        value = context.lookup(token[1]);\n\t        if (value != null) buffer += mustache.escape(value);\n\t        break;\n\t      case 'text':\n\t        buffer += token[1];\n\t        break;\n\t      }\n\t    }\n\t\n\t    return buffer;\n\t  };\n\t\n\t  mustache.name = \"mustache.js\";\n\t  mustache.version = \"0.8.1\";\n\t  mustache.tags = [ \"{{\", \"}}\" ];\n\t\n\t  // All high-level mustache.* functions use this writer.\n\t  var defaultWriter = new Writer();\n\t\n\t  /**\n\t   * Clears all cached templates in the default writer.\n\t   */\n\t  mustache.clearCache = function () {\n\t    return defaultWriter.clearCache();\n\t  };\n\t\n\t  /**\n\t   * Parses and caches the given template in the default writer and returns the\n\t   * array of tokens it contains. Doing this ahead of time avoids the need to\n\t   * parse templates on the fly as they are rendered.\n\t   */\n\t  mustache.parse = function (template, tags) {\n\t    return defaultWriter.parse(template, tags);\n\t  };\n\t\n\t  /**\n\t   * Renders the `template` with the given `view` and `partials` using the\n\t   * default writer.\n\t   */\n\t  mustache.render = function (template, view, partials) {\n\t    return defaultWriter.render(template, view, partials);\n\t  };\n\t\n\t  // This is here for backwards compatibility with 0.4.x.\n\t  mustache.to_html = function (template, view, partials, send) {\n\t    var result = mustache.render(template, view, partials);\n\t\n\t    if (isFunction(send)) {\n\t      send(result);\n\t    } else {\n\t      return result;\n\t    }\n\t  };\n\t\n\t  // Export the escaping function so that the user may override it.\n\t  // See https://github.com/janl/mustache.js/issues/244\n\t  mustache.escape = escapeHtml;\n\t\n\t  // Export these mainly for testing, but also for advanced usage.\n\t  mustache.Scanner = Scanner;\n\t  mustache.Context = Context;\n\t  mustache.Writer = Writer;\n\t\n\t}));\n\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\t(function() {\n\t    var $ = __webpack_require__(2);\n\t    var cockpit = __webpack_require__(3);\n\t\n\t    var lister = __webpack_require__(6);\n\t    var adder = __webpack_require__(7);\n\t\n\t    var _ = cockpit.gettext;\n\t\n\t    function AuthorizedKeys (user_name, home_dir) {\n\t        var self = this;\n\t        var dir = home_dir + \"/.ssh\";\n\t        var filename = dir + \"/authorized_keys\";\n\t        var file = null;\n\t        var watch = null;\n\t        var last_tag = null;\n\t\n\t        self.keys = [];\n\t        self.state = \"loading\";\n\t\n\t        function process_failure (ex) {\n\t            self.keys = [];\n\t            if (ex.problem == \"access-denied\") {\n\t                self.state = ex.problem;\n\t            } else if (ex.problem == \"not-found\") {\n\t                self.state = \"ready\";\n\t            } else {\n\t                self.state = \"failed\";\n\t                console.warn(\"Error proccessing authentication keys: \"+ ex);\n\t            }\n\t            $(self).triggerHandler(\"changed\");\n\t        }\n\t\n\t        function update_keys(keys, tag) {\n\t            if (tag !== last_tag)\n\t                return;\n\t\n\t            self.keys = keys;\n\t            self.state = \"ready\";\n\t            $(self).triggerHandler(\"changed\");\n\t        }\n\t\n\t        /*\n\t         * Splits up a strings like:\n\t         *\n\t         * 2048 SHA256:AAAAB3NzaC1yc2EAAAADAQ Comment Here (RSA)\n\t         * 2048 SHA256:AAAAB3NzaC1yc2EAAAADAQ (RSA)\n\t         */\n\t        var PUBKEY_RE = /^(\\S+)\\s+(\\S+)\\s+(.*)\\((\\S+)\\)$/;\n\t\n\t        function parse_pubkeys(input) {\n\t            var df = $.Deferred();\n\t            var keys = [];\n\t\n\t            cockpit.script(lister)\n\t                .input(input + \"\\n\")\n\t                .done(function(output) {\n\t                    var match, obj, i, line, lines = output.split(\"\\n\");\n\t                    for (i = 0; i + 1 < lines.length; i += 2) {\n\t                        line = lines[i];\n\t                        obj = { raw: lines[i + 1] };\n\t                        keys.push(obj);\n\t                        match = lines[i].trim().match(PUBKEY_RE);\n\t                        obj.valid = !!match && !!obj.raw;\n\t                        if (match) {\n\t                            obj.size = match[1];\n\t                            obj.fp = match[2];\n\t                            obj.comment = match[3].trim();\n\t                            if (obj.comment == \"authorized_keys\" || obj.comment == \"no comment\")\n\t                                obj.comment = null;\n\t                            obj.algorithm = match[4];\n\t\n\t                            /* Old ssh-keygen versions need us to find the comment ourselves */\n\t                            if (!obj.comment && obj.raw)\n\t                                obj.comment = obj.raw.split(\" \").splice(0, 2).join(\" \") || null;\n\t                        }\n\t                    }\n\t                })\n\t                .always(function() {\n\t                    df.resolve(keys);\n\t                });\n\t\n\t            return df.promise();\n\t        }\n\t\n\t        function parse_keys(content, tag, ex) {\n\t            last_tag = tag;\n\t\n\t            if (ex)\n\t                return process_failure(ex);\n\t\n\t            if (!content)\n\t                return update_keys([ ], tag);\n\t\n\t            parse_pubkeys(content)\n\t                .done(function(keys) {\n\t                    update_keys(keys, tag);\n\t                });\n\t        }\n\t\n\t        self.add_key = function(key) {\n\t            var df = $.Deferred();\n\t            df.notify(_(\"Validating key\"));\n\t            parse_pubkeys(key)\n\t                .done(function(keys) {\n\t                    var obj = keys[0];\n\t                    if (obj && obj.valid) {\n\t                        df.notify(_(\"Adding key\"));\n\t                        cockpit.script(adder, [ user_name, home_dir ], { superuser: \"try\", err: \"message\" })\n\t                            .input(obj.raw + \"\\n\")\n\t                            .done(function() {\n\t                                df.resolve();\n\t                            })\n\t                            .fail(function(ex) {\n\t                                df.reject(_(\"Error saving authorized keys: \") + ex);\n\t                            });\n\t                    } else {\n\t                        df.reject(_(\"The key you provided was not valid.\"));\n\t                    }\n\t                });\n\t\n\t            return df.promise();\n\t        };\n\t\n\t        self.remove_key = function(key) {\n\t            return file.modify(function(content) {\n\t                var i;\n\t                var lines = null;\n\t                var new_lines = [];\n\t\n\t                if (!content)\n\t                    return \"\";\n\t\n\t                new_lines = [];\n\t                lines = content.trim().split('\\n');\n\t                for (i = 0; i < lines.length; i++) {\n\t                    if (lines[i] === key)\n\t                        key = undefined;\n\t                    else\n\t                        new_lines.push(lines[i]);\n\t                }\n\t                return new_lines.join(\"\\n\");\n\t            });\n\t        };\n\t\n\t        self.close = function() {\n\t            if (watch)\n\t                watch.remove();\n\t\n\t            if (file)\n\t                file.close();\n\t        };\n\t\n\t        file = cockpit.file(filename, {'superuser': 'try'});\n\t        watch = file.watch(parse_keys);\n\t    }\n\t\n\t    module.exports = {\n\t        instance: function instance(user_name, home_dir) {\n\t            return new AuthorizedKeys(user_name, home_dir);\n\t        }\n\t    };\n\t}());\n\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \"#!/bin/sh\\n\\ndir=$(mktemp -d)\\ncd \\\"$dir\\\"\\n\\nprocess()\\n{\\n    if [ -z \\\"$1\\\" ]; then\\n        return\\n    fi\\n    case \\\"$1\\\" in\\n    \\\\#*)\\n        ;;\\n    *)\\n        echo \\\"$1\\\"> authorized_keys\\n        echo \\\"$(LC_ALL=C ssh-keygen -l -f authorized_keys)\\\"\\n        echo \\\"$1\\\"\\n        ;;\\n    esac\\n}\\n\\nsed -e '$a\\\\' | while read -r line; do\\n    process \\\"$line\\\"\\ndone\\n\\nrm -f \\\"$dir/authorized_keys\\\"\\nrmdir \\\"$dir\\\"\\n\"\n\n/***/ },\n/* 7 */\n/***/ function(module, exports) {\n\n\tmodule.exports = \"#!/bin/sh\\n\\nset -euf\\nmkdir -p \\\"$2/.ssh\\\"\\ncd \\\"$2/.ssh\\\"\\n\\nchown $1 .\\n\\ntouch authorized_keys 2> /dev/null || true\\nchown $1 authorized_keys 2> /dev/null || true\\n\\nsed -i -e '$a\\\\' authorized_keys\\ncat >> authorized_keys\\n\\nchown $1 authorized_keys 2> /dev/null || true\\nchmod 600 authorized_keys\\n\"\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\t(function() {\n\t    \"use strict\";\n\t\n\t    var $ = __webpack_require__(2);\n\t    var cockpit = __webpack_require__(3);\n\t\n\t    var unique_number = 0;\n\t    function unique() {\n\t        unique_number += 1;\n\t        return \"unique\" + -(new Date()) + -unique_number;\n\t    }\n\t\n\t    /* Dialog Patterns */\n\t\n\t    function clear_errors(sel) {\n\t        sel.find(\".dialog-error\").remove();\n\t        sel.find(\".has-error\").removeClass(\"has-error\");\n\t        sel.find(\".dialog-wrapper\").off(\".dialog-error\");\n\t        sel.off(\".dialog-error\");\n\t    }\n\t\n\t    function field_error(target, error) {\n\t        var wrapper = target.parent();\n\t        var next, refresh;\n\t\n\t        if (!wrapper.is(\".dialog-wrapper\")) {\n\t            wrapper = $(\"<div class='dialog-wrapper'>\").insertBefore(target);\n\t\n\t            /*\n\t             * Some bootstrap plugins replace html controls with their own\n\t             * stuff, so we have to account for that here.\n\t             */\n\t\n\t            next = target.next();\n\t            if (next.is(\".bootstrap-select\") && next.selectpicker) {\n\t                next.remove();\n\t                refresh = next.selectpicker;\n\t            }\n\t\n\t            target.remove().appendTo(wrapper);\n\t\n\t            if (refresh)\n\t                refresh.call(target);\n\t        }\n\t\n\t        var message;\n\t        if (error.message)\n\t            message = $(\"<div class='dialog-error help-block'>\").text(error.message);\n\t        wrapper.addClass(\"has-error\").append(message);\n\t\n\t        if (!wrapper.hasClass(\"error-keep\")) {\n\t            wrapper.on(\"keypress.dialog-error change.dialog-error\", function() {\n\t                wrapper.removeClass(\"has-error\")\n\t                    .find(\".dialog-error.help-block\").css(\"visibility\", \"hidden\");\n\t            });\n\t        }\n\t    }\n\t\n\t    function global_error(sel, error) {\n\t        var alert = $(\"<div class='alert alert-danger dialog-error'>\");\n\t        var text = error.message || error.toString();\n\t        alert.text(text);\n\t        $(\"<span class='fa fa-exclamation-triangle'>\").prependTo(alert);\n\t\n\t        /* Always log global dialog errors for easier debugging */\n\t        console.warn(text);\n\t\n\t        var footer = sel.find(\".modal-footer\");\n\t        if (footer.length)\n\t            alert.prependTo(footer);\n\t        else\n\t            alert.appendTo(sel);\n\t    }\n\t\n\t    function display_errors(sel, errors) {\n\t        clear_errors(sel);\n\t\n\t        /* The list of errors can also be passed as an array */\n\t        if (errors.length == 1 && $.isArray(errors[0]))\n\t            errors = errors[0];\n\t\n\t        var any = false;\n\t        errors.forEach(function(error) {\n\t            var target;\n\t            if (error) {\n\t                target = sel.find(error.target);\n\t\n\t                /* Errors for a specific field added below that field */\n\t                if (target && target.length)\n\t                    field_error(target, error);\n\t                else\n\t                    global_error(sel, error);\n\t\n\t                any = true;\n\t            }\n\t        });\n\t\n\t        if (!any)\n\t            return;\n\t\n\t        /* When dialog is shown again, remove all mods */\n\t        sel.on(\"show.bs.modal.dialog-error\", function() {\n\t            clear_errors(sel);\n\t        });\n\t    }\n\t\n\t    function DialogWait(promise, handle) {\n\t        this.promise = promise;\n\t        this.disabled = [];\n\t        this.handle = handle;\n\t    }\n\t\n\t    function clear_wait(sel) {\n\t        var data = sel.data(\"dialog-wait\");\n\t        sel.data(\"dialog-wait\", null);\n\t\n\t        sel.find(\".dialog-wait-ct\").remove();\n\t        sel.find(\".btn\").off(\".dialog-wait\");\n\t        sel.off(\".dialog-wait\");\n\t\n\t        if (data) {\n\t            data.disabled.forEach(function(ctl) {\n\t                ctl.removeAttr(\"disabled\");\n\t            });\n\t        }\n\t    }\n\t\n\t    function display_wait(sel, promise, handle) {\n\t        clear_wait(sel);\n\t\n\t        if (!promise) {\n\t            if (handle)\n\t                sel.modal(\"hide\");\n\t            return sel;\n\t        }\n\t\n\t        /* Clear all errors in the dialog */\n\t        if (handle)\n\t            display_errors(sel, []);\n\t\n\t        var wait = $(\"<div class='dialog-wait-ct pull-left'>\");\n\t        $(\"<div class='spinner spinner-sm'>\").appendTo(wait);\n\t        var message = $(\"<span>\").appendTo(wait);\n\t\n\t        sel.find(\".modal-footer button\").first().before(wait);\n\t\n\t        var data = new DialogWait(promise, handle);\n\t        sel.data(\"dialog-wait\", data);\n\t\n\t        var cancellation = promise.cancel || promise.close;\n\t        var cancelled = false;\n\t\n\t        /* Disable everything and stash previous disabled state */\n\t        var controls = sel.find(\".form-control\").add(\".btn\", sel);\n\t        if (cancellation)\n\t            controls = controls.not(\"[data-dismiss]\").not(\".btn-cancel\");\n\t        controls.each(function() {\n\t            var ctl = $(this);\n\t            if (!ctl.attr(\"disabled\")) {\n\t                data.disabled.push(ctl);\n\t                ctl.attr(\"disabled\", \"disabled\");\n\t            }\n\t        });\n\t\n\t        sel.find(\".btn[data-dismiss], .btn-cancel\").on(\"click.dialog-wait\", function() {\n\t            cancelled = true;\n\t            if (cancellation)\n\t                cancellation.apply(promise);\n\t            return false;\n\t        });\n\t\n\t        /* When dialog is shown again, remove all mods */\n\t        sel.on(\"hide.bs.modal.dialog-wait\", function() {\n\t            clear_wait(sel);\n\t        });\n\t\n\t        /*\n\t         * There is no way to remove a callback from a promise\n\t         * so we have to be careful to only react if still\n\t         * processing the same promise.\n\t         */\n\t        function restore() {\n\t            var state, data = sel.data(\"dialog-wait\");\n\t            if (data && data.promise === promise) {\n\t                clear_wait(sel);\n\t                state = promise.state();\n\t                if (cancelled || (state == \"resolved\" && data.handle))\n\t                    sel.modal('hide');\n\t                else if (state == \"rejected\" && data.handle)\n\t                    display_errors(sel, [ arguments[0] ]);\n\t            }\n\t        }\n\t\n\t        function update(arg) {\n\t            var data = sel.data(\"dialog-wait\");\n\t            if (data && data.promise === promise) {\n\t                if (typeof arg !== \"string\")\n\t                    arg = \"\";\n\t                message.text(arg);\n\t            }\n\t        }\n\t\n\t        promise\n\t            .always(restore)\n\t            .progress(update);\n\t\n\t        return sel;\n\t    }\n\t\n\t    $.fn.dialog = function dialog(action /* ... */) {\n\t        if (action === \"failure\")\n\t            return display_errors(this, Array.prototype.slice.call(arguments, 1));\n\t        else if (action === \"wait\")\n\t            return display_wait(this, arguments[1]);\n\t        else if (action === \"promise\")\n\t            return display_wait(this, arguments[1], true);\n\t        else\n\t            console.warn(\"unknown dialog action: \" + action);\n\t    };\n\t\n\t    window.addEventListener(\"hashchange\", function() {\n\t        $(\".modal\").modal(\"hide\");\n\t    });\n\t\n\t    /*\n\t     * OnOff switch pattern\n\t     */\n\t\n\t    function onoff_refresh(sel) {\n\t        /* During testing, no Cockpit dependency */\n\t        var _ = cockpit.gettext || function(x) { return x; };\n\t\n\t        sel = sel.find(\".btn-onoff-ct\").andSelf().filter(\".btn-onoff-ct\");\n\t        sel.each(function(x, el) {\n\t            var self = $(el)\n\t                .attr(\"data-toggle\", \"buttons\")\n\t                .addClass(\"btn-group\");\n\t            var value = self.onoff(\"value\");\n\t            var buttons = self.find(\".btn\");\n\t            var name = self.find(\"input\").first().attr(\"name\") || unique();\n\t            var i, input, text;\n\t            for (i = buttons.length; i < 2; i++) {\n\t                input = $('<input type=\"radio\" autocomplete=\"off\">');\n\t                text = document.createTextNode(i === 0 ? _(\"On\") : _(\"Off\"));\n\t                self.append($('<label class=\"btn\">').append(input, text));\n\t                buttons = null;\n\t            }\n\t            buttons = buttons || self.find(\".btn\");\n\t            buttons.find(\"input\").attr(\"name\", name);\n\t            onoff_change(self, !!value);\n\t        });\n\t        return sel;\n\t    }\n\t\n\t    function onoff_value(sel) {\n\t        return sel.find(\".btn\").first().hasClass(\"active\");\n\t    }\n\t\n\t    function onoff_change(sel, value) {\n\t        return sel.each(function(i, el) {\n\t            var buttons = $(el).find(\".btn\");\n\t            buttons.first().toggleClass(\"active\", !!value).find(\"input\").prop(\"checked\", !!value);\n\t            buttons.last().toggleClass(\"active\", !value).find(\"input\").prop(\"checked\", !value);\n\t        });\n\t    }\n\t\n\t    $.fn.onoff = function onoff(action /* ... */) {\n\t        if (arguments.length === 0 || action == \"refresh\") {\n\t            return onoff_refresh(this);\n\t        } else if (action === \"value\") {\n\t            if (arguments.length === 1)\n\t                return onoff_value(this);\n\t            else\n\t                return onoff_change(this, arguments[1]);\n\t        } else if (action == \"disabled\") {\n\t            return this.find(\".btn\").toggleClass(\"disabled\", arguments[1]);\n\t        } else {\n\t            console.warn(\"unknown switch action: \" + action);\n\t        }\n\t    };\n\t\n\t    /* ----------------------------------------------------------------------------\n\t     * Sliders\n\t     *\n\t     * <div class=\"slider\" value=\"0.5\">\n\t     *    <div class=\"slider-bar\">\n\t     *        <div class=\"slider-thumb\"></div>\n\t     *    </div>\n\t     *    <div class=\"slider-bar\">\n\t     *        <!-- optional left overs -->\n\t     *    </div>\n\t     * </div>\n\t     *\n\t     * A slider control. The first div.slider-bar is the one that is resized.\n\t     * The value will be bounded between 0 and 1 as a floating point number.\n\t     *\n\t     * The following div.slider-bar if present is resized to fill the remainder\n\t     * of the slider if not given a specific size. You can put more div.slider-bar\n\t     * inside it to reflect squashing other prevous allocations.\n\t     *\n\t     * If the following div.slider-bar have a width specified, then the\n\t     * slider supports the concept of overflowing. If the slider overflows\n\t     * it will get the .slider-warning class and go a bit red.\n\t     *\n\t     * On document creation any div.slider are automatically turned into\n\t     * Bar graphs.\n\t     *\n\t     * Slider has the following extra read/write properties:\n\t     *\n\t     * .value: the floating point value the slider is set to.\n\t     * .disabled: whether to display slider as disabled and refuse interacton.\n\t     *\n\t     * Slider has this event:\n\t     *\n\t     * on('change'): fired when the slider changes, passes value as additional arg.\n\t     */\n\t\n\t    function resize_flex(slider, flex, total, part) {\n\t        var value = 0;\n\t        if (part > total)\n\t            value = 1;\n\t        else if (part < 0 || isNaN(part))\n\t            value = 0;\n\t        else if (!isNaN(total) && total > 0 && part >= 0)\n\t            value = (part / total);\n\t        $(flex).css('width', (value * 100) + \"%\").\n\t            next(\"div\").css('margin-left', $(flex).css('width'));\n\t\n\t        /* Set the property and the attribute */\n\t        slider.value = value;\n\t    }\n\t\n\t    function update_value(slider) {\n\t        resize_flex(slider, $(slider).children(\"div.slider-bar\").first()[0], 1, slider.value);\n\t    }\n\t\n\t    function check_overflow(slider) {\n\t        $(slider).toggleClass(\"slider-warning\",\n\t                              slider.offsetWidth < slider.scrollWidth);\n\t    }\n\t\n\t    function setup_slider(slider) {\n\t        $(slider).attr('unselectable', 'on');\n\t\n\t        Object.defineProperty(slider, \"value\", {\n\t            get: function() {\n\t                return parseFloat(this.getAttribute(\"value\"));\n\t            },\n\t            set: function(v) {\n\t                var s = String(v);\n\t                if (s != this.getAttribute(\"value\"))\n\t                    this.setAttribute(\"value\", v);\n\t            }\n\t        });\n\t\n\t        Object.defineProperty(slider, \"disabled\", {\n\t            get: function() {\n\t                if (!this.hasAttribute(\"disabled\"))\n\t                    return false;\n\t                return this.getAttribute(\"disabled\").toLowerCase() != \"false\";\n\t            },\n\t            set: function(v) {\n\t                this.setAttribute(\"disabled\", v ? \"true\" : \"false\");\n\t            }\n\t        });\n\t\n\t        update_value(slider);\n\t        check_overflow(slider);\n\t\n\t        $(slider).on(\"change\", function() {\n\t            update_value(slider);\n\t            $(slider).toggleClass(\"slider-disabled\", slider.disabled);\n\t        });\n\t\n\t        if (slider.disabled)\n\t            $(slider).addClass(\"slider-disabled\");\n\t\n\t        $(slider).on(\"mousedown\", function(ev) {\n\t            if (slider.disabled)\n\t                return true; /* default action */\n\t            var flex;\n\t            var offset = $(slider).offset().left;\n\t            if ($(ev.target).hasClass(\"slider-thumb\")) {\n\t                var hitx  = (ev.offsetX || ev.clientX - $(ev.target).offset().left);\n\t                offset += (hitx - $(ev.target).outerWidth() / 2);\n\t                flex = $(ev.target).parent()[0];\n\t            } else {\n\t                flex = $(slider).children(\"div.slider-bar\").first()[0];\n\t                resize_flex(slider, flex, $(slider).width(), (ev.pageX - offset));\n\t                $(slider).trigger(\"change\", [slider.value]);\n\t                check_overflow(slider);\n\t            }\n\t\n\t            $(document).\n\t                on(\"mousemove.slider\", function(ev) {\n\t                    resize_flex(slider, flex, $(slider).width(), (ev.pageX - offset));\n\t                    $(slider).trigger(\"change\", [slider.value]);\n\t                    check_overflow(slider);\n\t                    return false;\n\t                }).\n\t                on(\"mouseup.slider\", function(ev) {\n\t                    $(document).\n\t                        off(\"mousemove.slider\").\n\t                        off(\"mouseup.slider\");\n\t                    return false;\n\t                });\n\t            return false; /* no default action */\n\t        });\n\t    }\n\t\n\t    function setup_sliders() {\n\t        $(\"div.slider\").each(function() {\n\t            setup_slider(this);\n\t        });\n\t    }\n\t\n\t    $.fn.slider = function Slider(action) {\n\t        var sel = this;\n\t        var div;\n\t        if (arguments.length === 0 || action == \"refresh\") {\n\t            sel.each(function() {\n\t                setup_slider(this);\n\t            });\n\t            return sel;\n\t        } else {\n\t            console.warn(\"unknown slider action: \" + action);\n\t        }\n\t    };\n\t\n\t    $(document).ready(setup_sliders);\n\t\n\t    /* -----------------------------------------------------------------------------\n\t     * Privileged UI actions.\n\t     */\n\t\n\t    // placement is optional, \"top\", \"left\", \"bottom\", \"right\"\n\t    $.fn.update_privileged = function update_privileged(perm, denied_message, placement) {\n\t        var allowed = (perm.allowed !== false);\n\t        var selector = this;\n\t\n\t        selector.each(function() {\n\t            // preserve old title first time to use when allowed\n\t            // activate tooltip\n\t            var allowed_key = 'allowed-title';\n\t            if (typeof $(this).data(allowed_key) === 'undefined' ||\n\t                   $(this).data(allowed_key) === false)\n\t                $(this).data(allowed_key, $(this).attr('title') || \"\");\n\t\n\t            var options = { html: true };\n\t            if (placement)\n\t                options['placement'] = placement;\n\t\n\t            $(this).tooltip(options);\n\t\n\t            if ($(this).hasClass(\"disabled\") === allowed) {\n\t              $(this).toggleClass(\"disabled\", !allowed)\n\t                   .attr('data-original-title', null);\n\t\n\t              if (allowed)\n\t                  $(this).attr('title', $(this).data(allowed_key));\n\t              else\n\t                  $(this).attr('title', denied_message);\n\t              $(this).tooltip('fixTitle');\n\t            }\n\t        });\n\t\n\t        return selector;\n\t    };\n\t}());\n\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\t// removed by extract-text-webpack-plugin\n\n/***/ }\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// users/users.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap fb96d86ff07998024dd6","'use strict';\n\n/*\n * This file is part of Cockpit.\n *\n * Copyright (C) 2013 Red Hat, Inc.\n *\n * Cockpit is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation; either version 2.1 of the License, or\n * (at your option) any later version.\n *\n * Cockpit is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with Cockpit; If not, see <http://www.gnu.org/licenses/>.\n */\n\nvar $ = require(\"jquery\");\nvar cockpit = require(\"cockpit\");\n\nvar Mustache = require(\"mustache\");\nvar authorized_keys = require(\"./authorized-keys\");\n\nrequire(\"patterns\");\n\ncockpit.translate();\nvar _ = cockpit.gettext;\nvar C_ = cockpit.gettext;\n\nvar permission = cockpit.permission({ admin: true });\n$(permission).on(\"changed\", update_accounts_privileged);\n\nfunction update_accounts_privileged() {\n    $(\".accounts-self-privileged\").addClass(\"accounts-privileged\");\n\n    $(\".accounts-privileged:not('.accounts-current-account')\").update_privileged(\n        permission, cockpit.format(\n            _(\"The user <b>$0</b> is not permitted to modify accounts\"),\n            permission.user ? permission.user.name : ''),\n        \"right\"\n    );\n    $(\".accounts-privileged\").find(\"input\")\n        .attr('disabled', permission.allowed === false ||\n                          $('#account-user-name').text() === 'root');\n\n    // enable fields for current account.\n    $(\".accounts-current-account\").update_privileged(\n        {allowed: true}, \"\"\n    );\n    $(\".accounts-current-account\").find(\"input\")\n        .attr('disabled', false);\n\n    if ($('#account-user-name').text() === 'root' && permission.allowed) {\n        $(\"#account-delete\").update_privileged({allowed: false},\n                                      _(\"Unable to delete root account\"));\n        $(\"#account-real-name-wrapper\").update_privileged({allowed: false},\n                                      _(\"Unable to rename root account\"));\n    }\n}\n\nfunction passwd_self(old_pass, new_pass) {\n    var old_exps = [\n        /.*\\(current\\) UNIX password: $/,\n    ];\n    var new_exps = [\n        /.*New password: $/,\n        /.*Retype new password: $/\n    ];\n    var bad_exps = [\n        /.*BAD PASSWORD:.*/\n    ];\n\n    var dfd = $.Deferred();\n    var buffer = \"\";\n    var sent_new = false;\n    var failure = _(\"Old password not accepted\");\n    var i;\n\n    var timeout = window.setTimeout(function() {\n        failure = _(\"Prompting via passwd timed out\");\n        proc.close(\"terminated\");\n    }, 10 * 1000);\n\n    var proc = cockpit.spawn([\"/usr/bin/passwd\"], { pty: true, environ: [ \"LC_ALL=C\" ], err: \"out\" })\n        .always(function() {\n            window.clearInterval(timeout);\n        })\n        .done(function() {\n            dfd.resolve();\n        })\n        .fail(function(ex) {\n            if (ex.constructor.name == \"ProcessError\")\n                ex = new Error(failure);\n            dfd.reject(ex);\n        })\n        .stream(function(data) {\n            buffer += data;\n            for (i = 0; i < old_exps.length; i++) {\n                if (old_exps[i].test(buffer)) {\n                    buffer = \"\";\n                    proc.input(old_pass + \"\\n\", true);\n                    return;\n                }\n            }\n\n            for (i = 0; i < new_exps.length; i++) {\n                if (new_exps[i].test(buffer)) {\n                    buffer = \"\";\n                    proc.input(new_pass + \"\\n\", true);\n                    failure = _(\"Failed to change password\");\n                    sent_new = true;\n                    return;\n                }\n            }\n\n            for (i = 0; sent_new && i < bad_exps.length; i++) {\n                if (bad_exps[i].test(buffer)) {\n                    failure = _(\"New password was not accepted\");\n                    return;\n                }\n            }\n        });\n\n    return dfd.promise();\n}\n\nfunction passwd_change(user, new_pass) {\n    var dfd = $.Deferred();\n\n    var buffer = \"\";\n    cockpit.spawn([ \"chpasswd\" ], {superuser: \"require\", err: \"out\" })\n        .input(user + \":\" + new_pass)\n        .done(function() {\n            dfd.resolve();\n        })\n        .fail(function(ex, response) {\n            if (ex.constructor.name == \"ProcessError\") {\n                console.log(ex);\n                if (response)\n                    ex = new Error(response);\n                else\n                    ex = new Error(_(\"Failed to change password\"));\n            }\n            dfd.reject(ex);\n        });\n\n    return dfd.promise();\n}\n\n/*\n * Similar to $.when() but serializes, and accepts functions\n * that return promises\n */\nfunction chain(functions) {\n    var dfd = $.Deferred();\n    var i = 0;\n\n    /* Either an array or functions passed */\n    if (typeof functions == \"function\")\n        functions = arguments;\n\n    function step() {\n        if (i == functions.length) {\n            dfd.resolve();\n            return;\n        }\n\n        (functions[i])()\n            .done(function() {\n                step();\n            })\n            .fail(function(ex) {\n                dfd.reject(ex);\n            });\n\n        i += 1;\n    }\n\n    step();\n    return dfd.promise();\n}\n\nfunction parse_passwd_content(content) {\n    if (!content) {\n        console.warn(\"Couldn't read /etc/passwd\");\n        return [ ];\n    }\n\n    var ret = [ ];\n    var lines = content.split('\\n');\n    var column;\n\n    for (var i = 0; i < lines.length; i++) {\n        if (! lines[i])\n            continue;\n        column = lines[i].split(':');\n        ret.push({\n            name: column[0],\n            password: column[1],\n            uid: parseInt(column[2], 10),\n            gid: parseInt(column[3], 10),\n            gecos: column[4].replace(/,*$/, ''),\n            home: column[5],\n            shell: column[6],\n        });\n    }\n\n    return ret;\n}\n\nfunction parse_group_content(content) {\n    content = (content || \"\").trim();\n    if (!content) {\n        console.warn(\"Couldn't read /etc/group\");\n        return [ ];\n    }\n\n    var ret = [ ];\n    var lines = content.split('\\n');\n    var column;\n\n    for (var i = 0; i < lines.length; i++) {\n        if (! lines[i])\n            continue;\n        column = lines[i].split(':');\n        ret.push({\n            name: column[0],\n            password: column[1],\n            gid: parseInt(column[2], 10),\n            userlist: column[3].split(','),\n        });\n    }\n\n    return ret;\n}\n\nfunction password_quality(password) {\n    var dfd = $.Deferred();\n\n    cockpit.spawn('/usr/bin/pwscore', { \"err\": \"message\" })\n       .input(password)\n       .done(function(content) {\n           var quality = parseInt(content, 10);\n           if (quality === 0) {\n               dfd.reject(new Error(_(\"Password is too weak\")));\n           } else if (quality <= 33) {\n               dfd.resolve(\"weak\");\n           } else if (quality <= 66) {\n               dfd.resolve(\"okay\");\n           } else if (quality <= 99) {\n               dfd.resolve(\"good\");\n           } else {\n               dfd.resolve(\"excellent\");\n           }\n       })\n       .fail(function(ex) {\n           dfd.reject(new Error(ex.message || _(\"Password is not acceptable\")));\n       });\n\n    return dfd.promise();\n}\n\nfunction is_user_in_group(user, group) {\n    for (var i = 0; group[\"userlist\"] && i < group[\"userlist\"].length; i++) {\n        if (group[\"userlist\"][i] === user)\n            return true;\n    }\n\n    return false;\n}\n\nfunction log_unexpected_error(error) {\n    console.warn(\"Unexpected error\", error);\n}\n\nPageAccounts.prototype = {\n    _init: function() {\n        this.id = \"accounts\";\n    },\n\n    getTitle: function() {\n        return C_(\"page-title\", \"Accounts\");\n    },\n\n    show: function() {\n    },\n\n    setup: function() {\n        $('#accounts-create').on('click', $.proxy (this, \"create\"));\n    },\n\n    enter: function() {\n        var self = this;\n\n        function parse_accounts(content) {\n            self.accounts = parse_passwd_content(content);\n            self.update();\n        }\n\n        this.handle_passwd =  cockpit.file('/etc/passwd');\n\n        this.handle_passwd.read()\n           .done(parse_accounts)\n           .fail(log_unexpected_error);\n\n        this.handle_passwd.watch(parse_accounts);\n    },\n\n    leave: function() {\n        if (this.handle_passwd) {\n            this.handle_passwd.close();\n            this.handle_passwd = null;\n        }\n    },\n\n    update: function() {\n        var list = $(\"#accounts-list\");\n\n        this.accounts.sort (function (a, b) {\n                                if (! a[\"gecos\"]) return -1;\n                                else if (! b[\"gecos\"]) return 1;\n                                else return a[\"gecos\"].localeCompare(b[\"gecos\"]);\n                            });\n\n        list.empty();\n        for (var i = 0; i < this.accounts.length; i++) {\n            if ((this.accounts[i][\"uid\"] < 1000 && this.accounts[i][\"uid\"] !== 0) ||\n                  this.accounts[i][\"shell\"].match(/^(\\/usr)?\\/sbin\\/nologin/) ||\n                  this.accounts[i][\"shell\"] === '/bin/false')\n                continue;\n            var img =\n                $('<div/>', { 'class': \"cockpit-account-pic pficon pficon-user\" });\n            var div =\n                $('<div/>', { 'class': \"cockpit-account\" }).append(\n                    img,\n                    $('<div/>', { 'class': \"cockpit-account-real-name\" }).text(this.accounts[i][\"gecos\"]),\n                    $('<div/>', { 'class': \"cockpit-account-user-name\" }).text(this.accounts[i][\"name\"]));\n            div.on('click', $.proxy(this, \"go\", this.accounts[i][\"name\"]));\n            list.append(div);\n        }\n    },\n\n    create: function () {\n        PageAccountsCreate.accounts = this.accounts;\n        $('#accounts-create-dialog').modal('show');\n    },\n\n    go: function (user) {\n        cockpit.location.go([ user ]);\n    }\n};\n\nfunction PageAccounts() {\n    this._init();\n}\n\nPageAccountsCreate.prototype = {\n    _init: function() {\n        this.id = \"accounts-create-dialog\";\n        this.username_dirty = false;\n    },\n\n    show: function() {\n    },\n\n    setup: function() {\n        var self = this;\n        $('#accounts-create-cancel').on('click', $.proxy(this, \"cancel\"));\n        $('#accounts-create-create').on('click', $.proxy(this, \"create\"));\n        $('#accounts-create-dialog .check-passwords').on('keydown change', $.proxy(this, \"validate\"));\n        $('#accounts-create-real-name').on('input', $.proxy(this, \"suggest_username\"));\n        $('#accounts-create-user-name').on('input', function() { self.username_dirty = true; });\n    },\n\n    enter: function() {\n        $('#accounts-create-user-name').val(\"\");\n        $('#accounts-create-real-name').val(\"\");\n        $('#accounts-create-pw1').val(\"\");\n        $('#accounts-create-pw2').val(\"\");\n        $('#accounts-create-locked').prop('checked', false);\n        $('#accounts-create-password-meter').removeClass(\"weak okay good excellent\");\n        $(\"#accounts-create-dialog\").dialog(\"failure\", null);\n        this.username_dirty = false;\n    },\n\n    leave: function() {\n    },\n\n    validate: function() {\n        var ex, fails = [];\n        var pw = $('#accounts-create-pw1').val();\n        if ($('#accounts-create-pw2').val() != pw) {\n            ex = new Error(_(\"The passwords do not match\"));\n            ex.target = \"#accounts-create-pw2\";\n            fails.push(ex);\n        }\n        if (!$('#accounts-create-user-name').val()) {\n            ex = new Error(_(\"No user name specified\"));\n            ex.target = '#accounts-create-user-name';\n            fails.push(ex);\n        }\n        if (!$('#accounts-create-real-name').val()) {\n            ex = new Error(_(\"No real name specified\"));\n            ex.target = '#accounts-create-real-name';\n            fails.push(ex);\n        }\n\n        /* The first check is immediately complete */\n        var dfd = $.Deferred();\n        if (fails.length)\n            dfd.reject(fails);\n        else\n            dfd.resolve();\n\n        var promise_password = password_quality(pw)\n            .fail(function(ex) {\n                ex.target = \"#accounts-create-pw2\";\n            })\n            .always(function(arg) {\n                var strength = this.state() == \"resolved\" ? arg : \"weak\";\n                var meter = $(\"#accounts-create-password-meter\")\n                    .removeClass(\"weak okay good excellent\");\n                if (pw)\n                    meter.addClass(strength);\n                var message = $(\"#accounts-create-password-meter-message\");\n                if (strength == \"excellent\") {\n                    message.text(_(\"Excellent password\"));\n                } else {\n                    message.text(\"\");\n                }\n            });\n\n        var promise_username = this.check_username()\n            .fail(function(ex) {\n                ex.target = \"#accounts-create-user-name\";\n            });\n\n        return cockpit.all(dfd, promise_password, promise_username);\n    },\n\n    cancel: function() {\n        $('#accounts-create-dialog').modal('hide');\n    },\n\n    create: function() {\n        var tasks = [\n            function create_user() {\n                var prog = [\"/usr/sbin/useradd\"];\n                if ($('#accounts-create-real-name').val()) {\n                    prog.push('-c');\n                    prog.push($('#accounts-create-real-name').val());\n                }\n                prog.push($('#accounts-create-user-name').val());\n                return cockpit.spawn(prog, { \"superuser\": \"require\", err: \"message\" });\n            }\n        ];\n\n        if ($('#accounts-create-locked').prop('checked')) {\n            tasks.push(function adjust_locked() {\n                return cockpit.spawn([\n                    \"/usr/sbin/usermod\",\n                    $('#accounts-create-user-name').val(),\n                    \"--lock\"\n                ], { superuser: \"require\", err: \"message\" });\n            });\n        }\n\n        tasks.push(function change_passwd() {\n            return passwd_change($('#accounts-create-user-name').val(), $('#accounts-create-pw1').val());\n        });\n\n        var promise = this.validate()\n            .fail(function(ex) {\n                $(\"#accounts-create-password-meter-message\").hide();\n                $(\"#accounts-create-dialog\").dialog(\"failure\", ex);\n            })\n            .done(function() {\n                promise = chain(tasks);\n                $(\"#accounts-create-dialog\").dialog(\"promise\", promise);\n            });\n\n        $(\"#accounts-create-dialog\").dialog(\"wait\", promise);\n    },\n\n    is_valid_char_username: function(c) {\n        return (c >= 'a' && c <= 'z') ||\n               (c >= 'A' && c <= 'Z') ||\n               (c >= '0' && c <= '9') ||\n               c == '.' || c == '_' || c == '-';\n    },\n\n    check_username: function() {\n        var dfd = $.Deferred();\n        var username = $('#accounts-create-user-name').val();\n\n        for (var i = 0; i < username.length; i++) {\n            if (! this.is_valid_char_username(username[i])) {\n                dfd.reject(new Error(\n                  _(\"The user name can only consist of letters from a-z, digits, dots, dashes and underscores.\")\n                ));\n                return dfd.promise();\n            }\n        }\n\n        for (var k = 0; k < PageAccountsCreate.accounts.length; k++) {\n            if (PageAccountsCreate.accounts[k]['name'] == username) {\n                dfd.reject(new Error(_(\"This user name already exists\")));\n                return dfd.promise();\n            }\n        }\n\n        dfd.resolve();\n        return dfd.promise();\n    },\n\n    suggest_username: function() {\n        var self = this;\n\n        function remove_diacritics(str) {\n            var translate_table = {\n               'a' :  '[]',\n               'ae':  '',\n               'c' :  '',\n               'd' :  '',\n               'e' :  '[]',\n               'i' :  '[]',\n               'l' :  '[]',\n               'n' :  '[]',\n               'o' :  '[]',\n               'oe':  '',\n               'r' :  '[]',\n               's' :  '',\n               't' :  '',\n               'u' :  '[]',\n               'y' :  '[]',\n               'z' :  '',\n            };\n            for (var i in translate_table)\n                str = str.replace(new RegExp(translate_table[i], 'g'), i);\n\n            for (var k = 0; k < str.length; ) {\n                if (! self.is_valid_char_username(str[k]))\n                    str = str.substr(0, k) + str.substr(k + 1);\n                else\n                   k++;\n            }\n\n            return str;\n        }\n\n        function make_username(realname) {\n            var result = \"\";\n            var name = realname.split(' ');\n\n            if (name.length === 1)\n                result = name[0].toLowerCase();\n            else if (name.length > 1)\n                result = name[0][0].toLowerCase() + name[name.length - 1].toLowerCase();\n\n            return remove_diacritics(result);\n        }\n\n        if (this.username_dirty)\n           return;\n\n        var username = make_username($('#accounts-create-real-name').val());\n        $('#accounts-create-user-name').val(username);\n    }\n\n};\n\nfunction PageAccountsCreate() {\n    this._init();\n}\n\nPageAccount.prototype = {\n    _init: function(user) {\n        this.id = \"account\";\n        this.section_id = \"accounts\";\n        this.roles = [];\n        this.role_template = $(\"#role-entry-tmpl\").html();\n        Mustache.parse(this.role_template);\n\n        this.keys_template = $(\"#authorized-keys-tmpl\").html();\n        Mustache.parse(this.keys_template);\n        this.authorized_keys = null;\n\n        this.user = user;\n    },\n\n    getTitle: function() {\n        return C_(\"page-title\", \"Accounts\");\n    },\n\n    show: function() {\n        var self = this;\n        $(\"#account\").toggle(!!self.account_id);\n        $(\"#account-failure\").toggle(!self.account_id);\n    },\n\n    setup: function() {\n        $('#account .breadcrumb a').on(\"click\", function() {\n            cockpit.location.go('/');\n        });\n\n        $('#account-real-name').on('change', $.proxy (this, \"change_real_name\"));\n        $('#account-real-name').on('keydown', $.proxy (this, \"real_name_edited\"));\n        $('#account-set-password').on('click', $.proxy (this, \"set_password\"));\n        $('#account-delete').on('click', $.proxy (this, \"delete_account\"));\n        $('#account-logout').on('click', $.proxy (this, \"logout_account\"));\n        $('#account-locked').on('change', $.proxy (this, \"change_locked\", true, null));\n        $('#add-authorized-key').on('click', $.proxy (this, \"add_key\"));\n        $('#add-authorized-key-dialog').on('hidden.bs.modal', function () {\n            $(\"#authorized-keys-text\").val(\"\");\n        });\n    },\n\n    setup_keys: function (user_name, home_dir) {\n        var self = this;\n        if (!self.authorized_keys) {\n            self.authorized_keys = authorized_keys.instance(user_name, home_dir);\n            $(self.authorized_keys).on(\"changed\", function () {\n                self.update();\n            });\n        }\n    },\n\n    remove_key: function (ev) {\n        if (!this.authorized_keys)\n            return;\n\n        var key = $(ev.target).data(\"raw\");\n        $(\".account-remove-key\").prop('disabled', true);\n        this.authorized_keys.remove_key(key)\n            .fail(show_unexpected_error)\n            .always(function () {\n                $(\".account-remove-key\").prop('disabled', false);\n            });\n    },\n\n    add_key: function () {\n        if (!this.authorized_keys) {\n            $(\"#add-authorized-key-dialog\").modal('hide');\n            return;\n        }\n\n        var key = $(\"#authorized-keys-text\").val();\n        var promise = this.authorized_keys.add_key(key);\n        $(\"#add-authorized-key-dialog\").dialog(\"promise\", promise);\n    },\n\n    get_user: function() {\n       var self = this;\n       function parse_user(content) {\n            var accounts = parse_passwd_content(content);\n\n            for (var i = 0; i < accounts.length; i++) {\n               if (accounts[i][\"name\"] !== self.account_id)\n                  continue;\n\n               self.account = accounts[i];\n               self.setup_keys(self.account.name, self.account.home);\n               self.update();\n            }\n        }\n\n        this.handle_passwd = cockpit.file('/etc/passwd');\n\n        this.handle_passwd.read()\n           .done(parse_user)\n           .fail(log_unexpected_error);\n\n        this.handle_passwd.watch(parse_user);\n    },\n\n    get_roles: function() {\n        var self = this;\n\n        var role_groups = {\n            \"wheel\":   _(\"Server Administrator\"),\n            \"sudo\":    _(\"Server Administrator\"),\n            \"docker\":  _(\"Container Administrator\")\n        };\n\n        function parse_groups(content) {\n            var groups = parse_group_content(content);\n            while (self.roles.length > 0)\n                self.roles.pop();\n            for (var i = 0; i < groups.length; i++) {\n                var name = groups[i][\"name\"];\n                if (role_groups[name]) {\n                    self.roles.push({\n                        name: name,\n                        desc: role_groups[name],\n                        id: groups[i][\"gid\"],\n                        member: is_user_in_group(self.account_id, groups[i]),\n                    });\n                }\n            }\n            $(self).triggerHandler(\"roles\");\n            self.update();\n        }\n\n        this.handle_groups = cockpit.file('/etc/group');\n\n        this.handle_groups.read()\n           .done(parse_groups)\n           .fail(log_unexpected_error);\n\n        this.handle_groups.watch(parse_groups);\n    },\n\n    get_last_login: function() {\n        var self = this;\n\n        function parse_last_login(data) {\n           data = data.split('\\n')[1]; // throw away header\n           if (data.length === 0) return null;\n           data =  data.split('   '); // get last column - separated by spaces\n\n           if (data[data.length - 1].indexOf('**Never logged in**') > -1)\n               return null;\n           else\n               return new Date(data[data.length - 1]);\n        }\n\n        cockpit.spawn([\"/usr/bin/lastlog\", \"-u\", self.account_id],\n                      { \"environ\": [\"LC_ALL=C\"] })\n           .done(function (data) {\n               self.lastLogin = parse_last_login(data);\n               self.update();\n           })\n           .fail(function() {\n               self.lastLogin = null;\n               self.update();\n           });\n    },\n\n    get_locked: function(update_display) {\n        update_display = typeof update_display !== 'undefined' ? update_display : true;\n        var dfd = $.Deferred();\n        var self = this;\n\n        function parse_locked(content) {\n            var status = content.split(\" \")[1];\n            // libuser uses \"LK\", shadow-utils use \"L\".\n            return status && (status == \"LK\" || status == \"L\");\n        }\n\n        cockpit.spawn([\"/usr/bin/passwd\", \"-S\", self.account_id],\n                      { \"environ\": [ \"LC_ALL=C\" ], \"superuser\": \"require\" })\n            .done(function(content) {\n                    self.locked = parse_locked(content);\n                    if (update_display)\n                        self.update();\n                    dfd.resolve(self.locked);\n                })\n            .fail(function(error) {\n                    dfd.reject(error);\n                });\n\n        return dfd.promise();\n    },\n\n    get_logged: function() {\n        var self = this;\n        if (!self.account_id) {\n            self.logged = false;\n            self.update();\n            return;\n        }\n\n        function parse_logged(content) {\n            self.logged = content.length > 0;\n            if (! self.logged)\n               self.get_last_login();\n            else\n               self.update();\n        }\n\n        cockpit.spawn([\"/usr/bin/w\", \"-sh\", self.account_id])\n           .done(parse_logged)\n           .fail(log_unexpected_error);\n    },\n\n    enter: function(account_id) {\n        this.account_id = account_id;\n\n        $(\"#account-real-name\").removeAttr(\"data-dirty\");\n\n        this.get_user();\n        this.get_roles();\n        this.get_locked();\n        this.get_logged();\n    },\n\n    leave: function() {\n        if (this.handle_passwd) {\n           this.handle_passwd.close();\n           this.handle_passwd = null;\n        }\n\n        if (this.handle_groups) {\n           this.handle_groups.close();\n           this.handle_groups = null;\n        }\n\n        if (this.authorized_keys) {\n           $(this.authorized_keys).off();\n           this.authorized_keys.close();\n           this.authorized_keys = null;\n        }\n\n        $('#account-failure').hide();\n    },\n\n    update: function() {\n\n        if (this.account) {\n            $('#account').show();\n            $('#account-failure').hide();\n            var name = $(\"#account-real-name\");\n\n            var title_name = this.account[\"gecos\"];\n            if (!title_name)\n                title_name = this.account[\"name\"];\n\n            $('#account-logout').attr('disabled', !this.logged);\n\n            $(\"#account-title\").text(title_name);\n            if (!name.attr(\"data-dirty\"))\n                $('#account-real-name').val(this.account[\"gecos\"]);\n\n            $('#account-user-name').text(this.account[\"name\"]);\n\n            if (this.logged)\n                $('#account-last-login').text(_(\"Logged In\"));\n            else if (! this.lastLogin)\n                $('#account-last-login').text(_(\"Never\"));\n            else\n                $('#account-last-login').text(this.lastLogin.toLocaleString());\n\n            if (typeof this.locked != 'undefined' && this.account[\"uid\"] !== 0) {\n                $('#account-locked').prop('checked', this.locked);\n                $('#account-locked').parents('tr').show();\n            } else {\n                $('#account-locked').parents('tr').hide();\n            }\n\n            if (this.authorized_keys) {\n                var keys = this.authorized_keys.keys;\n                var state = this.authorized_keys.state;\n                var keys_html = Mustache.render(this.keys_template, {\n                    \"keys\": keys,\n                    \"empty\": keys.length === 0 && state == \"ready\",\n                    \"denied\": state == \"access-denied\",\n                    \"failed\": state == \"failed\",\n                });\n                $('#account-authorized-keys-list').html(keys_html);\n                $(\".account-remove-key\")\n                    .on(\"click\", $.proxy (this, \"remove_key\"));\n                $('#account-authorized-keys').show();\n            } else {\n                $('#account-authorized-keys').hide();\n            }\n\n            if (this.account[\"uid\"] !== 0) {\n                var html = Mustache.render(this.role_template,\n                                           { \"roles\": this.roles});\n                $('#account-change-roles-roles').html(html);\n                $('#account-roles').parents('tr').show();\n                $(\"#account-change-roles-roles :input\")\n                    .on(\"change\", $.proxy (this, \"change_role\"));\n            } else {\n                $('#account-roles').parents('tr').hide();\n            }\n            $('#account .breadcrumb .active').text(title_name);\n\n            // check accounts-self-privileged whether account is the same as currently logged in user\n            $(\".accounts-self-privileged\").\n                toggleClass(\"accounts-current-account\",\n                            this.user.id == this.account[\"uid\"]);\n\n        } else {\n            $('#account').hide();\n            $('#account-failure').show();\n            $('#account-real-name').val(\"\");\n            $('#account-user-name').text(\"\");\n            $('#account-last-login').text(\"\");\n            $('#account-locked').prop('checked', false);\n            $('#account-roles').text(\"\");\n            $('#account .breadcrumb .active').text(\"?\");\n        }\n        update_accounts_privileged();\n    },\n\n    change_role: function(ev) {\n        var name = $(ev.target).data(\"name\");\n        var id = $(ev.target).data(\"gid\");\n        if (!name || !id || !this.account[\"name\"])\n            return;\n\n        if ($(ev.target).prop('checked')) {\n            cockpit.spawn([\"/usr/sbin/usermod\", this.account[\"name\"],\n                           \"-G\", id, \"-a\"], { \"superuser\": \"require\", err: \"message\" })\n               .fail(show_unexpected_error);\n        } else {\n            cockpit.spawn([\"/usr/bin/gpasswd\", \"-d\", this.account[\"name\"],\n                           name], { \"superuser\": \"require\", err: \"message\" })\n                   .fail(show_unexpected_error);\n        }\n    },\n\n    real_name_edited: function() {\n        $(\"#account-real-name\").attr(\"data-dirty\", \"true\");\n    },\n\n    check_role_for_self_mod: function () {\n        return (this.account[\"name\"] == this.user.name ||\n                permission.allowed !== false);\n    },\n\n    change_real_name: function() {\n        var self = this;\n\n        var name = $(\"#account-real-name\");\n        name.attr(\"data-dirty\", \"true\");\n\n        if (!self.check_role_for_self_mod ()) {\n            self.update ();\n            return;\n        }\n\n        // TODO: unwanted chars check\n        var value = name.val();\n\n        cockpit.spawn([\"/usr/sbin/usermod\", self.account[\"name\"], \"--comment\", value],\n                      { \"superuser\": \"try\", err: \"message\"})\n           .done(function(data) {\n               self.account[\"gecos\"] = value;\n               self.update();\n               name.removeAttr(\"data-dirty\");\n           })\n           .fail(show_unexpected_error);\n    },\n\n    change_locked: function(verify_status, desired_lock_state) {\n        desired_lock_state = desired_lock_state !== null ?\n            desired_lock_state : $('#account-locked').prop('checked');\n        var self = this;\n        cockpit.spawn([\"/usr/sbin/usermod\",\n                       this.account[\"name\"],\n                       desired_lock_state ? \"--lock\" : \"--unlock\"], { \"superuser\": \"require\", err: \"message\"})\n            .done(function() {\n                self.get_locked(false)\n                    .done(function(locked) {\n                        /* if we care about what the lock state should be and it doesn't match, try to change again\n                           this is a workaround for different ways of handling a locked account\n                           https://github.com/cockpit-project/cockpit/issues/1216\n                           https://bugzilla.redhat.com/show_bug.cgi?id=853153\n                           This seems to be fixed in fedora 23 (usermod catches the different locking behavior)\n                        */\n                        if (verify_status && desired_lock_state !== locked) {\n                            console.log(\"Account locked state doesn't match desired value, trying again.\");\n                            // only retry once to avoid uncontrolled recursion\n                            self.change_locked(false, desired_lock_state);\n                        } else {\n                            self.update();\n                        }\n                    });\n                })\n           .fail(show_unexpected_error);\n    },\n\n    set_password: function() {\n        if (!this.check_role_for_self_mod ())\n            return;\n\n        PageAccountSetPassword.user_name = this.account[\"name\"];\n        $('#account-set-password-dialog').modal('show');\n    },\n\n    delete_account: function() {\n        PageAccountConfirmDelete.user_name = this.account[\"name\"];\n        $('#account-confirm-delete-dialog').modal('show');\n    },\n\n    logout_account: function() {\n        cockpit.spawn([\"/usr/bin/loginctl\", \"terminate-user\", this.account[\"name\"]],\n                      { \"superuser\": \"try\", err: \"message\"})\n           .done($.proxy (this, \"get_logged\"))\n           .fail(show_unexpected_error);\n\n    },\n};\n\nfunction PageAccount(user) {\n    this._init(user);\n}\n\nvar crop_handle_width = 20;\n\nPageAccountConfirmDelete.prototype = {\n    _init: function() {\n        this.id = \"account-confirm-delete-dialog\";\n    },\n\n    show: function() {\n    },\n\n    setup: function() {\n        $('#account-confirm-delete-apply').on('click', $.proxy(this, \"apply\"));\n    },\n\n    enter: function() {\n        $('#account-confirm-delete-files').prop('checked', false);\n        $('#account-confirm-delete-title').text(cockpit.format(_(\"Delete $0\"), PageAccountConfirmDelete.user_name));\n    },\n\n    leave: function() {\n    },\n\n    apply: function() {\n        var prog = [\"/usr/sbin/userdel\"];\n\n        if ($('#account-confirm-delete-files').prop('checked'))\n            prog.push(\"-r\");\n\n        prog.push(PageAccountConfirmDelete.user_name);\n\n        cockpit.spawn(prog, { \"superuser\": \"require\", err: \"message\" })\n           .done(function () {\n              $('#account-confirm-delete-dialog').modal('hide');\n               cockpit.location.go(\"/\");\n           })\n           .fail(show_unexpected_error);\n    }\n};\n\nfunction PageAccountConfirmDelete() {\n    this._init();\n}\n\nPageAccountSetPassword.prototype = {\n    _init: function(user) {\n        this.id = \"account-set-password-dialog\";\n        this.user = user;\n    },\n\n    show: function() {\n        if (this.user.name !== PageAccountSetPassword.user_name) {\n            $('#account-set-password-old').parents('tr').toggle(false);\n            $('#account-set-password-pw1').focus();\n        } else {\n            $('#account-set-password-old').parents('tr').toggle(true);\n            $('#account-set-password-old').focus();\n        }\n    },\n\n    setup: function() {\n        $('#account-set-password-apply').on('click', $.proxy(this, \"apply\"));\n        $('#account-set-password-dialog .check-passwords').on('keydown change', $.proxy(this, \"validate\"));\n    },\n\n    enter: function() {\n        $('#account-set-password-old').val(\"\");\n        $('#account-set-password-pw1').val(\"\");\n        $('#account-set-password-pw2').val(\"\");\n        $('#account-set-password-meter').removeClass(\"weak okay good excellent\");\n        $(\"#account-set-password-dialog\").dialog(\"failure\", null);\n    },\n\n    leave: function() {\n    },\n\n    validate: function() {\n        var ex;\n        var pw = $('#account-set-password-pw1').val();\n        if ($('#account-set-password-pw2').val() != pw) {\n            ex = new Error(_(\"The passwords do not match\"));\n            ex.target = \"#account-set-password-pw2\";\n        }\n\n        var dfd = $.Deferred();\n        if (ex)\n            dfd.reject(ex);\n        else\n            dfd.resolve();\n\n        var promise = password_quality(pw)\n            .fail(function(ex) {\n                ex.target = \"#account-set-password-pw2\";\n            })\n            .always(function(arg) {\n                var strength = (this.state() == \"resolved\") ? arg : \"weak\";\n                var meter = $(\"#account-set-password-meter\")\n                    .removeClass(\"weak okay good excellent\");\n                if (pw)\n                    meter.addClass(strength);\n                var message = $(\"#account-set-password-meter-message\");\n                if (strength == \"excellent\") {\n                    message.text(_(\"Excellent password\"));\n                } else {\n                    message.text(\"\");\n                }\n            });\n\n        return cockpit.all(dfd, promise);\n    },\n\n    apply: function() {\n        var self = this;\n\n        var promise = this.validate()\n            .done(function() {\n                var user = PageAccountSetPassword.user_name;\n                var password = $('#account-set-password-pw1').val();\n\n                if (self.user.name === user)\n                    promise = passwd_self($('#account-set-password-old').val(), password);\n                else\n                    promise = passwd_change(user, password);\n\n                $(\"#account-set-password-dialog\").dialog(\"promise\", promise);\n            })\n            .fail(function(ex) {\n                $(\"#account-set-password-meter-message\").hide();\n                $(\"#account-set-password-dialog\").dialog(\"failure\", ex);\n            });\n        $(\"#account-set-password-dialog\").dialog(\"wait\", promise);\n    }\n};\n\nfunction PageAccountSetPassword(user) {\n    this._init(user);\n}\n\n/* INITIALIZATION AND NAVIGATION\n *\n * The code above still uses the legacy 'Page' abstraction for both\n * pages and dialogs, and expects page.setup, page.enter, page.show,\n * and page.leave to be called at the right times.\n *\n * We cater to this with a little compatability shim consisting of\n * 'dialog_setup', 'page_show', and 'page_hide'.\n */\n\nfunction show_error_dialog(title, message) {\n    if (message) {\n        $(\"#error-popup-title\").text(title);\n        $(\"#error-popup-message\").text(message);\n    } else {\n        $(\"#error-popup-title\").text(_(\"Error\"));\n        $(\"#error-popup-message\").text(title);\n    }\n\n    $('.modal[role=\"dialog\"]').modal('hide');\n    $('#error-popup').modal('show');\n}\n\nfunction show_unexpected_error(error) {\n    show_error_dialog(_(\"Unexpected error\"), error.message || error);\n}\n\nfunction dialog_setup(d) {\n    d.setup();\n    $('#' + d.id).\n        on('show.bs.modal', function () { d.enter(); }).\n        on('shown.bs.modal', function () { d.show(); }).\n        on('hidden.bs.modal', function () { d.leave(); });\n}\n\nfunction page_show(p, arg) {\n    if (p._entered_)\n        p.leave();\n    p.enter(arg);\n    p._entered_ = true;\n    $('#' + p.id).show();\n    p.show();\n}\n\nfunction page_hide(p) {\n    $('#' + p.id).hide();\n    if (p._entered_) {\n        p.leave();\n        p._entered_ = false;\n    }\n}\n\nfunction init() {\n    var overview_page;\n    var account_page;\n\n    cockpit.user().done(function (user) {\n        function navigate() {\n            var path = cockpit.location.path;\n\n            if (path.length === 0) {\n                page_hide(account_page);\n                page_show(overview_page);\n            } else if (path.length === 1) {\n                page_hide(overview_page);\n                page_show(account_page, path[0]);\n            } else { /* redirect */\n                console.warn(\"not a users location: \" + path);\n                cockpit.location = '';\n            }\n\n            $(\"body\").show();\n        }\n\n        cockpit.translate();\n\n        overview_page = new PageAccounts();\n        overview_page.setup();\n\n        account_page = new PageAccount(user);\n        account_page.setup();\n\n        dialog_setup(new PageAccountsCreate());\n        dialog_setup(new PageAccountConfirmDelete());\n        dialog_setup(new PageAccountSetPassword(user));\n\n        $(cockpit).on(\"locationchanged\", navigate);\n        navigate();\n    });\n}\n\n$(init);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../pkg/users/local.js\n// module id = 1\n// module chunks = 0","module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 2\n// module chunks = 0","module.exports = cockpit;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cockpit\"\n// module id = 3\n// module chunks = 0","/*!\n * mustache.js - Logic-less {{mustache}} templates with JavaScript\n * http://github.com/janl/mustache.js\n */\n\n/*global define: false*/\n\n(function (root, factory) {\n  if (typeof exports === \"object\" && exports) {\n    factory(exports); // CommonJS\n  } else {\n    var mustache = {};\n    factory(mustache);\n    if (typeof define === \"function\" && define.amd) {\n      define(mustache); // AMD\n    } else {\n      root.Mustache = mustache; // <script>\n    }\n  }\n}(this, function (mustache) {\n\n  var whiteRe = /\\s*/;\n  var spaceRe = /\\s+/;\n  var nonSpaceRe = /\\S/;\n  var eqRe = /\\s*=/;\n  var curlyRe = /\\s*\\}/;\n  var tagRe = /#|\\^|\\/|>|\\{|&|=|!/;\n\n  // Workaround for https://issues.apache.org/jira/browse/COUCHDB-577\n  // See https://github.com/janl/mustache.js/issues/189\n  var RegExp_test = RegExp.prototype.test;\n  function testRegExp(re, string) {\n    return RegExp_test.call(re, string);\n  }\n\n  function isWhitespace(string) {\n    return !testRegExp(nonSpaceRe, string);\n  }\n\n  var Object_toString = Object.prototype.toString;\n  var isArray = Array.isArray || function (object) {\n    return Object_toString.call(object) === '[object Array]';\n  };\n\n  function isFunction(object) {\n    return typeof object === 'function';\n  }\n\n  function escapeRegExp(string) {\n    return string.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, \"\\\\$&\");\n  }\n\n  var entityMap = {\n    \"&\": \"&amp;\",\n    \"<\": \"&lt;\",\n    \">\": \"&gt;\",\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    \"/\": '&#x2F;'\n  };\n\n  function escapeHtml(string) {\n    return String(string).replace(/[&<>\"'\\/]/g, function (s) {\n      return entityMap[s];\n    });\n  }\n\n  function escapeTags(tags) {\n    if (!isArray(tags) || tags.length !== 2) {\n      throw new Error('Invalid tags: ' + tags);\n    }\n\n    return [\n      new RegExp(escapeRegExp(tags[0]) + \"\\\\s*\"),\n      new RegExp(\"\\\\s*\" + escapeRegExp(tags[1]))\n    ];\n  }\n\n  /**\n   * Breaks up the given `template` string into a tree of tokens. If the `tags`\n   * argument is given here it must be an array with two string values: the\n   * opening and closing tags used in the template (e.g. [ \"<%\", \"%>\" ]). Of\n   * course, the default is to use mustaches (i.e. mustache.tags).\n   *\n   * A token is an array with at least 4 elements. The first element is the\n   * mustache symbol that was used inside the tag, e.g. \"#\" or \"&\". If the tag\n   * did not contain a symbol (i.e. {{myValue}}) this element is \"name\". For\n   * all template text that appears outside a symbol this element is \"text\".\n   *\n   * The second element of a token is its \"value\". For mustache tags this is\n   * whatever else was inside the tag besides the opening symbol. For text tokens\n   * this is the text itself.\n   *\n   * The third and fourth elements of the token are the start and end indices\n   * in the original template of the token, respectively.\n   *\n   * Tokens that are the root node of a subtree contain two more elements: an\n   * array of tokens in the subtree and the index in the original template at which\n   * the closing tag for that section begins.\n   */\n  function parseTemplate(template, tags) {\n    tags = tags || mustache.tags;\n    template = template || '';\n\n    if (typeof tags === 'string') {\n      tags = tags.split(spaceRe);\n    }\n\n    var tagRes = escapeTags(tags);\n    var scanner = new Scanner(template);\n\n    var sections = [];     // Stack to hold section tokens\n    var tokens = [];       // Buffer to hold the tokens\n    var spaces = [];       // Indices of whitespace tokens on the current line\n    var hasTag = false;    // Is there a {{tag}} on the current line?\n    var nonSpace = false;  // Is there a non-space char on the current line?\n\n    // Strips all whitespace tokens array for the current line\n    // if there was a {{#tag}} on it and otherwise only space.\n    function stripSpace() {\n      if (hasTag && !nonSpace) {\n        while (spaces.length) {\n          delete tokens[spaces.pop()];\n        }\n      } else {\n        spaces = [];\n      }\n\n      hasTag = false;\n      nonSpace = false;\n    }\n\n    var start, type, value, chr, token, openSection;\n    while (!scanner.eos()) {\n      start = scanner.pos;\n\n      // Match any text between tags.\n      value = scanner.scanUntil(tagRes[0]);\n      if (value) {\n        for (var i = 0, len = value.length; i < len; ++i) {\n          chr = value.charAt(i);\n\n          if (isWhitespace(chr)) {\n            spaces.push(tokens.length);\n          } else {\n            nonSpace = true;\n          }\n\n          tokens.push(['text', chr, start, start + 1]);\n          start += 1;\n\n          // Check for whitespace on the current line.\n          if (chr === '\\n') {\n            stripSpace();\n          }\n        }\n      }\n\n      // Match the opening tag.\n      if (!scanner.scan(tagRes[0])) break;\n      hasTag = true;\n\n      // Get the tag type.\n      type = scanner.scan(tagRe) || 'name';\n      scanner.scan(whiteRe);\n\n      // Get the tag value.\n      if (type === '=') {\n        value = scanner.scanUntil(eqRe);\n        scanner.scan(eqRe);\n        scanner.scanUntil(tagRes[1]);\n      } else if (type === '{') {\n        value = scanner.scanUntil(new RegExp('\\\\s*' + escapeRegExp('}' + tags[1])));\n        scanner.scan(curlyRe);\n        scanner.scanUntil(tagRes[1]);\n        type = '&';\n      } else {\n        value = scanner.scanUntil(tagRes[1]);\n      }\n\n      // Match the closing tag.\n      if (!scanner.scan(tagRes[1])) {\n        throw new Error('Unclosed tag at ' + scanner.pos);\n      }\n\n      token = [ type, value, start, scanner.pos ];\n      tokens.push(token);\n\n      if (type === '#' || type === '^') {\n        sections.push(token);\n      } else if (type === '/') {\n        // Check section nesting.\n        openSection = sections.pop();\n\n        if (!openSection) {\n          throw new Error('Unopened section \"' + value + '\" at ' + start);\n        }\n        if (openSection[1] !== value) {\n          throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + start);\n        }\n      } else if (type === 'name' || type === '{' || type === '&') {\n        nonSpace = true;\n      } else if (type === '=') {\n        // Set the tags for the next time around.\n        tagRes = escapeTags(tags = value.split(spaceRe));\n      }\n    }\n\n    // Make sure there are no open sections when we're done.\n    openSection = sections.pop();\n    if (openSection) {\n      throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + scanner.pos);\n    }\n\n    return nestTokens(squashTokens(tokens));\n  }\n\n  /**\n   * Combines the values of consecutive text tokens in the given `tokens` array\n   * to a single token.\n   */\n  function squashTokens(tokens) {\n    var squashedTokens = [];\n\n    var token, lastToken;\n    for (var i = 0, len = tokens.length; i < len; ++i) {\n      token = tokens[i];\n\n      if (token) {\n        if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {\n          lastToken[1] += token[1];\n          lastToken[3] = token[3];\n        } else {\n          squashedTokens.push(token);\n          lastToken = token;\n        }\n      }\n    }\n\n    return squashedTokens;\n  }\n\n  /**\n   * Forms the given array of `tokens` into a nested tree structure where\n   * tokens that represent a section have two additional items: 1) an array of\n   * all tokens that appear in that section and 2) the index in the original\n   * template that represents the end of that section.\n   */\n  function nestTokens(tokens) {\n    var nestedTokens = [];\n    var collector = nestedTokens;\n    var sections = [];\n\n    var token, section;\n    for (var i = 0, len = tokens.length; i < len; ++i) {\n      token = tokens[i];\n\n      switch (token[0]) {\n      case '#':\n      case '^':\n        collector.push(token);\n        sections.push(token);\n        collector = token[4] = [];\n        break;\n      case '/':\n        section = sections.pop();\n        section[5] = token[2];\n        collector = sections.length > 0 ? sections[sections.length - 1][4] : nestedTokens;\n        break;\n      default:\n        collector.push(token);\n      }\n    }\n\n    return nestedTokens;\n  }\n\n  /**\n   * A simple string scanner that is used by the template parser to find\n   * tokens in template strings.\n   */\n  function Scanner(string) {\n    this.string = string;\n    this.tail = string;\n    this.pos = 0;\n  }\n\n  /**\n   * Returns `true` if the tail is empty (end of string).\n   */\n  Scanner.prototype.eos = function () {\n    return this.tail === \"\";\n  };\n\n  /**\n   * Tries to match the given regular expression at the current position.\n   * Returns the matched text if it can match, the empty string otherwise.\n   */\n  Scanner.prototype.scan = function (re) {\n    var match = this.tail.match(re);\n\n    if (match && match.index === 0) {\n      var string = match[0];\n      this.tail = this.tail.substring(string.length);\n      this.pos += string.length;\n      return string;\n    }\n\n    return \"\";\n  };\n\n  /**\n   * Skips all text until the given regular expression can be matched. Returns\n   * the skipped string, which is the entire tail if no match can be made.\n   */\n  Scanner.prototype.scanUntil = function (re) {\n    var index = this.tail.search(re), match;\n\n    switch (index) {\n    case -1:\n      match = this.tail;\n      this.tail = \"\";\n      break;\n    case 0:\n      match = \"\";\n      break;\n    default:\n      match = this.tail.substring(0, index);\n      this.tail = this.tail.substring(index);\n    }\n\n    this.pos += match.length;\n\n    return match;\n  };\n\n  /**\n   * Represents a rendering context by wrapping a view object and\n   * maintaining a reference to the parent context.\n   */\n  function Context(view, parentContext) {\n    this.view = view == null ? {} : view;\n    this.cache = { '.': this.view };\n    this.parent = parentContext;\n  }\n\n  /**\n   * Creates a new context using the given view with this context\n   * as the parent.\n   */\n  Context.prototype.push = function (view) {\n    return new Context(view, this);\n  };\n\n  /**\n   * Returns the value of the given name in this context, traversing\n   * up the context hierarchy if the value is absent in this context's view.\n   */\n  Context.prototype.lookup = function (name) {\n    var value;\n    if (name in this.cache) {\n      value = this.cache[name];\n    } else {\n      var context = this;\n\n      while (context) {\n        if (name.indexOf('.') > 0) {\n          value = context.view;\n\n          var names = name.split('.'), i = 0;\n          while (value != null && i < names.length) {\n            value = value[names[i++]];\n          }\n        } else {\n          value = context.view[name];\n        }\n\n        if (value != null) break;\n\n        context = context.parent;\n      }\n\n      this.cache[name] = value;\n    }\n\n    if (isFunction(value)) {\n      value = value.call(this.view);\n    }\n\n    return value;\n  };\n\n  /**\n   * A Writer knows how to take a stream of tokens and render them to a\n   * string, given a context. It also maintains a cache of templates to\n   * avoid the need to parse the same template twice.\n   */\n  function Writer() {\n    this.cache = {};\n  }\n\n  /**\n   * Clears all cached templates in this writer.\n   */\n  Writer.prototype.clearCache = function () {\n    this.cache = {};\n  };\n\n  /**\n   * Parses and caches the given `template` and returns the array of tokens\n   * that is generated from the parse.\n   */\n  Writer.prototype.parse = function (template, tags) {\n    var cache = this.cache;\n    var tokens = cache[template];\n\n    if (tokens == null) {\n      tokens = cache[template] = parseTemplate(template, tags);\n    }\n\n    return tokens;\n  };\n\n  /**\n   * High-level method that is used to render the given `template` with\n   * the given `view`.\n   *\n   * The optional `partials` argument may be an object that contains the\n   * names and templates of partials that are used in the template. It may\n   * also be a function that is used to load partial templates on the fly\n   * that takes a single argument: the name of the partial.\n   */\n  Writer.prototype.render = function (template, view, partials) {\n    var tokens = this.parse(template);\n    var context = (view instanceof Context) ? view : new Context(view);\n    return this.renderTokens(tokens, context, partials, template);\n  };\n\n  /**\n   * Low-level method that renders the given array of `tokens` using\n   * the given `context` and `partials`.\n   *\n   * Note: The `originalTemplate` is only ever used to extract the portion\n   * of the original template that was contained in a higher-order section.\n   * If the template doesn't use higher-order sections, this argument may\n   * be omitted.\n   */\n  Writer.prototype.renderTokens = function (tokens, context, partials, originalTemplate) {\n    var buffer = '';\n\n    // This function is used to render an arbitrary template\n    // in the current context by higher-order sections.\n    var self = this;\n    function subRender(template) {\n      return self.render(template, context, partials);\n    }\n\n    var token, value;\n    for (var i = 0, len = tokens.length; i < len; ++i) {\n      token = tokens[i];\n\n      switch (token[0]) {\n      case '#':\n        value = context.lookup(token[1]);\n        if (!value) continue;\n\n        if (isArray(value)) {\n          for (var j = 0, jlen = value.length; j < jlen; ++j) {\n            buffer += this.renderTokens(token[4], context.push(value[j]), partials, originalTemplate);\n          }\n        } else if (typeof value === 'object' || typeof value === 'string') {\n          buffer += this.renderTokens(token[4], context.push(value), partials, originalTemplate);\n        } else if (isFunction(value)) {\n          if (typeof originalTemplate !== 'string') {\n            throw new Error('Cannot use higher-order sections without the original template');\n          }\n\n          // Extract the portion of the original template that the section contains.\n          value = value.call(context.view, originalTemplate.slice(token[3], token[5]), subRender);\n\n          if (value != null) buffer += value;\n        } else {\n          buffer += this.renderTokens(token[4], context, partials, originalTemplate);\n        }\n\n        break;\n      case '^':\n        value = context.lookup(token[1]);\n\n        // Use JavaScript's definition of falsy. Include empty arrays.\n        // See https://github.com/janl/mustache.js/issues/186\n        if (!value || (isArray(value) && value.length === 0)) {\n          buffer += this.renderTokens(token[4], context, partials, originalTemplate);\n        }\n\n        break;\n      case '>':\n        if (!partials) continue;\n        value = isFunction(partials) ? partials(token[1]) : partials[token[1]];\n        if (value != null) buffer += this.renderTokens(this.parse(value), context, partials, value);\n        break;\n      case '&':\n        value = context.lookup(token[1]);\n        if (value != null) buffer += value;\n        break;\n      case 'name':\n        value = context.lookup(token[1]);\n        if (value != null) buffer += mustache.escape(value);\n        break;\n      case 'text':\n        buffer += token[1];\n        break;\n      }\n    }\n\n    return buffer;\n  };\n\n  mustache.name = \"mustache.js\";\n  mustache.version = \"0.8.1\";\n  mustache.tags = [ \"{{\", \"}}\" ];\n\n  // All high-level mustache.* functions use this writer.\n  var defaultWriter = new Writer();\n\n  /**\n   * Clears all cached templates in the default writer.\n   */\n  mustache.clearCache = function () {\n    return defaultWriter.clearCache();\n  };\n\n  /**\n   * Parses and caches the given template in the default writer and returns the\n   * array of tokens it contains. Doing this ahead of time avoids the need to\n   * parse templates on the fly as they are rendered.\n   */\n  mustache.parse = function (template, tags) {\n    return defaultWriter.parse(template, tags);\n  };\n\n  /**\n   * Renders the `template` with the given `view` and `partials` using the\n   * default writer.\n   */\n  mustache.render = function (template, view, partials) {\n    return defaultWriter.render(template, view, partials);\n  };\n\n  // This is here for backwards compatibility with 0.4.x.\n  mustache.to_html = function (template, view, partials, send) {\n    var result = mustache.render(template, view, partials);\n\n    if (isFunction(send)) {\n      send(result);\n    } else {\n      return result;\n    }\n  };\n\n  // Export the escaping function so that the user may override it.\n  // See https://github.com/janl/mustache.js/issues/244\n  mustache.escape = escapeHtml;\n\n  // Export these mainly for testing, but also for advanced usage.\n  mustache.Scanner = Scanner;\n  mustache.Context = Context;\n  mustache.Writer = Writer;\n\n}));\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../bower_components/mustache/mustache.js\n// module id = 4\n// module chunks = 0","'use strict';\n\n(function() {\n    var $ = require(\"jquery\");\n    var cockpit = require(\"cockpit\");\n\n    var lister = require(\"raw!./ssh-list-public-keys.sh\");\n    var adder = require(\"raw!./ssh-add-public-key.sh\");\n\n    var _ = cockpit.gettext;\n\n    function AuthorizedKeys (user_name, home_dir) {\n        var self = this;\n        var dir = home_dir + \"/.ssh\";\n        var filename = dir + \"/authorized_keys\";\n        var file = null;\n        var watch = null;\n        var last_tag = null;\n\n        self.keys = [];\n        self.state = \"loading\";\n\n        function process_failure (ex) {\n            self.keys = [];\n            if (ex.problem == \"access-denied\") {\n                self.state = ex.problem;\n            } else if (ex.problem == \"not-found\") {\n                self.state = \"ready\";\n            } else {\n                self.state = \"failed\";\n                console.warn(\"Error proccessing authentication keys: \"+ ex);\n            }\n            $(self).triggerHandler(\"changed\");\n        }\n\n        function update_keys(keys, tag) {\n            if (tag !== last_tag)\n                return;\n\n            self.keys = keys;\n            self.state = \"ready\";\n            $(self).triggerHandler(\"changed\");\n        }\n\n        /*\n         * Splits up a strings like:\n         *\n         * 2048 SHA256:AAAAB3NzaC1yc2EAAAADAQ Comment Here (RSA)\n         * 2048 SHA256:AAAAB3NzaC1yc2EAAAADAQ (RSA)\n         */\n        var PUBKEY_RE = /^(\\S+)\\s+(\\S+)\\s+(.*)\\((\\S+)\\)$/;\n\n        function parse_pubkeys(input) {\n            var df = $.Deferred();\n            var keys = [];\n\n            cockpit.script(lister)\n                .input(input + \"\\n\")\n                .done(function(output) {\n                    var match, obj, i, line, lines = output.split(\"\\n\");\n                    for (i = 0; i + 1 < lines.length; i += 2) {\n                        line = lines[i];\n                        obj = { raw: lines[i + 1] };\n                        keys.push(obj);\n                        match = lines[i].trim().match(PUBKEY_RE);\n                        obj.valid = !!match && !!obj.raw;\n                        if (match) {\n                            obj.size = match[1];\n                            obj.fp = match[2];\n                            obj.comment = match[3].trim();\n                            if (obj.comment == \"authorized_keys\" || obj.comment == \"no comment\")\n                                obj.comment = null;\n                            obj.algorithm = match[4];\n\n                            /* Old ssh-keygen versions need us to find the comment ourselves */\n                            if (!obj.comment && obj.raw)\n                                obj.comment = obj.raw.split(\" \").splice(0, 2).join(\" \") || null;\n                        }\n                    }\n                })\n                .always(function() {\n                    df.resolve(keys);\n                });\n\n            return df.promise();\n        }\n\n        function parse_keys(content, tag, ex) {\n            last_tag = tag;\n\n            if (ex)\n                return process_failure(ex);\n\n            if (!content)\n                return update_keys([ ], tag);\n\n            parse_pubkeys(content)\n                .done(function(keys) {\n                    update_keys(keys, tag);\n                });\n        }\n\n        self.add_key = function(key) {\n            var df = $.Deferred();\n            df.notify(_(\"Validating key\"));\n            parse_pubkeys(key)\n                .done(function(keys) {\n                    var obj = keys[0];\n                    if (obj && obj.valid) {\n                        df.notify(_(\"Adding key\"));\n                        cockpit.script(adder, [ user_name, home_dir ], { superuser: \"try\", err: \"message\" })\n                            .input(obj.raw + \"\\n\")\n                            .done(function() {\n                                df.resolve();\n                            })\n                            .fail(function(ex) {\n                                df.reject(_(\"Error saving authorized keys: \") + ex);\n                            });\n                    } else {\n                        df.reject(_(\"The key you provided was not valid.\"));\n                    }\n                });\n\n            return df.promise();\n        };\n\n        self.remove_key = function(key) {\n            return file.modify(function(content) {\n                var i;\n                var lines = null;\n                var new_lines = [];\n\n                if (!content)\n                    return \"\";\n\n                new_lines = [];\n                lines = content.trim().split('\\n');\n                for (i = 0; i < lines.length; i++) {\n                    if (lines[i] === key)\n                        key = undefined;\n                    else\n                        new_lines.push(lines[i]);\n                }\n                return new_lines.join(\"\\n\");\n            });\n        };\n\n        self.close = function() {\n            if (watch)\n                watch.remove();\n\n            if (file)\n                file.close();\n        };\n\n        file = cockpit.file(filename, {'superuser': 'try'});\n        watch = file.watch(parse_keys);\n    }\n\n    module.exports = {\n        instance: function instance(user_name, home_dir) {\n            return new AuthorizedKeys(user_name, home_dir);\n        }\n    };\n}());\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../pkg/users/authorized-keys.js\n// module id = 5\n// module chunks = 0","module.exports = \"#!/bin/sh\\n\\ndir=$(mktemp -d)\\ncd \\\"$dir\\\"\\n\\nprocess()\\n{\\n    if [ -z \\\"$1\\\" ]; then\\n        return\\n    fi\\n    case \\\"$1\\\" in\\n    \\\\#*)\\n        ;;\\n    *)\\n        echo \\\"$1\\\"> authorized_keys\\n        echo \\\"$(LC_ALL=C ssh-keygen -l -f authorized_keys)\\\"\\n        echo \\\"$1\\\"\\n        ;;\\n    esac\\n}\\n\\nsed -e '$a\\\\' | while read -r line; do\\n    process \\\"$line\\\"\\ndone\\n\\nrm -f \\\"$dir/authorized_keys\\\"\\nrmdir \\\"$dir\\\"\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/raw-loader!../pkg/users/ssh-list-public-keys.sh\n// module id = 6\n// module chunks = 0","module.exports = \"#!/bin/sh\\n\\nset -euf\\nmkdir -p \\\"$2/.ssh\\\"\\ncd \\\"$2/.ssh\\\"\\n\\nchown $1 .\\n\\ntouch authorized_keys 2> /dev/null || true\\nchown $1 authorized_keys 2> /dev/null || true\\n\\nsed -i -e '$a\\\\' authorized_keys\\ncat >> authorized_keys\\n\\nchown $1 authorized_keys 2> /dev/null || true\\nchmod 600 authorized_keys\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/raw-loader!../pkg/users/ssh-add-public-key.sh\n// module id = 7\n// module chunks = 0","'use strict';\n\n(function() {\n    \"use strict\";\n\n    var $ = require('jquery');\n    var cockpit = require('cockpit');\n\n    var unique_number = 0;\n    function unique() {\n        unique_number += 1;\n        return \"unique\" + -(new Date()) + -unique_number;\n    }\n\n    /* Dialog Patterns */\n\n    function clear_errors(sel) {\n        sel.find(\".dialog-error\").remove();\n        sel.find(\".has-error\").removeClass(\"has-error\");\n        sel.find(\".dialog-wrapper\").off(\".dialog-error\");\n        sel.off(\".dialog-error\");\n    }\n\n    function field_error(target, error) {\n        var wrapper = target.parent();\n        var next, refresh;\n\n        if (!wrapper.is(\".dialog-wrapper\")) {\n            wrapper = $(\"<div class='dialog-wrapper'>\").insertBefore(target);\n\n            /*\n             * Some bootstrap plugins replace html controls with their own\n             * stuff, so we have to account for that here.\n             */\n\n            next = target.next();\n            if (next.is(\".bootstrap-select\") && next.selectpicker) {\n                next.remove();\n                refresh = next.selectpicker;\n            }\n\n            target.remove().appendTo(wrapper);\n\n            if (refresh)\n                refresh.call(target);\n        }\n\n        var message;\n        if (error.message)\n            message = $(\"<div class='dialog-error help-block'>\").text(error.message);\n        wrapper.addClass(\"has-error\").append(message);\n\n        if (!wrapper.hasClass(\"error-keep\")) {\n            wrapper.on(\"keypress.dialog-error change.dialog-error\", function() {\n                wrapper.removeClass(\"has-error\")\n                    .find(\".dialog-error.help-block\").css(\"visibility\", \"hidden\");\n            });\n        }\n    }\n\n    function global_error(sel, error) {\n        var alert = $(\"<div class='alert alert-danger dialog-error'>\");\n        var text = error.message || error.toString();\n        alert.text(text);\n        $(\"<span class='fa fa-exclamation-triangle'>\").prependTo(alert);\n\n        /* Always log global dialog errors for easier debugging */\n        console.warn(text);\n\n        var footer = sel.find(\".modal-footer\");\n        if (footer.length)\n            alert.prependTo(footer);\n        else\n            alert.appendTo(sel);\n    }\n\n    function display_errors(sel, errors) {\n        clear_errors(sel);\n\n        /* The list of errors can also be passed as an array */\n        if (errors.length == 1 && $.isArray(errors[0]))\n            errors = errors[0];\n\n        var any = false;\n        errors.forEach(function(error) {\n            var target;\n            if (error) {\n                target = sel.find(error.target);\n\n                /* Errors for a specific field added below that field */\n                if (target && target.length)\n                    field_error(target, error);\n                else\n                    global_error(sel, error);\n\n                any = true;\n            }\n        });\n\n        if (!any)\n            return;\n\n        /* When dialog is shown again, remove all mods */\n        sel.on(\"show.bs.modal.dialog-error\", function() {\n            clear_errors(sel);\n        });\n    }\n\n    function DialogWait(promise, handle) {\n        this.promise = promise;\n        this.disabled = [];\n        this.handle = handle;\n    }\n\n    function clear_wait(sel) {\n        var data = sel.data(\"dialog-wait\");\n        sel.data(\"dialog-wait\", null);\n\n        sel.find(\".dialog-wait-ct\").remove();\n        sel.find(\".btn\").off(\".dialog-wait\");\n        sel.off(\".dialog-wait\");\n\n        if (data) {\n            data.disabled.forEach(function(ctl) {\n                ctl.removeAttr(\"disabled\");\n            });\n        }\n    }\n\n    function display_wait(sel, promise, handle) {\n        clear_wait(sel);\n\n        if (!promise) {\n            if (handle)\n                sel.modal(\"hide\");\n            return sel;\n        }\n\n        /* Clear all errors in the dialog */\n        if (handle)\n            display_errors(sel, []);\n\n        var wait = $(\"<div class='dialog-wait-ct pull-left'>\");\n        $(\"<div class='spinner spinner-sm'>\").appendTo(wait);\n        var message = $(\"<span>\").appendTo(wait);\n\n        sel.find(\".modal-footer button\").first().before(wait);\n\n        var data = new DialogWait(promise, handle);\n        sel.data(\"dialog-wait\", data);\n\n        var cancellation = promise.cancel || promise.close;\n        var cancelled = false;\n\n        /* Disable everything and stash previous disabled state */\n        var controls = sel.find(\".form-control\").add(\".btn\", sel);\n        if (cancellation)\n            controls = controls.not(\"[data-dismiss]\").not(\".btn-cancel\");\n        controls.each(function() {\n            var ctl = $(this);\n            if (!ctl.attr(\"disabled\")) {\n                data.disabled.push(ctl);\n                ctl.attr(\"disabled\", \"disabled\");\n            }\n        });\n\n        sel.find(\".btn[data-dismiss], .btn-cancel\").on(\"click.dialog-wait\", function() {\n            cancelled = true;\n            if (cancellation)\n                cancellation.apply(promise);\n            return false;\n        });\n\n        /* When dialog is shown again, remove all mods */\n        sel.on(\"hide.bs.modal.dialog-wait\", function() {\n            clear_wait(sel);\n        });\n\n        /*\n         * There is no way to remove a callback from a promise\n         * so we have to be careful to only react if still\n         * processing the same promise.\n         */\n        function restore() {\n            var state, data = sel.data(\"dialog-wait\");\n            if (data && data.promise === promise) {\n                clear_wait(sel);\n                state = promise.state();\n                if (cancelled || (state == \"resolved\" && data.handle))\n                    sel.modal('hide');\n                else if (state == \"rejected\" && data.handle)\n                    display_errors(sel, [ arguments[0] ]);\n            }\n        }\n\n        function update(arg) {\n            var data = sel.data(\"dialog-wait\");\n            if (data && data.promise === promise) {\n                if (typeof arg !== \"string\")\n                    arg = \"\";\n                message.text(arg);\n            }\n        }\n\n        promise\n            .always(restore)\n            .progress(update);\n\n        return sel;\n    }\n\n    $.fn.dialog = function dialog(action /* ... */) {\n        if (action === \"failure\")\n            return display_errors(this, Array.prototype.slice.call(arguments, 1));\n        else if (action === \"wait\")\n            return display_wait(this, arguments[1]);\n        else if (action === \"promise\")\n            return display_wait(this, arguments[1], true);\n        else\n            console.warn(\"unknown dialog action: \" + action);\n    };\n\n    window.addEventListener(\"hashchange\", function() {\n        $(\".modal\").modal(\"hide\");\n    });\n\n    /*\n     * OnOff switch pattern\n     */\n\n    function onoff_refresh(sel) {\n        /* During testing, no Cockpit dependency */\n        var _ = cockpit.gettext || function(x) { return x; };\n\n        sel = sel.find(\".btn-onoff-ct\").andSelf().filter(\".btn-onoff-ct\");\n        sel.each(function(x, el) {\n            var self = $(el)\n                .attr(\"data-toggle\", \"buttons\")\n                .addClass(\"btn-group\");\n            var value = self.onoff(\"value\");\n            var buttons = self.find(\".btn\");\n            var name = self.find(\"input\").first().attr(\"name\") || unique();\n            var i, input, text;\n            for (i = buttons.length; i < 2; i++) {\n                input = $('<input type=\"radio\" autocomplete=\"off\">');\n                text = document.createTextNode(i === 0 ? _(\"On\") : _(\"Off\"));\n                self.append($('<label class=\"btn\">').append(input, text));\n                buttons = null;\n            }\n            buttons = buttons || self.find(\".btn\");\n            buttons.find(\"input\").attr(\"name\", name);\n            onoff_change(self, !!value);\n        });\n        return sel;\n    }\n\n    function onoff_value(sel) {\n        return sel.find(\".btn\").first().hasClass(\"active\");\n    }\n\n    function onoff_change(sel, value) {\n        return sel.each(function(i, el) {\n            var buttons = $(el).find(\".btn\");\n            buttons.first().toggleClass(\"active\", !!value).find(\"input\").prop(\"checked\", !!value);\n            buttons.last().toggleClass(\"active\", !value).find(\"input\").prop(\"checked\", !value);\n        });\n    }\n\n    $.fn.onoff = function onoff(action /* ... */) {\n        if (arguments.length === 0 || action == \"refresh\") {\n            return onoff_refresh(this);\n        } else if (action === \"value\") {\n            if (arguments.length === 1)\n                return onoff_value(this);\n            else\n                return onoff_change(this, arguments[1]);\n        } else if (action == \"disabled\") {\n            return this.find(\".btn\").toggleClass(\"disabled\", arguments[1]);\n        } else {\n            console.warn(\"unknown switch action: \" + action);\n        }\n    };\n\n    /* ----------------------------------------------------------------------------\n     * Sliders\n     *\n     * <div class=\"slider\" value=\"0.5\">\n     *    <div class=\"slider-bar\">\n     *        <div class=\"slider-thumb\"></div>\n     *    </div>\n     *    <div class=\"slider-bar\">\n     *        <!-- optional left overs -->\n     *    </div>\n     * </div>\n     *\n     * A slider control. The first div.slider-bar is the one that is resized.\n     * The value will be bounded between 0 and 1 as a floating point number.\n     *\n     * The following div.slider-bar if present is resized to fill the remainder\n     * of the slider if not given a specific size. You can put more div.slider-bar\n     * inside it to reflect squashing other prevous allocations.\n     *\n     * If the following div.slider-bar have a width specified, then the\n     * slider supports the concept of overflowing. If the slider overflows\n     * it will get the .slider-warning class and go a bit red.\n     *\n     * On document creation any div.slider are automatically turned into\n     * Bar graphs.\n     *\n     * Slider has the following extra read/write properties:\n     *\n     * .value: the floating point value the slider is set to.\n     * .disabled: whether to display slider as disabled and refuse interacton.\n     *\n     * Slider has this event:\n     *\n     * on('change'): fired when the slider changes, passes value as additional arg.\n     */\n\n    function resize_flex(slider, flex, total, part) {\n        var value = 0;\n        if (part > total)\n            value = 1;\n        else if (part < 0 || isNaN(part))\n            value = 0;\n        else if (!isNaN(total) && total > 0 && part >= 0)\n            value = (part / total);\n        $(flex).css('width', (value * 100) + \"%\").\n            next(\"div\").css('margin-left', $(flex).css('width'));\n\n        /* Set the property and the attribute */\n        slider.value = value;\n    }\n\n    function update_value(slider) {\n        resize_flex(slider, $(slider).children(\"div.slider-bar\").first()[0], 1, slider.value);\n    }\n\n    function check_overflow(slider) {\n        $(slider).toggleClass(\"slider-warning\",\n                              slider.offsetWidth < slider.scrollWidth);\n    }\n\n    function setup_slider(slider) {\n        $(slider).attr('unselectable', 'on');\n\n        Object.defineProperty(slider, \"value\", {\n            get: function() {\n                return parseFloat(this.getAttribute(\"value\"));\n            },\n            set: function(v) {\n                var s = String(v);\n                if (s != this.getAttribute(\"value\"))\n                    this.setAttribute(\"value\", v);\n            }\n        });\n\n        Object.defineProperty(slider, \"disabled\", {\n            get: function() {\n                if (!this.hasAttribute(\"disabled\"))\n                    return false;\n                return this.getAttribute(\"disabled\").toLowerCase() != \"false\";\n            },\n            set: function(v) {\n                this.setAttribute(\"disabled\", v ? \"true\" : \"false\");\n            }\n        });\n\n        update_value(slider);\n        check_overflow(slider);\n\n        $(slider).on(\"change\", function() {\n            update_value(slider);\n            $(slider).toggleClass(\"slider-disabled\", slider.disabled);\n        });\n\n        if (slider.disabled)\n            $(slider).addClass(\"slider-disabled\");\n\n        $(slider).on(\"mousedown\", function(ev) {\n            if (slider.disabled)\n                return true; /* default action */\n            var flex;\n            var offset = $(slider).offset().left;\n            if ($(ev.target).hasClass(\"slider-thumb\")) {\n                var hitx  = (ev.offsetX || ev.clientX - $(ev.target).offset().left);\n                offset += (hitx - $(ev.target).outerWidth() / 2);\n                flex = $(ev.target).parent()[0];\n            } else {\n                flex = $(slider).children(\"div.slider-bar\").first()[0];\n                resize_flex(slider, flex, $(slider).width(), (ev.pageX - offset));\n                $(slider).trigger(\"change\", [slider.value]);\n                check_overflow(slider);\n            }\n\n            $(document).\n                on(\"mousemove.slider\", function(ev) {\n                    resize_flex(slider, flex, $(slider).width(), (ev.pageX - offset));\n                    $(slider).trigger(\"change\", [slider.value]);\n                    check_overflow(slider);\n                    return false;\n                }).\n                on(\"mouseup.slider\", function(ev) {\n                    $(document).\n                        off(\"mousemove.slider\").\n                        off(\"mouseup.slider\");\n                    return false;\n                });\n            return false; /* no default action */\n        });\n    }\n\n    function setup_sliders() {\n        $(\"div.slider\").each(function() {\n            setup_slider(this);\n        });\n    }\n\n    $.fn.slider = function Slider(action) {\n        var sel = this;\n        var div;\n        if (arguments.length === 0 || action == \"refresh\") {\n            sel.each(function() {\n                setup_slider(this);\n            });\n            return sel;\n        } else {\n            console.warn(\"unknown slider action: \" + action);\n        }\n    };\n\n    $(document).ready(setup_sliders);\n\n    /* -----------------------------------------------------------------------------\n     * Privileged UI actions.\n     */\n\n    // placement is optional, \"top\", \"left\", \"bottom\", \"right\"\n    $.fn.update_privileged = function update_privileged(perm, denied_message, placement) {\n        var allowed = (perm.allowed !== false);\n        var selector = this;\n\n        selector.each(function() {\n            // preserve old title first time to use when allowed\n            // activate tooltip\n            var allowed_key = 'allowed-title';\n            if (typeof $(this).data(allowed_key) === 'undefined' ||\n                   $(this).data(allowed_key) === false)\n                $(this).data(allowed_key, $(this).attr('title') || \"\");\n\n            var options = { html: true };\n            if (placement)\n                options['placement'] = placement;\n\n            $(this).tooltip(options);\n\n            if ($(this).hasClass(\"disabled\") === allowed) {\n              $(this).toggleClass(\"disabled\", !allowed)\n                   .attr('data-original-title', null);\n\n              if (allowed)\n                  $(this).attr('title', $(this).data(allowed_key));\n              else\n                  $(this).attr('title', denied_message);\n              $(this).tooltip('fixTitle');\n            }\n        });\n\n        return selector;\n    };\n}());\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../pkg/lib/patterns.js\n// module id = 8\n// module chunks = 0"],"sourceRoot":""}