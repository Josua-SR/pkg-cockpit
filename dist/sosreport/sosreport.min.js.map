{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"jQuery\"","webpack:///external \"cockpit\"","webpack:///../pkg/sosreport/run-sosreport.sh","webpack:///../pkg/sosreport/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","jQuery","cockpit","sos_task","sos_archive_url","sos_archive_files","_","gettext","sos_init","$","css","hide","text","task","script","run_sosreport_sh","superuser","err","pty","output","plugins_count","progress_regex","finishing_regex","starting_regex","archive_regex","stream","lines","split","length","exec","parseInt","show","toString","done","archive","basename","replace","indexOf","substr","query","window","btoa","JSON","stringify","payload","binary","path","max_read_size","external","prefix","URL","transport","uri","csrf_token","pathname","sos_error","fail","error","sos_create","message","extra","sos_cancel","close","spawn","concat","console","log","modal","sos_download","iframe","attr","on","event","title","contentDocument","append","translate","wait"],"mappings":"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","file":"sosreport/sosreport.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","module.exports = jQuery;","module.exports = cockpit;","module.exports = \"#! /bin/bash\\n\\npresent () {\\n    which \\\"$1\\\" >/dev/null 2>/dev/null\\n}\\n\\nif present sosreport; then\\n    exec sosreport \\\"$@\\\"\\nelif present atomic; then\\n\\n    # HACK - sosreport inside the container does not behave as\\n    #        advertised, so we fix it via --sysroot and --tmp-dir.\\n    #\\n    # https://bugzilla.redhat.com/show_bug.cgi?id=1299794\\n    # https://bugzilla.redhat.com/show_bug.cgi?id=1277223\\n\\n    exec atomic run rhel7/support-tools -- sosreport --sysroot /host --tmp-dir /host/var/tmp \\\"$@\\\"\\nelse\\n    echo >&2 \\\"The sosreport utility is not installed.  This should not happen.  Please complain to your distribution vendor.\\\"\\n    exit 1\\nfi\\n\"","/*\n * This file is part of Cockpit.\n *\n * Copyright (C) 2015 Red Hat, Inc.\n *\n * Cockpit is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation; either version 2.1 of the License, or\n * (at your option) any later version.\n *\n * Cockpit is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with Cockpit; If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport cockpit from \"cockpit\";\nimport $ from \"jquery\";\n\nimport run_sosreport_sh from \"raw-loader!./run-sosreport.sh\";\n\nconst _ = cockpit.gettext;\n\nvar sos_task;\nvar sos_archive_url;\nvar sos_archive_files;\n\nfunction sos_init() {\n    // Start right away\n    sos_create();\n}\n\nfunction sos_error(message, extra) {\n    $(\"#sos-alert, #sos-progress, #sos-download\").hide();\n    $(\"#sos-error .alert-message\").text(message);\n    if (extra) {\n        $(\"#sos-error-extra\").text(extra);\n        $(\"#sos-error-extra\").show();\n    } else\n        $(\"#sos-error-extra\").hide();\n    $(\"#sos-error\").show();\n    $(\"#sos-cancel\").text(_(\"Close\"));\n}\n\nfunction sos_create() {\n    $(\"#sos-progress .progress-bar\").css(\"width\", \"0%\");\n    $(\"#sos-download, #sos-error\").hide();\n    $(\"#sos-cancel\").text(_(\"Cancel\"));\n\n    sos_archive_url = null;\n    sos_archive_files = [ ];\n\n    var task = cockpit.script(run_sosreport_sh, [ \"--batch\" ],\n                              { superuser: true, err: \"out\", pty: true });\n    sos_task = task;\n\n    // TODO - Use a real API instead of scraping stdout once such\n    //        an API exists.\n\n    var output = \"\";\n    var plugins_count = 0;\n    var progress_regex = /Running ([0-9]+)\\/([0-9]+):/; // Only for sos < 3.6\n    var finishing_regex = /Finishing plugins.*\\[Running: (.*)\\]/;\n    var starting_regex = /Starting ([0-9]+)\\/([0-9]+).*\\[Running: (.*)\\]/;\n    var archive_regex = /Your sosreport has been generated and saved in:[ \\r\\n]+(\\/[^\\r\\n]+)/;\n\n    task.stream(function (text) {\n        if (sos_task == task) {\n            var m, p;\n            p = 0;\n\n            output += text;\n            var lines = output.split(\"\\n\");\n            for (var i = lines.length - 1; i >= 0; i--) {\n                if ((m = starting_regex.exec(lines[i]))) {\n                    plugins_count = parseInt(m[2], 10);\n                    p = ((parseInt(m[1], 10) - m[3].split(\" \").length) / plugins_count) * 100;\n                    break;\n                } else if ((m = finishing_regex.exec(lines[i]))) {\n                    if (!plugins_count)\n                        p = 100;\n                    else\n                        p = ((plugins_count - m[1].split(\" \").length) / plugins_count) * 100;\n                    break;\n                } else if ((m = progress_regex.exec(lines[i]))) {\n                    p = (parseInt(m[1], 10) / parseInt(m[2], 10)) * 100;\n                    break;\n                }\n            }\n            $(\"#sos-alert, #sos-progress\").show();\n            $(\"#sos-progress .progress-bar\").css(\"width\", p.toString() + \"%\");\n        }\n    });\n    task.done(function () {\n        if (sos_task == task) {\n            var m = archive_regex.exec(output);\n            if (m) {\n                var archive = m[1];\n                var basename = archive.replace(/.*\\//, \"\");\n\n                // When running sosreport in a container on the\n                // Atomics, the archive path needs to be adjusted.\n                //\n                if (archive.indexOf(\"/host\") === 0)\n                    archive = archive.substr(5);\n\n                sos_archive_files = [ archive, archive + \".md5\" ];\n\n                var query = window.btoa(JSON.stringify({\n                    payload: \"fsread1\",\n                    binary: \"raw\",\n                    path: archive,\n                    superuser: true,\n                    max_read_size: 150 * 1024 * 1024,\n                    external: {\n                        \"content-disposition\": 'attachment; filename=\"' + basename + '\"',\n                        \"content-type\": \"application/x-xz, application/octet-stream\"\n                    }\n                }));\n                var prefix = (new URL(cockpit.transport.uri(\"channel/\" + cockpit.transport.csrf_token))).pathname;\n                sos_archive_url = prefix + '?' + query;\n                $(\"#sos-progress, #sos-error\").hide();\n                $(\"#sos-alert, #sos-download\").show();\n                $(\"#sos-cancel\").text(_(\"Close\"));\n            } else {\n                sos_error(_(\"No archive has been created.\"), output);\n            }\n            sos_task = null;\n        }\n    });\n    task.fail(function (error) {\n        if (sos_task == task) {\n            sos_error(error.toString(), output);\n            sos_task = null;\n        }\n    });\n}\n\nfunction sos_cancel() {\n    if (sos_task) {\n        sos_task.close(\"cancelled\");\n        sos_task = null;\n    }\n    if (sos_archive_files.length > 0) {\n        cockpit.spawn([ \"rm\" ].concat(sos_archive_files), { superuser: true, err: \"message\" })\n                .fail(function (error) {\n                    console.log(\"failed to remove\", sos_archive_files, error);\n                });\n    }\n    sos_archive_url = null;\n    sos_archive_files = [ ];\n    $(\"#sos\").modal('hide');\n}\n\nfunction sos_download() {\n    // We download via a hidden iframe to get better control over\n    // the error cases.\n    var iframe = $('<iframe>').attr('src', sos_archive_url)\n            .hide();\n    iframe.on('load', function (event) {\n        var title = iframe.get(0).contentDocument.title;\n        if (title)\n            sos_error(title);\n    });\n    $('body').append(iframe);\n}\n\nfunction init() {\n    $(function () {\n        $(\"#sos\").on(\"show.bs.modal\", sos_init);\n        $(\"#sos-cancel\").on(\"click\", sos_cancel);\n        $('#sos-download button').on('click', sos_download);\n\n        cockpit.translate();\n        $('body').show();\n\n        // Send a 'init' message.  This tells the tests that we\n        // are ready to go.\n        //\n        cockpit.transport.wait(function () { });\n    });\n}\n\ninit();\n"],"sourceRoot":""}