{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"cockpit\"","webpack:///../pkg/playground/speed.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","cockpit","channel","websocket","timer","start","total","proc","update","element","document","getElementById","innerHTML","format_bytes_per_sec","Date","now","console","log","memory","pid","script","then","data","parts","split","ex","String","echo","ev","stop","sideband","target","id","length","parseInt","batch","interval","isNaN","window","alert","binary","checked","options","payload","input","ArrayBuffer","Array","join","generate","WebSocket","transport","uri","csrf_token","btoa","JSON","stringify","binaryType","onopen","send","setInterval","onmessage","event","byteLength","onclose","addEventListener","problem","read","path","max_read_size","download","anchor","external","content-disposition","content-type","indexOf","createElement","href","hostname","port","pathname","prefix","URL","query","open","close","ws","clearInterval","wait","body","style","display"],"mappings":"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","file":"playground/speed.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 27);\n","module.exports = cockpit;","import cockpit from \"cockpit\";\n\nvar channel = null;\nvar websocket = null;\nvar timer = null;\nvar start = null;\nvar total = 0;\nvar proc = null;\n\nfunction update() {\n    var element = document.getElementById(\"speed\");\n    if (channel || websocket) {\n        element.innerHTML = cockpit.format_bytes_per_sec((total * 1000) / (Date.now() - start));\n        console.log(total);\n    } else {\n        element.innerHTML = \"\";\n    }\n\n    var memory = document.getElementById(\"memory\");\n    var pid = document.getElementById(\"pid\");\n    if (!proc) {\n        proc = cockpit.script(\"echo $PPID && cat /proc/$PPID/statm\");\n        proc.then(function(data) {\n            var parts = data.split(\"\\n\");\n            pid.innerHTML = parts[0];\n            memory.innerHTML = parts[1];\n            proc = null;\n        }, function(ex) {\n            memory.innerHTML = String(ex);\n            proc = null;\n        });\n    }\n}\n\nfunction echo(ev) {\n    stop();\n\n    var sideband = ev.target.id == \"echo-sideband\";\n\n    function generate(length, binary) {\n        if (binary)\n            return new window.ArrayBuffer(length);\n        else\n            return (new Array(length)).join(\"x\");\n    }\n\n    var length = parseInt(document.getElementById(\"message\").value, 10);\n    var batch = parseInt(document.getElementById(\"batch\").value, 10);\n    var interval = parseInt(document.getElementById(\"interval\").value, 10);\n\n    if (isNaN(length) || isNaN(interval) || isNaN(batch)) {\n        window.alert(\"Bad value\");\n        return;\n    }\n\n    var binary = document.getElementById.checked;\n    var options = { payload: \"echo\" };\n    var input = generate(length, binary);\n    start = new Date();\n    total = 0;\n\n    if (sideband) {\n        if (binary)\n            options.binary = \"raw\";\n\n        websocket = new window.WebSocket(cockpit.transport.uri(\"channel/\" + cockpit.transport.csrf_token) +\n            \"?\" + window.btoa(JSON.stringify(options)));\n        websocket.binaryType = 'arraybuffer';\n\n        websocket.onopen = function() {\n            for (var i = 0; i < batch; i++)\n                websocket.send(input);\n            timer = window.setInterval(function() {\n                for (var i = 0; i < batch; i++)\n                    websocket.send(input);\n            }, interval);\n        };\n\n        websocket.onmessage = function(event) {\n            if (binary)\n                total += event.data.byteLength;\n            else\n                total += event.data.length;\n        };\n\n        websocket.onclose = function(event) {\n            if (websocket)\n                window.alert(\"channel closed\");\n            stop();\n        };\n    } else {\n        if (binary)\n            options.binary = true;\n\n        channel = cockpit.channel(options);\n\n        channel.addEventListener(\"message\", function(event, data) {\n            total += data.length;\n        });\n        channel.addEventListener(\"close\", function(event, options) {\n            if (options.problem)\n                window.alert(options.problem);\n            stop();\n        });\n\n        for (var i = 0; i < batch; i++)\n            channel.send(input);\n\n        timer = window.setInterval(function() {\n            for (var i = 0; i < batch; i++)\n                channel.send(input);\n        }, interval);\n    }\n}\n\nfunction read(ev) {\n    stop();\n\n    var sideband = ev.target.id == \"read-sideband\";\n    var path = document.getElementById(\"read-path\");\n\n    var options = {\n        payload: \"fsread1\",\n        path: path.value,\n        max_read_size: 100 * 1024 * 1024 * 1024,\n        binary: sideband ? \"raw\" : true,\n    };\n\n    start = Date.now();\n    total = 0;\n\n    if (sideband) {\n        websocket = new window.WebSocket(cockpit.transport.uri(\"channel/\" + cockpit.transport.csrf_token) +\n            \"?\" + window.btoa(JSON.stringify(options)));\n        websocket.binaryType = 'arraybuffer';\n        websocket.onmessage = function(event) {\n            total += event.data.byteLength;\n        };\n        websocket.onclose = function(event) {\n            if (websocket)\n                window.alert(\"channel closed\");\n            stop();\n        };\n    } else {\n        channel = cockpit.channel(options);\n        channel.addEventListener(\"message\", function(event, data) {\n            total += data.length;\n        });\n        channel.addEventListener(\"close\", function(event, options) {\n            if (options.problem)\n                window.alert(options.problem);\n            stop();\n        });\n    }\n}\n\nfunction download(ev) {\n    stop();\n\n    var path = document.getElementById(\"download-path\");\n    var anchor;\n\n    var options = {\n        binary: \"raw\",\n        max_read_size: 100 * 1024 * 1024 * 1024,\n        external: {\n            \"content-disposition\": 'attachment; filename=\"download\"',\n            \"content-type\": \"application/octet-stream\"\n        }\n    };\n\n    /* Allow use of HTTP URLs */\n    if (path.value.indexOf(\"http\") === 0) {\n        anchor = document.createElement(\"a\");\n        anchor.href = path.value;\n        options[\"payload\"] = \"http-stream2\";\n        options[\"address\"] = anchor.hostname;\n        options[\"port\"] = parseInt(anchor.port, 10);\n        options[\"path\"] = anchor.pathname;\n        options[\"method\"] = \"GET\";\n    } else {\n        options[\"payload\"] = \"fsread1\";\n        options[\"path\"] = path.value;\n    }\n\n    console.log(\"Download\", options);\n\n    start = Date.now();\n    total = 0;\n\n    var prefix = (new URL(cockpit.transport.uri(\"channel/\" + cockpit.transport.csrf_token))).pathname;\n    var query = window.btoa(JSON.stringify(options));\n    window.open(prefix + \"?\" + query);\n}\n\nfunction stop() {\n    update();\n\n    if (channel)\n        channel.close();\n    channel = null;\n    var ws = websocket;\n    websocket = null;\n    if (ws)\n        ws.close();\n\n    window.clearInterval(timer);\n    timer = null;\n}\n\ncockpit.transport.wait(function() {\n    document.getElementById(\"echo-normal\").addEventListener(\"click\", echo);\n    document.getElementById(\"echo-sideband\").addEventListener(\"click\", echo);\n    document.getElementById(\"read-normal\").addEventListener(\"click\", read);\n    document.getElementById(\"read-sideband\").addEventListener(\"click\", read);\n    document.getElementById(\"download-external\").addEventListener(\"click\", download);\n    document.getElementById(\"stop\").addEventListener(\"click\", stop);\n    window.setInterval(update, 500);\n    document.body.style.display = \"block\";\n});\n"],"sourceRoot":""}