{"version":3,"sources":["dist/base1/cockpit.js"],"names":["url_root","window","localStorage","getItem","e","mock","cockpit","event_mixin","debugging","sessionStorage","in_array","array","val","length","i","is_array","it","Object","prototype","toString","call","is_function","x","is_object","is_plain_object","is_negative","n","extend","to","j","len","key","from","arguments","undefined","invoke_functions","functions","self","args","apply","default_transport","public_transport","reload_after_disconnect","expect_disconnect","init_callback","default_host","process_hints","incoming_filters","outgoing_filters","transport_origin","location","origin","protocol","hostname","port","array_from_raw_string","str","constructor","data","Array","charCodeAt","array_to_raw_string","String","fromCharCode","uint6_to_b64","base64_encode","btoa","ArrayBuffer","Uint8Array","mod3","uint24","substr","b64_to_uint6","base64_decode","atob","ilen","eq","olen","mod4","oi","ii","addEventListener","transport_debug","console","debug","obj","handlers","defineProperties","enumerable","value","type","handler","push","removeEventListener","dispatchEvent","event","slice","detail","CustomEvent","bubbles","cancelable","unshift","calculate_application","path","pathname","_url_root","indexOf","replace","split","calculate_url","suffix","window_loc","url","prefix","host","join_data","buffers","binary","join","k","total","set","ParentWebSocket","parent","this","readyState","receive","source","byteLength","onclose","onmessage","send","message","postMessage","close","setTimeout","onopen","parse_channel","pos","channel","warn","subarray","substring","Transport","application","last_channel","channel_seed","last_transport","ws","check_health_timer","ignore_health_check","got_message","name","options","ex","ws_loc","WebSocket","MozWebSocket","error","setInterval","ready","log","problem","control_cbs","message_cbs","waiting_for_init","ready_for_channels","binaryType","reload","dispatch_data","arg","payload","control","JSON","parse","process_control","process_message","command","clearInterval","ows","chan","next_channel","process_init","version","csrf_token","func","send_control","send_data","send_message","output","buffer","hint","stringify","register","control_cb","message_cb","unregister","ensure_transport","callback","transport","Channel","closed","waiting","received_done","sent_done","id","queue","valid","on_message","on_close","resolve","on_ready","on_control","done","send_payload","trans","item","shift","wait","defer","reject","promise","then","squash","consumed","block","resolve_path_dots","parts","out","part","pop","factory","event_target","manifests","Utf8TextEncoder","encoding","encode","string","unescape","encodeURIComponent","Utf8TextDecoder","fatal","decode","stream","beg","p","ok","decodeURIComponent","escape","utf8_encoder","utf8_decoder","kill","group","inject","filter","uri","later_queue","later_timeout","later_drain","later_invoke","promise_then","state","fulfilled","rejected","updated","result","Deferred","pending","status","schedule_process_queue","create_promise","Promise","target","catch_","finally_","handle_callback","fail","always","progress","state_","process_queue","fn","deferred","process_scheduled","pur","values","deferred_resolve","deferred_reject","deferred_notify","callbacks","notify","Error","prep_promise","resolved","is_resolved","callback_output","when","all","promises","counter","results","forEach","fmt_re","format","fmt","m","y","format_number","number","lang","language","toLocaleString","toFixed","maximumSignificantDigits","minimumSignificantDigits","format_units","suffixes","factor","separate","quotient","keys","divisor","sort","reverse","Math","pow","string_representation","ret","byte_suffixes","1000","1024","format_bytes","get_byte_units","guide_value","unit","index","units","selected","byte_sec_suffixes","format_bytes_per_sec","bit_suffixes","format_bits_per_sec","StorageHelper","storageName","storage","prefixedKey","both","setItem","removeItem","clear","full","lookup_storage","win","StorageCache","org_key","provider","consumer","trigger","last","claimed","floor","random","ev","document","createEvent","initStorageEvent","claim","claiming","changed","unclaim","current_value","parseInt","newValue","oldValue","new_value","cache","SeriesSink","interval","identifier","fetch_callback","limit","setup_index","count","head","tail","search","idx","low","high","mid","fetch","end","for_walking","stash","load","at","entry","b","eb","en","fetches","items","max","min","process","mapping","num","splice","next","registered","_register","grid","gdata","links","remove","jlen","klen","row","map","f","t","input","remove_sink","series","unique","SeriesGrid","rows","sinks","suppress","walking","offset","add","sink","cb","sync","move_internal","stop_walking","move","now","Date","walk","start","BasicError","logout","disconnect","drop_privileges","info","system","the_user","user","dfd","dbus","bus","reply","Id","v","Name","full_name","Full","groups","Groups","home","Home","shell","Shell","classList","stopPropagation","last_loc","get_window_location_hash","href","Location","decode_path","pre_parts","concat","with_root","opt","query","push_option","first","hasOwnProperty","href_for_go_or_replace","go","hash","writable","defineProperty","get","jump","hiddenProp","hiddenHint","visibility_change","hidden","mozHidden","msHidden","webkitHidden","ProcessError","exit_status","exit_signal","_","trim","spawn_debug","spawn","bind","script","dbus_debug","DBusError","arg1","DBusCache","meta","connect","iface","emit","props","copy","update","lookup","each","ifa","DBusProxy","client","defined","waits","$","expando","define","methods","toLowerCase","properties","config","prop","flags","variant","signal","subscribe","interface","waited","watch","DBusProxies","path_namespace","match","proxy","DBusClient","track","owner","unique_name","subscribers","published","calls","constructors","*","ensure_cache","matches","member","arg0","msg","subscription","handle","close_perform","outstanding","last_cookie","method","method_call","rule","add-match","prev","remove-match","unwatch","unknown_interface","unknown_method","not_implemented","invoke","object","cookie","publish","unpublish","Constructor","proxies","shared_dbus","internal","session","shared","old_close","byte_array","file","read","modify","base_channel_options","syntax","read_promise","read_channel","opts","try_read","content_parts","fire_watch_callbacks","content","tag","replace_channel","new_content","expected_tag","file_content","batch","initial_content","initial_tag","new_tag","read_then_update","watch_callbacks","n_watch_callbacks","watch_channel","watch_tag","ensure_watch_channel","message_string","po_data","po_plural","locale","po","header","translate","what","w","wlen","tlen","list","tasks","el","querySelectorAll","getAttribute","textContent","gettext","setAttribute","removeAttribute","context","translated","imply","ngettext","string1","stringN","noop","HttpError","reason","valueOf","http_debug","find_header","headers","HttpClient","endpoint","active_requests","unix","isNaN","address","capabilities","param","request","req","params","body","streamer","responsers","resp","response","post","reqs","http","check_superuser","ch","superuser","Permission","allowed","is_superuser","_is_superuser","admin","decide","includes","permission","MetricsChannel","options_list","channels","following","fetch_for_series","archives","follow","transfer","is_archive","archive_source","close_options","last_len","dataj","dataj_len","lastj","lastj_len","timestamp","message_len","drain","metrics","metric","","metrics_path_names","instances","instance","archive_options_list","oops","old_onerror","onerror","line","self_module_id","scripts","src","lastIndexOf","amd"],"mappings":"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","sourcesContent":["/*\n * This file is part of Cockpit.\n *\n * Copyright (C) 2014 Red Hat, Inc.\n *\n * Cockpit is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation; either version 2.1 of the License, or\n * (at your option) any later version.\n *\n * Cockpit is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with Cockpit; If not, see <http://www.gnu.org/licenses/>.\n */\n\n/* eslint-disable indent,no-empty */\n\nvar url_root;\n\ntry {\n    // Sometimes this throws a SecurityError such as during testing\n    url_root = window.localStorage.getItem('url-root');\n} catch (e) { }\n\n/* injected by tests */\nvar mock = mock || { }; // eslint-disable-line no-use-before-define\n\n(function() {\nvar cockpit = { };\nevent_mixin(cockpit, { });\n\nif (typeof window.debugging === \"undefined\") {\n    try {\n        // Sometimes this throws a SecurityError such as during testing\n        window.debugging = window.sessionStorage[\"debugging\"] ||\n                           window.localStorage[\"debugging\"];\n    } catch (e) { }\n}\n\nfunction in_array(array, val) {\n    var length = array.length;\n    for (var i = 0; i < length; i++) {\n        if (val === array[i])\n            return true;\n    }\n    return false;\n}\n\n/* HACK: http://web.mit.edu/jwalden/www/isArray.html */\nfunction is_array(it) {\n    return Object.prototype.toString.call(it) === '[object Array]';\n}\n\nfunction is_function(x) {\n    return typeof x === 'function';\n}\n\nfunction is_object(x) {\n    return x !== null && typeof x === 'object';\n}\n\nfunction is_plain_object(x) {\n    return is_object(x) && Object.prototype.toString.call(x) === '[object Object]';\n}\n\n/* Also works for negative zero */\nfunction is_negative(n) {\n    return ((n = +n) || 1 / n) < 0;\n}\n\n/* Object.assign() workalike */\nfunction extend(to/* , from ... */) {\n    var j, len, key, from;\n    for (j = 1, len = arguments.length; j < len; j++) {\n        from = arguments[j];\n        if (from) {\n            for (key in from) {\n                if (from[key] !== undefined)\n                    to[key] = from[key];\n            }\n        }\n    }\n    return to;\n}\n\nfunction invoke_functions(functions, self, args) {\n    var length = functions ? functions.length : 0;\n    for (var i = 0; i < length; i++) {\n        if (functions[i])\n            functions[i].apply(self, args);\n    }\n}\n\n/* -------------------------------------------------------------------------\n * Channels\n *\n * Public: https://cockpit-project.org/guide/latest/api-base1.html\n */\n\nvar default_transport = null;\nvar public_transport = null;\nvar reload_after_disconnect = false;\nvar expect_disconnect = false;\nvar init_callback = null;\nvar default_host = null;\nvar process_hints = null;\nvar incoming_filters = null;\nvar outgoing_filters = null;\n\nvar transport_origin = window.location.origin;\n\nif (!transport_origin) {\n    transport_origin = window.location.protocol + \"//\" + window.location.hostname +\n        (window.location.port ? ':' + window.location.port : '');\n}\n\nfunction array_from_raw_string(str, constructor) {\n    var length = str.length;\n    var data = new (constructor || Array)(length);\n    for (var i = 0; i < length; i++)\n        data[i] = str.charCodeAt(i) & 0xFF;\n    return data;\n}\n\nfunction array_to_raw_string(data) {\n    var length = data.length;\n    var str = \"\";\n    for (var i = 0; i < length; i++)\n        str += String.fromCharCode(data[i]);\n    return str;\n}\n\n/*\n * These are the polyfills from Mozilla. It's pretty nasty that\n * these weren't in the typed array standardization.\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\n */\n\nfunction uint6_to_b64 (x) {\n    return x < 26 ? x + 65 : x < 52 ? x + 71 : x < 62 ? x - 4 : x === 62 ? 43 : x === 63 ? 47 : 65;\n}\n\nfunction base64_encode(data) {\n    if (typeof data === \"string\")\n        return window.btoa(data);\n    /* For when the caller has chosen to use ArrayBuffer */\n    if (data instanceof window.ArrayBuffer)\n        data = new window.Uint8Array(data);\n    var length = data.length;\n    var mod3 = 2;\n    var str = \"\";\n    for (var uint24 = 0, i = 0; i < length; i++) {\n        mod3 = i % 3;\n        uint24 |= data[i] << (16 >>> mod3 & 24);\n        if (mod3 === 2 || length - i === 1) {\n            str += String.fromCharCode(uint6_to_b64(uint24 >>> 18 & 63),\n                                       uint6_to_b64(uint24 >>> 12 & 63),\n                                       uint6_to_b64(uint24 >>> 6 & 63),\n                                       uint6_to_b64(uint24 & 63));\n            uint24 = 0;\n        }\n    }\n\n    return str.substr(0, str.length - 2 + mod3) + (mod3 === 2 ? '' : mod3 === 1 ? '=' : '==');\n}\n\nfunction b64_to_uint6 (x) {\n    return x > 64 && x < 91 ? x - 65 : x > 96 && x < 123\n        ? x - 71 : x > 47 && x < 58 ? x + 4 : x === 43 ? 62 : x === 47 ? 63 : 0;\n}\n\nfunction base64_decode(str, constructor) {\n    if (constructor === String)\n        return window.atob(str);\n    var ilen = str.length;\n    for (var eq = 0; eq < 3; eq++) {\n        if (str[ilen - (eq + 1)] != '=')\n            break;\n    }\n    var olen = (ilen * 3 + 1 >> 2) - eq;\n    var data = new (constructor || Array)(olen);\n    for (var mod3, mod4, uint24 = 0, oi = 0, ii = 0; ii < ilen; ii++) {\n        mod4 = ii & 3;\n        uint24 |= b64_to_uint6(str.charCodeAt(ii)) << 18 - 6 * mod4;\n        if (mod4 === 3 || ilen - ii === 1) {\n            for (mod3 = 0; mod3 < 3 && oi < olen; mod3++, oi++)\n                data[oi] = uint24 >>> (16 >>> mod3 & 24) & 255;\n            uint24 = 0;\n        }\n    }\n    return data;\n}\n\nwindow.addEventListener('beforeunload', function() {\n    expect_disconnect = true;\n}, false);\n\nfunction transport_debug() {\n    if (window.debugging == \"all\" || window.debugging == \"channel\")\n        console.debug.apply(console, arguments);\n}\n\n/*\n * Extends an object to have the standard DOM style addEventListener\n * removeEventListener and dispatchEvent methods. The dispatchEvent\n * method has the additional capability to create a new event from a type\n * string and arguments.\n */\nfunction event_mixin(obj, handlers) {\n    Object.defineProperties(obj, {\n        addEventListener: {\n            enumerable: false,\n            value: function addEventListener(type, handler) {\n                if (handlers[type] === undefined)\n                    handlers[type] = [ ];\n                handlers[type].push(handler);\n            }\n        },\n        removeEventListener: {\n            enumerable: false,\n            value: function removeEventListener(type, handler) {\n                var length = handlers[type] ? handlers[type].length : 0;\n                for (var i = 0; i < length; i++) {\n                    if (handlers[type][i] === handler) {\n                        handlers[type][i] = null;\n                        break;\n                    }\n                }\n            }\n        },\n        dispatchEvent: {\n            enumerable: false,\n            value: function dispatchEvent(event) {\n                var type, args;\n                if (typeof event === \"string\") {\n                    type = event;\n                    args = Array.prototype.slice.call(arguments, 1);\n\n                    var detail = null;\n                    if (arguments.length == 2)\n                        detail = arguments[1];\n                    else if (arguments.length > 2)\n                        detail = args;\n\n                    event = new CustomEvent(type, {\n                        bubbles: false,\n                        cancelable: false,\n                        detail: detail\n                    });\n\n                    args.unshift(event);\n                } else {\n                    type = event.type;\n                    args = arguments;\n                }\n                if (is_function(obj['on' + type]))\n                    obj['on' + type].apply(obj, args);\n                invoke_functions(handlers[type], obj, args);\n            }\n        }\n    });\n}\n\nfunction calculate_application() {\n    var path = window.location.pathname || \"/\";\n    var _url_root = url_root;\n    if (window.mock && window.mock.pathname)\n        path = window.mock.pathname;\n    if (window.mock && window.mock.url_root)\n        _url_root = window.mock.url_root;\n\n    if (_url_root && path.indexOf('/' + _url_root) === 0)\n        path = path.replace('/' + _url_root, '') || '/';\n\n    if (path.indexOf(\"/cockpit/\") !== 0 && path.indexOf(\"/cockpit+\") !== 0) {\n        if (path.indexOf(\"/=\") === 0)\n            path = \"/cockpit+\" + path.split(\"/\")[1];\n        else\n            path = \"/cockpit\";\n    }\n\n    return path.split(\"/\")[1];\n}\n\nfunction calculate_url(suffix) {\n    if (!suffix)\n        suffix = \"socket\";\n    var window_loc = window.location.toString();\n    var _url_root = url_root;\n\n    if (window.mock && window.mock.url)\n        return window.mock.url;\n    if (window.mock && window.mock.url_root)\n        _url_root = window.mock.url_root;\n\n    var prefix = calculate_application();\n    if (_url_root)\n        prefix = _url_root + \"/\" + prefix;\n\n    if (window_loc.indexOf('http:') === 0) {\n        return \"ws://\" + window.location.host + \"/\" + prefix + \"/\" + suffix;\n    } else if (window_loc.indexOf('https:') === 0) {\n        return \"wss://\" + window.location.host + \"/\" + prefix + \"/\" + suffix;\n    } else {\n        transport_debug(\"Cockpit must be used over http or https\");\n        return null;\n    }\n}\n\nfunction join_data(buffers, binary) {\n    if (!binary)\n        return buffers.join(\"\");\n\n    var data;\n    var i, j, k;\n    var total = 0;\n    var length = buffers.length;\n    for (i = 0; i < length; i++)\n        total += buffers[i].length;\n\n    if (window.Uint8Array)\n        data = new window.Uint8Array(total);\n    else\n        data = new Array(total);\n\n    if (data.set) {\n        for (j = 0, i = 0; i < length; i++) {\n            data.set(buffers[i], j);\n            j += buffers[i].length;\n        }\n    } else {\n        for (j = 0, i = 0; i < length; i++) {\n            for (k = 0; k < buffers[i].length; k++)\n                data[i + j] = buffers[i][k];\n            j += buffers[i].length;\n        }\n    }\n\n    return data;\n}\n\n/*\n * A WebSocket that connects to parent frame. The mechanism\n * for doing this will eventually be documented publicly,\n * but for now:\n *\n *  * Forward raw cockpit1 string protocol messages via window.postMessage\n *  * Listen for cockpit1 string protocol messages via window.onmessage\n *  * Never accept or send messages to another origin\n *  * An empty string message means \"close\" (not completely used yet)\n */\nfunction ParentWebSocket(parent) {\n    var self = this;\n    self.readyState = 0;\n\n    window.addEventListener(\"message\", function receive(event) {\n        if (event.origin !== transport_origin || event.source !== parent)\n            return;\n        var data = event.data;\n        if (data === undefined || (data.length === undefined && data.byteLength === undefined))\n            return;\n        if (data.length === 0) {\n            self.readyState = 3;\n            self.onclose();\n        } else {\n            self.onmessage(event);\n        }\n    }, false);\n\n    self.send = function send(message) {\n        parent.postMessage(message, transport_origin);\n    };\n\n    self.close = function close() {\n        self.readyState = 3;\n        parent.postMessage(\"\", transport_origin);\n        self.onclose();\n    };\n\n    window.setTimeout(function() {\n        self.readyState = 1;\n        self.onopen();\n    }, 0);\n}\n\nfunction parse_channel(data) {\n    var binary, length, pos, channel;\n\n    /* A binary message, split out the channel */\n    if (data instanceof window.ArrayBuffer) {\n        binary = new window.Uint8Array(data);\n        length = binary.length;\n        for (pos = 0; pos < length; pos++) {\n            if (binary[pos] == 10) /* new line */\n                break;\n        }\n        if (pos === length) {\n            console.warn(\"binary message without channel\");\n            return null;\n        } else if (pos === 0) {\n            console.warn(\"binary control message\");\n            return null;\n        } else {\n            channel = String.fromCharCode.apply(null, binary.subarray(0, pos));\n        }\n\n    /* A textual message */\n    } else {\n        pos = data.indexOf('\\n');\n        if (pos === -1) {\n            console.warn(\"text message without channel\");\n            return null;\n        }\n        channel = data.substring(0, pos);\n    }\n\n    return channel;\n}\n\n/* Private Transport class */\nfunction Transport() {\n    var self = this;\n    self.application = calculate_application();\n\n    /* We can trigger events */\n    event_mixin(self, { });\n\n    var last_channel = 0;\n    var channel_seed = \"\";\n\n    if (window.mock)\n        window.mock.last_transport = self;\n\n    var ws;\n    var check_health_timer;\n    var ignore_health_check = false;\n    var got_message = false;\n\n    /* See if we should communicate via parent */\n    if (window.parent !== window && window.name.indexOf(\"cockpit1:\") === 0)\n        ws = new ParentWebSocket(window.parent);\n\n    /* HACK: Compatibility if we're hosted by older Cockpit versions */\n    try {\n           /* See if we should communicate via parent */\n           if (!ws && window.parent !== window && window.parent.options &&\n                window.parent.options.protocol == \"cockpit1\") {\n               ws = new ParentWebSocket(window.parent);\n            }\n    } catch (ex) {\n       /* permission access errors */\n    }\n\n    if (!ws) {\n        var ws_loc = calculate_url();\n        transport_debug(\"connecting to \" + ws_loc);\n\n        if (ws_loc) {\n            if (\"WebSocket\" in window) {\n                ws = new window.WebSocket(ws_loc, \"cockpit1\");\n            } else if (\"MozWebSocket\" in window) { // Firefox 6\n                ws = new window.MozWebSocket(ws_loc);\n            } else {\n                console.error(\"WebSocket not supported, application will not work!\");\n            }\n        }\n\n        check_health_timer = window.setInterval(function () {\n            if (self.ready)\n                ws.send(\"\\n{ \\\"command\\\": \\\"ping\\\" }\");\n            if (!got_message) {\n                if (ignore_health_check) {\n                    console.log(\"health check failure ignored\");\n                } else {\n                    console.log(\"health check failed\");\n                    self.close({ \"problem\": \"timeout\" });\n                }\n            }\n            got_message = false;\n        }, 30000);\n    }\n\n    if (!ws) {\n        ws = { close: function() { } };\n        window.setTimeout(function() {\n            self.close({ \"problem\": \"no-cockpit\" });\n        }, 50);\n    }\n\n    var control_cbs = { };\n    var message_cbs = { };\n    var waiting_for_init = true;\n    self.ready = false;\n\n    /* Called when ready for channels to interact */\n    function ready_for_channels() {\n        if (!self.ready) {\n            self.ready = true;\n            self.dispatchEvent(\"ready\");\n        }\n    }\n\n    ws.onopen = function() {\n        if (ws) {\n            if (typeof ws.binaryType !== \"undefined\")\n                ws.binaryType = \"arraybuffer\";\n            ws.send(\"\\n{ \\\"command\\\": \\\"init\\\", \\\"version\\\": 1 }\");\n        }\n    };\n\n    ws.onclose = function() {\n        transport_debug(\"WebSocket onclose\");\n        ws = null;\n        if (reload_after_disconnect) {\n            expect_disconnect = true;\n            window.location.reload(true);\n        }\n        self.close();\n    };\n\n    ws.onmessage = self.dispatch_data = function(arg) {\n        got_message = true;\n\n        /* The first line of a message is the channel */\n        var message = arg.data;\n\n        var channel = parse_channel(message);\n        if (channel === null)\n            return false;\n\n        var payload, control;\n        if (message instanceof window.ArrayBuffer)\n            payload = new window.Uint8Array(message, channel.length + 1);\n        else\n            payload = message.substring(channel.length + 1);\n\n        /* A control message, always string */\n        if (!channel) {\n            transport_debug(\"recv control:\", payload);\n            control = JSON.parse(payload);\n        } else {\n            transport_debug(\"recv \" + channel + \":\", payload);\n        }\n\n        var i;\n        var length = incoming_filters ? incoming_filters.length : 0;\n        for (i = 0; i < length; i++) {\n            if (incoming_filters[i](message, channel, control) === false)\n                return false;\n        }\n\n        if (!channel)\n            process_control(control);\n        else\n            process_message(channel, payload);\n\n        return true;\n    };\n\n    self.close = function close(options) {\n        if (!options)\n            options = { \"problem\": \"disconnected\" };\n        options.command = \"close\";\n        window.clearInterval(check_health_timer);\n        var ows = ws;\n        ws = null;\n        if (ows)\n            ows.close();\n        if (expect_disconnect)\n            return;\n        ready_for_channels(); /* ready to fail */\n\n        /* Broadcast to everyone */\n        for (var chan in control_cbs)\n            control_cbs[chan].apply(null, [options]);\n    };\n\n    self.next_channel = function next_channel() {\n        last_channel++;\n        return channel_seed + String(last_channel);\n    };\n\n    function process_init(options) {\n        if (options.problem) {\n            self.close({ \"problem\": options.problem });\n            return;\n        }\n\n        if (options.version !== 1) {\n            console.error(\"received unsupported version in init message: \" + options.version);\n            self.close({ \"problem\": \"not-supported\" });\n            return;\n        }\n\n        if (options[\"channel-seed\"])\n            channel_seed = String(options[\"channel-seed\"]);\n        if (options[\"host\"])\n            default_host = options[\"host\"];\n\n        if (public_transport) {\n            public_transport.options = options;\n            public_transport.csrf_token = options[\"csrf-token\"];\n            public_transport.host = default_host;\n        }\n\n        if (init_callback)\n            init_callback(options);\n\n        if (waiting_for_init) {\n            waiting_for_init = false;\n            ready_for_channels();\n        }\n    }\n\n    function process_control(data) {\n        var channel = data.channel;\n        var func;\n\n        /* Init message received */\n        if (data.command == \"init\") {\n            process_init(data);\n        } else if (waiting_for_init) {\n            waiting_for_init = false;\n            if (data.command != \"close\" || channel) {\n                console.error(\"received message before init: \", data.command);\n                data = { \"problem\": \"protocol-error\" };\n            }\n            self.close(data);\n\n        /* Any pings get sent back as pongs */\n        } else if (data.command == \"ping\") {\n            data[\"command\"] = \"pong\";\n            self.send_control(data);\n        } else if (data.command == \"pong\") {\n            /* Any pong commands are ignored */\n\n        } else if (data.command == \"hint\") {\n            if (process_hints)\n                process_hints(data);\n        } else if (channel !== undefined) {\n            func = control_cbs[channel];\n            if (func)\n                func(data);\n        }\n    }\n\n    function process_message(channel, payload) {\n        var func = message_cbs[channel];\n        if (func)\n            func(payload);\n    }\n\n    /* The channel/control arguments is used by filters, and auto-populated if necessary */\n    self.send_data = function send_data(data, channel, control) {\n        if (!ws) {\n            console.log(\"transport closed, dropped message: \", data);\n            return false;\n        }\n\n        var i;\n        var length = outgoing_filters ? outgoing_filters.length : 0;\n        for (i = 0; i < length; i++) {\n            if (channel === undefined)\n                channel = parse_channel(data);\n            if (!channel && control === undefined)\n                control = JSON.parse(data);\n            if (outgoing_filters[i](data, channel, control) === false)\n                return false;\n        }\n\n        ws.send(data);\n        return true;\n    };\n\n    /* The control arguments is used by filters, and auto populated if necessary */\n    self.send_message = function send_message(payload, channel, control) {\n        if (channel)\n            transport_debug(\"send \" + channel, payload);\n        else\n            transport_debug(\"send control:\", payload);\n\n        /* A binary message */\n        if (payload.byteLength || is_array(payload)) {\n            if (payload instanceof window.ArrayBuffer)\n                payload = new window.Uint8Array(payload);\n            var output = join_data([ array_from_raw_string(channel), [ 10 ], payload ], true);\n            return self.send_data(output.buffer, channel, control);\n\n        /* A string message */\n        } else {\n            return self.send_data(channel.toString() + \"\\n\" + payload, channel, control);\n        }\n    };\n\n    self.send_control = function send_control(data) {\n        if (!ws && (data.command == \"close\" || data.command == \"kill\"))\n            return; /* don't complain if closed and closing */\n        if (check_health_timer &&\n            data.command == \"hint\" && data.hint == \"ignore_transport_health_check\") {\n            /* This is for us, process it directly. */\n            ignore_health_check = data.data;\n            return;\n        }\n        return self.send_message(JSON.stringify(data), \"\", data);\n    };\n\n    self.register = function register(channel, control_cb, message_cb) {\n        control_cbs[channel] = control_cb;\n        message_cbs[channel] = message_cb;\n    };\n\n    self.unregister = function unregister(channel) {\n        delete control_cbs[channel];\n        delete message_cbs[channel];\n    };\n}\n\nfunction ensure_transport(callback) {\n    var transport;\n    if (!default_transport)\n        default_transport = new Transport();\n    transport = default_transport;\n    if (transport.ready) {\n        callback(transport);\n    } else {\n        transport.addEventListener(\"ready\", function() {\n            callback(transport);\n        });\n    }\n}\n\n/* Always close the transport explicitly: allows parent windows to track us */\nwindow.addEventListener(\"unload\", function() {\n    if (default_transport)\n        default_transport.close();\n});\n\nfunction Channel(options) {\n    var self = this;\n\n    /* We can trigger events */\n    event_mixin(self, { });\n\n    var transport;\n    var ready = null;\n    var closed = null;\n    var waiting = null;\n    var received_done = false;\n    var sent_done = false;\n    var id = null;\n    var binary = (options.binary === true);\n\n    /*\n     * Queue while waiting for transport, items are tuples:\n     * [is_control ? true : false, payload]\n     */\n    var queue = [ ];\n\n    /* Handy for callers, but not used by us */\n    self.valid = true;\n    self.options = options;\n    self.binary = binary;\n    self.id = id;\n\n    function on_message(payload) {\n        if (received_done) {\n            console.warn(\"received message after done\");\n            self.close(\"protocol-error\");\n        } else {\n            self.dispatchEvent(\"message\", payload);\n        }\n    }\n\n    function on_close(data) {\n        closed = data;\n        self.valid = false;\n        if (transport && id)\n            transport.unregister(id);\n        if (closed.message)\n            console.warn(closed.message);\n        self.dispatchEvent(\"close\", closed);\n        if (waiting)\n            waiting.resolve(closed);\n    }\n\n    function on_ready(data) {\n        ready = data;\n        self.dispatchEvent(\"ready\", ready);\n    }\n\n    function on_control(data) {\n        if (data.command == \"close\") {\n            on_close(data);\n            return;\n        } else if (data.command == \"ready\") {\n            on_ready(data);\n        }\n\n        var done = data.command === \"done\";\n        if (done && received_done) {\n            console.warn(\"received two done commands on channel\");\n            self.close(\"protocol-error\");\n        } else {\n            if (done)\n                received_done = true;\n            self.dispatchEvent(\"control\", data);\n        }\n    }\n\n    function send_payload(payload) {\n        if (!binary) {\n            if (typeof payload !== \"string\")\n                payload = String(payload);\n        }\n        transport.send_message(payload, id);\n    }\n\n    ensure_transport(function(trans) {\n        transport = trans;\n        if (closed)\n            return;\n\n        id = transport.next_channel();\n        self.id = id;\n\n        /* Register channel handlers */\n        transport.register(id, on_control, on_message);\n\n        /* Now open the channel */\n        var command = { };\n        for (var i in options)\n            command[i] = options[i];\n        command.command = \"open\";\n        command.channel = id;\n\n        if (!command.host) {\n            if (default_host)\n                command.host = default_host;\n        }\n\n        if (binary)\n            command.binary = \"raw\";\n        else\n            delete command.binary;\n\n        command[\"flow-control\"] = true;\n        transport.send_control(command);\n\n        /* Now drain the queue */\n        while (queue.length > 0) {\n            var item = queue.shift();\n            if (item[0]) {\n                item[1][\"channel\"] = id;\n                transport.send_control(item[1]);\n            } else {\n                send_payload(item[1]);\n            }\n        }\n    });\n\n    self.send = function send(message) {\n        if (closed)\n            console.warn(\"sending message on closed channel\");\n        else if (sent_done)\n            console.warn(\"sending message after done\");\n        else if (!transport)\n            queue.push([false, message]);\n        else\n            send_payload(message);\n    };\n\n    self.control = function control(options) {\n        options = options || { };\n        if (!options.command)\n            options.command = \"options\";\n        if (options.command === \"done\")\n            sent_done = true;\n        options.channel = id;\n        if (!transport)\n            queue.push([true, options]);\n        else\n            transport.send_control(options);\n    };\n\n    self.wait = function wait(callback) {\n        if (!waiting) {\n            waiting = cockpit.defer();\n            if (closed) {\n                waiting.reject(closed);\n            } else if (ready) {\n                waiting.resolve(ready);\n            } else {\n                self.addEventListener(\"ready\", function(event, data) {\n                    waiting.resolve(data);\n                });\n                self.addEventListener(\"close\", function(event, data) {\n                    waiting.reject(data);\n                });\n            }\n        }\n        var promise = waiting.promise;\n        if (callback)\n            promise.then(callback, callback);\n        return promise;\n    };\n\n    self.close = function close(options) {\n        if (closed)\n            return;\n\n        if (!options)\n            options = { };\n        else if (typeof options == \"string\")\n            options = { \"problem\" : options };\n        options[\"command\"] = \"close\";\n        options[\"channel\"] = id;\n\n        if (!transport)\n            queue.push([true, options]);\n        else\n            transport.send_control(options);\n        on_close(options);\n    };\n\n    self.buffer = function buffer(callback) {\n        var buffers = [];\n        buffers.callback = callback;\n        buffers.squash = function squash() {\n            return join_data(buffers, binary);\n        };\n\n        function on_message(event, data) {\n            var consumed, block;\n            buffers.push(data);\n            if (buffers.callback) {\n                block = join_data(buffers, binary);\n                if (block.length > 0) {\n                    consumed = buffers.callback.call(self, block);\n                    if (typeof consumed !== \"number\" || consumed === block.length) {\n                        buffers.length = 0;\n                    } else if (consumed === 0) {\n                        buffers.length = 1;\n                        buffers[0] = block;\n                    } else if (consumed !== 0) {\n                        buffers.length = 1;\n                        if (block.subarray)\n                            buffers[0] = block.subarray(consumed);\n                        else if (block.substring)\n                            buffers[0] = block.substring(consumed);\n                        else\n                            buffers[0] = block.slice(consumed);\n                    }\n                }\n            }\n        }\n\n        function on_close() {\n            self.removeEventListener(\"message\", on_message);\n            self.removeEventListener(\"close\", on_close);\n        }\n\n        self.addEventListener(\"message\", on_message);\n        self.addEventListener(\"close\", on_close);\n\n        return buffers;\n    };\n\n    self.toString = function toString() {\n        var host = options[\"host\"] || \"localhost\";\n        return \"[Channel \" + (self.valid ? id : \"<invalid>\") + \" -> \" + host + \"]\";\n    };\n}\n\n/* Resolve dots and double dots */\nfunction resolve_path_dots(parts) {\n    var out = [ ];\n    var length = parts.length;\n    for (var i = 0; i < length; i++) {\n        var part = parts[i];\n        if (part === \"\" || part == \".\") {\n            continue;\n        } else if (part == \"..\") {\n            if (out.length === 0)\n                return null;\n            out.pop();\n        } else {\n            out.push(part);\n        }\n    }\n    return out;\n}\n\nfunction factory() {\n    cockpit.channel = function channel(options) {\n        return new Channel(options);\n    };\n\n    cockpit.event_target = function event_target(obj) {\n        event_mixin(obj, { });\n        return obj;\n    };\n\n    cockpit.extend = extend;\n\n    /* These can be filled in by loading ../manifests.js */\n    cockpit.manifests = { };\n\n    /* ------------------------------------------------------------\n     * Text Encoding\n     */\n\n    function Utf8TextEncoder(constructor) {\n        var self = this;\n        self.encoding = \"utf-8\";\n\n        self.encode = function encode(string, options) {\n            var data = window.unescape(encodeURIComponent(string));\n            if (constructor === String)\n                return data;\n            return array_from_raw_string(data, constructor);\n        };\n    }\n\n    function Utf8TextDecoder(fatal) {\n        var self = this;\n        var buffer = null;\n        self.encoding = \"utf-8\";\n\n        self.decode = function decode(data, options) {\n            var stream = options && options.stream;\n\n            if (data === null || data === undefined)\n                data = \"\";\n            if (typeof data !== \"string\")\n                data = array_to_raw_string(data);\n            if (buffer) {\n                data = buffer + data;\n                buffer = null;\n            }\n\n            /* We have to scan to do non-fatal and streaming */\n            var beg = 0;\n            var i = 0;\n            var len = data.length;\n            var p, x, j, ok;\n            var str = \"\";\n\n            while (i < len) {\n                p = data.charCodeAt(i);\n                x = p == 255 ? 0\n                    : p > 251 && p < 254 ? 6\n                    : p > 247 && p < 252 ? 5\n                    : p > 239 && p < 248 ? 4\n                    : p > 223 && p < 240 ? 3\n                    : p > 191 && p < 224 ? 2\n                    : p < 128 ? 1 : 0;\n\n                ok = (i + x <= len);\n                if (!ok && stream) {\n                    buffer = data.substring(i);\n                    break;\n                }\n                if (x === 0)\n                    ok = false;\n                for (j = 1; ok && j < x; j++)\n                    ok = (data.charCodeAt(i + j) & 0x80) !== 0;\n\n                if (!ok) {\n                    if (fatal) {\n                        i = len;\n                        break;\n                    }\n\n                    str += decodeURIComponent(window.escape(data.substring(beg, i)));\n                    str += \"\\ufffd\";\n                    i++;\n                    beg = i;\n                } else {\n                    i += x;\n                }\n            }\n\n            str += decodeURIComponent(window.escape(data.substring(beg, i)));\n            return str;\n        };\n    }\n\n    cockpit.utf8_encoder = function utf8_encoder(constructor) {\n        return new Utf8TextEncoder(constructor);\n    };\n\n    cockpit.utf8_decoder = function utf8_decoder(fatal) {\n        return new Utf8TextDecoder(!!fatal);\n    };\n\n    cockpit.base64_encode = base64_encode;\n    cockpit.base64_decode = base64_decode;\n\n    cockpit.kill = function kill(host, group) {\n        var options = { };\n        if (host)\n            options.host = host;\n        if (group)\n            options.group = group;\n        cockpit.transport.control(\"kill\", options);\n    };\n\n    /* Not public API ... yet? */\n    cockpit.hint = function hint(name, options) {\n        if (!default_transport)\n            return;\n        if (!options)\n            options = default_host;\n        if (typeof options == \"string\")\n            options = { \"host\": options };\n        options[\"hint\"] = name;\n        cockpit.transport.control(\"hint\", options);\n    };\n\n    cockpit.transport = public_transport = {\n        wait: ensure_transport,\n        inject: function inject(message, out) {\n            if (!default_transport)\n                return false;\n            if (out === undefined || out)\n                return default_transport.send_data(message);\n            else\n                return default_transport.dispatch_data({ data: message });\n        },\n        filter: function filter(callback, out) {\n            if (out) {\n                if (!outgoing_filters)\n                    outgoing_filters = [ ];\n                outgoing_filters.push(callback);\n            } else {\n                if (!incoming_filters)\n                    incoming_filters = [ ];\n                incoming_filters.push(callback);\n            }\n        },\n        close: function close(problem) {\n            var options;\n            if (problem)\n                options = { \"problem\": problem };\n            if (default_transport)\n                default_transport.close(options);\n            default_transport = null;\n            this.options = { };\n        },\n        origin: transport_origin,\n        options: { },\n        uri: calculate_url,\n        control: function(command, options) {\n            options = extend({ }, options);\n            options[\"command\"] = command;\n            ensure_transport(function(transport) {\n                transport.send_control(options);\n            });\n        },\n        application: function () {\n            if (!default_transport || window.mock)\n                return calculate_application();\n            return default_transport.application;\n        },\n    };\n\n    /* ------------------------------------------------------------------------------------\n     * An ordered queue of functions that should be called later.\n     */\n\n    var later_queue = [];\n    var later_timeout = null;\n\n    function later_drain() {\n        var func;\n        var queue = later_queue;\n        later_timeout = null;\n        later_queue = [];\n        for (;;) {\n            func = queue.shift();\n            if (!func)\n                break;\n            func();\n        }\n    }\n\n    function later_invoke(func) {\n        if (func)\n            later_queue.push(func);\n        if (later_timeout === null)\n            later_timeout = window.setTimeout(later_drain, 0);\n    }\n\n    /* ------------------------------------------------------------------------------------\n     * Promises.\n     * Based on Q and angular promises, with some jQuery compatibility. See the angular\n     * license in COPYING.node for license lineage. There are some key differences with\n     * both Q and jQuery.\n     *\n     *  * Exceptions thrown in handlers are not treated as rejections or failures.\n     *    Exceptions remain actual exceptions.\n     *  * Unlike jQuery callbacks added to an already completed promise don't execute\n     *    immediately. Wait until control is returned to the browser.\n     */\n\n    function promise_then(state, fulfilled, rejected, updated) {\n        if (fulfilled === undefined && rejected === undefined && updated === undefined)\n            return null;\n        var result = new Deferred();\n        state.pending = state.pending || [];\n        state.pending.push([result, fulfilled, rejected, updated]);\n        if (state.status > 0)\n            schedule_process_queue(state);\n        return result.promise;\n    }\n\n    function create_promise(state) {\n        /* Like jQuery the promise object is callable */\n        var self = function Promise(target) {\n            if (target) {\n                extend(target, self);\n                return target;\n            }\n            return self;\n        };\n\n        state.status = 0;\n\n        self.then = function then(fulfilled, rejected, updated) {\n            return promise_then(state, fulfilled, rejected, updated) || self;\n        };\n\n        self[\"catch\"] = function catch_(callback) {\n            return promise_then(state, null, callback) || self;\n        };\n\n        self[\"finally\"] = function finally_(callback, updated) {\n            return promise_then(state, function() {\n                return handle_callback(arguments, true, callback);\n            }, function() {\n                return handle_callback(arguments, false, callback);\n            }, updated) || self;\n        };\n\n        /* Basic jQuery Promise compatibility */\n        self.done = function done(fulfilled) {\n            promise_then(state, fulfilled);\n            return self;\n        };\n\n        self.fail = function fail(rejected) {\n            promise_then(state, null, rejected);\n            return self;\n        };\n\n        self.always = function always(callback) {\n            promise_then(state, callback, callback);\n            return self;\n        };\n\n        self.progress = function progress(updated) {\n            promise_then(state, null, null, updated);\n            return self;\n        };\n\n        self.state = function state_() {\n            if (state.status == 1)\n                return \"resolved\";\n            if (state.status == 2)\n                return \"rejected\";\n            return \"pending\";\n        };\n\n        /* Promises are recursive like jQuery */\n        self.promise = self;\n\n        return self;\n    }\n\n    function process_queue(state) {\n        var fn, deferred, pending;\n\n        pending = state.pending;\n        state.process_scheduled = false;\n        state.pending = undefined;\n        for (var i = 0, ii = pending.length; i < ii; ++i) {\n            state.pur = true;\n            deferred = pending[i][0];\n            fn = pending[i][state.status];\n            if (is_function(fn)) {\n                deferred.resolve(fn.apply(state.promise, state.values));\n            } else if (state.status === 1) {\n                deferred.resolve.apply(deferred.resolve, state.values);\n            } else {\n                deferred.reject.apply(deferred.reject, state.values);\n            }\n        }\n    }\n\n    function schedule_process_queue(state) {\n        if (state.process_scheduled || !state.pending)\n            return;\n        state.process_scheduled = true;\n        later_invoke(function() { process_queue(state) });\n    }\n\n    function deferred_resolve(state, values) {\n        var then;\n        var done = false;\n        if (is_object(values[0]) || is_function(values[0]))\n            then = values[0] && values[0].then;\n        if (is_function(then)) {\n            state.status = -1;\n            then.call(values[0], function(/* ... */) {\n                if (done)\n                    return;\n                done = true;\n                deferred_resolve(state, arguments);\n            }, function(/* ... */) {\n                if (done)\n                    return;\n                done = true;\n                deferred_reject(state, arguments);\n            }, function(/* ... */) {\n                deferred_notify(state, arguments);\n            });\n        } else {\n            state.values = values;\n            state.status = 1;\n            schedule_process_queue(state);\n        }\n    }\n\n    function deferred_reject(state, values) {\n        state.values = values;\n        state.status = 2;\n        schedule_process_queue(state);\n    }\n\n    function deferred_notify(state, values) {\n        var callbacks = state.pending;\n        if ((state.status <= 0) && callbacks && callbacks.length) {\n            later_invoke(function() {\n                var callback, result;\n                for (var i = 0, ii = callbacks.length; i < ii; i++) {\n                    result = callbacks[i][0];\n                    callback = callbacks[i][3];\n                    if (is_function(callback))\n                        result.notify(callback.apply(state.promise, values));\n                    else\n                        result.notify.apply(result, values);\n                }\n            });\n        }\n    }\n\n    function Deferred() {\n        var self = this;\n        var state = { };\n        self.promise = state.promise = create_promise(state);\n\n        self.resolve = function resolve(/* ... */) {\n            if (arguments[0] === state.promise)\n                throw new Error(\"Expected promise to be resolved with other value than itself\");\n            if (!state.status)\n                deferred_resolve(state, arguments);\n            return self;\n        };\n\n        self.reject = function reject(/* ... */) {\n            if (state.status)\n                return;\n            deferred_reject(state, arguments);\n            return self;\n        };\n\n        self.notify = function notify(/* ... */) {\n            deferred_notify(state, arguments);\n            return self;\n        };\n    }\n\n    function prep_promise(values, resolved) {\n        var result = cockpit.defer();\n        if (resolved)\n            result.resolve.apply(result, values);\n        else\n            result.reject.apply(result, values);\n        return result.promise;\n    }\n\n    function handle_callback(values, is_resolved, callback) {\n        var callback_output = null;\n        if (is_function(callback))\n            callback_output = callback();\n        if (callback_output && is_function(callback_output.then)) {\n            return callback_output.then(function() {\n                return prep_promise(values, is_resolved);\n            }, function() {\n                return prep_promise(arguments, false);\n            });\n        } else {\n            return prep_promise(values, is_resolved);\n        }\n    }\n\n    cockpit.when = function when(value, fulfilled, rejected, updated) {\n        var result = cockpit.defer();\n        result.resolve(value);\n        return result.promise.then(fulfilled, rejected, updated);\n    };\n\n    cockpit.all = function all(promises) { // eslint-disable-line cockpit/no-cockpit-all\n        var deferred = cockpit.defer();\n        var counter = 0;\n        var results = [];\n\n        if (arguments.length != 1 && !is_array(promises))\n            promises = Array.prototype.slice.call(arguments);\n\n        promises.forEach(function(promise, key) {\n            counter++;\n            cockpit.when(promise).then(function(value) {\n                results[key] = value;\n                if (!(--counter))\n                    deferred.resolve.apply(deferred, results);\n            }, function(/* ... */) {\n                deferred.reject.apply(deferred, arguments);\n            });\n        });\n\n        if (counter === 0)\n            deferred.resolve(results);\n        return deferred.promise;\n    };\n\n    cockpit.resolve = function resolve(result) {\n        return cockpit.defer().resolve(result).promise;\n    };\n\n    cockpit.reject = function reject(ex) {\n        return cockpit.defer().reject(ex).promise;\n    };\n\n    cockpit.defer = function() {\n        return new Deferred();\n    };\n\n    /* ---------------------------------------------------------------------\n     * Utilities\n     */\n\n    var fmt_re = /\\$\\{([^}]+)\\}|\\$([a-zA-Z0-9_]+)/g;\n    cockpit.format = function format(fmt, args) {\n        if (arguments.length != 2 || !is_object(args) || args === null)\n            args = Array.prototype.slice.call(arguments, 1);\n\n        function replace(m, x, y) {\n            var value = args[x || y];\n\n            /* Special-case 0 (also catches 0.0). All other falsy values return\n             * the empty string.\n             */\n            if (value === 0)\n                return '0';\n\n            return value || '';\n        }\n\n        return fmt.replace(fmt_re, replace);\n    };\n\n    cockpit.format_number = function format_number(number) {\n        /* We show 3 digits of precison but avoid scientific notation.\n         * We also show integers without digits after the comma.\n         *\n         * We want to localise the decimal place, but we never want to\n         * show thousands separators (to avoid ambiguity).  For this\n         * reason, for integers and large enough numbers, we use\n         * non-localised conversions (and in both cases, show no\n         * fractional part).\n         */\n        var lang = cockpit.language === undefined ? undefined : cockpit.language.replace('_', '-');\n\n        if (!number && number !== 0)\n            return \"\";\n        else if (number % 1 === 0)\n            return number.toString();\n        else if (number > 0 && number <= 0.001)\n            return (0.001).toLocaleString(lang);\n        else if (number < 0 && number >= -0.001)\n            return (-0.001).toLocaleString(lang);\n        else if (number > 999 || number < -999)\n            return number.toFixed(0);\n        else\n            return number.toLocaleString(lang, {\n                maximumSignificantDigits: 3,\n                minimumSignificantDigits: 3\n            });\n    };\n\n    function format_units(number, suffixes, factor, separate) {\n        var quotient;\n        var suffix = null;\n        var key, keys;\n        var divisor;\n        var y, x, i;\n\n        /* Find that factor string */\n        if (!number && number !== 0) {\n            suffix = null;\n        } else if (typeof (factor) === \"string\") {\n            /* Prefer larger factors */\n            keys = [];\n            for (key in suffixes)\n                keys.push(key);\n            keys.sort().reverse();\n            for (y = 0; y < keys.length; y++) {\n                for (x = 0; x < suffixes[keys[y]].length; x++) {\n                    if (factor == suffixes[keys[y]][x]) {\n                        number = number / Math.pow(keys[y], x);\n                        suffix = factor;\n                        break;\n                    }\n                }\n                if (suffix)\n                    break;\n            }\n\n        /* @factor is a number */\n        } else if (factor in suffixes) {\n            divisor = 1;\n            for (i = 0; i < suffixes[factor].length; i++) {\n                quotient = number / divisor;\n                if (quotient < factor) {\n                    number = quotient;\n                    suffix = suffixes[factor][i];\n                    break;\n                }\n                divisor *= factor;\n            }\n        }\n\n        var string_representation = cockpit.format_number(number);\n        var ret;\n\n        if (string_representation && suffix)\n            ret = [string_representation, suffix];\n        else\n            ret = [string_representation];\n\n        if (!separate)\n            ret = ret.join(\" \");\n\n        return ret;\n    }\n\n    var byte_suffixes = {\n        1000: [ null, \"KB\", \"MB\", \"GB\", \"TB\", \"PB\", \"EB\", \"ZB\" ],\n        1024: [ null, \"KiB\", \"MiB\", \"GiB\", \"TiB\", \"PiB\", \"EiB\", \"ZiB\" ]\n    };\n\n    cockpit.format_bytes = function format_bytes(number, factor, separate) {\n        if (factor === undefined)\n            factor = 1024;\n        return format_units(number, byte_suffixes, factor, separate);\n    };\n\n    cockpit.get_byte_units = function get_byte_units(guide_value, factor) {\n        if (factor === undefined || !(factor in byte_suffixes))\n            factor = 1024;\n\n        function unit(index) {\n            return { name: byte_suffixes[factor][index],\n                     factor: Math.pow(factor, index)\n                   };\n        }\n\n        var units = [ unit(2), unit(3), unit(4) ];\n\n        // The default unit is the largest one that gives us at least\n        // two decimal digits in front of the comma.\n\n        for (var i = units.length - 1; i >= 0; i--) {\n            if (i === 0 || (guide_value / units[i].factor) >= 10) {\n                units[i].selected = true;\n                break;\n            }\n        }\n\n        return units;\n    };\n\n    var byte_sec_suffixes = {\n        1024: [ \"B/s\", \"KiB/s\", \"MiB/s\", \"GiB/s\", \"TiB/s\", \"PiB/s\", \"EiB/s\", \"ZiB/s\" ]\n    };\n\n    cockpit.format_bytes_per_sec = function format_bytes_per_sec(number, factor, separate) {\n        if (factor === undefined)\n            factor = 1024;\n        return format_units(number, byte_sec_suffixes, factor, separate);\n    };\n\n    var bit_suffixes = {\n        1000: [ \"bps\", \"Kbps\", \"Mbps\", \"Gbps\", \"Tbps\", \"Pbps\", \"Ebps\", \"Zbps\" ]\n    };\n\n    cockpit.format_bits_per_sec = function format_bits_per_sec(number, factor, separate) {\n        if (factor === undefined)\n            factor = 1000;\n        return format_units(number, bit_suffixes, factor, separate);\n    };\n\n    /* ---------------------------------------------------------------------\n     * Storage Helper.\n     *\n     * Use application to prefix data stored in browser storage\n     * with helpers for compatibility.\n     */\n    function StorageHelper(storageName) {\n        var self = this;\n        var storage;\n\n        try {\n            storage = window[storageName];\n        } catch (e) { }\n\n        self.prefixedKey = function (key) {\n            return cockpit.transport.application() + \":\" + key;\n        };\n\n        self.getItem = function (key, both) {\n            var value = storage.getItem(self.prefixedKey(key));\n            if (!value && both)\n                value = storage.getItem(key);\n            return value;\n        };\n\n        self.setItem = function (key, value, both) {\n            storage.setItem(self.prefixedKey(key), value);\n            if (both)\n                storage.setItem(key, value);\n        };\n\n        self.removeItem = function(key, both) {\n            storage.removeItem(self.prefixedKey(key));\n            if (both)\n                storage.removeItem(key);\n        };\n\n        /* Instead of clearing, purge anything that isn't prefixed with an application\n         * and anything prefixed with our application.\n         */\n        self.clear = function(full) {\n            var i = 0;\n            while (i < storage.length) {\n                var k = storage.key(i);\n                if (full && k.indexOf(\"cockpit\") !== 0)\n                    storage.removeItem(k);\n                else if (k.indexOf(cockpit.transport.application()) === 0)\n                    storage.removeItem(k);\n                else\n                    i++;\n            }\n        };\n    }\n\n    cockpit.localStorage = new StorageHelper(\"localStorage\");\n    cockpit.sessionStorage = new StorageHelper(\"sessionStorage\");\n\n    /* ---------------------------------------------------------------------\n     * Shared data cache.\n     *\n     * We cannot use sessionStorage when keeping lots of data in memory and\n     * sharing it between frames. It has a rather paltry limit on the amount\n     * of data it can hold ... so we use window properties instead.\n     */\n\n    function lookup_storage(win) {\n        var storage;\n        if (win.parent && win.parent !== win)\n            storage = lookup_storage(win.parent);\n        if (!storage) {\n            try {\n                storage = win[\"cv1-storage\"];\n                if (!storage)\n                    win[\"cv1-storage\"] = storage = { };\n            } catch (ex) { }\n        }\n        return storage;\n    }\n\n    function StorageCache(org_key, provider, consumer) {\n        var self = this;\n        var key = cockpit.transport.application() + \":\" + org_key;\n\n        /* For triggering events and ownership */\n        var trigger = window.sessionStorage;\n        var last;\n\n        var storage = lookup_storage(window);\n\n        var claimed = false;\n        var source;\n\n        function callback() {\n            var value;\n\n            /* Only run the callback if we have a result */\n            if (storage[key] !== undefined) {\n                value = storage[key];\n                window.setTimeout(function() {\n                    if (consumer(value, org_key) === false)\n                        self.close();\n                });\n            }\n        }\n\n        function result(value) {\n            if (source && !claimed)\n                claimed = true;\n            if (!claimed)\n                return;\n\n            // use a random number to avoid races by separate instances\n            var version = Math.floor(Math.random() * 10000000) + 1;\n\n            /* Event for the local window */\n            var ev = document.createEvent(\"StorageEvent\");\n            ev.initStorageEvent(\"storage\", false, false, key, null,\n                                version, window.location, trigger);\n\n            storage[key] = value;\n            trigger.setItem(key, version);\n            ev.self = self;\n            window.dispatchEvent(ev);\n        }\n\n        self.claim = function claim() {\n            if (source)\n                return;\n\n            /* In case we're unclaimed during the callback */\n            var claiming = { close: function() { } };\n            source = claiming;\n\n            var changed = provider(result, org_key);\n            if (source === claiming)\n                source = changed;\n            else\n                changed.close();\n        };\n\n        function unclaim() {\n            if (source && source.close)\n                source.close();\n            source = null;\n\n            if (!claimed)\n                return;\n\n            claimed = false;\n\n            var current_value = trigger.getItem(key);\n            if (current_value)\n                current_value = parseInt(current_value, 10);\n            else\n                current_value = null;\n\n            if (last && last === current_value) {\n                var ev = document.createEvent(\"StorageEvent\");\n                var version = trigger[key];\n                ev.initStorageEvent(\"storage\", false, false, key, version,\n                                    null, window.location, trigger);\n                delete storage[key];\n                trigger.removeItem(key);\n                ev.self = self;\n                window.dispatchEvent(ev);\n            }\n        }\n\n        function changed(event) {\n            if (event.key !== key)\n                return;\n\n            /* check where the event came from\n               - it came from someone else:\n                   if it notifies their unclaim (new value null) and we haven't already claimed, do so\n               - it came from ourselves:\n                   if the new value doesn't match the actual value in the cache, and\n                   we tried to claim (from null to a number), cancel our claim\n             */\n            if (event.self !== self) {\n                if (!event.newValue && !claimed) {\n                    self.claim();\n                    return;\n                }\n            } else if (claimed && !event.oldValue && (event.newValue !== trigger.getItem(key))) {\n                unclaim();\n            }\n\n            var new_value = null;\n            if (event.newValue)\n                new_value = parseInt(event.newValue, 10);\n            if (last !== new_value) {\n                last = new_value;\n                callback();\n            }\n        }\n\n        self.close = function() {\n            window.removeEventListener(\"storage\", changed, true);\n            unclaim();\n        };\n\n        window.addEventListener(\"storage\", changed, true);\n\n        /* Always clear this data on unload */\n        window.addEventListener(\"beforeunload\", function() {\n            self.close();\n        });\n        window.addEventListener(\"unload\", function() {\n            self.close();\n        });\n\n        if (trigger.getItem(key))\n            callback();\n        else\n            self.claim();\n    }\n\n    cockpit.cache = function cache(key, provider, consumer) {\n        return new StorageCache(key, provider, consumer);\n    };\n\n    /* ---------------------------------------------------------------------\n     * Metrics\n     *\n     * Implements the cockpit.series and cockpit.grid. Part of the metrics\n     * implementations that do not require jquery.\n     */\n\n    function SeriesSink(interval, identifier, fetch_callback) {\n        var self = this;\n\n        self.interval = interval;\n        self.limit = identifier ? 64 * 1024 : 1024;\n\n        /*\n         * The cache sits on a window, either our own or a parent\n         * window whichever we can access properly.\n         *\n         * Entries in the index are:\n         *\n         * { beg: N, items: [], mapping: { }, next: item }\n         */\n        var index = setup_index(identifier);\n\n        /*\n         * A linked list through the index, that we use for expiry\n         * of the cache.\n         */\n        var count = 0;\n        var head = null;\n        var tail = null;\n\n        function setup_index(id) {\n            if (!id)\n                return [];\n\n            /* Try and find a good place to cache data */\n            var storage = lookup_storage(window);\n\n            var index = storage[id];\n            if (!index)\n                storage[id] = index = [];\n            return index;\n        }\n\n        function search(idx, beg) {\n            var low = 0;\n            var high = idx.length - 1;\n            var mid, val;\n\n            while (low <= high) {\n                mid = (low + high) / 2 | 0;\n                val = idx[mid].beg;\n                if (val < beg)\n                    low = mid + 1;\n                else if (val > beg)\n                    high = mid - 1;\n                else\n                    return mid; /* key found */\n            }\n            return low;\n        }\n\n        function fetch(beg, end, for_walking) {\n            if (fetch_callback) {\n                if (!for_walking) {\n                    /* Stash some fake data synchronously so that we don't ask\n                     * again for the same range while they are still fetching\n                     * it asynchronously.\n                     */\n                    stash(beg, new Array(end - beg), { });\n                }\n                fetch_callback(beg, end, for_walking);\n            }\n        }\n\n        self.load = function load(beg, end, for_walking) {\n            if (end <= beg)\n                return;\n\n            var at = search(index, beg);\n\n            var entry;\n            var b, e, eb, en, i;\n            var len = index.length;\n            var last = beg;\n\n            /* We do this in two phases: First, we walk the index to\n             * process what we already have and at the same time make\n             * notes about what we need to fetch.  Then we go over the\n             * notes and actually fetch what we need.  That way, the\n             * fetch callbacks in the second phase can modify the\n             * index data structure without disturbing the walk in the\n             * first phase.\n             */\n\n            var fetches = [ ];\n\n            /* Data relevant to this range can be at the found index, or earlier */\n            for (i = at > 0 ? at - 1 : at; i < len; i++) {\n                entry = index[i];\n                en = entry.items.length;\n                if (!en)\n                    continue;\n\n                eb = entry.beg;\n                b = Math.max(eb, beg);\n                e = Math.min(eb + en, end);\n\n                if (b < e) {\n                    if (b > last)\n                        fetches.push([ last, b ]);\n                    process(b, entry.items.slice(b - eb, e - eb), entry.mapping);\n                    last = e;\n                } else if (i >= at) {\n                    break; /* no further intersections */\n                }\n            }\n\n            for (i = 0; i < fetches.length; i++)\n                fetch(fetches[i][0], fetches[i][1], for_walking);\n\n            if (last != end)\n                fetch(last, end, for_walking);\n        };\n\n        function stash(beg, items, mapping) {\n            if (!items.length)\n                return;\n\n            var at = search(index, beg);\n\n            var end = beg + items.length;\n            var entry;\n            var num;\n\n            var b, e, eb, en, i;\n            var len = index.length;\n            for (i = at > 0 ? at - 1 : at; i < len; i++) {\n                entry = index[i];\n                en = entry.items.length;\n                if (!en)\n                    continue;\n\n                eb = entry.beg;\n                b = Math.max(eb, beg);\n                e = Math.min(eb + en, end);\n\n                /*\n                 * We truncate blocks that intersect with this one\n                 *\n                 * We could adjust them, but in general the loaders are\n                 * intelligent enough to only load the required data, so\n                 * not doing this optimization yet.\n                 */\n\n                if (b < e) {\n                    num = e - b;\n                    entry.items.splice(b - eb, num);\n                    count -= num;\n                    if (b - eb === 0)\n                        entry.beg += (e - eb);\n                } else if (i >= at) {\n                    break; /* no further intersections */\n                }\n            }\n\n            /* Insert our item into the array */\n            entry = { beg: beg, items: items, mapping: mapping };\n            if (!head)\n                head = entry;\n            if (tail)\n                tail.next = entry;\n            tail = entry;\n            count += items.length;\n            index.splice(at, 0, entry);\n\n            /* Remove any items with zero length around insertion point */\n            for (at--; at <= i; at++) {\n                entry = index[at];\n                if (entry && !entry.items.length) {\n                    index.splice(at, 1);\n                    at--;\n                }\n            }\n\n            /* If our index has gotten too big, expire entries */\n            while (head && count > self.limit) {\n                count -= head.items.length;\n                head.items = [];\n                head.mapping = null;\n                head = head.next || null;\n            }\n\n            /* Remove any entries with zero length at beginning */\n            len = index.length;\n            for (i = 0; i < len; i++) {\n                if (index[i].items.length > 0)\n                    break;\n            }\n            index.splice(0, i);\n        }\n\n        /*\n         * Used to populate grids, the keys are grid ids and\n         * the values are objects: { grid, rows, notify }\n         *\n         * The rows field is an object indexed by paths\n         * container aliases, and the values are: [ row, path ]\n         */\n        var registered = { };\n\n        /* An undocumented function called by DataGrid */\n        self._register = function _register(grid, id) {\n            if (grid.interval != interval)\n                throw Error(\"mismatched metric interval between grid and sink\");\n            var gdata = registered[id];\n            if (!gdata) {\n                gdata = registered[id] = { grid: grid, links: [ ] };\n                gdata.links.remove = function remove() {\n                    delete registered[id];\n                };\n            }\n            return gdata.links;\n        };\n\n        function process(beg, items, mapping) {\n            var i, j, jlen, k, klen;\n            var data, path, row, map;\n            var id, gdata, grid;\n            var f, t, n, b, e;\n\n            var end = beg + items.length;\n\n            for (id in registered) {\n                gdata = registered[id];\n                grid = gdata.grid;\n\n                b = Math.max(beg, grid.beg);\n                e = Math.min(end, grid.end);\n\n                /* Does this grid overlap the bounds of item? */\n                if (b < e) {\n                    /* Where in the items to take from */\n                    f = b - beg;\n\n                    /* Where and how many to place */\n                    t = b - grid.beg;\n\n                    /* How many to process */\n                    n = e - b;\n\n                    for (i = 0; i < n; i++) {\n                        klen = gdata.links.length;\n                        for (k = 0; k < klen; k++) {\n                            path = gdata.links[k][0];\n                            row = gdata.links[k][1];\n\n                            /* Calulate the data field to fill in */\n                            data = items[f + i];\n                            map = mapping;\n                            jlen = path.length;\n                            for (j = 0; data !== undefined && j < jlen; j++) {\n                                if (!data) {\n                                    data = undefined;\n                                } else if (map !== undefined && map !== null) {\n                                    map = map[path[j]];\n                                    if (map)\n                                        data = data[map[\"\"]];\n                                    else\n                                        data = data[path[j]];\n                                } else {\n                                    data = data[path[j]];\n                                }\n                            }\n\n                            row[t + i] = data;\n                        }\n                    }\n\n                    /* Notify the grid, so it can call any functions */\n                    grid.notify(t, n);\n                }\n            }\n        }\n\n        self.input = function input(beg, items, mapping) {\n            process(beg, items, mapping);\n            stash(beg, items, mapping);\n        };\n\n        self.close = function () {\n            var grid, id;\n            for (id in registered) {\n                grid = registered[id];\n                if (grid && grid.grid)\n                    grid.grid.remove_sink(self);\n            }\n        };\n    }\n\n    cockpit.series = function series(interval, cache, fetch) {\n        return new SeriesSink(interval, cache, fetch);\n    };\n\n    var unique = 1;\n\n    function SeriesGrid(interval, beg, end) {\n        var self = this;\n\n        /* We can trigger events */\n        event_mixin(self, { });\n\n        var rows = [];\n\n        self.interval = interval;\n        self.beg = 0;\n        self.end = 0;\n\n        /*\n         * Used to populate table data, the values are:\n         * [ callback, row ]\n         */\n        var callbacks = [ ];\n\n        var sinks = [ ];\n\n        var suppress = 0;\n\n        var id = \"g1-\" + unique;\n        unique += 1;\n\n        /* Used while walking */\n        var walking = null;\n        var offset = null;\n\n        self.notify = function notify(x, n) {\n            if (suppress)\n                return;\n            if (x + n > self.end - self.beg)\n                n = (self.end - self.beg) - x;\n            if (n <= 0)\n                return;\n            var j;\n            var jlen = callbacks.length;\n            var callback, row;\n            for (j = 0; j < jlen; j++) {\n                callback = callbacks[j][0];\n                row = callbacks[j][1];\n                callback.call(self, row, x, n);\n            }\n\n            self.dispatchEvent(\"notify\", x, n);\n        };\n\n        self.add = function add(/* sink, path */) {\n            var row = [];\n            rows.push(row);\n\n            var sink, path, links, cb;\n\n            /* Called as add(sink, path) */\n            if (is_object(arguments[0])) {\n                sink = arguments[0];\n                sink = sink[\"series\"] || sink;\n\n                /* The path argument can be an array, or a dot separated string */\n                path = arguments[1];\n                if (!path)\n                    path = [];\n                else if (typeof (path) === \"string\")\n                    path = path.split(\".\");\n\n                links = sink._register(self, id);\n                if (!links.length)\n                    sinks.push({ sink: sink, links: links });\n                links.push([path, row]);\n\n            /* Called as add(callback) */\n            } else if (is_function(arguments[0])) {\n                cb = [ arguments[0], row ];\n                if (arguments[1] === true)\n                    callbacks.unshift(cb);\n                else\n                    callbacks.push(cb);\n\n            /* Not called as add() */\n            } else if (arguments.length !== 0) {\n                throw Error(\"invalid args to grid.add()\");\n            }\n\n            return row;\n        };\n\n        self.remove = function remove(row) {\n            var j, i, ilen, jlen;\n\n            /* Remove from the sinks */\n            ilen = sinks.length;\n            for (i = 0; i < ilen; i++) {\n                jlen = sinks[i].links.length;\n                for (j = 0; j < jlen; j++) {\n                    if (sinks[i].links[j][1] === row) {\n                        sinks[i].links.splice(j, 1);\n                        break;\n                    }\n                }\n            }\n\n            /* Remove from our list of rows */\n            ilen = rows.length;\n            for (i = 0; i < ilen; i++) {\n                if (rows[i] === row) {\n                    rows.splice(i, 1);\n                    break;\n                }\n            }\n        };\n\n        self.remove_sink = function remove_sink(sink) {\n            var i;\n            var len = sinks.length;\n            for (i = 0; i < len; i++) {\n                if (sinks[i].sink === sink) {\n                    sinks[i].links.remove();\n                    sinks.splice(i, 1);\n                    break;\n                }\n            }\n        };\n\n        self.sync = function sync(for_walking) {\n            /* Suppress notifications */\n            suppress++;\n\n            /* Ask all sinks to load data */\n            var sink, i;\n            var len = sinks.length;\n            for (i = 0; i < len; i++) {\n                sink = sinks[i].sink;\n                sink.load(self.beg, self.end, for_walking);\n            }\n\n            suppress--;\n\n            /* Notify for all rows */\n            self.notify(0, self.end - self.beg);\n        };\n\n        function move_internal(beg, end, for_walking) {\n            if (end === undefined)\n                end = beg + (self.end - self.beg);\n\n            if (end < beg)\n                beg = end;\n\n            self.beg = beg;\n            self.end = end;\n\n            if (!rows.length)\n                return;\n\n            rows.forEach(function(row) {\n                row.length = 0;\n            });\n\n            self.sync(for_walking);\n        }\n\n        function stop_walking() {\n            window.clearInterval(walking);\n            walking = null;\n            offset = null;\n        }\n\n        self.move = function move(beg, end) {\n            stop_walking();\n            /* Some code paths use now twice.\n             * They should use the same value.\n             */\n            var now = null;\n\n            /* Treat negative numbers relative to now */\n            if (beg === undefined) {\n                beg = 0;\n            } else if (is_negative(beg)) {\n                now = Date.now();\n                beg = Math.floor(now / self.interval) + beg;\n            }\n            if (end !== undefined && is_negative(end)) {\n                if (now === null)\n                    now = Date.now();\n                end = Math.floor(now / self.interval) + end;\n            }\n\n            move_internal(beg, end, false);\n        };\n\n        self.walk = function walk() {\n            /* Don't overflow 32 signed bits with the interval since\n             * many browsers will mishandle it.  This means that plots\n             * that would make about one step every month don't walk\n             * at all, but I guess that is ok.\n             *\n             * For example,\n             * https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setTimeout\n             * says:\n             *\n             *    Browsers including Internet Explorer, Chrome,\n             *    Safari, and Firefox store the delay as a 32-bit\n             *    signed Integer internally. This causes an Integer\n             *    overflow when using delays larger than 2147483647,\n             *    resulting in the timeout being executed immediately.\n             */\n\n            var start = Date.now();\n            if (self.interval > 2000000000)\n                return;\n\n            stop_walking();\n            offset = start - self.beg * self.interval;\n            walking = window.setInterval(function() {\n                var now = Date.now();\n                move_internal(Math.floor((now - offset) / self.interval), undefined, true);\n            }, self.interval);\n        };\n\n        self.close = function close() {\n            stop_walking();\n            while (sinks.length)\n                (sinks.pop()).links.remove();\n        };\n\n        self.move(beg, end);\n    }\n\n    cockpit.grid = function grid(interval, beg, end) {\n        return new SeriesGrid(interval, beg, end);\n    };\n\n    /* --------------------------------------------------------------------\n     * Basic utilities.\n     */\n\n    function BasicError(problem, message) {\n        this.problem = problem;\n        this.message = message || cockpit.message(problem);\n        this.toString = function() {\n            return this.message;\n        };\n    }\n\n    cockpit.logout = function logout(reload) {\n        /* fully clear session storage */\n        cockpit.sessionStorage.clear(true);\n\n        /* Only clean application data from localStorage,\n         * except for login-data. Clear that completely */\n        cockpit.localStorage.removeItem('login-data', true);\n        cockpit.localStorage.clear(false);\n\n        if (reload !== false)\n            reload_after_disconnect = true;\n        ensure_transport(function(transport) {\n            if (!transport.send_control({ \"command\": \"logout\", \"disconnect\": true }))\n                window.location.reload(reload_after_disconnect);\n        });\n        window.sessionStorage.setItem(\"logout-intent\", \"explicit\");\n    };\n\n    /* Not public API ... yet? */\n    cockpit.drop_privileges = function drop_privileges() {\n        ensure_transport(function(transport) {\n            transport.send_control({ \"command\": \"logout\", \"disconnect\": false });\n        });\n    };\n\n    /* ---------------------------------------------------------------------\n     * User and system information\n     */\n\n    cockpit.info = { };\n    event_mixin(cockpit.info, { });\n\n    init_callback = function(options) {\n        if (options.system)\n            extend(cockpit.info, options.system);\n        if (options.system)\n            cockpit.info.dispatchEvent(\"changed\");\n    };\n\n    var the_user = null;\n    cockpit.user = function () {\n        var dfd = cockpit.defer();\n        var dbus;\n        if (!the_user) {\n            dbus = cockpit.dbus(null, { \"bus\": \"internal\" });\n            dbus.call(\"/user\", \"org.freedesktop.DBus.Properties\", \"GetAll\",\n                      [ \"cockpit.User\" ], { \"type\": \"s\" })\n                .done(function(reply) {\n                    var user = reply[0];\n                    dfd.resolve({\n                        id: user.Id.v,\n                        name: user.Name.v,\n                        full_name: user.Full.v,\n                        groups: user.Groups.v,\n                        home: user.Home.v,\n                        shell: user.Shell.v\n                    });\n                })\n                .fail(function(ex) {\n                    dfd.reject(ex);\n                })\n                .always(function() {\n                    dbus.close();\n                });\n        } else {\n            dfd.resolve(the_user);\n        }\n\n        return dfd.promise;\n    };\n\n    /* ------------------------------------------------------------------------\n     * Override for broken browser behavior\n     */\n\n    document.addEventListener(\"click\", function(ev) {\n        if (ev.target.classList && in_array(ev.target.classList, 'disabled'))\n          ev.stopPropagation();\n    }, true);\n\n    /* ------------------------------------------------------------------------\n     * Cockpit location\n     */\n\n    /* HACK: Mozilla will unescape 'window.location.hash' before returning\n     * it, which is broken.\n     *\n     * https://bugzilla.mozilla.org/show_bug.cgi?id=135309\n     */\n\n    var last_loc = null;\n\n    function get_window_location_hash() {\n        return (window.location.href.split('#')[1] || '');\n    }\n\n    function Location() {\n        var self = this;\n        var application = cockpit.transport.application();\n        self.url_root = url_root || \"\";\n        if (application.indexOf(\"cockpit+=\") === 0) {\n            if (self.url_root)\n                self.url_root += '/';\n            self.url_root = self.url_root + application.replace(\"cockpit+\", '');\n        }\n\n        var href = get_window_location_hash();\n        var options = { };\n        var path = decode(href, options);\n\n        function decode_path(input) {\n            var parts = input.split('/').map(decodeURIComponent);\n            var result, i;\n            var pre_parts = [];\n\n            if (self.url_root)\n                pre_parts = self.url_root.split('/').map(decodeURIComponent);\n\n            if (input && input[0] !== \"/\") {\n                result = [].concat(path);\n                result.pop();\n                result = result.concat(parts);\n            } else {\n                result = parts;\n            }\n\n            result = resolve_path_dots(result);\n            for (i = 0; i < pre_parts.length; i++) {\n                if (pre_parts[i] !== result[i])\n                    break;\n            }\n            if (i == pre_parts.length)\n                result.splice(0, pre_parts.length);\n\n            return result;\n        }\n\n        function encode(path, options, with_root) {\n            if (typeof path == \"string\")\n                path = decode_path(path, self.path);\n\n            var href = \"/\" + path.map(encodeURIComponent).join(\"/\");\n            if (with_root && self.url_root && href.indexOf(\"/\" + self.url_root + \"/\" !== 0))\n                href = \"/\" + self.url_root + href;\n\n            /* Undo unnecessary encoding of these */\n            href = href.replace(\"%40\", \"@\");\n            href = href.replace(\"%3D\", \"=\");\n            href = href.replace(/%2B/g, \"+\");\n\n            var opt, value;\n            var query = [];\n            function push_option(v) {\n                query.push(encodeURIComponent(opt) + \"=\" + encodeURIComponent(v));\n            }\n\n            if (options) {\n                for (opt in options) {\n                    value = options[opt];\n                    if (!is_array(value))\n                        value = [ value ];\n                    value.forEach(push_option);\n                }\n                if (query.length > 0)\n                    href += \"?\" + query.join(\"&\");\n            }\n            return href;\n        }\n\n        function decode(href, options) {\n            if (href[0] == '#')\n                href = href.substr(1);\n\n            var pos = href.indexOf('?');\n            var first = href;\n            if (pos === -1)\n                first = href;\n            else\n                first = href.substr(0, pos);\n            var path = decode_path(first);\n            if (pos !== -1 && options) {\n                href.substring(pos + 1).split(\"&\")\n                .forEach(function(opt) {\n                    var last;\n                    var parts = opt.split('=');\n                    var name = decodeURIComponent(parts[0]);\n                    var value = decodeURIComponent(parts[1]);\n                    if (options.hasOwnProperty(name)) {\n                        last = options[name];\n                        if (!is_array(value))\n                            last = options[name] = [ last ];\n                        last.push(value);\n                    } else {\n                        options[name] = value;\n                    }\n                });\n            }\n\n            return path;\n        }\n\n        function href_for_go_or_replace(/* ... */) {\n            var href;\n            if (arguments.length == 1 && arguments[0] instanceof Location) {\n                href = String(arguments[0]);\n            } else if (typeof arguments[0] == \"string\") {\n                var options = arguments[1] || { };\n                href = encode(decode(arguments[0], options), options);\n            } else {\n                href = encode.apply(self, arguments);\n            }\n            return href;\n        }\n\n        function replace(/* ... */) {\n            if (self !== last_loc)\n                return;\n            var href = href_for_go_or_replace.apply(self, arguments);\n            window.location.replace(window.location.pathname + '#' + href);\n        }\n\n        function go(/* ... */) {\n            if (self !== last_loc)\n                return;\n            var href = href_for_go_or_replace.apply(self, arguments);\n            window.location.hash = '#' + href;\n        }\n\n        Object.defineProperties(self, {\n            path: {\n                enumerable: true,\n                writable: false,\n                value: path\n            },\n            options: {\n                enumerable: true,\n                writable: false,\n                value: options\n            },\n            href: {\n                enumerable: true,\n                value: href\n            },\n            go: { value: go },\n            replace: { value: replace },\n            encode: { value: encode },\n            decode: { value: decode },\n            toString: { value: function() { return href } }\n        });\n    }\n\n    Object.defineProperty(cockpit, \"location\", {\n        enumerable: true,\n        get: function() {\n            if (!last_loc || last_loc.href !== get_window_location_hash())\n                last_loc = new Location();\n            return last_loc;\n        },\n        set: function(v) {\n            cockpit.location.go(v);\n        }\n    });\n\n    window.addEventListener(\"hashchange\", function() {\n        last_loc = null;\n        var hash = window.location.hash;\n        if (hash.indexOf(\"#\") === 0)\n            hash = hash.substring(1);\n        cockpit.hint(\"location\", { \"hash\": hash });\n        cockpit.dispatchEvent(\"locationchanged\");\n    });\n\n    /* ------------------------------------------------------------------------\n     * Cockpit jump\n     */\n\n    cockpit.jump = function jump(path, host) {\n        if (is_array(path))\n            path = \"/\" + path.map(encodeURIComponent).join(\"/\")\n.replace(\"%40\", \"@\")\n.replace(\"%3D\", \"=\")\n.replace(/%2B/g, \"+\");\n        else\n            path = \"\" + path;\n\n        /* When host is not given (undefined), use current transport's host. If\n         * it is null, use localhost.\n         */\n        if (host === undefined)\n            host = cockpit.transport.host;\n\n        var options = { command: \"jump\", location: path, host: host };\n        cockpit.transport.inject(\"\\n\" + JSON.stringify(options));\n    };\n\n    /* ---------------------------------------------------------------------\n     * Cockpit Page Visibility\n     */\n\n    (function() {\n        var hiddenProp;\n        var hiddenHint = false;\n\n        function visibility_change() {\n            var value = document[hiddenProp];\n            if (!hiddenProp || typeof value === \"undefined\")\n                value = false;\n            if (value === false)\n                value = hiddenHint;\n            if (cockpit.hidden !== value) {\n                cockpit.hidden = value;\n                cockpit.dispatchEvent(\"visibilitychange\");\n            }\n        }\n\n        if (typeof document.hidden !== \"undefined\") {\n            hiddenProp = \"hidden\";\n            document.addEventListener(\"visibilitychange\", visibility_change);\n        } else if (typeof document.mozHidden !== \"undefined\") {\n            hiddenProp = \"mozHidden\";\n            document.addEventListener(\"mozvisibilitychange\", visibility_change);\n        } else if (typeof document.msHidden !== \"undefined\") {\n            hiddenProp = \"msHidden\";\n            document.addEventListener(\"msvisibilitychange\", visibility_change);\n        } else if (typeof document.webkitHidden !== \"undefined\") {\n            hiddenProp = \"webkitHidden\";\n            document.addEventListener(\"webkitvisibilitychange\", visibility_change);\n        }\n\n        /*\n         * Wait for changes in visibility of just our iframe. These are delivered\n         * via a hint message from the parent. For now we are the only handler of\n         * hint messages, so this is implemented rather simply on purpose.\n         */\n        process_hints = function(data) {\n            if (\"hidden\" in data) {\n                hiddenHint = data.hidden;\n                visibility_change();\n            }\n        };\n\n        /* The first time */\n        visibility_change();\n    }());\n\n    /* ---------------------------------------------------------------------\n     * Spawning\n     */\n\n    function ProcessError(options, name) {\n        this.problem = options.problem || null;\n        this.exit_status = options[\"exit-status\"];\n        if (this.exit_status === undefined)\n            this.exit_status = null;\n        this.exit_signal = options[\"exit-signal\"];\n        if (this.exit_signal === undefined)\n            this.exit_signal = null;\n        this.message = options.message;\n\n        if (this.message === undefined) {\n            if (this.problem)\n                this.message = cockpit.message(options.problem);\n            else if (this.exit_signal !== null)\n                this.message = cockpit.format(_(\"$0 killed with signal $1\"), name, this.exit_signal);\n            else if (this.exit_status !== undefined)\n                this.message = cockpit.format(_(\"$0 exited with code $1\"), name, this.exit_status);\n            else\n                this.message = cockpit.format(_(\"$0 failed\"), name);\n        } else {\n            this.message = this.message.trim();\n        }\n\n        this.toString = function() {\n            return this.message;\n        };\n    }\n\n    function spawn_debug() {\n        if (window.debugging == \"all\" || window.debugging == \"spawn\")\n            console.debug.apply(console, arguments);\n    }\n\n    /* public */\n    cockpit.spawn = function(command, options) {\n        var dfd = cockpit.defer();\n\n        var args = { \"payload\": \"stream\", \"spawn\": [] };\n        if (command instanceof Array) {\n            for (var i = 0; i < command.length; i++)\n                args[\"spawn\"].push(String(command[i]));\n        } else {\n            args[\"spawn\"].push(String(command));\n        }\n        if (options !== undefined)\n            extend(args, options);\n\n        var name = args[\"spawn\"][0] || \"process\";\n        var channel = cockpit.channel(args);\n\n        /* Callback that wants a stream response, see below */\n        var buffer = channel.buffer(null);\n\n        channel.addEventListener(\"close\", function(event, options) {\n            var data = buffer.squash();\n            spawn_debug(\"process closed:\", JSON.stringify(options));\n            if (data)\n                spawn_debug(\"process output:\", data);\n            if (options.message !== undefined)\n                spawn_debug(\"process error:\", options.message);\n\n            if (options.problem)\n                dfd.reject(new ProcessError(options, name));\n            else if (options[\"exit-status\"] || options[\"exit-signal\"])\n                dfd.reject(new ProcessError(options, name), data);\n            else if (options.message !== undefined)\n                dfd.resolve(data, options.message);\n            else\n                dfd.resolve(data);\n        });\n\n        var ret = dfd.promise;\n        ret.stream = function(callback) {\n            buffer.callback = callback.bind(ret);\n            return this;\n        };\n\n        ret.input = function(message, stream) {\n            if (message !== null && message !== undefined) {\n                spawn_debug(\"process input:\", message);\n                channel.send(message);\n            }\n            if (!stream)\n                channel.control({ command: \"done\" });\n            return this;\n        };\n\n        ret.close = function(problem) {\n            spawn_debug(\"process closing:\", problem);\n            if (channel.valid)\n                channel.close(problem);\n            return this;\n        };\n\n        return ret;\n    };\n\n    /* public */\n    cockpit.script = function(script, args, options) {\n        if (!options && is_plain_object(args)) {\n            options = args;\n            args = [];\n        }\n        var command = [ \"/bin/sh\", \"-c\", script, \"--\" ];\n        command.push.apply(command, args);\n        return cockpit.spawn(command, options);\n    };\n\n    function dbus_debug() {\n        if (window.debugging == \"all\" || window.debugging == \"dbus\")\n            console.debug.apply(console, arguments);\n    }\n\n    function DBusError(arg, arg1) {\n        if (typeof (arg) == \"string\") {\n            this.problem = arg;\n            this.name = null;\n            this.message = arg1 || cockpit.message(arg);\n        } else {\n            this.problem = null;\n            this.name = arg[0];\n            this.message = arg[1][0] || arg[0];\n        }\n        this.toString = function() {\n            return this.message;\n        };\n    }\n\n    function DBusCache() {\n        var self = this;\n\n        var callbacks = [ ];\n        self.data = { };\n        self.meta = { };\n\n        self.connect = function connect(path, iface, callback, first) {\n            var cb = [path, iface, callback];\n            if (first)\n                callbacks.unshift(cb);\n            else\n                callbacks.push(cb);\n            return {\n                remove: function remove() {\n                    var i;\n                    var length = callbacks.length;\n                    for (i = 0; i < length; i++) {\n                        var cb = callbacks[i];\n                        if (cb[0] === path && cb[1] === iface && cb[2] === callback) {\n                            delete cb[i];\n                            break;\n                        }\n                    }\n                }\n            };\n        };\n\n        function emit(path, iface, props) {\n            var copy = callbacks.slice();\n            var i;\n            var length = copy.length;\n            for (i = 0; i < length; i++) {\n                var cb = copy[i];\n                if ((!cb[0] || cb[0] === path) &&\n                    (!cb[1] || cb[1] === iface)) {\n                    cb[2](props, path);\n                }\n            }\n        }\n\n        self.update = function update(path, iface, props) {\n            if (!self.data[path])\n                self.data[path] = { };\n            if (!self.data[path][iface])\n                self.data[path][iface] = props;\n            else\n                props = extend(self.data[path][iface], props);\n            emit(path, iface, props);\n        };\n\n        self.remove = function remove(path, iface) {\n            if (self.data[path]) {\n                delete self.data[path][iface];\n                emit(path, iface, null);\n            }\n        };\n\n        self.lookup = function lookup(path, iface) {\n            if (self.data[path])\n                return self.data[path][iface];\n            return undefined;\n        };\n\n        self.each = function each(iface, callback) {\n            var path, ifa;\n            for (path in self.data) {\n                for (iface in self.data[path]) {\n                    if (ifa == iface)\n                        callback(self.data[path][iface], path);\n                }\n            }\n        };\n\n        self.close = function close() {\n            self.data = { };\n            var copy = callbacks;\n            callbacks = [ ];\n            var i;\n            var length = copy.length;\n            for (i = 0; i < length; i++)\n                copy[i].callback();\n        };\n    }\n\n    function DBusProxy(client, cache, iface, path, options) {\n        var self = this;\n        event_mixin(self, { });\n\n        var valid = false;\n        var defined = false;\n        var waits = cockpit.defer();\n\n        /* No enumeration on these properties */\n        Object.defineProperties(self, {\n            \"client\": { value: client, enumerable: false, writable: false },\n            \"path\": { value: path, enumerable: false, writable: false },\n            \"iface\": { value: iface, enumerable: false, writable: false },\n            \"valid\": { get: function() { return valid }, enumerable: false },\n            \"wait\": { enumerable: false, writable: false,\n                value: function(func) {\n                    if (func)\n                        waits.promise.always(func);\n                    return waits.promise;\n                }\n            },\n            \"call\": { value: function(name, args, options) { return client.call(path, iface, name, args, options) },\n                      enumerable: false, writable: false },\n            \"data\": { value: { }, enumerable: false }\n        });\n\n        if (typeof window.$ === \"function\") {\n            Object.defineProperty(self, window.$.expando, {\n                value: { }, writable: true, enumerable: false\n            });\n        }\n\n        if (!options)\n            options = { };\n\n        function define() {\n            if (!cache.meta[iface])\n                return;\n\n            var meta = cache.meta[iface];\n            defined = true;\n\n            Object.keys(meta.methods || { }).forEach(function(name) {\n                if (name[0].toLowerCase() == name[0])\n                    return; /* Only map upper case */\n\n                /* Again, make sure these don't show up in enumerations */\n                Object.defineProperty(self, name, {\n                    enumerable: false,\n                    value: function() {\n                        var dfd = cockpit.defer();\n                        client.call(path, iface, name, Array.prototype.slice.call(arguments))\n                            .done(function(reply) { dfd.resolve.apply(dfd, reply) })\n                            .fail(function(ex) { dfd.reject(ex) });\n                        return dfd.promise;\n                    }\n                });\n            });\n\n            Object.keys(meta.properties || { }).forEach(function(name) {\n                if (name[0].toLowerCase() == name[0])\n                    return; /* Only map upper case */\n\n                var config = {\n                    enumerable: true,\n                    get: function() { return self.data[name] },\n                    set: function(v) { throw Error(name + \"is not writable\") }\n                };\n\n                var prop = meta.properties[name];\n                if (prop.flags && prop.flags.indexOf('w') !== -1) {\n                    config.set = function(v) {\n                        client.call(path, \"org.freedesktop.DBus.Properties\", \"Set\",\n                                [ iface, name, cockpit.variant(prop.type, v) ])\n                            .fail(function(ex) {\n                                console.log(\"Couldn't set \" + iface + \" \" + name +\n                                            \" at \" + path + \": \" + ex);\n                            });\n                    };\n                }\n\n                /* Again, make sure these don't show up in enumerations */\n                Object.defineProperty(self, name, config);\n            });\n        }\n\n        function update(props) {\n            if (props) {\n                extend(self.data, props);\n                if (!defined)\n                    define();\n                valid = true;\n            } else {\n                valid = false;\n            }\n            self.dispatchEvent(\"changed\", props);\n        }\n\n        cache.connect(path, iface, update, true);\n        update(cache.lookup(path, iface));\n\n        function signal(path, iface, name, args) {\n            self.dispatchEvent(\"signal\", name, args);\n            if (name[0].toLowerCase() != name[0]) {\n                args = args.slice();\n                args.unshift(name);\n                self.dispatchEvent.apply(self, args);\n            }\n        }\n\n        client.subscribe({ \"path\": path, \"interface\": iface }, signal, options.subscribe !== false);\n\n        function waited(ex) {\n            if (valid)\n                waits.resolve();\n            else\n                waits.reject(ex);\n        }\n\n        /* If watching then do a proper watch, otherwise object is done */\n        if (options.watch !== false)\n            client.watch({ \"path\": path, \"interface\": iface }).always(waited);\n        else\n            waited();\n    }\n\n    function DBusProxies(client, cache, iface, path_namespace, options) {\n        var self = this;\n        event_mixin(self, { });\n\n        var waits;\n\n        Object.defineProperties(self, {\n            \"client\": { value: client, enumerable: false, writable: false },\n            \"iface\": { value: iface, enumerable: false, writable: false },\n            \"path_namespace\": { value: path_namespace, enumerable: false, writable: false },\n            \"wait\": { enumerable: false, writable: false,\n                value: function(func) {\n                    if (func)\n                        waits.always(func);\n                    return waits;\n                }\n            }\n        });\n\n        if (typeof window.$ === \"function\") {\n            Object.defineProperty(self, window.$.expando, {\n                value: { }, writable: true, enumerable: false\n            });\n        }\n\n        /* Subscribe to signals once for all proxies */\n        var match = { \"interface\": iface, \"path_namespace\": path_namespace };\n\n        /* Callbacks added by proxies */\n        client.subscribe(match);\n\n        /* Watch for property changes */\n        if (options.watch !== false) {\n            waits = client.watch(match);\n        } else {\n            waits = cockpit.defer().resolve().promise;\n        }\n\n        /* Already added watch/subscribe, tell proxies not to */\n        options = extend({ watch: false, subscribe: false }, options);\n\n        function update(props, path) {\n            var proxy = self[path];\n            if (path) {\n                if (!props && proxy) {\n                    delete self[path];\n                    self.dispatchEvent(\"removed\", proxy);\n                } else if (props) {\n                    if (!proxy) {\n                        proxy = self[path] = client.proxy(iface, path, options);\n                        self.dispatchEvent(\"added\", proxy);\n                    }\n                    self.dispatchEvent(\"changed\", proxy);\n                }\n            }\n        }\n\n        cache.connect(null, iface, update, false);\n        cache.each(iface, update);\n    }\n\n    function DBusClient(name, options) {\n        var self = this;\n        event_mixin(self, { });\n\n        var args = { };\n        var track = false;\n        var owner = null;\n\n        if (options) {\n            if (options.track)\n                track = true;\n\n            delete options['track'];\n            extend(args, options);\n        }\n        args.payload = \"dbus-json3\";\n        if (name)\n            args.name = name;\n        self.options = options;\n        self.unique_name = null;\n\n        dbus_debug(\"dbus open: \", args);\n\n        var channel = cockpit.channel(args);\n        var subscribers = { };\n        var published = { };\n        var calls = { };\n        var cache;\n\n        /* The problem we closed with */\n        var closed;\n\n        self.constructors = { \"*\": DBusProxy };\n\n        /* Allows waiting on the channel if necessary */\n        self.wait = channel.wait;\n\n        function ensure_cache() {\n            if (!cache)\n                cache = new DBusCache();\n        }\n\n        function send(payload) {\n            if (channel && channel.valid) {\n                dbus_debug(\"dbus:\", payload);\n                channel.send(payload);\n                return true;\n            }\n            return false;\n        }\n\n        function matches(signal, match) {\n            if (match.path && signal[0] !== match.path)\n                return false;\n            if (match.path_namespace && signal[0].indexOf(match.path_namespace) !== 0)\n                return false;\n            if (match[\"interface\"] && signal[1] !== match[\"interface\"])\n                return false;\n            if (match.member && signal[2] !== match.member)\n                return false;\n            if (match.arg0 && (!signal[3] || signal[3][0] !== match.arg0))\n                return false;\n            return true;\n        }\n\n        function on_message(event, payload) {\n            dbus_debug(\"dbus:\", payload);\n            var msg;\n            try {\n                msg = JSON.parse(payload);\n            } catch (ex) {\n                console.warn(\"received invalid dbus json message:\", ex);\n            }\n            if (msg === undefined) {\n                channel.close({ \"problem\": \"protocol-error\" });\n                return;\n            }\n            var dfd, options;\n            if (msg.id !== undefined)\n                dfd = calls[msg.id];\n            if (msg.reply) {\n                if (dfd) {\n                    options = { };\n                    if (msg.type)\n                        options.type = msg.type;\n                    if (msg.flags)\n                        options.flags = msg.flags;\n                    dfd.resolve(msg.reply[0] || [], options);\n                    delete calls[msg.id];\n                }\n                return;\n            } else if (msg.error) {\n                if (dfd) {\n                    dfd.reject(new DBusError(msg.error));\n                    delete calls[msg.id];\n                }\n                return;\n            }\n\n            /*\n             * The above promise resolutions or failures are triggered via\n             * later_invoke(). In order to preserve ordering guarantees we\n             * also have to process other events that way too.\n             */\n            later_invoke(function() {\n                var id, subscription;\n                if (msg.signal) {\n                    for (id in subscribers) {\n                        subscription = subscribers[id];\n                        if (subscription.callback) {\n                            if (matches(msg.signal, subscription.match))\n                                subscription.callback.apply(self, msg.signal);\n                        }\n                    }\n                } else if (msg.call) {\n                    handle(msg.call, msg.id);\n                } else if (msg.notify) {\n                    notify(msg.notify);\n                } else if (msg.meta) {\n                    meta(msg.meta);\n                } else if (msg.owner !== undefined) {\n                    self.dispatchEvent(\"owner\", msg.owner);\n\n                    /*\n                     * We won't get this signal with the same\n                     * owner twice so if we've seen an owner\n                     * before that means it has changed.\n                     */\n                    if (track && owner)\n                        self.close();\n\n                    owner = msg.owner;\n                } else {\n                    dbus_debug(\"received unexpected dbus json message:\", payload);\n                }\n            });\n        }\n\n        function meta(data) {\n            ensure_cache();\n            extend(cache.meta, data);\n            self.dispatchEvent(\"meta\", data);\n        }\n\n        self.meta = function(data, options) {\n            if (!channel || !channel.valid)\n                return;\n\n            var message = extend({ }, options, {\n                \"meta\": data\n            });\n\n            send(JSON.stringify(message));\n            meta(data);\n        };\n\n        function notify(data) {\n            ensure_cache();\n            var path, iface, props;\n            for (path in data) {\n                for (iface in data[path]) {\n                    props = data[path][iface];\n                    if (!props)\n                        cache.remove(path, iface);\n                    else\n                        cache.update(path, iface, props);\n                }\n            }\n            self.dispatchEvent(\"notify\", data);\n        }\n\n        this.notify = notify;\n\n        function close_perform(options) {\n            closed = options.problem || \"disconnected\";\n            var id;\n            var outstanding = calls;\n            calls = { };\n            for (id in outstanding) {\n                outstanding[id].reject(new DBusError(closed, options.message));\n            }\n            self.dispatchEvent(\"close\", options);\n        }\n\n        this.close = function close(options) {\n            if (typeof options == \"string\")\n                options = { \"problem\": options };\n            if (!options)\n                options = { };\n            if (channel)\n                channel.close(options);\n            else\n                close_perform(options);\n        };\n\n        function on_ready(event, message) {\n            dbus_debug(\"dbus ready:\", options);\n            self.unique_name = message[\"unique-name\"];\n        }\n\n        function on_close(event, options) {\n            dbus_debug(\"dbus close:\", options);\n            channel.removeEventListener(\"ready\", on_ready);\n            channel.removeEventListener(\"message\", on_message);\n            channel.removeEventListener(\"close\", on_close);\n            channel = null;\n            close_perform(options);\n        }\n\n        channel.addEventListener(\"ready\", on_ready);\n        channel.addEventListener(\"message\", on_message);\n        channel.addEventListener(\"close\", on_close);\n\n        var last_cookie = 1;\n\n        this.call = function call(path, iface, method, args, options) {\n            var dfd = cockpit.defer();\n            var id = String(last_cookie);\n            last_cookie++;\n            var method_call = extend({ }, options, {\n                \"call\": [ path, iface, method, args || [] ],\n                \"id\": id\n            });\n\n            var msg = JSON.stringify(method_call);\n            if (send(msg))\n                calls[id] = dfd;\n            else\n                dfd.reject(new DBusError(closed));\n\n            return dfd.promise;\n        };\n\n        self.signal = function signal(path, iface, member, args, options) {\n            if (!channel || !channel.valid)\n                return;\n\n            var message = extend({ }, options, {\n                \"signal\": [ path, iface, member, args || [] ]\n            });\n\n            send(JSON.stringify(message));\n        };\n\n        this.subscribe = function subscribe(match, callback, rule) {\n            var subscription = {\n                match: extend({ }, match),\n                callback: callback\n            };\n\n            if (rule !== false)\n                send(JSON.stringify({ \"add-match\": subscription.match }));\n\n            var id;\n            if (callback) {\n                id = String(last_cookie);\n                last_cookie++;\n                subscribers[id] = subscription;\n            }\n\n            return {\n                remove: function() {\n                    var prev;\n                    if (id) {\n                        prev = subscribers[id];\n                        if (prev)\n                            delete subscribers[id];\n                    }\n                    if (rule !== false && prev)\n                        send(JSON.stringify({ \"remove-match\": prev.match }));\n                }\n            };\n        };\n\n        self.watch = function watch(path) {\n            var match;\n            if (is_plain_object(path))\n                match = extend({ }, path);\n            else\n                match = { path: String(path) };\n\n            var id = String(last_cookie);\n            last_cookie++;\n            var dfd = cockpit.defer();\n\n            var msg = JSON.stringify({ \"watch\": match, \"id\": id });\n            if (send(msg))\n                calls[id] = dfd;\n            else\n                dfd.reject(new DBusError(closed));\n\n            var ret = dfd.promise;\n            ret.remove = function remove() {\n                if (id in calls) {\n                    dfd.reject(new DBusError(\"cancelled\"));\n                    delete calls[id];\n                }\n                send(JSON.stringify({ \"unwatch\": match }));\n            };\n            return ret;\n        };\n\n        function unknown_interface(path, iface) {\n            var message = \"DBus interface \" + iface + \" not available at \" + path;\n            return cockpit.reject(new DBusError([ \"org.freedesktop.DBus.Error.UnknownInterface\", [ message ] ]));\n        }\n\n        function unknown_method(path, iface, method) {\n            var message = \"DBus method \" + iface + \" \" + method + \" not available at \" + path;\n            return cockpit.reject(new DBusError([ \"org.freedesktop.DBus.Error.UnknownMethod\", [ message ] ]));\n        }\n\n        function not_implemented(path, iface, method) {\n            console.warn(\"method is not implemented properly: \", path, iface, method);\n            return unknown_method(path, iface, method);\n        }\n\n        function invoke(call) {\n            var path = call[0];\n            var iface = call[1];\n            var method = call[2];\n            var object = published[path + \"\\n\" + iface];\n            var info = cache.meta[iface];\n            if (!object || !info)\n                return unknown_interface(path, iface);\n            if (!info.methods || !(method in info.methods))\n                return unknown_method(path, iface, method);\n            if (typeof object[method] != \"function\")\n                return not_implemented(path, iface, method);\n            return object[method].apply(object, call[3]);\n        }\n\n        function handle(call, cookie) {\n            var result = invoke(call);\n            if (!cookie)\n                return; /* Discard result */\n            cockpit.when(result).then(function() {\n                var out = Array.prototype.slice.call(arguments, 0);\n                if (out.length == 1 && typeof out[0] == \"undefined\")\n                    out = [ ];\n                send(JSON.stringify({ \"reply\": [ out ], \"id\": cookie }));\n            }, function(ex) {\n                var error = [ ];\n                error[0] = ex.name || \" org.freedesktop.DBus.Error.Failed\";\n                error[1] = [ cockpit.message(ex) || error[0] ];\n                send(JSON.stringify({ \"error\": error, \"id\": cookie }));\n            });\n        }\n\n        self.publish = function(path, iface, object, options) {\n            var publish = [ path, iface ];\n\n            var id = String(last_cookie);\n            last_cookie++;\n            var dfd = calls[id] = cockpit.defer();\n\n            var payload = JSON.stringify(extend({ }, options, {\n                \"publish\": publish,\n                \"id\": id,\n            }));\n\n            if (send(payload))\n                calls[id] = dfd;\n            else\n                dfd.reject(new DBusError(closed));\n\n            var key = path + \"\\n\" + iface;\n            dfd.promise.then(function() {\n                published[key] = object;\n            });\n\n            /* Return a way to remove this object */\n            var ret = dfd.promise;\n            ret.remove = function remove() {\n                if (id in calls) {\n                    dfd.reject(new DBusError(\"cancelled\"));\n                    delete calls[id];\n                }\n                delete published[key];\n                send(JSON.stringify({ \"unpublish\": publish }));\n            };\n            return ret;\n        };\n\n        self.proxy = function proxy(iface, path, options) {\n            if (!iface)\n                iface = name;\n            iface = String(iface);\n            if (!path)\n                path = \"/\" + iface.replace(/\\./g, \"/\");\n            var Constructor = self.constructors[iface];\n            if (!Constructor)\n                Constructor = self.constructors[\"*\"];\n            if (!options)\n                options = { };\n            ensure_cache();\n            return new Constructor(self, cache, iface, String(path), options);\n        };\n\n        self.proxies = function proxies(iface, path_namespace, options) {\n            if (!iface)\n                iface = name;\n            if (!path_namespace)\n                path_namespace = \"/\";\n            if (!options)\n                options = { };\n            ensure_cache();\n            return new DBusProxies(self, cache, String(iface), String(path_namespace), options);\n        };\n    }\n\n    /* Well known busses */\n    var shared_dbus = {\n        internal: null,\n        session: null,\n        system: null,\n    };\n\n    /* public */\n    cockpit.dbus = function dbus(name, options) {\n        if (!options)\n            options = { \"bus\": \"system\" };\n\n        /*\n         * Figure out if this we should use a shared bus.\n         *\n         * This is only the case if a null name *and* the\n         * options are just a simple { \"bus\": \"xxxx\" }\n         */\n        var keys = Object.keys(options);\n        var bus = options.bus;\n        var shared = !name && keys.length == 1 && bus in shared_dbus;\n\n        if (shared && shared_dbus[bus])\n            return shared_dbus[bus];\n\n        var client = new DBusClient(name, options);\n\n        /*\n         * Store the shared bus for next time. Override the\n         * close function to only work when a problem is\n         * indicated.\n         */\n        var old_close;\n        if (shared) {\n            client.close = function() {\n                if (arguments.length > 0)\n                    old_close.apply(client, arguments);\n            };\n            client.addEventListener(\"close\", function() {\n                if (shared_dbus[bus] == client)\n                    shared_dbus[bus] = null;\n            });\n            shared_dbus[bus] = client;\n        }\n\n        return client;\n    };\n\n    cockpit.variant = function variant(type, value) {\n        return { 'v': value, 't': type };\n    };\n\n    cockpit.byte_array = function byte_array(string) {\n        return window.btoa(string);\n    };\n\n    /* File access\n     */\n\n    cockpit.file = function file(path, options) {\n        options = options || { };\n        var binary = options.binary;\n\n        var self = {\n            path: path,\n            read: read,\n            replace: replace,\n            modify: modify,\n\n            watch: watch,\n\n            close: close\n        };\n\n        var base_channel_options = extend({ }, options);\n        delete base_channel_options.syntax;\n\n        function parse(str) {\n            if (options.syntax && options.syntax.parse)\n                return options.syntax.parse(str);\n            else\n                return str;\n        }\n\n        function stringify(obj) {\n            if (options.syntax && options.syntax.stringify)\n                return options.syntax.stringify(obj);\n            else\n                return obj;\n        }\n\n        var read_promise = null;\n        var read_channel;\n\n        function read() {\n            if (read_promise)\n                return read_promise;\n\n            var dfd = cockpit.defer();\n            var opts = extend({ }, base_channel_options, {\n                payload: \"fsread1\",\n                path: path\n            });\n\n            function try_read() {\n                read_channel = cockpit.channel(opts);\n                var content_parts = [ ];\n                read_channel.addEventListener(\"message\", function (event, message) {\n                    content_parts.push(message);\n                });\n                read_channel.addEventListener(\"close\", function (event, message) {\n                    read_channel = null;\n\n                    if (message.problem == \"change-conflict\") {\n                        try_read();\n                        return;\n                    }\n\n                    read_promise = null;\n\n                    if (message.problem) {\n                        var error = new BasicError(message.problem, message.message);\n                        fire_watch_callbacks(null, null, error);\n                        dfd.reject(error);\n                        return;\n                    }\n\n                    var content;\n                    if (message.tag == \"-\")\n                        content = null;\n                    else {\n                        try {\n                            content = parse(join_data(content_parts, binary));\n                        } catch (e) {\n                            fire_watch_callbacks(null, null, e);\n                            dfd.reject(e);\n                            return;\n                        }\n                    }\n\n                    fire_watch_callbacks(content, message.tag);\n                    dfd.resolve(content, message.tag);\n                });\n            }\n\n            try_read();\n\n            read_promise = dfd.promise;\n            return read_promise;\n        }\n\n        var replace_channel = null;\n\n        function replace(new_content, expected_tag) {\n            var dfd = cockpit.defer();\n\n            var file_content;\n            try {\n                if (new_content === null)\n                    file_content = null;\n                else\n                    file_content = stringify(new_content);\n            } catch (e) {\n                dfd.reject(e);\n                return dfd.promise;\n            }\n\n            if (replace_channel)\n                replace_channel.close(\"abort\");\n\n            var opts = extend({ }, base_channel_options, {\n                payload: \"fsreplace1\",\n                path: path,\n                tag: expected_tag\n            });\n            replace_channel = cockpit.channel(opts);\n\n            replace_channel.addEventListener(\"close\", function (event, message) {\n                replace_channel = null;\n                if (message.problem) {\n                    dfd.reject(new BasicError(message.problem, message.message));\n                } else {\n                    fire_watch_callbacks(new_content, message.tag);\n                    dfd.resolve(message.tag);\n                }\n            });\n\n            var len = 0;\n            var binary = false;\n            if (file_content) {\n                if (file_content.byteLength) {\n                    len = file_content.byteLength;\n                    binary = true;\n                } else if (file_content.length) {\n                    len = file_content.length;\n                }\n            }\n\n            var i, n;\n            var batch = 16 * 1024;\n            for (i = 0; i < len; i += batch) {\n                n = Math.min(len - i, batch);\n                if (binary)\n                    replace_channel.send(new window.Uint8Array(file_content.buffer, i, n));\n                else\n                    replace_channel.send(file_content.substr(i, n));\n            }\n\n            replace_channel.control({ command: \"done\" });\n            return dfd.promise;\n        }\n\n        function modify(callback, initial_content, initial_tag) {\n            var dfd = cockpit.defer();\n\n            function update(content, tag) {\n                var new_content = callback(content);\n                if (new_content === undefined)\n                    new_content = content;\n                replace(new_content, tag)\n                    .done(function (new_tag) {\n                        dfd.resolve(new_content, new_tag);\n                    })\n                    .fail(function (error) {\n                        if (error.problem == \"change-conflict\")\n                            read_then_update();\n                        else\n                            dfd.reject(error);\n                    });\n            }\n\n            function read_then_update() {\n                read()\n                    .done(update)\n                    .fail(function (error) {\n                        dfd.reject(error);\n                    });\n            }\n\n            if (initial_content === undefined)\n                read_then_update();\n            else\n                update(initial_content, initial_tag);\n\n            return dfd.promise;\n        }\n\n        var watch_callbacks = [];\n        var n_watch_callbacks = 0;\n\n        var watch_channel = null;\n        var watch_tag;\n\n        function ensure_watch_channel() {\n            if (n_watch_callbacks > 0) {\n                if (watch_channel)\n                    return;\n\n                var opts = extend({ }, base_channel_options, {\n                    payload: \"fswatch1\",\n                    path: path\n                });\n                watch_channel = cockpit.channel(opts);\n                watch_channel.addEventListener(\"message\", function (event, message_string) {\n                    var message;\n                    try { message = JSON.parse(message_string) } catch (e) { message = null }\n                    if (message && message.path == path && message.tag && message.tag != watch_tag)\n                        read();\n                });\n            } else {\n                if (watch_channel) {\n                    watch_channel.close();\n                    watch_channel = null;\n                }\n            }\n        }\n\n        function fire_watch_callbacks(/* content, tag, error */) {\n            watch_tag = arguments[1] || null;\n            invoke_functions(watch_callbacks, self, arguments);\n        }\n\n        function watch(callback) {\n            if (callback)\n                watch_callbacks.push(callback);\n            n_watch_callbacks += 1;\n            ensure_watch_channel();\n\n            watch_tag = null;\n            read();\n\n            return {\n                remove: function () {\n                    var index;\n                    if (callback) {\n                        index = watch_callbacks.indexOf(callback);\n                        if (index > -1)\n                            watch_callbacks[index] = null;\n                    }\n                    n_watch_callbacks -= 1;\n                    ensure_watch_channel();\n                }\n            };\n        }\n\n        function close() {\n            if (read_channel)\n                read_channel.close(\"cancelled\");\n            if (replace_channel)\n                replace_channel.close(\"cancelled\");\n            if (watch_channel)\n                watch_channel.close(\"cancelled\");\n        }\n\n        return self;\n    };\n\n    /* ---------------------------------------------------------------------\n     * Localization\n     */\n\n    var po_data = { };\n    var po_plural;\n\n    cockpit.language = undefined;\n\n    cockpit.locale = function locale(po) {\n        var lang = cockpit.language || \"en\";\n        var header;\n\n        if (po) {\n            extend(po_data, po);\n            header = po[\"\"];\n        } else if (po === null) {\n            po_data = { };\n        }\n\n        if (header) {\n            if (header[\"plural-forms\"])\n                po_plural = header[\"plural-forms\"];\n            if (header[\"language\"])\n                lang = header[\"language\"];\n        }\n\n        cockpit.language = lang;\n    };\n\n    cockpit.translate = function translate(/* ... */) {\n        var what;\n\n        /* Called without arguments, entire document */\n        if (arguments.length === 0)\n            what = [ document ];\n\n        /* Called with a single array like argument */\n        else if (arguments.length === 1 && arguments[0].length)\n            what = arguments[0];\n\n        /* Called with 1 or more element arguments */\n        else\n            what = arguments;\n\n        /* Translate all the things */\n        var w, wlen, val, i, ilen, t, tlen, list, tasks, el;\n        for (w = 0, wlen = what.length; w < wlen; w++) {\n            /* The list of things to translate */\n            list = null;\n            if (what[w].querySelectorAll)\n                list = what[w].querySelectorAll(\"[translatable], [translate]\");\n            if (!list)\n                continue;\n\n            /* Each element */\n            for (i = 0, ilen = list.length; i < ilen; i++) {\n                el = list[i];\n\n                val = el.getAttribute(\"translate\") || el.getAttribute(\"translatable\") || \"yes\";\n                if (val == \"no\")\n                    continue;\n\n                /* Each thing to translate */\n                tasks = val.split(\" \");\n                val = el.getAttribute(\"translate-context\") || el.getAttribute(\"context\");\n                for (t = 0, tlen = tasks.length; t < tlen; t++) {\n                    if (tasks[t] == \"yes\" || tasks[t] == \"translate\")\n                        el.textContent = cockpit.gettext(val, el.textContent);\n                    else if (tasks[t])\n                        el.setAttribute(tasks[t], cockpit.gettext(val, el.getAttribute(tasks[t]) || \"\"));\n                }\n\n                /* Mark this thing as translated */\n                el.removeAttribute(\"translatable\");\n                el.removeAttribute(\"translate\");\n            }\n        }\n    };\n\n    cockpit.gettext = function gettext(context, string) {\n        /* Missing first parameter */\n        if (arguments.length == 1) {\n            string = context;\n            context = undefined;\n        }\n\n        var key = context ? context + '\\u0004' + string : string;\n        if (po_data) {\n            var translated = po_data[key];\n            if (translated && translated[1])\n                return translated[1];\n        }\n        return string;\n    };\n\n    function imply(val) {\n        return (val === true ? 1 : val || 0);\n    }\n\n    cockpit.ngettext = function ngettext(context, string1, stringN, num) {\n        /* Missing first parameter */\n        if (arguments.length == 3) {\n            num = stringN;\n            stringN = string1;\n            string1 = context;\n            context = undefined;\n        }\n\n        var key = context ? context + '\\u0004' + string1 : string1;\n        if (po_data && po_plural) {\n            var translated = po_data[key];\n            if (translated) {\n                var i = imply(po_plural(num)) + 1;\n                if (translated[i])\n                    return translated[i];\n            }\n        }\n        if (num == 1)\n            return string1;\n        return stringN;\n    };\n\n    cockpit.noop = function noop(arg0, arg1) {\n        return arguments[arguments.length - 1];\n    };\n\n    /* Only for _() calls here in the cockpit code */\n    var _ = cockpit.gettext;\n\n    cockpit.message = function message(arg) {\n        if (arg.message)\n            return arg.message;\n\n        var problem = null;\n        if (arg.problem)\n            problem = arg.problem;\n        else\n            problem = arg + \"\";\n        if (problem == \"terminated\")\n            return _(\"Your session has been terminated.\");\n        else if (problem == \"no-session\")\n            return _(\"Your session has expired. Please log in again.\");\n        else if (problem == \"access-denied\")\n            return _(\"Not permitted to perform this action.\");\n        else if (problem == \"authentication-failed\")\n            return _(\"Login failed\");\n        else if (problem == \"authentication-not-supported\")\n            return _(\"The server refused to authenticate using any supported methods.\");\n        else if (problem == \"unknown-hostkey\")\n            return _(\"Untrusted host\");\n        else if (problem == \"unknown-host\")\n            return _(\"Untrusted host\");\n        else if (problem == \"invalid-hostkey\")\n            return _(\"Host key is incorrect\");\n        else if (problem == \"internal-error\")\n            return _(\"Internal error\");\n        else if (problem == \"timeout\")\n            return _(\"Connection has timed out.\");\n        else if (problem == \"no-cockpit\")\n            return _(\"Cockpit is not installed on the system.\");\n        else if (problem == \"no-forwarding\")\n            return _(\"Cannot forward login credentials\");\n        else if (problem == \"disconnected\")\n            return _(\"Server has closed the connection.\");\n        else if (problem == \"not-supported\")\n            return _(\"Cockpit is not compatible with the software on the system.\");\n        else if (problem == \"no-host\")\n            return _(\"Cockpit could not contact the given host.\");\n        else if (problem == \"too-large\")\n            return _(\"Too much data\");\n        else\n            return problem;\n    };\n\n    function HttpError(arg0, arg1, message) {\n        this.status = parseInt(arg0, 10);\n        this.reason = arg1;\n        this.message = message || arg1;\n        this.problem = null;\n\n        this.valueOf = function() {\n            return this.status;\n        };\n        this.toString = function() {\n            return this.status + \" \" + this.message;\n        };\n    }\n\n    function http_debug() {\n        if (window.debugging == \"all\" || window.debugging == \"http\")\n            console.debug.apply(console, arguments);\n    }\n\n    function find_header(headers, name) {\n        if (!headers)\n            return undefined;\n        name = name.toLowerCase();\n        for (var head in headers) {\n            if (head.toLowerCase() == name)\n                return headers[head];\n        }\n        return undefined;\n    }\n\n    function HttpClient(endpoint, options) {\n        var self = this;\n\n        self.options = options;\n        options.payload = \"http-stream2\";\n\n        var active_requests = [ ];\n\n        if (endpoint !== undefined) {\n            if (endpoint.indexOf && endpoint.indexOf(\"/\") === 0) {\n                options.unix = endpoint;\n            } else {\n                var port = parseInt(endpoint, 10);\n                if (!isNaN(port))\n                    options.port = port;\n                else\n                    throw Error(\"The endpoint must be either a unix path or port number\");\n            }\n        }\n\n        if (options.address) {\n            if (!options.capabilities)\n                options.capabilities = [];\n            options.capabilities.push(\"address\");\n        }\n\n        function param(obj) {\n            return Object.keys(obj).map(function(k) {\n                return encodeURIComponent(k) + '=' + encodeURIComponent(obj[k]);\n            })\n.join('&')\n.split('%20')\n.join('+'); /* split/join because phantomjs */\n        }\n\n        self.request = function request(req) {\n            var dfd = cockpit.defer();\n            var ret = dfd.promise;\n\n            if (!req.path)\n                req.path = \"/\";\n            if (!req.method)\n                req.method = \"GET\";\n            if (req.params) {\n                if (req.path.indexOf(\"?\") === -1)\n                    req.path += \"?\" + param(req.params);\n                else\n                    req.path += \"&\" + param(req.params);\n            }\n            delete req.params;\n\n            var input = req.body;\n            delete req.body;\n\n            var headers = req.headers;\n            delete req.headers;\n\n            extend(req, options);\n\n            /* Combine the headers */\n            if (options.headers && headers)\n                req.headers = extend({ }, options.headers, headers);\n            else if (options.headers)\n                req.headers = options.headers;\n            else\n                req.headers = headers;\n\n            http_debug(\"http request:\", JSON.stringify(req));\n\n            /* We need a channel for the request */\n            var channel = cockpit.channel(req);\n\n            if (input !== undefined) {\n                if (input !== \"\") {\n                    http_debug(\"http input:\", input);\n                    channel.send(input);\n                }\n                http_debug(\"http done\");\n                channel.control({ command: \"done\" });\n            }\n\n            /* Callbacks that want to stream or get headers */\n            var streamer = null;\n            var responsers = null;\n\n            var resp = null;\n\n            var buffer = channel.buffer(function(data) {\n                /* Fire any streamers */\n                if (resp && resp.status >= 200 && resp.status <= 299 && streamer)\n                    return streamer.call(ret, data);\n                return 0;\n            });\n\n            function on_control(event, options) {\n                /* Anyone looking for response details? */\n                if (options.command == \"response\") {\n                    resp = options;\n                    if (responsers) {\n                        resp.headers = resp.headers || { };\n                        invoke_functions(responsers, ret, [resp.status, resp.headers]);\n                    }\n                }\n            }\n\n            function on_close(event, options) {\n                var pos = active_requests.indexOf(ret);\n                if (pos >= 0)\n                    active_requests.splice(pos, 1);\n\n                if (options.problem) {\n                    http_debug(\"http problem: \", options.problem);\n                    dfd.reject(new BasicError(options.problem));\n                } else {\n                    var body = buffer.squash();\n\n                    /* An error, fail here */\n                    if (resp && (resp.status < 200 || resp.status > 299)) {\n                        var message;\n                        var type = find_header(resp.headers, \"Content-Type\");\n                        if (type && !channel.binary) {\n                            if (type.indexOf(\"text/plain\") === 0)\n                                message = body;\n                        }\n                        http_debug(\"http status: \", resp.status);\n                        dfd.reject(new HttpError(resp.status, resp.reason, message), body);\n                    } else {\n                        http_debug(\"http done\");\n                        dfd.resolve(body);\n                    }\n                }\n\n                channel.removeEventListener(\"control\", on_control);\n                channel.removeEventListener(\"close\", on_close);\n            }\n\n            channel.addEventListener(\"control\", on_control);\n            channel.addEventListener(\"close\", on_close);\n\n            ret.stream = function(callback) {\n                streamer = callback;\n                return ret;\n            };\n            ret.response = function(callback) {\n                if (responsers === null)\n                    responsers = [];\n                responsers.push(callback);\n                return ret;\n            };\n            ret.input = function(message, stream) {\n                if (message !== null && message !== undefined) {\n                    http_debug(\"http input:\", message);\n                    channel.send(message);\n                }\n                if (!stream) {\n                    http_debug(\"http done\");\n                    channel.control({ command: \"done\" });\n                }\n                return ret;\n            };\n            ret.close = function(problem) {\n                http_debug(\"http closing:\", problem);\n                channel.close(problem);\n                return ret;\n            };\n\n            active_requests.push(ret);\n            return ret;\n        };\n\n        self.get = function get(path, params, headers) {\n            return self.request({\n                \"method\": \"GET\",\n                \"params\": params,\n                \"path\": path,\n                \"body\": \"\",\n                \"headers\": headers\n            });\n        };\n\n        self.post = function post(path, body, headers) {\n            headers = headers || { };\n\n            if (is_plain_object(body) || is_array(body)) {\n                body = JSON.stringify(body);\n                if (find_header(headers, \"Content-Type\") === undefined)\n                    headers[\"Content-Type\"] = \"application/json\";\n            } else if (body === undefined || body === null) {\n                body = \"\";\n            } else if (typeof body !== \"string\") {\n                body = String(body);\n            }\n\n            return self.request({\n                \"method\": \"POST\",\n                \"path\": path,\n                \"body\": body,\n                \"headers\": headers\n            });\n        };\n\n        self.close = function close(problem) {\n            var reqs = active_requests.slice();\n            for (var i = 0; i < reqs.length; i++)\n                reqs[i].close(problem);\n        };\n    }\n\n    /* public */\n    cockpit.http = function(endpoint, options) {\n        if (is_plain_object(endpoint) && options === undefined) {\n            options = endpoint;\n            endpoint = undefined;\n        }\n        return new HttpClient(endpoint, options || { });\n    };\n\n    /* ---------------------------------------------------------------------\n     * Permission\n     */\n\n    function check_superuser() {\n        var dfd = cockpit.defer();\n        var ch = cockpit.channel({ payload: \"null\", superuser: \"require\" });\n        ch.wait()\n            .then(function () { dfd.resolve(true) })\n            .fail(function () { dfd.resolve(false) })\n            .always(function () { ch.close() });\n\n        return dfd.promise();\n    }\n\n    function Permission(options) {\n        var self = this;\n        event_mixin(self, { });\n\n        self.allowed = null;\n        self.user = options ? options.user : null; // pre-fill for unit tests\n        self.is_superuser = options ? options._is_superuser : null; // pre-fill for unit tests\n\n        var group = null;\n        var admin = false;\n\n        if (options)\n            group = options.group;\n\n        if (options && options.admin)\n            admin = true;\n\n        function decide(user) {\n            if (user.id === 0)\n                return true;\n\n            if (group)\n                return !!(user.groups || []).includes(group);\n\n            if (admin)\n                return self.is_superuser;\n\n            if (user.id === undefined)\n                return null;\n\n            return false;\n        }\n\n        if (self.user && self.is_superuser !== null) {\n            self.allowed = decide(self.user);\n        } else {\n            // eslint-disable-next-line cockpit/no-cockpit-all\n            cockpit.all(cockpit.user(), check_superuser())\n                .done(function (user, is_superuser) {\n                    self.user = user;\n                    self.is_superuser = is_superuser;\n                    var allowed = decide(user);\n                    if (self.allowed !== allowed) {\n                        self.allowed = allowed;\n                        self.dispatchEvent(\"changed\");\n                    }\n                });\n        }\n\n        self.close = function close() {\n            /* no-op for now */\n        };\n    }\n\n    cockpit.permission = function permission(arg) {\n        return new Permission(arg);\n    };\n\n    /* ---------------------------------------------------------------------\n     * Metrics\n     *\n     */\n\n    function MetricsChannel(interval, options_list, cache) {\n        var self = this;\n        event_mixin(self, { });\n\n        if (options_list.length === undefined)\n            options_list = [ options_list ];\n\n        var channels = [ ];\n        var following = false;\n\n        self.series = cockpit.series(interval, cache, fetch_for_series);\n        self.archives = null;\n        self.meta = null;\n\n        function fetch_for_series(beg, end, for_walking) {\n            if (!for_walking)\n                self.fetch(beg, end);\n            else\n                self.follow();\n        }\n\n        function transfer(options_list, callback, is_archive) {\n            if (options_list.length === 0)\n                return;\n\n            if (!is_archive) {\n                if (following)\n                    return;\n                following = true;\n            }\n\n            var options = extend({\n                payload: \"metrics1\",\n                interval: interval,\n                source: \"internal\"\n            }, options_list[0]);\n\n            delete options.archive_source;\n\n            var channel = cockpit.channel(options);\n            channels.push(channel);\n\n            var meta = null;\n            var last = null;\n            var beg;\n\n            channel.addEventListener(\"close\", function(ev, close_options) {\n                if (!is_archive)\n                    following = false;\n\n                if (options_list.length > 1 &&\n                    (close_options.problem == \"not-supported\" || close_options.problem == \"not-found\")) {\n                    transfer(options_list.slice(1), callback);\n                } else if (close_options.problem) {\n                    if (close_options.problem != \"terminated\" &&\n                        close_options.problem != \"disconnected\" &&\n                        close_options.problem != \"authentication-failed\" &&\n                        (close_options.problem != \"not-found\" || !is_archive) &&\n                        (close_options.problem != \"not-supported\" || !is_archive)) {\n                        console.warn(\"metrics channel failed: \" + close_options.problem);\n                    }\n                } else if (is_archive) {\n                    if (!self.archives) {\n                        self.archives = true;\n                        self.dispatchEvent('changed');\n                    }\n                }\n            });\n\n            channel.addEventListener(\"message\", function(ev, payload) {\n                var message = JSON.parse(payload);\n\n                var data, last_len, dataj, dataj_len, lastj, lastj_len;\n                var i, j, k;\n                var timestamp;\n\n                /* A meta message? */\n                var message_len = message.length;\n                if (message_len === undefined) {\n                    meta = message;\n                    timestamp = 0;\n                    if (meta.now && meta.timestamp)\n                        timestamp = meta.timestamp + (Date.now() - meta.now);\n                    beg = Math.floor(timestamp / interval);\n                    callback(beg, meta, null, options_list[0]);\n\n                    /* Trigger to outside interest that meta changed */\n                    self.meta = meta;\n                    self.dispatchEvent('changed');\n\n                /* A data message */\n                } else if (meta) {\n                    /* Data decompression */\n                    for (i = 0; i < message_len; i++) {\n                        data = message[i];\n                        if (last) {\n                            last_len = last.length;\n                            for (j = 0; j < last_len; j++) {\n                                dataj = data[j];\n                                if (dataj === null || dataj === undefined) {\n                                    data[j] = last[j];\n                                } else {\n                                    dataj_len = dataj.length;\n                                    if (dataj_len !== undefined) {\n                                        lastj = last[j];\n                                        lastj_len = last[j].length;\n                                        for (k = 0; k < dataj_len; k++) {\n                                            if (dataj[k] === null)\n                                                dataj[k] = lastj[k];\n                                        }\n                                        for (; k < lastj_len; k++)\n                                            dataj[k] = lastj[k];\n                                    }\n                                }\n                            }\n                        }\n                        last = data;\n                    }\n\n                    /* Return the data */\n                    callback(beg, meta, message, options_list[0]);\n\n                    /* Bump timestamp for the next message */\n                    beg += message_len;\n                    meta.timestamp += (interval * message_len);\n                }\n            });\n        }\n\n        function drain(beg, meta, message, options) {\n            var mapping, map, name;\n\n            /* Generate a mapping object if necessary */\n            mapping = meta.mapping;\n            if (!mapping) {\n                mapping = { };\n                meta.metrics.forEach(function(metric, i) {\n                    map = { \"\": i };\n                    if (options.metrics_path_names)\n                        name = options.metrics_path_names[i];\n                    else\n                        name = metric.name;\n                    mapping[name] = map;\n                    if (metric.instances) {\n                        metric.instances.forEach(function(instance, i) {\n                            if (instance === \"\")\n                                instance = \"/\";\n                            map[instance] = { \"\": i };\n                        });\n                    }\n                });\n                meta.mapping = mapping;\n            }\n\n            if (message)\n                self.series.input(beg, message, mapping);\n        }\n\n        self.fetch = function fetch(beg, end) {\n            var timestamp = beg * interval - Date.now();\n            var limit = end - beg;\n\n            var archive_options_list = [ ];\n            for (var i = 0; i < options_list.length; i++) {\n                if (options_list[i].archive_source) {\n                    archive_options_list.push(extend({}, options_list[i],\n                                                       { \"source\": options_list[i].archive_source,\n                                                         timestamp: timestamp,\n                                                         limit: limit\n                                                       }));\n                }\n            }\n\n            transfer(archive_options_list, drain, true);\n        };\n\n        self.follow = function follow() {\n            transfer(options_list, drain);\n        };\n\n        self.close = function close(options) {\n            var i;\n            var len = channels.length;\n            if (self.series)\n                self.series.close();\n\n            for (i = 0; i < len; i++)\n                channels[i].close(options);\n        };\n    }\n\n    cockpit.metrics = function metrics(interval, options) {\n        return new MetricsChannel(interval, options);\n    };\n\n    /* ---------------------------------------------------------------------\n     * Ooops handling.\n     *\n     * If we're embedded, send oops to parent frame. Since everything\n     * could be broken at this point, just do it manually, without\n     * involving cockpit.transport or any of that logic.\n     */\n\n    cockpit.oops = function oops() {\n        if (window.parent !== window && window.name.indexOf(\"cockpit1:\") === 0)\n            window.parent.postMessage(\"\\n{ \\\"command\\\": \\\"oops\\\" }\", transport_origin);\n    };\n\n    var old_onerror = window.onerror;\n    window.onerror = function(msg, url, line) {\n        cockpit.oops();\n        if (old_onerror)\n            return old_onerror(msg, url, line);\n        return false;\n    };\n\n    return cockpit;\n} /* scope end */\n\n/*\n * Register this script as a module and/or with globals\n */\n\nvar self_module_id;\n\n/* Check how we're being loaded */\nvar last = document.scripts[document.scripts.length - 1].src || \"\";\nvar pos = last.indexOf(\"/cockpit.js\");\nif (pos === -1)\n    pos = last.indexOf(\"/cockpit.min.js\");\nif (pos !== -1)\n    pos = last.substring(0, pos).lastIndexOf(\"/\");\n\n/* cockpit.js is being loaded as a <script>  and no other loader around? */\nif (pos !== -1) {\n    self_module_id = last.substring(pos + 1, last.indexOf(\".\", pos + 1));\n    window.cockpit = factory();\n}\n\n/* Cockpit loaded via AMD loader */\nif (is_function(window.define) && window.define.amd) {\n    if (self_module_id)\n        define(self_module_id, [], window.cockpit); // eslint-disable-line no-undef\n    else\n        define([], factory); // eslint-disable-line no-undef\n}\n})();\n"]}