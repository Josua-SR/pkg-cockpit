{"version":3,"sources":["dist/base1/cockpit.js"],"names":["url_root","window","localStorage","getItem","e","mock","phantom_checkpoint","debugging","sessionStorage","in_array","array","val","length","i","is_array","it","Object","prototype","toString","call","is_function","x","is_object","is_plain_object","is_negative","n","extend","to","j","len","key","from","arguments","undefined","invoke_functions","functions","self","args","apply","default_transport","public_transport","reload_after_disconnect","expect_disconnect","init_callback","default_host","process_hints","filters","have_array_buffer","ArrayBuffer","transport_origin","location","origin","protocol","hostname","port","array_from_raw_string","str","constructor","data","Array","charCodeAt","array_to_raw_string","String","fromCharCode","uint6_to_b64","base64_encode","btoa","Uint8Array","mod3","uint24","substr","b64_to_uint6","base64_decode","atob","ilen","eq","olen","mod4","oi","ii","addEventListener","transport_debug","console","debug","event_mixin","obj","handlers","defineProperties","enumerable","value","type","handler","push","removeEventListener","dispatchEvent","event","slice","document","createEvent","initCustomEvent","unshift","calculate_application","path","pathname","_url_root","indexOf","replace","split","calculate_url","suffix","window_loc","url","prefix","host","join_data","buffers","binary","join","k","total","set","ParentWebSocket","parent","this","readyState","receive","source","onclose","onmessage","send","message","postMessage","close","setTimeout","onopen","Transport","application","last_channel","channel_seed","last_transport","ws","check_health_timer","got_message","name","options","ex","ws_loc","WebSocket","MozWebSocket","error","setInterval","log","problem","control_cbs","message_cbs","waiting_for_init","binary_type_available","ready","ready_for_channels","binaryType","reload","channel","pos","warn","subarray","substring","payload","control","buffer","JSON","parse","process_control","process_message","command","clearInterval","ows","chan","next_channel","process_init","version","csrf_token","func","send_data","send_message","byteLength","output","send_control","stringify","register","control_cb","message_cb","unregister","ensure_transport","callback","transport","Channel","valid","received_done","sent_done","id","base64","queue","on_message","on_close","on_control","done","send_payload","trans","item","shift","squash","consumed","block","resolve_path_dots","parts","out","part","pop","basic_scope","cockpit","jquery","event_target","manifests","Utf8TextEncoder","encoding","encode","string","unescape","encodeURIComponent","Utf8TextDecoder","fatal","decode","stream","beg","p","ok","decodeURIComponent","escape","utf8_encoder","utf8_decoder","kill","group","hint","wait","inject","filter","uri","later_queue","later_timeout","later_drain","later_invoke","promise_then","state","fulfilled","rejected","updated","result","Deferred","pending","status","schedule_process_queue","promise","create_promise","Promise","target","then","catch_","finally_","handle_callback","fail","always","progress","state_","process_queue","fn","deferred","process_scheduled","pur","resolve","values","reject","deferred_resolve","deferred_reject","deferred_notify","callbacks","notify","Error","prep_promise","resolved","defer","is_resolved","callback_output","when","all","promises","counter","results","forEach","fmt_re","format","fmt","m","y","format_number","number","toFixed","format_units","suffixes","factor","separate","quotient","keys","divisor","sort","reverse","Math","pow","string_representation","ret","byte_suffixes","1000","1024","format_bytes","get_byte_units","guide_value","unit","index","units","selected","byte_sec_suffixes","format_bytes_per_sec","bit_suffixes","format_bits_per_sec","StorageHelper","storage","prefixedKey","both","setItem","removeItem","clear","full","lookup_storage","win","StorageCache","org_key","provider","consumer","trigger","last","claimed","floor","random","ev","initStorageEvent","claim","unclaim","current_value","parseInt","changed","newValue","oldValue","new_value","cache","SeriesSink","interval","identifier","fetch_callback","limit","setup_index","count","head","tail","search","idx","low","high","mid","fetch","end","for_walking","stash","load","at","entry","b","eb","en","fetches","items","max","min","process","mapping","remove","num","splice","next","registered","_register","grid","gdata","links","jlen","klen","row","map","f","t","input","series","unique","SeriesGrid","rows","sinks","suppress","walking","offset","add","sink","cb","sync","move_internal","stop_walking","move","now","Date","walk","start","BasicError","logout","disconnect","drop_privileges","info","system","the_user","user","dfd","dbus","bus","reply","Id","v","Name","full_name","Full","groups","Groups","home","Home","shell","Shell","classList","stopPropagation","last_loc","get_window_location_hash","href","Location","decode_path","pre_parts","concat","with_root","opt","query","push_option","first","hasOwnProperty","href_for_go_or_replace","go","hash","writable","defineProperty","get","jump","hiddenProp","hiddenHint","visibility_change","hidden","mozHidden","msHidden","webkitHidden","ProcessError","exit_status","exit_signal","_","trim","spawn_debug","spawn","script","dbus_debug","DBusError","arg","DBusCache","meta","connect","iface","emit","props","copy","update","lookup","each","ifa","DBusProxy","client","defined","waits","$","expando","define","methods","toLowerCase","properties","config","prop","flags","variant","signal","subscribe","interface","waited","watch","DBusProxies","path_namespace","match","proxy","DBusClient","track","owner","subscribers","calls","closed","constructors","*","ensure_cache","matches","member","arg0","msg","subscription","close_perform","outstanding","last_cookie","method","method_call","rule","add-match","prev","remove-match","unwatch","Constructor","proxies","byte_array","file","read","modify","base_channel_options","syntax","read_promise","read_channel","opts","try_read","content_parts","fire_watch_callbacks","content","tag","replace_channel","new_content","expected_tag","file_content","batch","initial_content","initial_tag","new_tag","read_then_update","watch_callbacks","n_watch_callbacks","watch_channel","watch_tag","ensure_watch_channel","message_string","po_data","po_plural","language","locale","po","lang","header","translate","what","w","wlen","tlen","list","tasks","el","querySelectorAll","getAttribute","textContent","gettext","setAttribute","removeAttribute","context","translated","imply","ngettext","string1","stringN","noop","arg1","HttpError","reason","valueOf","http_debug","find_header","headers","HttpClient","endpoint","active_requests","unix","isNaN","address","capabilities","param","request","req","params","body","streamer","responsers","resp","response","post","reqs","http","authority","Permission","allowed","admin","decide","permission","timestamp","getTime","MetricsChannel","options_list","channels","following","fetch_for_series","archives","follow","transfer","is_archive","archive_source","close_options","data_len","last_len","dataj","dataj_len","lastj","lastj_len","message_len","drain","metrics","metric","","metrics_path_names","instances","instance","archive_options_list","oops","old_onerror","navigator","userAgent","onerror","line","basics","factory","self_module_id","scripts","src","lastIndexOf","amd"],"mappings":"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","sourcesContent":["/*\n * This file is part of Cockpit.\n *\n * Copyright (C) 2014 Red Hat, Inc.\n *\n * Cockpit is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation; either version 2.1 of the License, or\n * (at your option) any later version.\n *\n * Cockpit is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with Cockpit; If not, see <http://www.gnu.org/licenses/>.\n */\n\nvar url_root;\n\ntry {\n    // Sometimes this throws a SecurityError such as during testing\n    url_root = window.localStorage.getItem('url-root');\n} catch(e) { }\n\nvar mock = mock || { };\n\nvar phantom_checkpoint = phantom_checkpoint || function () { };\n\n(function() {\n\"use strict\";\n\nif (typeof window.debugging === \"undefined\") {\n    try {\n        // Sometimes this throws a SecurityError such as during testing\n        window.debugging = window.sessionStorage[\"debugging\"] ||\n                           window.localStorage[\"debugging\"];\n    } catch(e) { }\n}\n\nfunction in_array(array, val) {\n    var length = array.length;\n    for (var i = 0; i < length; i++) {\n        if (val === array[i])\n            return true;\n    }\n    return false;\n}\n\n/* HACK: http://web.mit.edu/jwalden/www/isArray.html */\nfunction is_array(it) {\n    return Object.prototype.toString.call(it) === '[object Array]';\n}\n\nfunction is_function(x) {\n    return typeof x === 'function';\n}\n\nfunction is_object(x) {\n    return x !== null && typeof x === 'object';\n}\n\nfunction is_plain_object(x) {\n    return is_object(x) && Object.prototype.toString.call(x) === '[object Object]';\n}\n\n/* Also works for negative zero */\nfunction is_negative(n) {\n    return ((n = +n) || 1 / n) < 0;\n}\n\n/* Object.assign() workalike */\nfunction extend(to/* , from ... */) {\n    var j, len, key, from;\n    for (j = 1, len = arguments.length; j < len; j++) {\n        from = arguments[j];\n        if (from) {\n            for (key in from) {\n                if (from[key] !== undefined)\n                    to[key] = from[key];\n            }\n        }\n    }\n    return to;\n}\n\nfunction invoke_functions(functions, self, args) {\n    var length = functions ? functions.length : 0;\n    for (var i = 0; i < length; i++) {\n        if (functions[i])\n            functions[i].apply(self, args);\n    }\n}\n\n/* -------------------------------------------------------------------------\n * Channels\n *\n * Public: https://files.cockpit-project.org/guide/api-cockpit.html\n */\n\nvar default_transport = null;\nvar public_transport = null;\nvar reload_after_disconnect = false;\nvar expect_disconnect = false;\nvar init_callback = null;\nvar default_host = null;\nvar process_hints = null;\nvar filters = [ ];\n\nvar have_array_buffer = !!window.ArrayBuffer;\n\nvar transport_origin = window.location.origin;\n\nif (!transport_origin) {\n    transport_origin = window.location.protocol + \"//\" + window.location.hostname +\n        (window.location.port ? ':' + window.location.port: '');\n}\n\nfunction array_from_raw_string(str, constructor) {\n    var length = str.length;\n    /* jshint -W056 */\n    var data = new (constructor || Array)(length);\n    for (var i = 0; i < length; i++)\n        data[i] = str.charCodeAt(i) & 0xFF;\n    return data;\n}\n\nfunction array_to_raw_string(data) {\n    var length = data.length, str = \"\";\n    for (var i = 0; i < length; i++)\n        str += String.fromCharCode(data[i]);\n    return str;\n}\n\n/*\n * These are the polyfills from Mozilla. It's pretty nasty that\n * these weren't in the typed array standardization.\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\n */\n\nfunction uint6_to_b64 (x) {\n    return x < 26 ? x + 65 : x < 52 ? x + 71 : x < 62 ? x - 4 : x === 62 ? 43 : x === 63 ? 47 : 65;\n}\n\nfunction base64_encode(data) {\n    if (typeof data === \"string\")\n        return window.btoa(data);\n    /* For when the caller has chosen to use ArrayBuffer */\n    if (have_array_buffer && data instanceof window.ArrayBuffer)\n        data = new window.Uint8Array(data);\n    var length = data.length, mod3 = 2, str = \"\";\n    for (var uint24 = 0, i = 0; i < length; i++) {\n        mod3 = i % 3;\n        uint24 |= data[i] << (16 >>> mod3 & 24);\n        if (mod3 === 2 || length - i === 1) {\n            str += String.fromCharCode(uint6_to_b64(uint24 >>> 18 & 63),\n                                       uint6_to_b64(uint24 >>> 12 & 63),\n                                       uint6_to_b64(uint24 >>> 6 & 63),\n                                       uint6_to_b64(uint24 & 63));\n            uint24 = 0;\n        }\n    }\n\n    return str.substr(0, str.length - 2 + mod3) + (mod3 === 2 ? '' : mod3 === 1 ? '=' : '==');\n}\n\nfunction b64_to_uint6 (x) {\n    return x > 64 && x < 91 ? x - 65 : x > 96 && x < 123 ?\n        x - 71 : x > 47 && x < 58 ? x + 4 : x === 43 ? 62 : x === 47 ? 63 : 0;\n}\n\nfunction base64_decode(str, constructor) {\n    if (constructor === String)\n        return window.atob(str);\n    var ilen = str.length;\n    for (var eq = 0; eq < 3; eq++) {\n        if (str[ilen - (eq + 1)] != '=')\n            break;\n    }\n    var olen = (ilen * 3 + 1 >> 2) - eq;\n    /* jshint -W056 */\n    var data = new (constructor || Array)(olen);\n    for (var mod3, mod4, uint24 = 0, oi = 0, ii = 0; ii < ilen; ii++) {\n        mod4 = ii & 3;\n        uint24 |= b64_to_uint6(str.charCodeAt(ii)) << 18 - 6 * mod4;\n        if (mod4 === 3 || ilen - ii === 1) {\n            for (mod3 = 0; mod3 < 3 && oi < olen; mod3++, oi++)\n                data[oi] = uint24 >>> (16 >>> mod3 & 24) & 255;\n            uint24 = 0;\n        }\n    }\n    return data;\n}\n\nwindow.addEventListener('beforeunload', function() {\n    expect_disconnect = true;\n}, false);\n\nfunction transport_debug() {\n    if (window.debugging == \"all\" || window.debugging == \"channel\")\n        console.debug.apply(console, arguments);\n}\n\n/*\n * Extends an object to have the standard DOM style addEventListener\n * removeEventListener and dispatchEvent methods. The dispatchEvent\n * method has the additional capability to create a new event from a type\n * string and arguments.\n */\nfunction event_mixin(obj, handlers) {\n    Object.defineProperties(obj, {\n        addEventListener: {\n            enumerable: false,\n            value: function addEventListener(type, handler) {\n                if (handlers[type] === undefined)\n                    handlers[type] = [ ];\n                handlers[type].push(handler);\n            }\n        },\n        removeEventListener: {\n            enumerable: false,\n            value: function removeEventListener(type, handler) {\n                var length = handlers[type] ? handlers[type].length : 0;\n                for (var i = 0; i < length; i++) {\n                    if (handlers[type][i] === handler) {\n                        handlers[type][i] = null;\n                        break;\n                    }\n                }\n            }\n        },\n        dispatchEvent: {\n            enumerable: false,\n            value: function dispatchEvent(event) {\n                var type, args;\n                if (typeof event === \"string\") {\n                    type = event;\n                    args = Array.prototype.slice.call(arguments, 1);\n                    event = document.createEvent(\"CustomEvent\");\n                    if (arguments.length == 2)\n                        event.initCustomEvent(type, false, false, arguments[1]);\n                    else if (arguments.length > 2)\n                        event.initCustomEvent(type, false, false, args);\n                    else\n                        event.initCustomEvent(type, false, false, null);\n                    args.unshift(event);\n                } else {\n                    type = event.type;\n                    args = arguments;\n                }\n                if (is_function(obj['on' + type]))\n                    obj['on' + type].apply(obj, args);\n                invoke_functions(handlers[type], obj, args);\n            }\n        }\n    });\n}\n\nfunction calculate_application() {\n    var path = window.location.pathname || \"/\";\n    var _url_root = url_root;\n    if (window.mock && window.mock.pathname)\n        path = window.mock.pathname;\n    if (window.mock && window.mock.url_root)\n        _url_root = window.mock.url_root;\n\n    if (_url_root && path.indexOf('/' + _url_root) === 0)\n        path = path.replace('/' + _url_root, '') || '/';\n\n    if (path.indexOf(\"/cockpit/\") !== 0 && path.indexOf(\"/cockpit+\") !== 0) {\n        if (path.indexOf(\"/=\") === 0)\n            path = \"/cockpit+\" + path.split(\"/\")[1];\n        else\n            path = \"/cockpit\";\n    }\n\n    return path.split(\"/\")[1];\n}\n\nfunction calculate_url(suffix) {\n    if (!suffix)\n        suffix = \"socket\";\n    var window_loc = window.location.toString();\n    var _url_root = url_root;\n\n    if (window.mock && window.mock.url)\n        return window.mock.url;\n    if (window.mock && window.mock.url_root)\n        _url_root = window.mock.url_root;\n\n    var prefix = calculate_application();\n    if (_url_root)\n        prefix = _url_root + \"/\" + prefix;\n\n    if (window_loc.indexOf('http:') === 0) {\n        return \"ws://\" + window.location.host + \"/\" + prefix + \"/\" + suffix;\n    } else if (window_loc.indexOf('https:') === 0) {\n        return \"wss://\" + window.location.host + \"/\" + prefix + \"/\" + suffix;\n    } else {\n        transport_debug(\"Cockpit must be used over http or https\");\n        return null;\n    }\n}\n\nfunction join_data(buffers, binary) {\n    if (!binary)\n        return buffers.join(\"\");\n\n    var data;\n    var j, k, total = 0;\n    var i, length = buffers.length;\n    for (i = 0; i < length; i++)\n        total += buffers[i].length;\n\n    if (window.Uint8Array)\n        data = new window.Uint8Array(total);\n    else\n        data = new Array(total);\n\n    if (data.set) {\n        for (j = 0, i = 0; i < length; i++) {\n            data.set(buffers[i], j);\n            j += buffers[i].length;\n        }\n    } else {\n        for (j = 0, i = 0; i < length; i++) {\n            for (k = 0; k < buffers[i].length; k++)\n                data[i + j] = buffers[i][k];\n            j += buffers[i].length;\n        }\n    }\n\n    return data;\n}\n\n/*\n * A WebSocket that connects to parent frame. The mechanism\n * for doing this will eventually be documented publicly,\n * but for now:\n *\n *  * Forward raw cockpit1 string protocol messages via window.postMessage\n *  * Listen for cockpit1 string protocol messages via window.onmessage\n *  * Never accept or send messages to another origin\n *  * An empty string message means \"close\" (not completely used yet)\n */\nfunction ParentWebSocket(parent) {\n    var self = this;\n    self.readyState = 0;\n\n    window.addEventListener(\"message\", function receive(event) {\n        if (event.origin !== transport_origin || event.source !== parent)\n            return;\n        var data = event.data;\n        if (data === undefined || data.length === undefined)\n            return;\n        if (data.length === 0) {\n            self.readyState = 3;\n            self.onclose();\n        } else {\n            self.onmessage(event);\n        }\n    }, false);\n\n    self.send = function send(message) {\n        parent.postMessage(message, transport_origin);\n    };\n\n    self.close = function close() {\n        self.readyState = 3;\n        parent.postMessage(\"\", transport_origin);\n        self.onclose();\n    };\n\n    window.setTimeout(function() {\n        self.readyState = 1;\n        self.onopen();\n    }, 0);\n}\n\n/* Private Transport class */\nfunction Transport() {\n    var self = this;\n    self.application = calculate_application();\n\n    /* We can trigger events */\n    event_mixin(self, { });\n\n    var last_channel = 0;\n    var channel_seed = \"\";\n\n    if (window.mock)\n        window.mock.last_transport = self;\n\n    var ws;\n    var check_health_timer;\n    var got_message = false;\n\n    /* See if we should communicate via parent */\n    if (window.parent !== window && window.name.indexOf(\"cockpit1:\") === 0)\n        ws = new ParentWebSocket(window.parent);\n\n    /* HACK: Compatibility if we're hosted by older Cockpit versions */\n    try {\n           /* See if we should communicate via parent */\n           if (!ws && window.parent !== window && window.parent.options &&\n                window.parent.options.protocol == \"cockpit1\") {\n               ws = new ParentWebSocket(window.parent);\n            }\n    } catch (ex) {\n       /* permission access errors */\n    }\n\n    if (!ws) {\n        var ws_loc = calculate_url();\n        transport_debug(\"connecting to \" + ws_loc);\n\n        if (ws_loc) {\n            if (\"WebSocket\" in window) {\n                ws = new window.WebSocket(ws_loc, \"cockpit1\");\n            } else if (\"MozWebSocket\" in window) { // Firefox 6\n                ws = new window.MozWebSocket(ws_loc);\n            } else {\n                console.error(\"WebSocket not supported, application will not work!\");\n            }\n        }\n\n        check_health_timer = window.setInterval(function () {\n            if (!got_message) {\n                console.log(\"health check failed\");\n                self.close({ \"problem\": \"timeout\" });\n            }\n            got_message = false;\n        }, 30000);\n    }\n\n    if (!ws) {\n        ws = { close: function() { } };\n        window.setTimeout(function() {\n            self.close({\"problem\": \"no-cockpit\"});\n        }, 50);\n    }\n\n    var control_cbs = { };\n    var message_cbs = { };\n    var waiting_for_init = true;\n    var binary_type_available = false;\n    self.ready = false;\n    self.binary = false;\n\n    /* Called when ready for channels to interact */\n    function ready_for_channels() {\n        if (!self.ready) {\n            self.ready = true;\n            self.dispatchEvent(\"ready\");\n        }\n    }\n\n    ws.onopen = function() {\n        if (ws) {\n            if (typeof ws.binaryType !== \"undefined\" && have_array_buffer) {\n                ws.binaryType = \"arraybuffer\";\n                binary_type_available = true;\n            }\n            ws.send(\"\\n{ \\\"command\\\": \\\"init\\\", \\\"version\\\": 1 }\");\n        }\n    };\n\n    ws.onclose = function() {\n        transport_debug(\"WebSocket onclose\");\n        ws = null;\n        if (reload_after_disconnect) {\n            expect_disconnect = true;\n            window.location.reload(true);\n        }\n        if (expect_disconnect)\n            return;\n        self.close();\n    };\n\n    ws.onmessage = function(event) {\n        got_message = true;\n\n        /* The first line of a message is the channel */\n        var data = event.data;\n        var binary = null;\n        var length;\n        var channel;\n        var pos;\n\n        /* A binary message, split out the channel */\n        if (have_array_buffer && data instanceof window.ArrayBuffer) {\n            binary = new window.Uint8Array(data);\n            length = binary.length;\n            for (pos = 0; pos < length; pos++) {\n                if (binary[pos] == 10) /* new line */\n                    break;\n            }\n            if (pos === length) {\n                console.warn(\"binary message without channel\");\n                return;\n            } else if (pos === 0) {\n                console.warn(\"binary control message\");\n                return;\n            } else {\n                channel = String.fromCharCode.apply(null, binary.subarray(0, pos));\n            }\n\n        /* A textual message */\n        } else {\n            pos = data.indexOf('\\n');\n            if (pos === -1) {\n                console.warn(\"text message without channel\");\n                return;\n            }\n            channel = data.substring(0, pos);\n        }\n\n        var payload, control;\n        if (binary)\n            payload = new window.Uint8Array(binary.buffer, pos + 1);\n        else\n            payload = data.substring(pos + 1);\n\n        /* A control message, always string */\n        if (!channel) {\n            transport_debug(\"recv control:\", payload);\n            control = JSON.parse(payload);\n        } else  {\n            transport_debug(\"recv \" + channel + \":\", payload);\n        }\n\n        length = filters.length;\n        for (var i = 0; i < length; i++) {\n            if (filters[i](data, channel, control) === false)\n                return;\n        }\n\n        if (!channel)\n            process_control(control);\n        else\n            process_message(channel, payload);\n\n        phantom_checkpoint();\n    };\n\n    self.close = function close(options) {\n        if (!options)\n            options = { \"problem\": \"disconnected\" };\n        options.command = \"close\";\n        window.clearInterval(check_health_timer);\n        var ows = ws;\n        ws = null;\n        if (ows)\n            ows.close();\n        ready_for_channels(); /* ready to fail */\n\n        /* Broadcast to everyone */\n        for (var chan in control_cbs)\n            control_cbs[chan].apply(null, [options]);\n    };\n\n    self.next_channel = function next_channel() {\n        last_channel++;\n        return channel_seed + String(last_channel);\n    };\n\n    function process_init(options) {\n        if (options.problem){\n            self.close({ \"problem\": options.problem });\n            return;\n        }\n\n        if (options.version !== 1) {\n            console.error(\"received unsupported version in init message: \" + options.version);\n            self.close({\"problem\": \"not-supported\"});\n            return;\n        }\n\n        if (in_array(options[\"capabilities\"] || [], \"binary\"))\n            self.binary = binary_type_available;\n        if (options[\"channel-seed\"])\n            channel_seed = String(options[\"channel-seed\"]);\n        if (options[\"host\"])\n            default_host = options[\"host\"];\n\n        if (public_transport) {\n            public_transport.options = options;\n            public_transport.csrf_token = options[\"csrf-token\"];\n            public_transport.host = default_host;\n        }\n\n        if (init_callback)\n            init_callback(options);\n\n        if (waiting_for_init) {\n            waiting_for_init = false;\n            ready_for_channels();\n        }\n    }\n\n    function process_control(data) {\n        var channel = data.channel;\n        var func;\n\n        /* Init message received */\n        if (data.command == \"init\") {\n            process_init(data);\n\n        } else if (waiting_for_init) {\n            waiting_for_init = false;\n            if (data.command != \"close\" || channel) {\n                console.error(\"received message before init: \", data.command);\n                data = { \"problem\": \"protocol-error\" };\n            }\n            self.close(data);\n\n        } else if (data.command == \"ping\") {\n            /* 'ping' messages are ignored */\n\n        } else if (data.command == \"hint\") {\n            if (process_hints)\n                process_hints(data);\n\n        } else if (channel !== undefined) {\n            func = control_cbs[channel];\n            if (func)\n                func.apply(null, [data]);\n        }\n    }\n\n    function process_message(channel, payload) {\n        var func = message_cbs[channel];\n        if (func)\n            func.apply(null, [payload]);\n    }\n\n    self.send_data = function send_data(data) {\n        if (!ws) {\n            console.log(\"transport closed, dropped message: \", data);\n            return false;\n        } else {\n            ws.send(data);\n            return true;\n        }\n    };\n\n    self.send_message = function send_message(channel, payload) {\n        if (channel)\n            transport_debug(\"send \" + channel, payload);\n        else\n            transport_debug(\"send control:\", payload);\n\n        /* A binary message */\n        if (payload.byteLength || is_array(payload)) {\n            if (payload instanceof window.ArrayBuffer)\n                payload = new window.Uint8Array(payload);\n            var output = join_data([array_from_raw_string(channel), [ 10 ], payload ], true);\n            return self.send_data(output.buffer);\n\n        /* A string message */\n        } else {\n            return self.send_data(channel.toString() + \"\\n\" + payload);\n        }\n    };\n\n    self.send_control = function send_control(data) {\n        if(!ws && (data.command == \"close\" || data.command == \"kill\"))\n            return; /* don't complain if closed and closing */\n        self.send_message(\"\", JSON.stringify(data));\n    };\n\n    self.register = function register(channel, control_cb, message_cb) {\n        control_cbs[channel] = control_cb;\n        message_cbs[channel] = message_cb;\n    };\n\n    self.unregister = function unregister(channel) {\n        delete control_cbs[channel];\n        delete message_cbs[channel];\n    };\n}\n\nfunction ensure_transport(callback) {\n    var transport;\n    if (!default_transport)\n        default_transport = new Transport();\n    transport = default_transport;\n    if (transport.ready) {\n        callback(transport);\n    } else {\n        transport.addEventListener(\"ready\", function() {\n            callback(transport);\n        });\n    }\n}\n\nfunction Channel(options) {\n    var self = this;\n\n    /* We can trigger events */\n    event_mixin(self, { });\n\n    var transport;\n    var valid = true;\n    var received_done = false;\n    var sent_done = false;\n    var id = null;\n    var base64 = false;\n    var binary = (options.binary === true);\n\n    /*\n     * Queue while waiting for transport, items are tuples:\n     * [is_control ? true : false, payload]\n     */\n    var queue = [ ];\n\n    /* Handy for callers, but not used by us */\n    self.valid = valid;\n    self.options = options;\n    self.binary = binary;\n    self.id = id;\n\n    function on_message(payload) {\n        if (received_done) {\n            console.warn(\"received message after done\");\n            self.close(\"protocol-error\");\n        } else {\n            if (base64)\n                payload = base64_decode(payload, window.Uint8Array || Array);\n            self.dispatchEvent(\"message\", payload);\n        }\n    }\n\n    function on_close(data) {\n        self.valid = valid = false;\n        if (transport && id)\n            transport.unregister(id);\n        if (data.message)\n            console.warn(data.message);\n        self.dispatchEvent(\"close\", data);\n    }\n\n    function on_control(data) {\n        if (data.command == \"close\") {\n            on_close(data);\n            return;\n        }\n\n        var done = data.command === \"done\";\n        if (done && received_done) {\n            console.warn(\"received two done commands on channel\");\n            self.close(\"protocol-error\");\n\n        } else {\n            if (done)\n                received_done = true;\n            self.dispatchEvent(\"control\", data);\n        }\n    }\n\n    function send_payload(payload) {\n        if (binary && base64) {\n            payload = base64_encode(payload);\n        } else if (!binary) {\n            if (typeof payload !== \"string\")\n                payload = String(payload);\n        }\n        transport.send_message(id, payload);\n    }\n\n    ensure_transport(function(trans) {\n        transport = trans;\n        if (!valid)\n            return;\n\n        id = transport.next_channel();\n        self.id = id;\n\n        /* Register channel handlers */\n        transport.register(id, on_control, on_message);\n\n        /* Now open the channel */\n        var command = { };\n        for (var i in options)\n            command[i] = options[i];\n        command.command = \"open\";\n        command.channel = id;\n\n        if (!command.host) {\n            if (default_host)\n                command.host = default_host;\n        }\n\n        if (binary) {\n            if (transport.binary) {\n                command.binary = \"raw\";\n            } else {\n                command.binary = \"base64\";\n                base64 = true;\n            }\n        } else {\n            delete command.binary;\n        }\n\n        transport.send_control(command);\n\n        /* Now drain the queue */\n        while(queue.length > 0) {\n            var item = queue.shift();\n            if (item[0]) {\n                item[1][\"channel\"] = id;\n                transport.send_control(item[1]);\n            } else {\n                send_payload(item[1]);\n            }\n        }\n    });\n\n    self.send = function send(message) {\n        if (!valid)\n            console.warn(\"sending message on closed channel\");\n        else if (sent_done)\n            console.warn(\"sending message after done\");\n        else if (!transport)\n            queue.push([false, message]);\n        else\n            send_payload(message);\n    };\n\n    self.control = function control(options) {\n        options = options || { };\n        if (!options.command)\n            options.command = \"options\";\n\tif (options.command === \"done\")\n            sent_done = true;\n        options.channel = id;\n        if (!transport)\n            queue.push([true, options]);\n        else\n            transport.send_control(options);\n    };\n\n    self.close = function close(options) {\n        if (!valid)\n            return;\n\n        if (!options)\n            options = { };\n        else if (typeof options == \"string\")\n            options = { \"problem\" : options };\n        options[\"command\"] = \"close\";\n        options[\"channel\"] = id;\n\n        if (!transport)\n            queue.push([true, options]);\n        else\n            transport.send_control(options);\n        on_close(options);\n    };\n\n    self.buffer = function buffer(callback) {\n        var buffers = [];\n        buffers.callback = callback;\n        buffers.squash = function squash() {\n            return join_data(buffers, binary);\n        };\n\n        function on_message(event, data) {\n            var consumed, block;\n            buffers.push(data);\n            if (buffers.callback) {\n                block = join_data(buffers, binary);\n                if (block.length > 0) {\n                    consumed = buffers.callback.call(self, block);\n                    if (typeof consumed !== \"number\" || consumed === block.length) {\n                        buffers.length = 0;\n                    } else if (consumed === 0) {\n                        buffers.length = 1;\n                        buffers[0] = block;\n                    } else if (consumed !== 0) {\n                        buffers.length = 1;\n                        if (block.subarray)\n                            buffers[0] = block.subarray(consumed);\n                        else if (block.substring)\n                            buffers[0] = block.substring(consumed);\n                        else\n                            buffers[0] = block.slice(consumed);\n                    }\n                }\n            }\n        }\n\n        function on_close() {\n            self.removeEventListener(\"message\", on_message);\n            self.removeEventListener(\"close\", on_close);\n        }\n\n        self.addEventListener(\"message\", on_message);\n        self.addEventListener(\"close\", on_close);\n\n        return buffers;\n    };\n\n    self.toString = function toString() {\n        var host = options[\"host\"] || \"localhost\";\n        return \"[Channel \" + (valid ? id : \"<invalid>\") + \" -> \" + host + \"]\";\n    };\n}\n\n/* Resolve dots and double dots */\nfunction resolve_path_dots(parts) {\n    var out = [ ];\n    var length = parts.length;\n    for (var i = 0; i < length; i++) {\n        var part = parts[i];\n        if (part === \"\" || part == \".\") {\n            continue;\n        } else if (part == \"..\") {\n            if (out.length === 0)\n                return null;\n            out.pop();\n        } else {\n            out.push(part);\n        }\n    }\n    return out;\n}\n\nfunction basic_scope(cockpit, jquery) {\n\n    cockpit.channel = function channel(options) {\n        return new Channel(options);\n    };\n\n    cockpit.event_target = function event_target(obj) {\n        event_mixin(obj, { });\n        return obj;\n    };\n\n    cockpit.extend = extend;\n\n    /* These can be filled in by loading ../manifests.js */\n    cockpit.manifests = { };\n\n    /* ------------------------------------------------------------\n     * Text Encoding\n     */\n\n    function Utf8TextEncoder(constructor) {\n        var self = this;\n        self.encoding = \"utf-8\";\n\n        self.encode = function encode(string, options) {\n            var data = window.unescape(encodeURIComponent(string));\n            if (constructor === String)\n                return data;\n            return array_from_raw_string(data, constructor);\n        };\n    }\n\n    function Utf8TextDecoder(fatal) {\n        var self = this;\n        var buffer = null;\n        self.encoding = \"utf-8\";\n\n        self.decode = function decode(data, options) {\n            var stream = options && options.stream;\n\n            if (data === null || data === undefined)\n                data = \"\";\n            if (typeof data !== \"string\")\n                data = array_to_raw_string(data);\n            if (buffer) {\n                data = buffer + data;\n                buffer = null;\n            }\n\n            /* We have to scan to do non-fatal and streaming */\n            var beg = 0, i = 0, len = data.length;\n            var p, x, j, ok;\n            var str = \"\";\n\n            while (i < len) {\n                p = data.charCodeAt(i);\n                x = p == 255 ? 0 :\n                    p > 251 && p < 254 ? 6 :\n                    p > 247 && p < 252 ? 5 :\n                    p > 239 && p < 248 ? 4 :\n                    p > 223 && p < 240 ? 3 :\n                    p > 191 && p < 224 ? 2 :\n                    p < 128 ? 1 : 0;\n\n                ok = (i + x <= len);\n                if (!ok && stream) {\n                    buffer = data.substring(i);\n                    break;\n                }\n                if (x === 0)\n                    ok = false;\n                for (j = 1; ok && j < x; j++)\n                    ok = (data.charCodeAt(i + j) & 0x80) !== 0;\n\n                if (!ok) {\n                    if (fatal) {\n                        i = len;\n                        break;\n                    }\n\n                    str += decodeURIComponent(window.escape(data.substring(beg, i)));\n                    str += \"\\ufffd\";\n                    i++;\n                    beg = i;\n                } else {\n                    i += x;\n                }\n            }\n\n            str += decodeURIComponent(window.escape(data.substring(beg, i)));\n            return str;\n        };\n    }\n\n    cockpit.utf8_encoder = function utf8_encoder(constructor) {\n        return new Utf8TextEncoder(constructor);\n    };\n\n    cockpit.utf8_decoder = function utf8_decoder(fatal) {\n        return new Utf8TextDecoder(!!fatal);\n    };\n\n    cockpit.base64_encode = base64_encode;\n    cockpit.base64_decode = base64_decode;\n\n    cockpit.kill = function kill(host, group) {\n        var options = { \"command\": \"kill\" };\n        if (host)\n            options.host = host;\n        if (group)\n            options.group = group;\n        ensure_transport(function(transport) {\n            transport.send_control(options);\n        });\n    };\n\n    /* Not public API ... yet? */\n    cockpit.hint = function hint(name, host) {\n        if (!host)\n            host = default_host;\n\n        var options = { \"command\": \"hint\",\n                        \"hint\": name,\n                        \"host\": host };\n\n        ensure_transport(function(transport) {\n            transport.send_control(options);\n        });\n    };\n\n    cockpit.transport = public_transport = {\n        wait: ensure_transport,\n        inject: function inject(message) {\n            if (!default_transport)\n                return false;\n            return default_transport.send_data(message);\n        },\n        filter: function filter(callback) {\n            filters.push(callback);\n        },\n        close: function close(problem) {\n            var options;\n            if (problem)\n                options = {\"problem\": problem };\n            if (default_transport)\n                default_transport.close(options);\n            default_transport = null;\n            this.options = { };\n        },\n        origin: transport_origin,\n        options: { },\n        uri: calculate_url,\n        application: function () {\n            if (!default_transport || window.mock)\n                return calculate_application();\n            return default_transport.application;\n        },\n    };\n\n    /* ------------------------------------------------------------------------------------\n     * An ordered queue of functions that should be called later.\n     */\n\n    var later_queue = [];\n    var later_timeout = null;\n\n    function later_drain() {\n        var func, queue = later_queue;\n        later_timeout = null;\n        later_queue = [];\n        for (;;) {\n            func = queue.shift();\n            if (!func)\n                break;\n            func();\n        }\n    }\n\n    function later_invoke(func) {\n        if (func)\n            later_queue.push(func);\n        if (later_timeout === null)\n            later_timeout = window.setTimeout(later_drain, 0);\n    }\n\n    /* ------------------------------------------------------------------------------------\n     * Promises.\n     * Based on Q and angular promises, with some jQuery compatibility. See the angular\n     * license in COPYING.bower for license lineage. There are some key differences with\n     * both Q and jQuery.\n     *\n     *  * Exceptions thrown in handlers are not treated as rejections or failures.\n     *    Exceptions remain actual exceptions.\n     *  * Unlike jQuery callbacks added to an already completed promise don't execute\n     *    immediately. Wait until control is returned to the browser.\n     */\n\n    function promise_then(state, fulfilled, rejected, updated) {\n        if (fulfilled === undefined && rejected === undefined && updated === undefined)\n            return null;\n        var result = new Deferred();\n        state.pending = state.pending || [];\n        state.pending.push([result, fulfilled, rejected, updated]);\n        if (state.status > 0)\n            schedule_process_queue(state);\n        return result.promise;\n    }\n\n    function create_promise(state) {\n\n        /* Like jQuery the promise object is callable */\n        var self = function Promise(target) {\n            if (target) {\n                extend(target, self);\n                return target;\n            }\n            return self;\n        };\n\n        state.status = 0;\n\n        self.then = function then(fulfilled, rejected, updated) {\n            return promise_then(state, fulfilled, rejected, updated) || self;\n        };\n\n        self[\"catch\"] = function catch_(callback) {\n            return promise_then(state, null, callback) || self;\n        };\n\n        self[\"finally\"] = function finally_(callback, updated) {\n            return promise_then(state, function() {\n                return handle_callback(arguments, true, callback);\n            }, function() {\n                return handle_callback(arguments, false, callback);\n            }, updated) || self;\n        };\n\n        /* Basic jQuery Promise compatibility */\n        self.done = function done(fulfilled) {\n            promise_then(state, fulfilled);\n            return self;\n        };\n\n        self.fail = function fail(rejected) {\n            promise_then(state, null, rejected);\n            return self;\n        };\n\n        self.always = function always(callback) {\n            promise_then(state, callback, callback);\n            return self;\n        };\n\n        self.progress = function progress(updated) {\n            promise_then(state, null, null, updated);\n            return self;\n        };\n\n        self.state = function state_() {\n            if (state.status == 1)\n                return \"resolved\";\n            if (state.status == 2)\n                return \"rejected\";\n            return \"pending\";\n        };\n\n        /* Promises are recursive like jQuery */\n        self.promise = self;\n\n        return self;\n    }\n\n    function process_queue(state) {\n        var fn, deferred, pending;\n\n        pending = state.pending;\n        state.process_scheduled = false;\n        state.pending = undefined;\n        for (var i = 0, ii = pending.length; i < ii; ++i) {\n            state.pur = true;\n            deferred = pending[i][0];\n            fn = pending[i][state.status];\n            if (is_function(fn)) {\n                deferred.resolve(fn.apply(state.promise, state.values));\n            } else if (state.status === 1) {\n                deferred.resolve.apply(deferred.resolve, state.values);\n            } else {\n                deferred.reject.apply(deferred.reject, state.values);\n            }\n        }\n    }\n\n    function schedule_process_queue(state) {\n        if (state.process_scheduled || !state.pending)\n            return;\n        state.process_scheduled = true;\n        later_invoke(function() { process_queue(state); });\n    }\n\n    function deferred_resolve(state, values) {\n        var then, done = false;\n        if (is_object(values[0]) || is_function(values[0]))\n            then = values[0] && values[0].then;\n        if (is_function(then)) {\n            state.status = -1;\n            then.call(values, function(/* ... */) {\n                if (done)\n                    return;\n                done = true;\n                deferred_resolve(state, arguments);\n            }, function(/* ... */) {\n                if (done)\n                    return;\n                done = true;\n                deferred_reject(state, arguments);\n            }, function(/* ... */) {\n                deferred_notify(state, arguments);\n            });\n        } else {\n            state.values = values;\n            state.status = 1;\n            schedule_process_queue(state);\n        }\n    }\n\n    function deferred_reject(state, values) {\n        state.values = values;\n        state.status = 2;\n        schedule_process_queue(state);\n    }\n\n    function deferred_notify(state, values) {\n        var callbacks = state.pending;\n        if ((state.status <= 0) && callbacks && callbacks.length) {\n            later_invoke(function() {\n                var callback, result;\n                for (var i = 0, ii = callbacks.length; i < ii; i++) {\n                    result = callbacks[i][0];\n                    callback = callbacks[i][3];\n                    if (is_function(callback))\n                        result.notify(callback.apply(state.promise, values));\n                    else\n                        result.notify.apply(result, values);\n                }\n            });\n        }\n    }\n\n    function Deferred() {\n        var self = this;\n        var state = { };\n        self.promise = state.promise = create_promise(state);\n\n        self.resolve = function resolve(/* ... */) {\n            if (arguments[0] === state.promise)\n                throw new Error(\"Expected promise to be resolved with other value than itself\");\n            if (!state.status)\n                deferred_resolve(state, arguments);\n            return self;\n        };\n\n        self.reject = function reject(/* ... */) {\n            if (state.status)\n                return;\n            deferred_reject(state, arguments);\n            return self;\n        };\n\n        self.notify = function notify(/* ... */) {\n            deferred_notify(state, arguments);\n            return self;\n        };\n    }\n\n    function prep_promise(values, resolved) {\n        var result = cockpit.defer();\n        if (resolved)\n            result.resolve.apply(result, values);\n        else\n            result.reject.apply(result, values);\n        return result.promise;\n    }\n\n    function handle_callback(values, is_resolved, callback) {\n        var callback_output = null;\n        if (is_function(callback))\n            callback_output = callback();\n        if (callback_output && is_function (callback_output.then)) {\n            return callback_output.then(function() {\n                return prep_promise(values, is_resolved);\n            }, function() {\n                return prep_promise(arguments, false);\n            });\n        } else {\n            return prep_promise(values, is_resolved);\n        }\n    }\n\n    cockpit.when = function when(value, fulfilled, rejected, updated) {\n        var result = cockpit.defer();\n        result.resolve(value);\n        return result.promise.then(fulfilled, rejected, updated);\n    };\n\n    cockpit.all = function all(promises) {\n        var deferred = cockpit.defer();\n        var counter = 0;\n        var results = [];\n\n        if (arguments.length != 1 && !is_array (promises))\n            promises = Array.prototype.slice.call(arguments);\n\n        promises.forEach(function(promise, key) {\n            counter++;\n            cockpit.when(promise).then(function(value) {\n                results[key] = value;\n                if (!(--counter))\n                    deferred.resolve.apply(deferred, results);\n            }, function(/* ... */) {\n                deferred.reject.apply(deferred, arguments);\n            });\n        });\n\n        if (counter === 0)\n            deferred.resolve(results);\n        return deferred.promise;\n    };\n\n    cockpit.resolve = function resolve(result) {\n        return cockpit.defer().resolve(result).promise;\n    };\n\n    cockpit.reject = function reject(ex) {\n        return cockpit.defer().reject(ex).promise;\n    };\n\n    cockpit.defer = function() {\n        return new Deferred();\n    };\n\n    /* ---------------------------------------------------------------------\n     * Utilities\n     */\n\n    var fmt_re = /\\$\\{([^}]+)\\}|\\$([a-zA-Z0-9_]+)/g;\n    cockpit.format = function format(fmt, args) {\n        if (arguments.length != 2 || !is_object(args) || args === null)\n            args = Array.prototype.slice.call(arguments, 1);\n        return fmt.replace(fmt_re, function(m, x, y) { return args[x || y] || \"\"; });\n    };\n\n    cockpit.format_number = function format_number(number) {\n        /* non-zero values should never appear zero */\n        if (number > 0 && number < 0.1)\n            number = 0.1;\n        else if (number < 0 && number > -0.1)\n            number = -0.1;\n\n        /* TODO: Make the decimal separator translatable */\n\n        /* only show as integer if we have a natural number */\n        if (!number && number !== 0)\n            return \"\";\n        else if (number % 1 === 0)\n            return number.toString();\n        else\n            return number.toFixed(1);\n    };\n\n    function format_units(number, suffixes, factor, separate) {\n        var quotient;\n        var suffix = null;\n        var key, keys;\n        var divisor;\n        var y, x, i;\n\n        /* Find that factor string */\n        if (!number && number !== 0) {\n            suffix = null;\n\n        } else if (typeof (factor) === \"string\") {\n            /* Prefer larger factors */\n            keys = [];\n            for (key in suffixes)\n                keys.push(key);\n            keys.sort().reverse();\n            for (y = 0; y < keys.length; y++) {\n                for (x = 0; x < suffixes[keys[y]].length; x++) {\n                    if (factor == suffixes[keys[y]][x]) {\n                        number = number / Math.pow(keys[y], x);\n                        suffix = factor;\n                        break;\n                    }\n                }\n                if (suffix)\n                    break;\n            }\n\n        /* @factor is a number */\n        } else if (factor in suffixes) {\n            divisor = 1;\n            for (i = 0; i < suffixes[factor].length; i++) {\n                quotient = number / divisor;\n                if (quotient < factor) {\n                    number = quotient;\n                    suffix = suffixes[factor][i];\n                    break;\n                }\n                divisor *= factor;\n            }\n        }\n\n        var string_representation = cockpit.format_number(number);\n        var ret;\n\n        if (string_representation && suffix)\n            ret = [string_representation, suffix];\n        else\n            ret = [string_representation];\n\n        if (!separate)\n            ret = ret.join(\" \");\n\n        return ret;\n    }\n\n    var byte_suffixes = {\n        1000: [ null, \"KB\", \"MB\", \"GB\", \"TB\", \"PB\", \"EB\", \"ZB\" ],\n        1024: [ null, \"KiB\", \"MiB\", \"GiB\", \"TiB\", \"PiB\", \"EiB\", \"ZiB\" ]\n    };\n\n    cockpit.format_bytes = function format_bytes(number, factor, separate) {\n        if (factor === undefined)\n            factor = 1024;\n        return format_units(number, byte_suffixes, factor, separate);\n    };\n\n    cockpit.get_byte_units = function get_byte_units(guide_value, factor) {\n        if (factor === undefined || ! (factor in byte_suffixes))\n            factor = 1024;\n\n        function unit(index) {\n            return { name: byte_suffixes[factor][index],\n                     factor: Math.pow(factor, index)\n                   };\n        }\n\n        var units = [ unit(2), unit(3), unit(4) ];\n\n        // The default unit is the largest one that gives us at least\n        // two decimal digits in front of the comma.\n\n        for (var i = units.length-1; i >= 0; i--) {\n            if (i === 0 || (guide_value / units[i].factor) >= 10) {\n                units[i].selected = true;\n                break;\n            }\n        }\n\n        return units;\n    };\n\n    var byte_sec_suffixes = {\n        1024: [ \"B/s\", \"KiB/s\", \"MiB/s\", \"GiB/s\", \"TiB/s\", \"PiB/s\", \"EiB/s\", \"ZiB/s\" ]\n    };\n\n    cockpit.format_bytes_per_sec = function format_bytes_per_sec(number, factor, separate) {\n        if (factor === undefined)\n            factor = 1024;\n        return format_units(number, byte_sec_suffixes, factor, separate);\n    };\n\n    var bit_suffixes = {\n        1000: [ \"bps\", \"Kbps\", \"Mbps\", \"Gbps\", \"Tbps\", \"Pbps\", \"Ebps\", \"Zbps\" ]\n    };\n\n    cockpit.format_bits_per_sec = function format_bits_per_sec(number, factor, separate) {\n        if (factor === undefined)\n            factor = 1000;\n        return format_units(number, bit_suffixes, factor, separate);\n    };\n\n    /* ---------------------------------------------------------------------\n     * Storage Helper.\n     *\n     * Use application to prefix data stored in browser storage\n     * with helpers for compatibility.\n     */\n    function StorageHelper(storage) {\n        var self = this;\n\n        self.prefixedKey = function (key) {\n            return cockpit.transport.application() + \":\" + key;\n        };\n\n        self.getItem = function (key, both) {\n            var value = storage.getItem(self.prefixedKey(key));\n            if (!value && both)\n                value = storage.getItem(key);\n            return value;\n        };\n\n        self.setItem = function (key, value, both) {\n            storage.setItem(self.prefixedKey(key), value);\n            if (both)\n                storage.setItem(key, value);\n        };\n\n        self.removeItem = function(key, both) {\n            storage.removeItem(self.prefixedKey(key));\n            if (both)\n                storage.removeItem(key);\n        };\n\n        /* Instead of clearing, purge anything that isn't prefixed with an application\n         * and anything prefixed with our application.\n         */\n        self.clear = function(full) {\n            var i = 0;\n            while (i < storage.length) {\n                var k = storage.key(i);\n                if (full && k.indexOf(\"cockpit\") !== 0)\n                    storage.removeItem(k);\n                else if (k.indexOf(cockpit.transport.application()) === 0)\n                    storage.removeItem(k);\n                else\n                    i++;\n            }\n        };\n    }\n\n    cockpit.localStorage = new StorageHelper(window.localStorage);\n    cockpit.sessionStorage = new StorageHelper(window.sessionStorage);\n\n    /* ---------------------------------------------------------------------\n     * Shared data cache.\n     *\n     * We cannot use sessionStorage when keeping lots of data in memory and\n     * sharing it between frames. It has a rather paltry limit on the amount\n     * of data it can hold ... so we use window properties instead.\n     */\n\n    function lookup_storage(win) {\n        var storage;\n        if (win.parent && win.parent !== win)\n            storage = lookup_storage(win.parent);\n        if (!storage) {\n            try {\n                storage = win[\"cv1-storage\"];\n                if (!storage)\n                    win[\"cv1-storage\"] = storage = { };\n            } catch(ex) { }\n        }\n        return storage;\n    }\n\n    function StorageCache(org_key, provider, consumer) {\n        var self = this;\n        var key = cockpit.transport.application() + \":\" + org_key;\n\n        /* For triggering events and ownership */\n        var trigger = window.sessionStorage;\n        var last;\n\n        var storage = lookup_storage(window);\n\n        var claimed = false;\n        var source;\n\n        function callback() {\n            /* Only run the callback if we have a result */\n            if (storage[key] !== undefined) {\n                if (consumer(storage[key], org_key) === false)\n                    self.close();\n            }\n        }\n\n        function result(value) {\n            if (source && !claimed)\n                claimed = true;\n            if (!claimed)\n                return;\n\n            // use a random number to avoid races by separate instances\n            var version = Math.floor(Math.random() * 10000000) + 1;\n\n            /* Event for the local window */\n            var ev = document.createEvent(\"StorageEvent\");\n            ev.initStorageEvent(\"storage\", false, false, key, null,\n                                version, window.location, trigger);\n\n            storage[key] = value;\n            trigger.setItem(key, version);\n            ev.self = self;\n            window.dispatchEvent(ev);\n        }\n\n        self.claim = function claim() {\n            if (!source)\n                source = provider(result, org_key);\n        };\n\n        function unclaim() {\n            if (source && source.close)\n                source.close();\n            source = null;\n\n            if (!claimed)\n                return;\n\n            claimed = false;\n\n            var current_value = trigger.getItem(key);\n            if (current_value)\n                current_value = parseInt(current_value, 10);\n            else\n                current_value = null;\n\n            if (last && last === current_value) {\n                var ev = document.createEvent(\"StorageEvent\");\n                var version = trigger[key];\n                ev.initStorageEvent(\"storage\", false, false, key, version,\n                                    null, window.location, trigger);\n                delete storage[key];\n                trigger.removeItem(key);\n                ev.self = self;\n                window.dispatchEvent(ev);\n            }\n        }\n\n        function changed(event) {\n            if (event.key !== key)\n                return;\n\n            /* check where the event came from\n               - it came from someone else:\n                   if it notifies their unclaim (new value null) and we haven't already claimed, do so\n               - it came from ourselves:\n                   if the new value doesn't match the actual value in the cache, and\n                   we tried to claim (from null to a number), cancel our claim\n             */\n            if (event.self !== self) {\n                if (!event.newValue && !claimed) {\n                    self.claim();\n                    return;\n                }\n            } else if (claimed && !event.oldValue && (event.newValue !== trigger.getItem(key))) {\n                unclaim();\n            }\n\n            var new_value = null;\n            if (event.newValue)\n                new_value = parseInt(event.newValue, 10);\n            if (last !== new_value) {\n                last = new_value;\n                callback();\n            }\n        }\n\n        self.close = function() {\n            window.removeEventListener(\"storage\", changed, true);\n            unclaim();\n        };\n\n        window.addEventListener(\"storage\", changed, true);\n\n        /* Always clear this data on unload */\n        window.addEventListener(\"beforeunload\", function() {\n            self.close();\n        });\n        window.addEventListener(\"unload\", function() {\n            self.close();\n        });\n\n        if (trigger.getItem(key))\n            callback();\n        else\n            self.claim();\n    }\n\n    cockpit.cache = function cache(key, provider, consumer) {\n        return new StorageCache(key, provider, consumer);\n    };\n\n    /* ---------------------------------------------------------------------\n     * Metrics\n     *\n     * Implements the cockpit.series and cockpit.grid. Part of the metrics\n     * implementations that do not require jquery.\n     */\n\n    function SeriesSink(interval, identifier, fetch_callback) {\n        var self = this;\n\n        self.interval = interval;\n        self.limit = identifier ? 64 * 1024 : 1024;\n\n        /*\n         * The cache sits on a window, either our own or a parent\n         * window whichever we can access properly.\n         *\n         * Entries in the index are:\n         *\n         * { beg: N, items: [], mapping: { }, next: item }\n         */\n        var index = setup_index(identifier);\n\n        /*\n         * A linked list through the index, that we use for expiry\n         * of the cache.\n         */\n        var count = 0;\n        var head = null;\n        var tail = null;\n\n        function setup_index(id) {\n            if (!id)\n                return [];\n\n            /* Try and find a good place to cache data */\n            var storage = lookup_storage(window);\n\n            var index = storage[id];\n            if (!index)\n                storage[id] = index = [];\n            return index;\n        }\n\n        function search(idx, beg) {\n            var low = 0;\n            var high = idx.length - 1;\n            var mid, val;\n\n            while (low <= high) {\n                mid = (low + high) / 2 | 0;\n                val = idx[mid].beg;\n                if (val < beg)\n                    low = mid + 1;\n                else if (val > beg)\n                    high = mid - 1;\n                else\n                    return mid; /* key found */\n            }\n            return low;\n        }\n\n        function fetch(beg, end, for_walking) {\n            if (fetch_callback) {\n                if (!for_walking) {\n                    /* Stash some fake data synchronously so that we don't ask\n                     * again for the same range while they are still fetching\n                     * it asynchronously.\n                     */\n                    stash(beg, new Array(end-beg), { });\n                }\n                fetch_callback(beg, end, for_walking);\n            }\n        }\n\n        self.load = function load(beg, end, for_walking) {\n            if (end <= beg)\n                return;\n\n            var at = search(index, beg);\n\n            var entry;\n            var b, e, eb, en, i, len = index.length;\n            var last = beg;\n\n            /* We do this in two phases: First, we walk the index to\n             * process what we already have and at the same time make\n             * notes about what we need to fetch.  Then we go over the\n             * notes and actually fetch what we need.  That way, the\n             * fetch callbacks in the second phase can modify the\n             * index data structure without disturbing the walk in the\n             * first phase.\n             */\n\n            var fetches = [ ];\n\n            /* Data relevant to this range can be at the found index, or earlier */\n            for (i = at > 0 ? at - 1 : at; i < len; i++) {\n                entry = index[i];\n                en = entry.items.length;\n                if (!en)\n                    continue;\n\n                eb = entry.beg;\n                b = Math.max(eb, beg);\n                e = Math.min(eb + en, end);\n\n                if (b < e) {\n                    if (b > last)\n                        fetches.push([ last, b ]);\n                    process(b, entry.items.slice(b - eb, e - eb), entry.mapping);\n                    last = e;\n                } else if (i >= at) {\n                    break; /* no further intersections */\n                }\n            }\n\n            for (i = 0; i < fetches.length; i++)\n                fetch(fetches[i][0], fetches[i][1], for_walking);\n\n            if (last != end)\n                fetch(last, end, for_walking);\n        };\n\n        function stash(beg, items, mapping) {\n            if (!items.length)\n                return;\n\n            var at = search(index, beg);\n\n            var end = beg + items.length;\n            var remove = [ ];\n            var entry;\n            var num;\n\n            var b, e, eb, en, i, len = index.length;\n            for (i = at > 0 ? at - 1 : at; i < len; i++) {\n                entry = index[i];\n                en = entry.items.length;\n                if (!en)\n                    continue;\n\n                eb = entry.beg;\n                b = Math.max(eb, beg);\n                e = Math.min(eb + en, end);\n\n                /*\n                 * We truncate blocks that intersect with this one\n                 *\n                 * We could adjust them, but in general the loaders are\n                 * intelligent enough to only load the required data, so\n                 * not doing this optimization yet.\n                 */\n\n                if (b < e) {\n                    num = e - b;\n                    entry.items.splice(b - eb, num);\n                    count -= num;\n                    if (b - eb === 0)\n                        entry.beg += (e - eb);\n                } else if (i >= at) {\n                    break; /* no further intersections */\n                }\n            }\n\n            /* Insert our item into the array */\n            entry = { beg: beg, items: items, mapping: mapping };\n            if (!head)\n                head = entry;\n            if (tail)\n                tail.next = entry;\n            tail = entry;\n            count += items.length;\n            index.splice(at, 0, entry);\n\n            /* Remove any items with zero length around insertion point */\n            for (at--; at <= i; at++) {\n                entry = index[at];\n                if (entry && !entry.items.length) {\n                    index.splice(at, 1);\n                    at--;\n                }\n            }\n\n            /* If our index has gotten too big, expire entries */\n            while (head && count > self.limit) {\n                count -= head.items.length;\n                head.items = [];\n                head.mapping = null;\n                head = head.next || null;\n            }\n\n            /* Remove any entries with zero length at beginning */\n            len = index.length;\n            for (i = 0; i < len; i++) {\n                if (index[i].items.length > 0)\n                    break;\n            }\n            index.splice(0, i);\n        }\n\n        /*\n         * Used to populate grids, the keys are grid ids and\n         * the values are objects: { grid, rows, notify }\n         *\n         * The rows field is an object indexed by paths\n         * container aliases, and the values are: [ row, path ]\n         */\n        var registered = { };\n\n        /* An undocumented function called by DataGrid */\n        self._register = function _register(grid, id) {\n            if (grid.interval != interval)\n                throw \"mismatched metric interval between grid and sink\";\n            var gdata = registered[id];\n            if (!gdata) {\n                gdata = registered[id] = { grid: grid, links: [ ] };\n                gdata.links.remove = function remove() {\n                    delete registered[id];\n                };\n            }\n            return gdata.links;\n        };\n\n        function process(beg, items, mapping) {\n            var i, j, jlen, k, klen;\n            var data, path, row, map;\n            var id, gdata, grid;\n            var f, t, n, b, e;\n\n            var end = beg + items.length;\n\n            for (id in registered) {\n                gdata = registered[id];\n                grid = gdata.grid;\n\n                b = Math.max(beg, grid.beg);\n                e = Math.min(end, grid.end);\n\n                /* Does this grid overlap the bounds of item? */\n                if (b < e) {\n\n                    /* Where in the items to take from */\n                    f = b - beg;\n\n                    /* Where and how many to place */\n                    t = b - grid.beg;\n\n                    /* How many to process */\n                    n = e - b;\n\n                    for (i = 0; i < n; i++) {\n                        klen = gdata.links.length;\n                        for (k = 0; k < klen; k++) {\n                            path = gdata.links[k][0];\n                            row = gdata.links[k][1];\n\n                            /* Calulate the data field to fill in */\n                            data = items[f + i];\n                            map = mapping;\n                            jlen = path.length;\n                            for (j = 0; data !== undefined && j < jlen; j++) {\n                                if (!data) {\n                                    data = undefined;\n                                } else if (map !== undefined && map !== null) {\n                                    map = map[path[j]];\n                                    if (map)\n                                        data = data[map[\"\"]];\n                                    else\n                                        data = data[path[j]];\n                                } else {\n                                    data = data[path[j]];\n                                }\n                            }\n\n                            row[t + i] = data;\n                        }\n                    }\n\n                    /* Notify the grid, so it can call any functions */\n                    grid.notify(t, n);\n                }\n            }\n        }\n\n        self.input = function input(beg, items, mapping) {\n            process(beg, items, mapping);\n            stash(beg, items, mapping);\n        };\n    }\n\n    cockpit.series = function series(interval, cache, fetch) {\n        return new SeriesSink(interval, cache, fetch);\n    };\n\n    var unique = 1;\n\n    function SeriesGrid(interval, beg, end) {\n        var self = this;\n\n        /* We can trigger events */\n        event_mixin(self, { });\n\n        var rows = [];\n\n        self.interval = interval;\n        self.beg = 0;\n        self.end = 0;\n\n        /*\n         * Used to populate table data, the values are:\n         * [ callback, row ]\n         */\n        var callbacks = [ ];\n\n        var sinks = [ ];\n\n        var suppress = 0;\n\n        var id = \"g1-\" + unique;\n        unique += 1;\n\n        /* Used while walking */\n        var walking = null;\n        var offset = null;\n\n        self.notify = function notify(x, n) {\n            if (suppress)\n                return;\n            if (x + n > self.end - self.beg)\n                n = (self.end - self.beg) - x;\n            if (n <= 0)\n                return;\n            var j, jlen = callbacks.length;\n            var callback, row;\n            for (j = 0; j < jlen; j++) {\n                callback = callbacks[j][0];\n                row = callbacks[j][1];\n                callback.call(self, row, x, n);\n            }\n\n            self.dispatchEvent(\"notify\", x, n);\n        };\n\n        self.add = function add(/* sink, path */) {\n            var row = [];\n            rows.push(row);\n\n            var registered, sink, path, links, cb;\n\n            /* Called as add(sink, path) */\n            if (is_object(arguments[0])) {\n                sink = arguments[0];\n                sink = sink[\"series\"] || sink;\n\n                /* The path argument can be an array, or a dot separated string */\n                path = arguments[1];\n                if (!path)\n                    path = [];\n                else if (typeof (path) === \"string\")\n                    path = path.split(\".\");\n\n                links = sink._register(self, id);\n                if (!links.length)\n                    sinks.push({ sink: sink, links: links });\n                links.push([path, row]);\n\n            /* Called as add(callback) */\n            } else if (is_function(arguments[0])) {\n                cb = [ arguments[0], row ];\n                if (arguments[1] === true)\n                    callbacks.unshift(cb);\n                else\n                    callbacks.push(cb);\n\n            /* Not called as add() */\n            } else if (arguments.length !== 0) {\n                throw \"invalid args to grid.add()\";\n            }\n\n            return row;\n        };\n\n        self.remove = function remove(row) {\n            var j, i, ilen, jlen;\n\n            /* Remove from the sinks */\n            ilen = sinks.length;\n            for (i = 0; i < ilen; i++) {\n                jlen = sinks[i].links.length;\n                for (j = 0; j < jlen; j++) {\n                    if (sinks[i].links[j][1] === row) {\n                        sinks[i].links.splice(j, 1);\n                        break;\n                    }\n                }\n            }\n\n            /* Remove from our list of rows */\n            ilen = rows.length;\n            for (i = 0; i < ilen; i++) {\n                if (rows[i] === row) {\n                    rows.splice(i, 1);\n                    break;\n                }\n            }\n        };\n\n        self.sync = function sync(for_walking) {\n            /* Suppress notifications */\n            suppress++;\n\n            /* Ask all sinks to load data */\n            var sink, i, len = sinks.length;\n            for (i = 0; i < len; i++) {\n                sink = sinks[i].sink;\n                sink.load(self.beg, self.end, for_walking);\n            }\n\n            suppress--;\n\n            /* Notify for all rows */\n            self.notify(0, self.end - self.beg);\n        };\n\n        function move_internal(beg, end, for_walking) {\n            if (end === undefined)\n                end = beg + (self.end - self.beg);\n\n            if (end < beg)\n                beg = end;\n\n            self.beg = beg;\n            self.end = end;\n\n            if (!rows.length)\n                return;\n\n            rows.forEach(function(row) {\n                row.length = 0;\n            });\n\n            self.sync(for_walking);\n        }\n\n        function stop_walking() {\n            window.clearInterval(walking);\n            walking = null;\n            offset = null;\n        }\n\n        self.move = function move(beg, end) {\n            stop_walking();\n            /* Some code paths use now twice.\n             * They should use the same value.\n             */\n            var now = null;\n\n            /* Treat negative numbers relative to now */\n            if (beg === undefined) {\n                beg = 0;\n            } else if (is_negative(beg)) {\n                now = Date.now();\n                beg = Math.floor(now / self.interval) + beg;\n            }\n            if (end !== undefined && is_negative(end)) {\n                if (now === null)\n                    now = Date.now();\n                end = Math.floor(now / self.interval) + end;\n            }\n\n            move_internal(beg, end, false);\n        };\n\n        self.walk = function walk() {\n            /* Don't overflow 32 signed bits with the interval since\n             * many browsers will mishandle it.  This means that plots\n             * that would make about one step every month don't walk\n             * at all, but I guess that is ok.\n             *\n             * For example,\n             * https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setTimeout\n             * says:\n             *\n             *    Browsers including Internet Explorer, Chrome,\n             *    Safari, and Firefox store the delay as a 32-bit\n             *    signed Integer internally. This causes an Integer\n             *    overflow when using delays larger than 2147483647,\n             *    resulting in the timeout being executed immediately.\n             */\n\n            var start = Date.now();\n            if (self.interval > 2000000000)\n                return;\n\n            stop_walking();\n            offset = start - self.beg * self.interval;\n            walking = window.setInterval(function() {\n                var now = Date.now();\n                move_internal(Math.floor((now - offset) / self.interval), undefined, true);\n            }, self.interval);\n        };\n\n        self.close = function close() {\n            stop_walking();\n            while (sinks.length)\n                (sinks.pop()).links.remove();\n        };\n\n        self.move(beg, end);\n    }\n\n    cockpit.grid = function grid(interval, beg, end) {\n        return new SeriesGrid(interval, beg, end);\n    };\n\n    /* --------------------------------------------------------------------\n     * Basic utilities.\n     */\n\n    function BasicError(problem, message) {\n        this.problem = problem;\n        this.message = message || cockpit.message(problem);\n        this.toString = function() {\n            return this.message;\n        };\n    }\n\n    cockpit.logout = function logout(reload) {\n        /* fully clear session storage */\n        cockpit.sessionStorage.clear(true);\n\n        /* Only clean application data from localStorage,\n         * except for login-data. Clear that completely */\n        cockpit.localStorage.removeItem('login-data', true);\n        cockpit.localStorage.clear(false);\n\n        if (reload !== false)\n            reload_after_disconnect = true;\n        ensure_transport(function(transport) {\n            transport.send_control({ \"command\": \"logout\", \"disconnect\": true });\n        });\n        window.sessionStorage.setItem(\"logout-intent\", \"explicit\");\n    };\n\n    /* Not public API ... yet? */\n    cockpit.drop_privileges = function drop_privileges() {\n        ensure_transport(function(transport) {\n            transport.send_control({ \"command\": \"logout\", \"disconnect\": false });\n        });\n    };\n\n    /* ---------------------------------------------------------------------\n     * User and system information\n     */\n\n    cockpit.info = { };\n    event_mixin(cockpit.info, { });\n\n    init_callback = function(options) {\n        if (options.system)\n            extend(cockpit.info, options.system);\n        if (options.system)\n            cockpit.info.dispatchEvent(\"changed\");\n    };\n\n    var the_user = null;\n    cockpit.user = function () {\n        var dfd = cockpit.defer();\n        var dbus;\n        if (!the_user) {\n            dbus = cockpit.dbus(null, { \"bus\": \"internal\" });\n            dbus.call(\"/user\", \"org.freedesktop.DBus.Properties\", \"GetAll\",\n                      [ \"cockpit.User\" ], { \"type\": \"s\" })\n                .done(function(reply) {\n                    var user = reply[0];\n                    dfd.resolve({\n                        id: user.Id.v,\n                        name: user.Name.v,\n                        full_name: user.Full.v,\n                        groups: user.Groups.v,\n                        home: user.Home.v,\n                        shell: user.Shell.v\n                    });\n                })\n                .fail(function(ex) {\n                    dfd.reject(ex);\n                })\n                .always(function() {\n                    dbus.close();\n                });\n        } else {\n            dfd.resolve(the_user);\n        }\n\n        return dfd.promise;\n    };\n\n    /* ------------------------------------------------------------------------\n     * Override for broken browser behavior\n     */\n\n    document.addEventListener(\"click\", function(ev) {\n        if (in_array(ev.target.classList, 'disabled'))\n          ev.stopPropagation();\n    }, true);\n\n    /* ------------------------------------------------------------------------\n     * Cockpit location\n     */\n\n    /* HACK: Mozilla will unescape 'window.location.hash' before returning\n     * it, which is broken.\n     *\n     * https://bugzilla.mozilla.org/show_bug.cgi?id=135309\n     */\n\n    var last_loc = null;\n\n    function get_window_location_hash() {\n        return (window.location.href.split('#')[1] || '');\n    }\n\n    function Location() {\n        var self = this;\n        var application = cockpit.transport.application();\n        self.url_root = url_root || \"\";\n        if (application.indexOf(\"cockpit+=\") === 0) {\n            if (self.url_root)\n                self.url_root += '/';\n            self.url_root = self.url_root + application.replace(\"cockpit+\", '');\n        }\n\n        var href = get_window_location_hash();\n        var options = { };\n        var path = decode(href, options);\n\n        function decode_path(input) {\n            var parts = input.split('/').map(decodeURIComponent);\n            var result, i, pre_parts = [];\n\n            if (self.url_root)\n                pre_parts = self.url_root.split('/').map(decodeURIComponent);\n\n            if (input && input[0] !== \"/\") {\n                result = [].concat(path);\n                result.pop();\n                result = result.concat(parts);\n            } else {\n                result = parts;\n            }\n\n            result = resolve_path_dots(result);\n            for (i = 0; i < pre_parts.length; i++) {\n                if (pre_parts[i] !== result[i])\n                    break;\n            }\n            if (i == pre_parts.length)\n                result.splice(0, pre_parts.length);\n\n            return result;\n        }\n\n        function encode(path, options, with_root) {\n            if (typeof path == \"string\")\n                path = decode_path(path, self.path);\n\n            var href = \"/\" + path.map(encodeURIComponent).join(\"/\");\n            if (with_root && self.url_root && href.indexOf(\"/\" + self.url_root + \"/\" !== 0))\n                href = \"/\" + self.url_root + href;\n\n            /* Undo unnecessary encoding of these */\n            href = href.replace(\"%40\", \"@\");\n            href = href.replace(\"%3D\", \"=\");\n\n            var i, opt, value, query = [];\n            function push_option(v) {\n                query.push(encodeURIComponent(opt) + \"=\" + encodeURIComponent(v));\n            }\n\n            if (options) {\n                for (opt in options) {\n                    value = options[opt];\n                    if (!is_array(value))\n                        value = [ value ];\n                    value.forEach(push_option);\n                }\n                if (query.length > 0)\n                    href += \"?\" + query.join(\"&\");\n            }\n            return href;\n        }\n\n        function decode(href, options) {\n            if (href[0] == '#')\n                href = href.substr(1);\n\n            var pos = href.indexOf('?');\n            var first = href;\n            if (pos === -1)\n                first = href;\n            else\n                first = href.substr(0, pos);\n            var path = decode_path(first);\n            if (pos !== -1 && options) {\n                href.substring(pos + 1).split(\"&\").forEach(function(opt) {\n                    var last, parts = opt.split('=');\n                    var name = decodeURIComponent(parts[0]);\n                    var value = decodeURIComponent(parts[1]);\n                    if (options.hasOwnProperty(name)) {\n                        last = options[name];\n                        if (!is_array(value))\n                            last = options[name] = [ last ];\n                        last.push(value);\n                    } else {\n                        options[name] = value;\n                    }\n                });\n            }\n\n            return path;\n        }\n\n        function href_for_go_or_replace(/* ... */) {\n            var href;\n            if (arguments.length == 1 && arguments[0] instanceof Location) {\n                href = String(arguments[0]);\n            } else if (typeof arguments[0] == \"string\") {\n                var options = arguments[1] || { };\n                href = encode(decode(arguments[0], options), options);\n            } else {\n                href = encode.apply(self, arguments);\n            }\n            return href;\n        }\n\n        function replace(/* ... */) {\n            if (self !== last_loc)\n                return;\n            var href = href_for_go_or_replace.apply(self, arguments);\n            window.location.replace(window.location.pathname + '#' + href);\n        }\n\n        function go(/* ... */) {\n            if (self !== last_loc)\n                return;\n            var href = href_for_go_or_replace.apply(self, arguments);\n            window.location.hash = '#' + href;\n        }\n\n        Object.defineProperties(self, {\n            path: {\n                enumerable: true,\n                writable: false,\n                value: path\n            },\n            options: {\n                enumerable: true,\n                writable: false,\n                value: options\n            },\n            href: {\n                enumerable: true,\n                value: href\n            },\n            go: { value: go },\n            replace: { value: replace },\n            encode: { value: encode },\n            decode: { value: decode },\n            toString: { value: function() { return href; } }\n        });\n    }\n\n    Object.defineProperty(cockpit, \"location\", {\n        enumerable: true,\n        get: function() {\n            if (!last_loc || last_loc.href !== get_window_location_hash())\n                last_loc = new Location();\n            return last_loc;\n        },\n        set: function(v) {\n            cockpit.location.go(v);\n        }\n    });\n\n    window.addEventListener(\"hashchange\", function() {\n        last_loc = null;\n        cockpit.dispatchEvent(\"locationchanged\");\n    });\n\n    /* ------------------------------------------------------------------------\n     * Cockpit jump\n     */\n\n    cockpit.jump = function jump(path, host) {\n        if (is_array(path))\n            path = \"/\" + path.map(encodeURIComponent).join(\"/\").replace(\"%40\", \"@\").replace(\"%3D\", \"=\");\n        else\n            path = \"\" + path;\n        var options = { command: \"jump\", location: path, host: host };\n        cockpit.transport.inject(\"\\n\" + JSON.stringify(options));\n    };\n\n    /* ---------------------------------------------------------------------\n     * Cockpit Page Visibility\n     */\n\n    (function() {\n        var hiddenProp;\n        var hiddenHint = false;\n\n        function visibility_change() {\n            var value = document[hiddenProp];\n            if (!hiddenProp || typeof value === \"undefined\")\n                value = false;\n            if (value === false)\n                value = hiddenHint;\n            if (cockpit.hidden !== value) {\n                cockpit.hidden = value;\n                cockpit.dispatchEvent(\"visibilitychange\");\n            }\n        }\n\n        if (typeof document.hidden !== \"undefined\") {\n            hiddenProp = \"hidden\";\n            document.addEventListener(\"visibilitychange\", visibility_change);\n        } else if (typeof document.mozHidden !== \"undefined\") {\n            hiddenProp = \"mozHidden\";\n            document.addEventListener(\"mozvisibilitychange\", visibility_change);\n        } else if (typeof document.msHidden !== \"undefined\") {\n            hiddenProp = \"msHidden\";\n            document.addEventListener(\"msvisibilitychange\", visibility_change);\n        } else if (typeof document.webkitHidden !== \"undefined\") {\n            hiddenProp = \"webkitHidden\";\n            document.addEventListener(\"webkitvisibilitychange\", visibility_change);\n        }\n\n        /*\n         * Wait for changes in visibility of just our iframe. These are delivered\n         * via a hint message from the parent. For now we are the only handler of\n         * hint messages, so this is implemented rather simply on purpose.\n         */\n        process_hints = function(data) {\n            if (\"hidden\" in data) {\n                hiddenHint = data.hidden;\n                visibility_change();\n            }\n        };\n\n        /* The first time */\n        visibility_change();\n    }());\n\n    /* ---------------------------------------------------------------------\n     * Spawning\n     *\n     * Public: https://files.cockpit-project.org/guide/api-cockpit.html\n     */\n\n    function ProcessError(options, name) {\n        this.problem = options.problem || null;\n        this.exit_status = options[\"exit-status\"];\n        if (this.exit_status === undefined)\n            this.exit_status = null;\n        this.exit_signal = options[\"exit-signal\"];\n        if (this.exit_signal === undefined)\n            this.exit_signal = null;\n        this.message = options.message;\n\n        if (this.message === undefined) {\n            if (this.problem)\n                this.message = cockpit.message(options.problem);\n            else if (this.exit_signal !== null)\n                this.message = cockpit.format(_(\"$0 killed with signal $1\"), name, this.exit_signal);\n            else if (this.exit_status !== undefined)\n                this.message = cockpit.format(_(\"$0 exited with code $1\"), name, this.exit_status);\n            else\n                this.message = cockpit.format(_(\"$0 failed\"), name);\n        } else {\n            this.message = this.message.trim();\n        }\n\n        this.toString = function() {\n            return this.message;\n        };\n    }\n\n    function spawn_debug() {\n        if (window.debugging == \"all\" || window.debugging == \"spawn\")\n            console.debug.apply(console, arguments);\n    }\n\n    /* public */\n    cockpit.spawn = function(command, options) {\n        var dfd = cockpit.defer();\n\n        var args = { \"payload\": \"stream\", \"spawn\": [] };\n        if (command instanceof Array) {\n            for (var i = 0; i < command.length; i++)\n                args[\"spawn\"].push(String(command[i]));\n        } else {\n            args[\"spawn\"].push(String(command));\n        }\n        if (options !== undefined)\n            extend(args, options);\n\n        var name = args[\"spawn\"][0] || \"process\";\n        var channel = cockpit.channel(args);\n\n        /* Callback that wants a stream response, see below */\n        var buffer = channel.buffer(null);\n\n        channel.addEventListener(\"close\", function(event, options) {\n            var data = buffer.squash();\n            spawn_debug(\"process closed:\", JSON.stringify(options));\n            if (data)\n                spawn_debug(\"process output:\", data);\n            if (options.message !== undefined)\n                spawn_debug(\"process error:\", options.message);\n\n            if (options.problem)\n                dfd.reject(new ProcessError(options, name));\n            else if (options[\"exit-status\"] || options[\"exit-signal\"])\n                dfd.reject(new ProcessError(options, name), data);\n            else if (options.message !== undefined)\n                dfd.resolve(data, options.message);\n            else\n                dfd.resolve(data);\n        });\n\n        var ret = dfd.promise;\n        ret.stream = function(callback) {\n            buffer.callback = callback;\n            return this;\n        };\n\n        ret.input = function(message, stream) {\n            if (message !== null && message !== undefined) {\n                spawn_debug(\"process input:\", message);\n                channel.send(message);\n            }\n            if (!stream)\n                channel.control({ command: \"done\" });\n            return this;\n        };\n\n        ret.close = function(problem) {\n            spawn_debug(\"process closing:\", problem);\n            if (channel.valid)\n                channel.close(problem);\n            return this;\n        };\n\n        return ret;\n    };\n\n    /* public */\n    cockpit.script = function(script, args, options) {\n        if (!options && is_plain_object(args)) {\n            options = args;\n            args = [];\n        }\n        var command = [ \"/bin/sh\", \"-c\", script, \"--\" ];\n        command.push.apply(command, args);\n        return cockpit.spawn(command, options);\n    };\n\n    function dbus_debug() {\n        if (window.debugging == \"all\" || window.debugging == \"dbus\")\n            console.debug.apply(console, arguments);\n    }\n\n    function DBusError(arg) {\n        if (typeof(arg) == \"string\") {\n            this.problem = arg;\n            this.name = null;\n            this.message = cockpit.message(arg);\n        } else {\n            this.problem = null;\n            this.name = arg[0];\n            this.message = arg[1][0] || arg[0];\n        }\n        this.toString = function() {\n            return this.message;\n        };\n    }\n\n    function DBusCache() {\n        var self = this;\n\n        var callbacks = [ ];\n        self.data = { };\n        self.meta = { };\n\n        self.connect = function connect(path, iface, callback, first) {\n            var cb = [path, iface, callback];\n            if (first)\n                callbacks.unshift(cb);\n            else\n                callbacks.push(cb);\n            return {\n                remove: function remove() {\n                    var i, length = callbacks.length;\n                    for (i = 0; i < length; i++) {\n                        var cb = callbacks[i];\n                        if (cb[0] === path && cb[1] === iface && cb[2] === callback) {\n                            delete cb[i];\n                            break;\n                        }\n                    }\n                }\n            };\n        };\n\n        function emit(path, iface, props) {\n            var copy = callbacks.slice();\n            var i, length = copy.length;\n            for (i = 0; i < length; i++) {\n                var cb = copy[i];\n                if ((!cb[0] || cb[0] === path) &&\n                    (!cb[1] || cb[1] === iface)) {\n                    cb[2](props, path);\n                }\n            }\n        }\n\n        self.update = function update(path, iface, props) {\n            if (!self.data[path])\n                self.data[path] = { };\n            if (!self.data[path][iface])\n                self.data[path][iface] = props;\n            else\n                props = extend(self.data[path][iface], props);\n            emit(path, iface, props);\n        };\n\n        self.remove = function remove(path, iface) {\n            if (self.data[path]) {\n                delete self.data[path][iface];\n                emit(path, iface, null);\n            }\n        };\n\n        self.lookup = function lookup(path, iface) {\n            if (self.data[path])\n                return self.data[path][iface];\n            return undefined;\n        };\n\n        self.each = function each(iface, callback) {\n            var path, ifa;\n            for (path in self.data) {\n                for (iface in self.data[path]) {\n                    if (ifa == iface)\n                        callback(self.data[path][iface], path);\n                }\n            }\n        };\n\n        self.close = function close() {\n            self.data = { };\n            var copy = callbacks;\n            callbacks = [ ];\n            var i, length = copy.length;\n            for (i = 0; i < length; i++)\n                copy[i].callback();\n        };\n    }\n\n    function DBusProxy(client, cache, iface, path, options) {\n        var self = this;\n        event_mixin(self, { });\n\n        var valid = false;\n        var defined = false;\n        var waits = cockpit.defer();\n\n        /* No enumeration on these properties */\n        Object.defineProperties(self, {\n            \"client\": { value: client, enumerable: false, writable: false },\n            \"path\": { value: path, enumerable: false, writable: false },\n            \"iface\": { value: iface, enumerable: false, writable: false },\n            \"valid\": { get: function() { return valid; }, enumerable: false },\n            \"wait\": { enumerable: false, writable: false,\n                value: function(func) {\n                    if (func)\n                        waits.promise.always(func);\n                    return waits.promise;\n                }\n            },\n            \"call\": { value: function(name, args) { return client.call(path, iface, name, args); },\n                      enumerable: false, writable: false },\n            \"data\": { value: { }, enumerable: false }\n        });\n\n        if (typeof window.$ === \"function\") {\n            Object.defineProperty(self, window.$.expando, {\n                value: { }, writable: true, enumerable: false\n            });\n        }\n\n        if (!options)\n            options = { };\n\n        function define() {\n            if (!cache.meta[iface])\n                return;\n\n            var meta = cache.meta[iface];\n            defined = true;\n\n            Object.keys(meta.methods || { }).forEach(function(name) {\n                if (name[0].toLowerCase() == name[0])\n                    return; /* Only map upper case */\n\n                /* Again, make sure these don't show up in enumerations */\n                Object.defineProperty(self, name, {\n                    enumerable: false,\n                    value: function() {\n                        var dfd = cockpit.defer();\n                        client.call(path, iface, name, Array.prototype.slice.call(arguments)).\n                            done(function(reply) { dfd.resolve.apply(dfd, reply); }).\n                            fail(function(ex) { dfd.reject(ex); });\n                        return dfd.promise;\n                    }\n                });\n            });\n\n            Object.keys(meta.properties || { }).forEach(function(name) {\n                if (name[0].toLowerCase() == name[0])\n                    return; /* Only map upper case */\n\n                var config = {\n                    enumerable: true,\n                    get: function() { return self.data[name]; },\n                    set: function(v) { throw name + \"is not writable\"; }\n                };\n\n                var prop = meta.properties[name];\n                if (prop.flags && prop.flags.indexOf('w') !== -1) {\n                    config.set = function(v) {\n                        client.call(path, \"org.freedesktop.DBus.Properties\", \"Set\",\n                                [ iface, name, cockpit.variant(prop.type, v) ]).\n                            fail(function(ex) {\n                                console.log(\"Couldn't set \" + iface + \" \" + name +\n                                            \" at \" + path + \": \" + ex);\n                            });\n                    };\n                }\n\n                /* Again, make sure these don't show up in enumerations */\n                Object.defineProperty(self, name, config);\n            });\n        }\n\n        function update(props) {\n            if (props) {\n                extend(self.data, props);\n                if (!defined)\n                    define();\n                valid = true;\n            } else {\n                valid = false;\n            }\n            self.dispatchEvent(\"changed\", props);\n        }\n\n        cache.connect(path, iface, update, true);\n        update(cache.lookup(path, iface));\n\n        function signal(path, iface, name, args) {\n            self.dispatchEvent(\"signal\", name, args);\n            if (name[0].toLowerCase() != name[0]) {\n                args = args.slice();\n                args.unshift(name);\n                self.dispatchEvent.apply(self, args);\n            }\n        }\n\n        client.subscribe({ \"path\": path, \"interface\": iface }, signal, options.subscribe !== false);\n\n        function waited(ex) {\n            if (valid)\n                waits.resolve();\n            else\n                waits.reject(ex);\n        }\n\n        /* If watching then do a proper watch, otherwise object is done */\n        if (options.watch !== false)\n            client.watch({ \"path\": path, \"interface\": iface }).always(waited);\n        else\n            waited();\n    }\n\n    function DBusProxies(client, cache, iface, path_namespace, options) {\n        var self = this;\n        event_mixin(self, { });\n\n        var waits;\n\n        Object.defineProperties(self, {\n            \"client\": { value: client, enumerable: false, writable: false },\n            \"iface\": { value: iface, enumerable: false, writable: false },\n            \"path_namespace\": { value: path_namespace, enumerable: false, writable: false },\n            \"wait\": { enumerable: false, writable: false,\n                value: function(func) {\n                    if (func)\n                        waits.always(func);\n                    return waits;\n                }\n            }\n        });\n\n        if (typeof window.$ === \"function\") {\n            Object.defineProperty(self, window.$.expando, {\n                value: { }, writable: true, enumerable: false\n            });\n        }\n\n        /* Subscribe to signals once for all proxies */\n        var match = { \"interface\": iface, \"path_namespace\": path_namespace };\n\n        /* Callbacks added by proxies */\n        client.subscribe(match);\n\n        /* Watch for property changes */\n        if (options.watch !== false) {\n            waits = client.watch(match);\n        } else {\n            waits = cockpit.defer().resolve().promise;\n        }\n\n        /* Already added watch/subscribe, tell proxies not to */\n        options = extend({ watch: false, subscribe: false }, options);\n\n        function update(props, path) {\n            var proxy = self[path];\n            if (!path) {\n                return;\n            } else if (!props && proxy) {\n                delete self[path];\n                self.dispatchEvent(\"removed\", proxy);\n            } else if (props) {\n                if (!proxy) {\n                    proxy = self[path] = client.proxy(iface, path, options);\n                    self.dispatchEvent(\"added\", proxy);\n                }\n                self.dispatchEvent(\"changed\", proxy);\n            }\n        }\n\n        cache.connect(null, iface, update, false);\n        cache.each(iface, update);\n    }\n\n    function DBusClient(name, options) {\n        var self = this;\n        event_mixin(self, { });\n\n        var args = { };\n        var track = false;\n        var owner = null;\n\n        if (options) {\n            if (options.track)\n                track = true;\n\n            delete options['track'];\n            extend(args, options);\n        }\n        args.payload = \"dbus-json3\";\n        args.name = name;\n        self.options = options;\n\n        dbus_debug(\"dbus open: \", args);\n\n        var channel = cockpit.channel(args);\n        var subscribers = { };\n        var calls = { };\n        var cache;\n\n        /* The problem we closed with */\n        var closed;\n\n        self.constructors = { \"*\": DBusProxy };\n\n        function ensure_cache() {\n            if (!cache)\n                cache = new DBusCache();\n        }\n\n        function matches(signal, match) {\n            if (match.path && signal[0] !== match.path)\n                return false;\n            if (match.path_namespace && signal[0].indexOf(match.path_namespace) !== 0)\n                return false;\n            if (match[\"interface\"] && signal[1] !== match[\"interface\"])\n                return false;\n            if (match.member && signal[2] !== match.member)\n                return false;\n            if (match.arg0 && signal[3] !== match.arg0)\n                return false;\n            return true;\n        }\n\n        function on_message(event, payload) {\n            dbus_debug(\"dbus:\", payload);\n            var msg;\n            try {\n                msg = JSON.parse(payload);\n            } catch(ex) {\n                console.warn(\"received invalid dbus json message:\", ex);\n            }\n            if (msg === undefined) {\n                channel.close({\"problem\": \"protocol-error\"});\n                return;\n            }\n            var dfd, options;\n            if (msg.id !== undefined)\n                dfd = calls[msg.id];\n            if (msg.reply) {\n                if (dfd) {\n                    options = { };\n                    if (msg.type)\n                        options.type = msg.type;\n                    if (msg.flags)\n                        options.flags = msg.flags;\n                    dfd.resolve(msg.reply[0] || [], options);\n                    delete calls[msg.id];\n                }\n                return;\n\n            } else if (msg.error) {\n                if (dfd) {\n                    dfd.reject(new DBusError(msg.error));\n                    delete calls[msg.id];\n                }\n                return;\n            }\n\n            /*\n             * The above promise resolutions or failures are triggered via\n             * later_invoke(). In order to preserve ordering guarantees we\n             * also have to process other events that way too.\n             */\n            later_invoke(function() {\n                var id, subscription;\n                if (msg.signal) {\n                    for (id in subscribers) {\n                        subscription = subscribers[id];\n                        if (subscription.callback) {\n                            if (matches(msg.signal, subscription.match))\n                                subscription.callback.apply(self, msg.signal);\n                        }\n                    }\n                } else if (msg.notify) {\n                    notify(msg.notify);\n                } else if (msg.meta) {\n                    meta(msg.meta);\n                } else if (msg.owner !== undefined) {\n                    self.dispatchEvent(\"owner\", msg.owner);\n\n                    /*\n                     * We won't get this signal with the same\n                     * owner twice so if we've seen an owner\n                     * before that means it has changed.\n                     */\n                    if (track && owner)\n                        self.close();\n\n                    owner = msg.owner;\n                } else {\n                    dbus_debug(\"received unexpected dbus json message:\", payload);\n                }\n            });\n        }\n\n        function meta(data) {\n            ensure_cache();\n            extend(cache.meta, data);\n            self.dispatchEvent(\"meta\", data);\n        }\n\n        function notify(data) {\n            ensure_cache();\n            var path, iface, props;\n            for (path in data) {\n                for (iface in data[path]) {\n                    props = data[path][iface];\n                    if (!props)\n                        cache.remove(path, iface);\n                    else\n                        cache.update(path, iface, props);\n                }\n            }\n            self.dispatchEvent(\"notify\", data);\n        }\n\n        this.notify = notify;\n\n        function close_perform(options) {\n            closed = options.problem || \"disconnected\";\n            var id, outstanding = calls;\n            calls = { };\n            for (id in outstanding) {\n                outstanding[id].reject(new DBusError(closed));\n            }\n            self.dispatchEvent(\"close\", options);\n        }\n\n        this.close = function close(options) {\n            if (typeof options == \"string\")\n                options = { \"problem\": options };\n            if (!options)\n                options = { };\n            if (channel)\n                channel.close(options);\n            else\n                close_perform(options);\n        };\n\n        function on_close(event, options) {\n            dbus_debug(\"dbus close:\", options);\n            channel.removeEventListener(\"message\", on_message);\n            channel.removeEventListener(\"close\", on_close);\n            channel = null;\n            close_perform(options);\n        }\n\n        channel.addEventListener(\"message\", on_message);\n        channel.addEventListener(\"close\", on_close);\n\n        var last_cookie = 1;\n\n        this.call = function call(path, iface, method, args, options) {\n            var dfd = cockpit.defer();\n            var id = String(last_cookie);\n            last_cookie++;\n            var method_call = {\n                \"call\": [ path, iface, method, args || [] ],\n                \"id\": id\n            };\n            if (options) {\n                if (options.type)\n                    method_call.type = options.type;\n                if (options.flags !== undefined)\n                    method_call.flags = options.flags;\n            }\n\n            var msg = JSON.stringify(method_call);\n            dbus_debug(\"dbus:\", msg);\n\n            if (channel) {\n                channel.send(msg);\n                calls[id] = dfd;\n            } else {\n                dfd.reject(new DBusError(closed));\n            }\n\n            return dfd.promise;\n        };\n\n        this.subscribe = function subscribe(match, callback, rule) {\n            var subscription = {\n                match: match || { },\n                callback: callback\n            };\n\n            if (rule !== false && channel && channel.valid) {\n                var msg = JSON.stringify({ \"add-match\": subscription.match });\n                dbus_debug(\"dbus:\", msg);\n                channel.send(msg);\n            }\n\n            var id;\n            if (callback) {\n                id = String(last_cookie);\n                last_cookie++;\n                subscribers[id] = subscription;\n            }\n\n            return {\n                remove: function() {\n                    var prev;\n                    if (id) {\n                        prev = subscribers[id];\n                        if (prev)\n                            delete subscribers[id];\n                    }\n                    if (rule !== false && channel && channel.valid && prev) {\n                        var msg = JSON.stringify({ \"remove-match\": prev.match });\n                        dbus_debug(\"dbus:\", msg);\n                        channel.send(msg);\n                    }\n                }\n            };\n        };\n\n        self.watch = function watch(path) {\n            var match;\n            if (is_plain_object(path))\n                match = path;\n            else\n                match = { path: String(path) };\n\n            var id = String(last_cookie);\n            last_cookie++;\n            var dfd = cockpit.defer();\n            calls[id] = dfd;\n\n            var msg = JSON.stringify({ \"watch\": match, \"id\": id });\n            if (channel && channel.valid) {\n                dbus_debug(\"dbus:\", msg);\n                channel.send(msg);\n            } else {\n                dfd.reject(new DBusError(closed));\n            }\n\n            var ret = dfd.promise;\n            ret.remove = function remove() {\n                delete calls[id];\n                if (channel && channel.valid) {\n                    msg = JSON.stringify({ \"unwatch\": match });\n                    dbus_debug(\"dbus:\", msg);\n                    channel.send(msg);\n                }\n            };\n            return ret;\n        };\n\n        self.proxy = function proxy(iface, path, options) {\n            if (!iface)\n                iface = name;\n            iface = String(iface);\n            if (!path)\n                path = \"/\" + iface.replace(/\\./g, \"/\");\n            var Constructor = self.constructors[iface];\n            if (!Constructor)\n                Constructor = self.constructors[\"*\"];\n            if (!options)\n                options = { };\n            ensure_cache();\n            return new Constructor(self, cache, iface, String(path), options);\n        };\n\n        self.proxies = function proxies(iface, path_namespace, options) {\n            if (!iface)\n                iface = name;\n            if (!path_namespace)\n                path_namespace = \"/\";\n            if (!options)\n                options = { };\n            ensure_cache();\n            return new DBusProxies(self, cache, String(iface), String(path_namespace), options);\n        };\n\n    }\n\n    /* public */\n    cockpit.dbus = function dbus(name, options) {\n        return new DBusClient(name, options);\n    };\n\n    cockpit.variant = function variant(type, value) {\n        return { 'v': value, 't': type };\n    };\n\n    cockpit.byte_array = function byte_array(string) {\n        return window.btoa(string);\n    };\n\n    /* File access\n     */\n\n    cockpit.file = function file(path, options) {\n        options = options || { };\n        var binary = options.binary;\n\n        var self = {\n            path: path,\n            read: read,\n            replace: replace,\n            modify: modify,\n\n            watch: watch,\n\n            close: close\n        };\n\n        var base_channel_options = extend({ }, options);\n        delete base_channel_options.syntax;\n\n        function parse(str) {\n            if (options.syntax && options.syntax.parse)\n                return options.syntax.parse(str);\n            else\n                return str;\n        }\n\n        function stringify(obj) {\n            if (options.syntax && options.syntax.stringify)\n                return options.syntax.stringify(obj);\n            else\n                return obj;\n        }\n\n        var read_promise = null;\n        var read_channel;\n\n        function read() {\n            if (read_promise)\n                return read_promise;\n\n            var dfd = cockpit.defer();\n            var opts = extend({ }, base_channel_options, {\n                payload: \"fsread1\",\n                path: path\n            });\n\n            function try_read() {\n                read_channel = cockpit.channel(opts);\n                var content_parts = [ ];\n                read_channel.addEventListener(\"message\", function (event, message) {\n                    content_parts.push(message);\n                });\n                read_channel.addEventListener(\"close\", function (event, message) {\n                    read_channel = null;\n\n                    if (message.problem == \"change-conflict\") {\n                        try_read();\n                        return;\n                    }\n\n                    read_promise = null;\n\n                    if (message.problem) {\n                        var error = new BasicError(message.problem, message.message);\n                        fire_watch_callbacks(null, null, error);\n                        dfd.reject(error);\n                        return;\n                    }\n\n                    var content;\n                    if (message.tag == \"-\")\n                        content = null;\n                    else {\n                        try {\n                            content = parse(join_data(content_parts, binary));\n                        } catch (e) {\n                            fire_watch_callbacks(null, null, e);\n                            dfd.reject(e);\n                            return;\n                        }\n                    }\n\n                    fire_watch_callbacks(content, message.tag);\n                    dfd.resolve(content, message.tag);\n                });\n            }\n\n            try_read();\n\n            read_promise = dfd.promise;\n            return read_promise;\n        }\n\n        var replace_channel = null;\n\n        function replace(new_content, expected_tag) {\n            var dfd = cockpit.defer();\n\n            var file_content;\n            try {\n                if (new_content === null)\n                    file_content = null;\n                else\n                    file_content = stringify(new_content);\n            }\n            catch (e) {\n                dfd.reject(e);\n                return dfd.promise;\n            }\n\n            if (replace_channel)\n                replace_channel.close(\"abort\");\n\n            var opts = extend({ }, base_channel_options, {\n                payload: \"fsreplace1\",\n                path: path,\n                tag: expected_tag\n            });\n            replace_channel = cockpit.channel(opts);\n\n            replace_channel.addEventListener(\"close\", function (event, message) {\n                replace_channel = null;\n                if (message.problem) {\n                    dfd.reject(new BasicError(message.problem, message.message));\n                } else {\n                    fire_watch_callbacks(new_content, message.tag);\n                    dfd.resolve(message.tag);\n                }\n            });\n\n            var len = 0, binary = false;\n            if (file_content) {\n                if (file_content.byteLength) {\n                    len = file_content.byteLength;\n                    binary = true;\n                } else if (file_content.length) {\n                    len = file_content.length;\n                }\n            }\n\n            var i, n, batch = 16 * 1024;\n            for (i = 0; i < len; i += batch) {\n                n = Math.min(len - i, batch);\n                if (binary)\n                    replace_channel.send(new window.Uint8Array(file_content.buffer, i, n));\n                else\n                    replace_channel.send(file_content.substr(i, n));\n            }\n\n            replace_channel.control({ command: \"done\" });\n            return dfd.promise;\n        }\n\n        function modify(callback, initial_content, initial_tag) {\n            var dfd = cockpit.defer();\n\n            function update(content, tag) {\n                var new_content = callback(content);\n                if (new_content === undefined)\n                    new_content = content;\n                replace(new_content, tag).\n                    done(function (new_tag) {\n                        dfd.resolve(new_content, new_tag);\n                    }).\n                    fail(function (error) {\n                        if (error.problem == \"change-conflict\")\n                            read_then_update();\n                        else\n                            dfd.reject(error);\n                    });\n            }\n\n            function read_then_update() {\n                read().\n                    done(update).\n                    fail (function (error) {\n                        dfd.reject(error);\n                    });\n            }\n\n            if (initial_content === undefined)\n                read_then_update();\n            else\n                update(initial_content, initial_tag);\n\n            return dfd.promise;\n        }\n\n        var watch_callbacks = [];\n        var n_watch_callbacks = 0;\n\n        var watch_channel = null;\n        var watch_tag;\n\n        function ensure_watch_channel() {\n            if (n_watch_callbacks > 0) {\n                if (watch_channel)\n                    return;\n\n                var opts = extend({ }, base_channel_options, {\n                    payload: \"fswatch1\",\n                    path: path\n                });\n                watch_channel = cockpit.channel(opts);\n                watch_channel.addEventListener(\"message\", function (event, message_string) {\n                    var message;\n                    try      { message = JSON.parse(message_string); }\n                    catch(e) { message = null; }\n                    if (message && message.path == path && message.tag && message.tag != watch_tag)\n                        read();\n                });\n            } else {\n                if (watch_channel) {\n                    watch_channel.close();\n                    watch_channel = null;\n                }\n            }\n        }\n\n        function fire_watch_callbacks(/* content, tag, error */) {\n            watch_tag = arguments[1] || null;\n            invoke_functions(watch_callbacks, self, arguments);\n        }\n\n        function watch(callback) {\n            if (callback)\n                watch_callbacks.push(callback);\n            n_watch_callbacks += 1;\n            ensure_watch_channel();\n\n            watch_tag = null;\n            read();\n\n            return {\n                remove: function () {\n                    var index;\n                    if (callback) {\n                        index = watch_callbacks.indexOf(callback);\n                        if (index > -1)\n                            watch_callbacks[index] = null;\n                    }\n                    n_watch_callbacks -= 1;\n                    ensure_watch_channel();\n                }\n            };\n        }\n\n        function close() {\n            if (read_channel)\n                read_channel.close(\"cancelled\");\n            if (replace_channel)\n                replace_channel.close(\"cancelled\");\n            if (watch_channel)\n                watch_channel.close(\"cancelled\");\n        }\n\n        return self;\n    };\n\n    /* ---------------------------------------------------------------------\n     * Localization\n     */\n\n    var po_data = { };\n    var po_plural;\n\n    cockpit.language = undefined;\n\n    cockpit.locale = function locale(po) {\n        var lang = cockpit.language || \"en\";\n        var header;\n\n        if (po) {\n            extend(po_data, po);\n            header = po[\"\"];\n        } else if (po === null) {\n            po_data = { };\n        }\n\n        if (header) {\n            if (header[\"plural-forms\"])\n                po_plural = header[\"plural-forms\"];\n            if (header[\"language\"])\n                lang = header[\"language\"];\n        }\n\n        cockpit.language = lang;\n    };\n\n    cockpit.translate = function translate(/* ... */) {\n\tvar what;\n\n        /* Called without arguments, entire document */\n\tif (arguments.length === 0)\n            what = [ document ];\n\n        /* Called with a single array like argument */\n        else if (arguments.length === 1 && arguments[0].length)\n            what = arguments[0];\n\n        /* Called with 1 or more element arguments */\n        else\n            what = arguments;\n\n        /* Translate all the things */\n        var w, wlen, val, i, ilen, t, tlen, list, tasks, el;\n\tfor (w = 0, wlen = what.length; w < wlen; w++) {\n\n            /* The list of things to translate */\n            list = null;\n            if (what[w].querySelectorAll)\n                list = what[w].querySelectorAll(\"[translatable], [translate]\");\n            if (!list)\n                continue;\n\n            /* Each element */\n            for (i = 0, ilen = list.length; i < ilen; i++) {\n                el = list[i];\n\n                val = el.getAttribute(\"translate\") || el.getAttribute(\"translatable\") || \"yes\";\n                if (val == \"no\")\n                    continue;\n\n                /* Each thing to translate */\n                tasks = val.split(\" \");\n                val = el.getAttribute(\"translate-context\") || el.getAttribute(\"context\");\n                for (t = 0, tlen = tasks.length; t < tlen; t++) {\n                    if (tasks[t] == \"yes\" || tasks[t] == \"translate\")\n                        el.textContent = cockpit.gettext(val, el.textContent);\n                    else if (tasks[t])\n                        el.setAttribute(tasks[t], cockpit.gettext(val, el.getAttribute(tasks[t]) || \"\"));\n                }\n\n                /* Mark this thing as translated */\n                el.removeAttribute(\"translatable\");\n                el.removeAttribute(\"translate\");\n            }\n        }\n    };\n\n    cockpit.gettext = function gettext(context, string) {\n        /* Missing first parameter */\n        if (arguments.length == 1) {\n            string = context;\n            context = undefined;\n        }\n\n        var key = context ? context + '\\u0004' + string : string;\n        if (po_data) {\n            var translated = po_data[key];\n            if (translated && translated[1])\n                return translated[1];\n        }\n        return string;\n    };\n\n    function imply( val ) {\n        return (val === true ? 1 : val ? val : 0);\n    }\n\n    cockpit.ngettext = function ngettext(context, string1, stringN, num) {\n        /* Missing first parameter */\n        if (arguments.length == 3) {\n            num = stringN;\n            stringN = string1;\n            string1 = context;\n            context = undefined;\n        }\n\n        var key = context ? context + '\\u0004' + string1 : string1;\n        if (po_data && po_plural) {\n            var translated = po_data[key];\n            if (translated) {\n                var i = imply(po_plural(num)) + 1;\n                if (translated[i])\n                    return translated[i];\n            }\n        }\n        if (num == 1)\n            return string1;\n        return stringN;\n    };\n\n    cockpit.noop = function noop(arg0, arg1) {\n        return arguments[arguments.length - 1];\n    };\n\n    /* Only for _() calls here in the cockpit code */\n    var _ = cockpit.gettext;\n\n    cockpit.message = function message(arg) {\n        if (arg.message)\n            return arg.message;\n\n        var problem = null;\n        if (arg.problem)\n            problem = arg.problem;\n        else\n            problem = arg + \"\";\n        if (problem == \"terminated\")\n            return _(\"Your session has been terminated.\");\n        else if (problem == \"no-session\")\n            return _(\"Your session has expired. Please log in again.\");\n        else if (problem == \"access-denied\")\n            return _(\"Not permitted to perform this action.\");\n        else if (problem == \"authentication-failed\")\n            return _(\"Login failed\");\n        else if (problem == \"authentication-not-supported\")\n            return _(\"The server refused to authenticate using any supported methods.\");\n        else if (problem == \"unknown-hostkey\")\n            return _(\"Untrusted host\");\n        else if (problem == \"invalid-hostkey\")\n            return _(\"Host key is incorrect\");\n        else if (problem == \"internal-error\")\n            return _(\"Internal error\");\n        else if (problem == \"timeout\")\n            return _(\"Connection has timed out.\");\n        else if (problem == \"no-cockpit\")\n            return _(\"Cockpit is not installed on the system.\");\n        else if (problem == \"no-forwarding\")\n            return _(\"Cannot forward login credentials\");\n        else if (problem == \"disconnected\")\n            return _(\"Server has closed the connection.\");\n        else if (problem == \"not-supported\")\n            return _(\"Cockpit is not compatible with the software on the system.\");\n        else if (problem == \"no-host\")\n            return _(\"Cockpit could not contact the given host.\");\n        else\n            return problem;\n    };\n\n    function HttpError(arg0, arg1, message) {\n        this.status = parseInt(arg0, 10);\n        this.reason = arg1;\n        this.message = message || arg1;\n        this.problem = null;\n\n        this.valueOf = function() {\n            return this.status;\n        };\n        this.toString = function() {\n            return this.status + \" \" + this.message;\n        };\n    }\n\n    function http_debug() {\n        if (window.debugging == \"all\" || window.debugging == \"http\")\n            console.debug.apply(console, arguments);\n    }\n\n    function find_header(headers, name) {\n        if (!headers)\n            return undefined;\n        name = name.toLowerCase();\n        for (var head in headers) {\n            if (head.toLowerCase() == name)\n                return headers[head];\n        }\n        return undefined;\n    }\n\n    function HttpClient(endpoint, options) {\n        var self = this;\n\n        self.options = options;\n        options.payload = \"http-stream1\";\n\n        var active_requests = [ ];\n\n        if (endpoint !== undefined) {\n            if (endpoint.indexOf && endpoint.indexOf(\"/\") === 0) {\n                options.unix = endpoint;\n            } else {\n                var port = parseInt(endpoint, 10);\n                if (!isNaN(port))\n                    options.port = port;\n                else\n                    throw \"The endpoint must be either a unix path or port number\";\n            }\n        }\n\n        if (options.address) {\n            if (!options.capabilities)\n                options.capabilities = [];\n            options.capabilities.push(\"address\");\n        }\n\n        function param(obj) {\n            return Object.keys(obj).map(function(k) {\n                return encodeURIComponent(k) + '=' + encodeURIComponent(obj[k]);\n            }).join('&').split('%20').join('+'); /* split/join because phantomjs */\n        }\n\n        self.request = function request(req) {\n            var dfd = cockpit.defer();\n\n            if (!req.path)\n                req.path = \"/\";\n            if (!req.method)\n                req.method = \"GET\";\n            if (req.params) {\n                if (req.path.indexOf(\"?\") === -1)\n                    req.path += \"?\" + param(req.params);\n                else\n                    req.path += \"&\" + param(req.params);\n            }\n            delete req.params;\n\n            var input = req.body;\n            delete req.body;\n\n            var headers = req.headers;\n            delete req.headers;\n\n            extend(req, options);\n\n            /* Combine the headers */\n            if (options.headers && headers)\n                req.headers = extend({ }, options.headers, headers);\n            else if (options.headers)\n                req.headers = options.headers;\n            else\n                req.headers = headers;\n\n            http_debug(\"http request:\", JSON.stringify(req));\n\n            /* We need a channel for the request */\n            var channel = cockpit.channel(req);\n\n            if (input !== undefined) {\n                if (input !== \"\") {\n                    http_debug(\"http input:\", input);\n                    channel.send(input);\n                }\n                http_debug(\"http done\");\n                channel.control({ command: \"done\" });\n            }\n\n            /* Callbacks that want to stream or get headers */\n            var streamer = null;\n            var responsers = null;\n\n            var count = 0;\n            var resp = null;\n\n            var buffer = channel.buffer(function(data) {\n                count += 1;\n\n                if (count === 1) {\n                    if (channel.binary)\n                        data = cockpit.utf8_decoder().decode(data);\n                    resp = JSON.parse(data);\n\n                    /* Anyone looking for response details? */\n                    if (responsers) {\n                        resp.headers = resp.headers || { };\n                        invoke_functions(responsers, self, [resp.status, resp.headers]);\n                    }\n                    return true;\n                }\n\n                /* Fire any streamers */\n                if (resp.status >= 200 && resp.status <= 299 && streamer)\n                    return streamer(data);\n\n                return 0;\n            });\n\n            function on_close(event, options) {\n                var pos = active_requests.indexOf(ret);\n                if (pos >= 0)\n                    active_requests.splice(pos, 1);\n\n                if (options.problem) {\n                    http_debug(\"http problem: \", options.problem);\n                    dfd.reject(new BasicError(options.problem));\n\n                } else {\n                    var body = buffer.squash();\n\n                    /* An error, fail here */\n                    if (resp && (resp.status < 200 || resp.status > 299)) {\n                        var message;\n                        var type = find_header(resp.headers, \"Content-Type\");\n                        if (type && !channel.binary) {\n                            if (type.indexOf(\"text/plain\") === 0)\n                                message = body;\n                        }\n                        http_debug(\"http status: \", resp.status);\n                        dfd.reject(new HttpError(resp.status, resp.reason, message), body);\n\n                    } else {\n                        http_debug(\"http done\");\n                        dfd.resolve(body);\n                    }\n                }\n\n                channel.removeEventListener(\"close\", on_close);\n            }\n\n            channel.addEventListener(\"close\", on_close);\n\n            var ret = dfd.promise;\n            ret.stream = function(callback) {\n                streamer = callback;\n                return ret;\n            };\n            ret.response = function(callback) {\n                if (responsers === null)\n                    responsers = [];\n                responsers.push(callback);\n                return ret;\n            };\n            ret.input = function(message, stream) {\n                if (message !== null && message !== undefined) {\n                    http_debug(\"http input:\", message);\n                    channel.send(message);\n                }\n                if (!stream) {\n                    http_debug(\"http done\");\n                    channel.control({ command: \"done\" });\n                }\n                return ret;\n            };\n            ret.close = function(problem) {\n                http_debug(\"http closing:\", problem);\n                channel.close(problem);\n                return ret;\n            };\n\n            active_requests.push(ret);\n            return ret;\n        };\n\n        self.get = function get(path, params, headers) {\n            return self.request({\n                \"method\": \"GET\",\n                \"params\": params,\n                \"path\": path,\n                \"body\": \"\",\n                \"headers\": headers\n            });\n        };\n\n        self.post = function post(path, body, headers) {\n            headers = headers || { };\n\n            if (is_plain_object(body) || is_array(body)) {\n                body = JSON.stringify(body);\n                if (find_header(headers, \"Content-Type\") === undefined)\n                    headers[\"Content-Type\"] = \"application/json\";\n            } else if (body === undefined || body === null) {\n                body = \"\";\n            } else if (typeof body !== \"string\") {\n                body = String(body);\n            }\n\n            return self.request({\n                \"method\": \"POST\",\n                \"path\": path,\n                \"body\": body,\n                \"headers\": headers\n            });\n        };\n\n        self.close = function close(problem) {\n            var reqs = active_requests.slice();\n            for (var i = 0; i < reqs.length; i++)\n                reqs[i].close(problem);\n        };\n\n    }\n\n    /* public */\n    cockpit.http = function(endpoint, options) {\n        if (is_plain_object(endpoint) && options === undefined) {\n            options = endpoint;\n            endpoint = undefined;\n        }\n        return new HttpClient(endpoint, options || { });\n    };\n\n    /* ---------------------------------------------------------------------\n     * Permission\n     */\n\n    var authority = null;\n\n    function Permission(options) {\n        var self = this;\n        event_mixin(self, { });\n\n        self.allowed = null;\n        self.user = options ? options.user : null;\n\n        var group = null;\n        var admin = false;\n\n        if (options)\n            group = options.group;\n\n        if (options && options.admin)\n            admin = true;\n\n        function decide(user) {\n            if (user.id === 0)\n                return true;\n\n            if (user.groups) {\n                var allowed = false;\n                user.groups.forEach(function(name) {\n                    if (name == group) {\n                        allowed = true;\n                        return false;\n                    }\n                    if (admin && (name == \"wheel\" || name == \"sudo\")) {\n                        allowed = true;\n                        return false;\n                    }\n                });\n                return allowed;\n            }\n\n            if (user.id === undefined)\n                return null;\n\n            return false;\n        }\n\n        if (self.user) {\n            self.allowed = decide(self.user);\n        } else {\n            cockpit.user().done(function (user) {\n                self.user = user;\n                var allowed = decide(user);\n                if (self.allowed !== allowed) {\n                    self.allowed = allowed;\n                    self.dispatchEvent(\"changed\");\n                }\n            });\n        }\n\n        self.close = function close() {\n            /* no-op for now */\n        };\n    }\n\n    cockpit.permission = function permission(arg) {\n        return new Permission(arg);\n    };\n\n    /* ---------------------------------------------------------------------\n     * Metrics\n     *\n     */\n\n    function timestamp(when, interval) {\n        if (typeof when == \"number\")\n            return when * interval;\n        else if (typeof when == \"string\")\n            when = new Date(when);\n        if (when instanceof Date)\n            return when.getTime();\n        else\n            throw \"invalid date or offset\";\n    }\n\n    function MetricsChannel(interval, options_list, cache) {\n        var self = this;\n        event_mixin(self, { });\n\n        if (options_list.length === undefined)\n            options_list = [ options_list ];\n\n        var channels = [ ];\n        var following = false;\n\n        self.series = cockpit.series(interval, cache, fetch_for_series);\n        self.archives = null;\n        self.meta = null;\n\n        function fetch_for_series(beg, end, for_walking) {\n            if (!for_walking)\n                self.fetch(beg, end);\n            else\n                self.follow();\n        }\n\n        function transfer(options_list, callback, is_archive) {\n            if (options_list.length === 0)\n                return;\n\n            if (!is_archive) {\n                if (following)\n                    return;\n                following = true;\n            }\n\n            var options = extend({\n                payload: \"metrics1\",\n                interval: interval,\n                source: \"internal\"\n            }, options_list[0]);\n\n            delete options.archive_source;\n\n            var channel = cockpit.channel(options);\n            channels.push(channel);\n\n            var meta = null;\n            var last = null;\n            var beg;\n\n            channel.addEventListener(\"close\", function(ev, close_options) {\n                if (!is_archive)\n                    following = false;\n\n                if (options_list.length > 1 &&\n                    (close_options.problem == \"not-supported\" || close_options.problem == \"not-found\")) {\n                    transfer(options_list.slice(1), callback);\n                } else if (close_options.problem) {\n                    if (close_options.problem != \"terminated\" &&\n                        close_options.problem != \"disconnected\" &&\n                        close_options.problem != \"authentication-failed\" &&\n                        (close_options.problem != \"not-found\" || !is_archive) &&\n                        (close_options.problem != \"not-supported\" || !is_archive)) {\n                        console.warn(\"metrics channel failed: \" + close_options.problem);\n                    }\n                } else if (is_archive) {\n                    if (!self.archives) {\n                        self.archives = true;\n                        self.dispatchEvent('changed');\n                    }\n                }\n            });\n\n            channel.addEventListener(\"message\", function(ev, payload) {\n                var message = JSON.parse(payload);\n\n                var data, data_len, last_len, dataj, dataj_len, lastj, lastj_len;\n                var i, j, k;\n                var timestamp;\n\n                /* A meta message? */\n                var message_len = message.length;\n                if (message_len === undefined) {\n                    meta = message;\n                    timestamp = 0;\n                    if (meta.now && meta.timestamp)\n                        timestamp = meta.timestamp + (Date.now() - meta.now);\n                    beg = Math.floor(timestamp / interval);\n                    callback(beg, meta, null, options_list[0]);\n\n                    /* Trigger to outside interest that meta changed */\n                    self.meta = meta;\n                    self.dispatchEvent('changed');\n\n                /* A data message */\n                } else if (meta) {\n\n                    /* Data decompression */\n                    for (i = 0; i < message_len; i++) {\n                        data = message[i];\n                        if (last) {\n                            data_len = data.length;\n                            last_len = last.length;\n                            for (j = 0; j < last_len; j++) {\n                                dataj = data[j];\n                                if (dataj === null || dataj === undefined) {\n                                    data[j] = last[j];\n                                } else {\n                                    dataj_len = dataj.length;\n                                    if (dataj_len !== undefined) {\n                                        lastj = last[j];\n                                        lastj_len = last[j].length;\n                                        for (k = 0; k < dataj_len; k++) {\n                                            if (dataj[k] === null)\n                                                dataj[k] = lastj[k];\n                                        }\n                                        for (; k < lastj_len; k++)\n                                            dataj[k] = lastj[k];\n                                    }\n                                }\n                            }\n                        }\n                        last = data;\n                    }\n\n                    /* Return the data */\n                    callback(beg, meta, message, options_list[0]);\n\n                    /* Bump timestamp for the next message */\n                    beg += message_len;\n                    meta.timestamp += (interval * message_len);\n                }\n            });\n        }\n\n        function drain(beg, meta, message, options) {\n            var mapping, map, name;\n\n            /* Generate a mapping object if necessary */\n            mapping = meta.mapping;\n            if (!mapping) {\n                mapping = { };\n                meta.metrics.forEach(function(metric, i) {\n                    map = { \"\": i };\n                    if (options.metrics_path_names)\n                        name = options.metrics_path_names[i];\n                    else\n                        name = metric.name;\n                    mapping[name] = map;\n                    if (metric.instances) {\n                        metric.instances.forEach(function(instance, i) {\n                            if (instance === \"\")\n                                instance = \"/\";\n                            map[instance] = { \"\": i };\n                        });\n                    }\n                });\n                meta.mapping = mapping;\n            }\n\n            if (message)\n                self.series.input(beg, message, mapping);\n        }\n\n        self.fetch = function fetch(beg, end) {\n            var timestamp = beg * interval - Date.now();\n            var limit = end - beg;\n\n            var archive_options_list = [ ];\n            for (var i = 0; i < options_list.length; i++) {\n                if (options_list[i].archive_source) {\n                    archive_options_list.push(extend({}, options_list[i],\n                                                       { \"source\": options_list[i].archive_source,\n                                                         timestamp: timestamp,\n                                                         limit: limit\n                                                       }));\n                }\n            }\n\n            transfer(archive_options_list, drain, true);\n        };\n\n        self.follow = function follow() {\n            transfer(options_list, drain);\n        };\n\n        self.close = function close(options) {\n            var i, len = channels.length;\n            for (i = 0; i < len; i++)\n                channels[i].close(options);\n        };\n    }\n\n    cockpit.metrics = function metrics(interval, options) {\n        return new MetricsChannel(interval, options);\n    };\n\n    /* ---------------------------------------------------------------------\n     * Ooops handling.\n     *\n     * If we're embedded, send oops to parent frame. Since everything\n     * could be broken at this point, just do it manually, without\n     * involving cockpit.transport or any of that logic.\n     */\n\n    cockpit.oops = function oops() {\n        if (window.parent !== window && window.name.indexOf(\"cockpit1:\") === 0)\n            window.parent.postMessage(\"\\n{ \\\"command\\\": \\\"oops\\\" }\", transport_origin);\n    };\n\n    var old_onerror;\n\n    if (window.navigator.userAgent.indexOf(\"PhantomJS\") == -1) {\n        old_onerror = window.onerror;\n        window.onerror = function(msg, url, line) {\n            cockpit.oops();\n            if (old_onerror)\n                return old_onerror(msg, url, line);\n            return false;\n        };\n    }\n\n} /* scope end */\n\n/*\n * Register this script as a module and/or with globals\n */\n\nvar cockpit = { };\nevent_mixin(cockpit, { });\n\nvar basics = false;\nfunction factory() {\n    if (!basics) {\n        basic_scope(cockpit);\n        basics = true;\n    }\n    return cockpit;\n}\n\nvar self_module_id;\n\n/* Check how we're being loaded */\nvar last = document.scripts[document.scripts.length - 1].src || \"\";\nvar pos = last.indexOf(\"/cockpit.js\");\nif (pos === -1)\n    pos = last.indexOf(\"/cockpit.min.js\");\nif (pos !== -1)\n    pos = last.substring(0, pos).lastIndexOf(\"/\");\n\n/* cockpit.js is being loaded as a <script>  and no other loader around? */\nif (pos !== -1) {\n    self_module_id = last.substring(pos + 1, last.indexOf(\".\", pos + 1));\n    window.cockpit = factory();\n}\n\n/* Cockpit loaded via AMD loader */\nif (is_function(window.define) && window.define.amd) {\n    if (self_module_id)\n        define(self_module_id, [], window.cockpit);\n    else\n        define([], factory);\n}\n\n})();\n"]}