/* @preserve: WARNING: This javascript file in the base1 package is deprecated */
console.warn("Deprecated: " + (new Error().fileName || "This javascript file").split("/").reverse()[0] + " in the Cockpit base1 package is deprecated");

(function(e, t) {
    if (typeof exports === "object" && exports) {
        t(exports);
    } else {
        var r = {};
        t(r);
        if (typeof define === "function" && define.amd) {
            define(r);
        } else {
            e.Mustache = r;
        }
    }
})(this, function(e) {
    var t = /\s*/;
    var r = /\s+/;
    var n = /\S/;
    var i = /\s*=/;
    var s = /\s*\}/;
    var a = /#|\^|\/|>|\{|&|=|!/;
    var o = RegExp.prototype.test;
    function c(e, t) {
        return o.call(e, t);
    }
    function l(e) {
        return !c(n, e);
    }
    var h = Object.prototype.toString;
    var f = Array.isArray || function(e) {
        return h.call(e) === "[object Array]";
    };
    function u(e) {
        return typeof e === "function";
    }
    function p(e) {
        return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&");
    }
    var v = {
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#39;",
        "/": "&#x2F;"
    };
    function g(e) {
        return String(e).replace(/[&<>"'\/]/g, function(e) {
            return v[e];
        });
    }
    function w(e) {
        if (!f(e) || e.length !== 2) {
            throw new Error("Invalid tags: " + e);
        }
        return [ new RegExp(p(e[0]) + "\\s*"), new RegExp("\\s*" + p(e[1])) ];
    }
    function d(n, o) {
        o = o || e.tags;
        n = n || "";
        if (typeof o === "string") {
            o = o.split(r);
        }
        var c = w(o);
        var h = new b(n);
        var f = [];
        var u = [];
        var v = [];
        var g = false;
        var d = false;
        function x() {
            if (g && !d) {
                while (v.length) {
                    delete u[v.pop()];
                }
            } else {
                v = [];
            }
            g = false;
            d = false;
        }
        var m, E, U, T, j, C;
        while (!h.eos()) {
            m = h.pos;
            U = h.scanUntil(c[0]);
            if (U) {
                for (var A = 0, R = U.length; A < R; ++A) {
                    T = U.charAt(A);
                    if (l(T)) {
                        v.push(u.length);
                    } else {
                        d = true;
                    }
                    u.push([ "text", T, m, m + 1 ]);
                    m += 1;
                    if (T === "\n") {
                        x();
                    }
                }
            }
            if (!h.scan(c[0])) break;
            g = true;
            E = h.scan(a) || "name";
            h.scan(t);
            if (E === "=") {
                U = h.scanUntil(i);
                h.scan(i);
                h.scanUntil(c[1]);
            } else if (E === "{") {
                U = h.scanUntil(new RegExp("\\s*" + p("}" + o[1])));
                h.scan(s);
                h.scanUntil(c[1]);
                E = "&";
            } else {
                U = h.scanUntil(c[1]);
            }
            if (!h.scan(c[1])) {
                throw new Error("Unclosed tag at " + h.pos);
            }
            j = [ E, U, m, h.pos ];
            u.push(j);
            if (E === "#" || E === "^") {
                f.push(j);
            } else if (E === "/") {
                C = f.pop();
                if (!C) {
                    throw new Error('Unopened section "' + U + '" at ' + m);
                }
                if (C[1] !== U) {
                    throw new Error('Unclosed section "' + C[1] + '" at ' + m);
                }
            } else if (E === "name" || E === "{" || E === "&") {
                d = true;
            } else if (E === "=") {
                c = w(o = U.split(r));
            }
        }
        C = f.pop();
        if (C) {
            throw new Error('Unclosed section "' + C[1] + '" at ' + h.pos);
        }
        return y(k(u));
    }
    function k(e) {
        var t = [];
        var r, n;
        for (var i = 0, s = e.length; i < s; ++i) {
            r = e[i];
            if (r) {
                if (r[0] === "text" && n && n[0] === "text") {
                    n[1] += r[1];
                    n[3] = r[3];
                } else {
                    t.push(r);
                    n = r;
                }
            }
        }
        return t;
    }
    function y(e) {
        var t = [];
        var r = t;
        var n = [];
        var i, s;
        for (var a = 0, o = e.length; a < o; ++a) {
            i = e[a];
            switch (i[0]) {
              case "#":
              case "^":
                r.push(i);
                n.push(i);
                r = i[4] = [];
                break;

              case "/":
                s = n.pop();
                s[5] = i[2];
                r = n.length > 0 ? n[n.length - 1][4] : t;
                break;

              default:
                r.push(i);
            }
        }
        return t;
    }
    function b(e) {
        this.string = e;
        this.tail = e;
        this.pos = 0;
    }
    b.prototype.eos = function() {
        return this.tail === "";
    };
    b.prototype.scan = function(e) {
        var t = this.tail.match(e);
        if (t && t.index === 0) {
            var r = t[0];
            this.tail = this.tail.substring(r.length);
            this.pos += r.length;
            return r;
        }
        return "";
    };
    b.prototype.scanUntil = function(e) {
        var t = this.tail.search(e), r;
        switch (t) {
          case -1:
            r = this.tail;
            this.tail = "";
            break;

          case 0:
            r = "";
            break;

          default:
            r = this.tail.substring(0, t);
            this.tail = this.tail.substring(t);
        }
        this.pos += r.length;
        return r;
    };
    function x(e, t) {
        this.view = e == null ? {} : e;
        this.cache = {
            ".": this.view
        };
        this.parent = t;
    }
    x.prototype.push = function(e) {
        return new x(e, this);
    };
    x.prototype.lookup = function(e) {
        var t;
        if (e in this.cache) {
            t = this.cache[e];
        } else {
            var r = this;
            while (r) {
                if (e.indexOf(".") > 0) {
                    t = r.view;
                    var n = e.split("."), i = 0;
                    while (t != null && i < n.length) {
                        t = t[n[i++]];
                    }
                } else {
                    t = r.view[e];
                }
                if (t != null) break;
                r = r.parent;
            }
            this.cache[e] = t;
        }
        if (u(t)) {
            t = t.call(this.view);
        }
        return t;
    };
    function m() {
        this.cache = {};
    }
    m.prototype.clearCache = function() {
        this.cache = {};
    };
    m.prototype.parse = function(e, t) {
        var r = this.cache;
        var n = r[e];
        if (n == null) {
            n = r[e] = d(e, t);
        }
        return n;
    };
    m.prototype.render = function(e, t, r) {
        var n = this.parse(e);
        var i = t instanceof x ? t : new x(t);
        return this.renderTokens(n, i, r, e);
    };
    m.prototype.renderTokens = function(t, r, n, i) {
        var s = "";
        var a = this;
        function o(e) {
            return a.render(e, r, n);
        }
        var c, l;
        for (var h = 0, p = t.length; h < p; ++h) {
            c = t[h];
            switch (c[0]) {
              case "#":
                l = r.lookup(c[1]);
                if (!l) continue;
                if (f(l)) {
                    for (var v = 0, g = l.length; v < g; ++v) {
                        s += this.renderTokens(c[4], r.push(l[v]), n, i);
                    }
                } else if (typeof l === "object" || typeof l === "string") {
                    s += this.renderTokens(c[4], r.push(l), n, i);
                } else if (u(l)) {
                    if (typeof i !== "string") {
                        throw new Error("Cannot use higher-order sections without the original template");
                    }
                    l = l.call(r.view, i.slice(c[3], c[5]), o);
                    if (l != null) s += l;
                } else {
                    s += this.renderTokens(c[4], r, n, i);
                }
                break;

              case "^":
                l = r.lookup(c[1]);
                if (!l || f(l) && l.length === 0) {
                    s += this.renderTokens(c[4], r, n, i);
                }
                break;

              case ">":
                if (!n) continue;
                l = u(n) ? n(c[1]) : n[c[1]];
                if (l != null) s += this.renderTokens(this.parse(l), r, n, l);
                break;

              case "&":
                l = r.lookup(c[1]);
                if (l != null) s += l;
                break;

              case "name":
                l = r.lookup(c[1]);
                if (l != null) s += e.escape(l);
                break;

              case "text":
                s += c[1];
                break;
            }
        }
        return s;
    };
    e.name = "mustache.js";
    e.version = "0.8.1";
    e.tags = [ "{{", "}}" ];
    var E = new m();
    e.clearCache = function() {
        return E.clearCache();
    };
    e.parse = function(e, t) {
        return E.parse(e, t);
    };
    e.render = function(e, t, r) {
        return E.render(e, t, r);
    };
    e.to_html = function(t, r, n, i) {
        var s = e.render(t, r, n);
        if (u(i)) {
            i(s);
        } else {
            return s;
        }
    };
    e.escape = g;
    e.Scanner = b;
    e.Context = x;
    e.Writer = m;
});
//# sourceMappingURL=mustache.min.js.map
