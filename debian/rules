#!/usr/bin/make -f

DEB_HOST_MULTIARCH ?= $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)

%:
	dh $@ --with=systemd

override_dh_auto_configure:
	# Hack! as long as we do not have the tools to rebuild the js bundles, ensure they are not rebuilt
	touch `find * -name bundle.min.js` pkg/kubernetes/kubernetes.min.js
	dh_auto_configure -- \
		--with-pamdir=/lib/$(DEB_HOST_MULTIARCH)/security \
		--libexecdir=/usr/lib/cockpit

override_dh_auto_install:
	dh_auto_install -- install-test-assets
	install -D -p -m 644 tools/cockpit.debian.pam debian/tmp/etc/pam.d/cockpit

override_dh_systemd_enable:
	dh_systemd_enable -p cockpit-ws --name=cockpit cockpit.socket

override_dh_systemd_start:
	dh_systemd_start -p cockpit-ws cockpit.socket
	dh_systemd_start -p cockpit-ws --no-start --restart-after-upgrade cockpit.service

override_dh_install:
	dh_install --list-missing -Xusr/src/debug

