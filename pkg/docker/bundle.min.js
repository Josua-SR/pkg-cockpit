
define("docker/client", ["jquery","base1/cockpit","docker/util","shell/shell","shell/cockpit-plot","shell/cockpit-util"],function(e,n,i,t){function r(){var r=this;var o;var a;var c;var u;var s;var f=true;var d;function g(){if(!d){d=window.setTimeout(function(){d=null;e(r).trigger("event")},300)}}function l(){o=c.get("/v1.12/events");o.stream(function(e){i.docker_debug("event:",e);if(u.state()=="pending")u.resolve();g()}).always(function(){window.setTimeout(function(){if(f&&o){l();f=false}},1e3)})}this.containers={};this.images={};this.waiting={};var m={};var p={};var h={};var v;var y;var b={};function _(e){if(!e.Name)return null;var n=e.Name;if(n[0]==="/")n=n.substring(1);return n}function k(e,n){if(n.State===undefined)n.State={};if(n.Config===undefined)n.Config={};for(var i in m[e]){if(n[i]===undefined)n[i]=m[e][i]}var t=_(n);if(t)p[t]=e;if(!n.CGroup)n.CGroup=G(e)}function C(n){var i=r.containers[n];if(i){var t=_(i);if(t&&p[t]==n)delete p[t];delete r.containers[n];e(r).trigger("container",[n,undefined])}}function w(){c.get("/v1.12/containers/json",{all:1}).done(function(n){var i=JSON.parse(n);if(u.state()=="pending")u.resolve();f=true;var t={};e(i).each(function(n,i){var o=i.Id;if(!o)return;t[o]=o;m[o]=i;c.get("/v1.12/containers/"+encodeURIComponent(o)+"/json").done(function(n){var i=JSON.parse(n);k(o,i);r.containers[o]=i;b[o]=[y.add(v,["cgroup.memory.usage",i.CGroup]),y.add(v,["cgroup.cpu.usage",i.CGroup]),y.add(v,["cgroup.memory.limit",i.CGroup]),y.add(v,["cgroup.cpu.shares",i.CGroup])];e(r).trigger("container",[o,i])})});var o=[];e.each(r.containers,function(e){if(!t[e])o.push(e)});e.each(o,function(e,n){C(n)})}).fail(function(n){if(u.state()=="pending")u.reject(n);s=true;e(r).trigger("failure",[n])})}function S(){for(var n in b){var i=r.containers[n];if(!i)continue;var t=b[n];var o=t[0][0];var a=t[2][0];if(a>1115e15)a=undefined;var c=t[1][0]/10;var u=t[3][0];if(o!=i.MemoryUsage||a!=i.MemoryLimit||c!=i.CpuUsage||u!=i.CpuPriority){i.MemoryUsage=o;i.MemoryLimit=a;i.CpuUsage=c;i.CpuPriority=u;e(r).trigger("container",[n,i])}}}function O(n,i){if(i.Config===undefined){if(i.ContainerConfig)i.Config=i.ContainerConfig;else i.Config={}}e.extend(i,h[n]);if(i.RepoTags)i.RepoTags.sort()}function T(n){if(r.images[n]){delete r.images[n];e(r).trigger("image",[n,undefined])}}function N(){c.get("/v1.12/images/json").done(function(n){var i=JSON.parse(n);if(u.state()=="pending")u.resolve();f=true;var t={};e.each(i,function(n,i){var o=i.Id;if(!o)return;t[o]=o;h[o]=i;c.get("/v1.12/images/"+encodeURIComponent(o)+"/json").done(function(n){var i=JSON.parse(n);O(o,i);r.images[o]=i;e(r).trigger("image",[o,i])})});var o=[];e.each(r.images,function(e){if(!t[e])o.push(e)});e.each(o,function(e,n){T(n)})}).fail(function(n){if(u.state()=="pending")u.reject(n);s=true;e(r).trigger("failure",[n])})}e(r).on("event",function(){w();N()});function U(){s=false;u=e.Deferred();c=n.http("/var/run/docker.sock",{superuser:"try"});l();if(a&&a.valid)a.close();c.get("/v1.12/info").done(function(i){var t=i&&JSON.parse(i);a=n.channel({payload:"fslist1",path:t["DockerRootDir"],superuser:"try"});e(a).on("message",function(e,n){g()});e(a).on("close",function(e,n){if(n.problem&&n.problem!="not-found")console.warn("monitor for docker directory failed: "+n.problem)});e(r).triggerHandler("event")}).fail(function(n){if(n!="not-found")console.warn("monitor for docker directory failed: "+n);e(r).triggerHandler("event")});v=n.metrics(1e3,{source:"internal",metrics:[{name:"cgroup.memory.usage",units:"bytes"},{name:"cgroup.cpu.usage",units:"millisec",derive:"rate"},{name:"cgroup.memory.limit",units:"bytes"},{name:"cgroup.cpu.shares",units:"count"}]});y=n.grid(1e3,-1,-0);y.walk();e(y).on("notify",function(e,n,i){S()})}var j=/docker-([A-Fa-f0-9]{64})\.scope/;var J=/.*\/ctr-(.+).service/;this.container_from_cgroup=R;function R(e){var n=j.exec(e);if(n)return n[1];n=J.exec(e);if(n)return p[n[1]];return null}this.cgroup_from_container=G;function G(e){return"system.slice/docker-"+e+".scope"}function I(n){if(n in r.containers)e(r).trigger("container",[n,r.containers[n]]);else if(n in r.images)e(r).trigger("image",[n,r.images[n]])}function q(e,n){if(e in r.waiting){r.waiting[e]++}else{r.waiting[e]=1;I(e)}}function P(e){r.waiting[e]--;if(r.waiting[e]===0){delete r.waiting[e];I(e)}}U();this.start=function x(e,n){q(e);i.docker_debug("starting:",e);return c.request({method:"POST",path:"/v1.12/containers/"+encodeURIComponent(e)+"/start",headers:{"Content-Type":"application/json"},body:JSON.stringify(n||{})}).fail(function(n){i.docker_debug("start failed:",e,n)}).done(function(n){i.docker_debug("started:",e,n)}).always(function(){P(e)})};this.stop=function D(e,n){q(e);if(n===undefined)n=10;i.docker_debug("stopping:",e,n);return c.request({method:"POST",path:"/v1.12/containers/"+encodeURIComponent(e)+"/stop",params:{t:n},body:""}).fail(function(n){i.docker_debug("stop failed:",e,n)}).done(function(n){i.docker_debug("stopped:",e,n)}).always(function(){P(e)})};this.restart=function L(e,n){q(e);if(n===undefined)n=10;i.docker_debug("restarting:",e);return c.request({method:"POST",path:"/v1.12/containers/"+encodeURIComponent(e)+"/restart",params:{t:n},body:""}).fail(function(n){i.docker_debug("restart failed:",e,n)}).done(function(n){i.docker_debug("restarted:",e,n)}).always(function(){P(e)})};this.create=function M(e,n){i.docker_debug("creating:",e);return c.request({method:"POST",path:"/v1.12/containers/create",params:{name:e},headers:{"Content-Type":"application/json"},body:JSON.stringify(n||{})}).fail(function(n){i.docker_debug("create failed:",e,n)}).done(function(n){i.docker_debug("created:",e,n)}).then(JSON.parse)};this.search=function F(e){i.docker_debug("searching:",e);return c.get("/v1.12/images/search",{term:e}).fail(function(n){i.docker_debug("search failed:",e,n)}).done(function(n){i.docker_debug("searched:",e,n)})};this.commit=function H(n,t,r,o){var a={container:n,repo:t};e.extend(a,r);q(n);i.docker_debug("committing:",n,t,r,o);return c.request({method:"POST",path:"/v1.12/commit",params:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(o||{})}).fail(function(e){i.docker_debug("commit failed:",t,e)}).done(function(e){i.docker_debug("committed:",t)}).always(function(){P(n)}).then(JSON.parse)};this.rm=function A(e,n){if(n===undefined)n=false;q(e);i.docker_debug("deleting:",e);return c.request({method:"DELETE",path:"/v1.12/containers/"+encodeURIComponent(e),params:{force:n},body:""}).fail(function(n){i.docker_debug("delete failed:",e,n)}).done(function(n){i.docker_debug("deleted:",e,n);C(e)}).always(function(){P(e)})};this.rmi=function z(e){q(e);i.docker_debug("deleting:",e);return c.request({method:"DELETE",path:"/v1.12/images/"+encodeURIComponent(e),body:""}).fail(function(n){i.docker_debug("delete failed:",e,n)}).done(function(n){i.docker_debug("deleted:",e,n);T(e)}).always(function(){P(e)})};function E(e,t,r,o){var a="/sys/fs/cgroup/"+e+"/"+t+"/"+r;var c="echo '"+o.toFixed(0)+"' > "+a;i.docker_debug("changing cgroup:",c);n.spawn(["sh","-c",c]).fail(function(e){console.warn(e)})}this.change_memory_limit=function B(e,n){if(n===undefined||n<=0)n=-1;return E("memory",this.containers[e].CGroup,"memory.limit_in_bytes",n)};this.change_swap_limit=function K(e,n){if(n===undefined||n<=0)n=-1;return E("memory",this.containers[e].CGroup,"memory.memsw.limit_in_bytes",n)};this.change_cpu_priority=function Q(e,n){if(n===undefined||n<=0)n=1024;return E("cpuacct",this.containers[e].CGroup,"cpu.shares",n)};this.machine_info=function V(){return t.util.machine_info()};this.info=function W(){return c.get("/v1.12/info").fail(function(e){i.docker_debug("info failed:",e)}).done(function(e){i.docker_debug("info:",e)})};this.close=function X(){if(v){v.close();y.close()}u=null};this.connect=function Y(){if(!u)U();return u.promise()};this.maybe_reconnect=function Z(){if(s){this.close();U()}return u.promise()}}return{init:function(){return new r}}});

//# sourceURL=docker/client.min.js

define("docker/details", ["jquery","base1/cockpit","base1/mustache","docker/docker","docker/util"],function(t,n,e,i,a){var r=n.gettext;var o=n.gettext;c.prototype={_init:function(t){this.client=t;this.terminal=null},getTitle:function(){return o("page-title","Containers")},setup:function(){var e=this;t("#container-details .breadcrumb a").on("click",function(){n.location.go("/")});t("#container-details-start").on("click",t.proxy(this,"start_container"));t("#container-details-stop").on("click",t.proxy(this,"stop_container"));t("#container-details-restart").on("click",t.proxy(this,"restart_container"));t("#container-details-delete").on("click",t.proxy(this,"delete_container"));e.memory_limit=new a.MemorySlider(t("#container-resources-dialog .memory-slider"),10*1024*1024,2*1024*1024*1024);e.cpu_priority=new a.CpuSlider(t("#container-resources-dialog .cpu-slider"),2,1e6);e.memory_usage=t("#container-details-memory .bar-row");t("#container-resources-dialog").on("show.bs.modal",function(){var n=e.client.containers[e.container_id];t(this).find(".container-name").text(e.name);e.memory_limit.value=n.MemoryLimit||undefined;e.cpu_priority.value=n.CpuPriority||undefined}).find(".btn-primary").on("click",function(){e.client.change_memory_limit(e.container_id,e.memory_limit.value);var t=e.memory_limit.value;if(!isNaN(t))t*=2;e.client.change_swap_limit(e.container_id,t);e.client.change_cpu_priority(e.container_id,e.cpu_priority.value)});var i=t("#container-commit-dialog")[0];t(i).on("show.bs.modal",function(){var r=e.client.containers[e.container_id];t(i).find(".container-name").text(e.name);var o=e.client.images[r.Config.Image];var c="";if(o&&o.RepoTags)c=o.RepoTags[0].split(":",1)[0];t(i).find(".container-repository").attr("value",c);t(i).find(".container-tag").attr("value","");var s=n.user["name"]||n.user["user"];t(i).find(".container-author").attr("value",s);var l="";if(r.Config)l=a.quote_cmdline(r.Config.Cmd);if(!l)l=r.Command;t(i).find(".container-command").attr("value",l)}).find(".btn-primary").on("click",function(){var r=n.location;var o={Cmd:a.unquote_cmdline(t(i).find(".container-command").val())};var c={author:t(i).find(".container-author").val()};var s=t(i).find(".container-tag").val();if(s)c["tag"]=s;var l=t(i).find(".container-repository").val();e.client.commit(e.container_id,l,c,o).fail(function(t){a.show_unexpected_error(t)}).done(function(){r.go("/")})})},enter:function(n){var e=this;t(this.client).off(".container-details");if(this.terminal){this.terminal.close();this.terminal=null}t("#container-terminal").hide();this.container_id=n;this.name=this.container_id.slice(0,12);this.client.machine_info().done(function(t){e.memory_limit.max=t.memory});t(this.client).on("container.container-details",function(t,n,i){if(n==e.container_id)e.update()});this.update()},maybe_show_terminal:function(n){if(!this.terminal){this.terminal=i.console(this.container_id,{tty:n.Config.Tty});t("#container-terminal").empty().append(this.terminal);this.terminal.connect()}this.terminal.typeable(n.State.Running);t("#container-terminal").show()},maybe_reconnect_terminal:function(){if(this.terminal&&!this.terminal.connected){this.terminal.connect();this.terminal.typeable(true)}},add_bindings:function(t,e){for(var i in e){var a=e[i];if(!a)continue;for(var o=0;o<a.length;o++){var c=a[o].HostIp;if(c==="")c="0.0.0.0";var s=n.format(r("${hip}:${hport} -> $cport"),{hip:c,hport:a[o].HostPort,cport:i});if(t.indexOf(s)===-1)t.push(s)}}return t},update:function(){t("#container-details-names").text("");t("#container-details-id").text("");t("#container-details-created").text("");t("#container-details-image").text("");t("#container-details-command").text("");t("#container-details-state").text("");t("#container-details-ports-row").hide();t("#container-details-links-row").hide();t("#container-details-resource-row").hide();var n=this.client.containers[this.container_id];a.docker_debug("container-details",this.container_id,n);if(!n){t("#container-details-names").text(r("Not found"));return}var e=!!this.client.waiting[this.container_id];t("#container-details div.spinner").toggle(e);t("#container-details button").toggle(!e);t("#container-details-start").prop("disabled",n.State.Running);t("#container-details-stop").prop("disabled",!n.State.Running);t("#container-details-restart").prop("disabled",!n.State.Running);t("#container-details-commit").prop("disabled",!!n.State.Running);t("#container-details-memory-row").toggle(!!n.State.Running);t("#container-details-cpu-row").toggle(!!n.State.Running);t("#container-details-resource-row").toggle(!!n.State.Running);this.name=a.render_container_name(n.Name);t("#container-details .breadcrumb .active").text(this.name);var i=[];if(n.NetworkSettings)this.add_bindings(i,n.NetworkSettings.Ports);if(n.HostConfig)this.add_bindings(i,n.HostConfig.PortBindings);t("#container-details-id").text(n.Id);t("#container-details-names").text(a.render_container_name(n.Name));t("#container-details-created").text(n.Created);t("#container-details-image").text(n.Image);t("#container-details-command").text(a.render_container_cmdline(n));t("#container-details-state").text(a.render_container_state(n.State));t("#container-details-ports-row").toggle(i.length>0);t("#container-details-ports").html(a.multi_line(i));this.update_links(n);a.update_memory_bar(this.memory_usage,n.MemoryUsage,n.MemoryLimit);t("#container-details-memory-text").text(a.format_memory_and_limit(n.MemoryUsage,n.MemoryLimit));t("#container-details .cpu-usage").text(a.format_cpu_usage(n.CpuUsage));t("#container-details .cpu-shares").text(a.format_cpu_shares(n.CpuPriority));this.maybe_show_terminal(n)},update_links:function(n){t("#container-details-links").empty();var e=n.HostConfig.Links;if(e){t("#container-details-links-row").toggle(true);t("#container-details-links").html(e.join("<br/>"))}},start_container:function(){var t=this;var n=this.container_id;this.client.start(this.container_id).fail(function(e){a.handle_scope_start_container(t.client,n,e.message,function(){t.maybe_reconnect_terminal()},null)}).done(function(){t.maybe_reconnect_terminal()})},stop_container:function(){this.client.stop(this.container_id).fail(function(t){a.show_unexpected_error(t)})},restart_container:function(){var t=this;this.client.restart(this.container_id).fail(function(t){a.show_unexpected_error(t)}).done(function(){t.maybe_reconnect_terminal()})},delete_container:function(){var t=this;var e=n.location;a.confirm(n.format(r("Please confirm deletion of $0"),t.name),r("Deleting a container will erase all data in it."),r("Delete")).done(function(){a.docker_container_delete(t.client,t.container_id,function(){e.go("/")},function(){})})}};function c(t){this._init(t)}function s(n){var e=new c(n);e.setup();function i(){t("#container-details").hide()}function a(n){e.enter(n);t("#container-details").show()}return{show:a,hide:i}}return{init:s}});

//# sourceURL=docker/details.min.js

define("docker/docker", ["jquery","base1/cockpit","base1/term"],function(e,n,r){"use strict";var t={};function a(){if(window.debugging=="all"||window.debugging=="docker")console.debug.apply(console,arguments)}var o=n.http("/var/run/docker.sock",{superuser:true});t.pull=function u(n,r,i){var s=e.Deferred();if(!r)r="latest";if(i)n=i+"/"+n;a("pulling: "+n+":"+r);var c={method:"POST",path:"/v1.12/images/create",body:"",params:{fromImage:n,tag:r}};var l;var u="";var f=o.request(c).stream(function(e){u+=e;var n=t.json_skip(u,0);if(n===0)return;var r=JSON.parse(u.substring(0,n));u=u.substring(n);if(r.error)l=r.error;else if(r.status)s.notify(r.status,r)}).fail(function(e){s.reject(e)}).done(function(){if(l)s.reject(new Error(l));else s.resolve()});var d=s.promise();d.cancel=function v(){f.close("cancelled");return d};return d};t.inspect_image=function f(n){var r=e.Deferred();o.get("/v1.12/images/"+encodeURIComponent(n)+"/json").done(function(e){r.resolve(JSON.parse(e))}).fail(function(e){r.reject(e)});var t=r.promise();t.cancel=function a(){return t};return t};function i(t,a){var o=this;var i=new r({cols:80,rows:24,screenKeys:true,useStyle:true,inlineStyle:false});var s=true;var c=n.utf8_decoder();var l=n.utf8_encoder();t.empty();i.open(t[0]);o.typeable=function u(e){i.cursorHidden=!e;if(e)i.showCursor();i.refresh(i.y,i.y);s=e};o.close=function f(){i.destroy()};if(typeof a=="string"){i.write("[31m"+a+"[m\r\n");o.close=function(){};o.typeable(false);return o}e(a).on("close",function(n,r){o.connected=false;var t=r.problem||"disconnected";i.write("[31m"+t+"[m\r\n");o.typeable(false);e(a).off("message");a=null});o.process=function d(e){i.write(c.decode(e));return e.length};i.on("data",function(e){if(s&&a)a.send(l.encode(e))});return o}function s(r,t){var a=this;var o=e("<pre>").addClass("logs");r.empty();r.append(o);var i;var s=[];function c(n){s.push(n);if(!i){i=window.setTimeout(function(){i=null;var n=o[0].scrollHeight-o.scrollTop()<=o.outerHeight();var r=e("<span>").text(s.join(""));s.length=0;o.append(r);if(n)o.scrollTop(o.prop("scrollHeight"))},50)}}if(typeof t=="string"){c(t);a.close=function(){};return a}t.control({batch:16384,latency:50});var l=n.utf8_decoder(false);a.process=function u(e){var n=0;var r,t;var a=e.length;while(true){if(a<n+8)return n;r=(e[n+4]&255)<<24|(e[n+5]&255)<<16|(e[n+6]&255)<<8|e[n+7]&255;if(a<n+8+r)return n;if(e.subarray)t=e.subarray(n+8,n+8+r);else t=e.slice(n+8,n+8+r);c(l.decode(t,{stream:true}));n+=8+r}return n};e(t).on("close",function(n,r){c(r.reason||"disconnected");a.connected=false;e(t).off();t=null});return a}function c(e,n){var r,t=n.length;var a,o=e.length-t+1;for(a=0;a<o;a++){for(r=0;r<t;r++){if(e[a+r]!==n[r])break}if(r==t)return a}return-1}t.console=function d(r,t,l){var u=e("<div>").addClass("console");var f=false;var d=false;var v=null;var p=null;var h;var g;if(Array.isArray(t)){if(!l)l={};g=l.tty;if(g===undefined||g===null)g=true;h={method:"POST",path:"/v1.15/containers/"+encodeURIComponent(r)+"/exec",headers:{"Content-Type":"application/json"},body:JSON.stringify({AttachStdin:g,AttachStdout:true,AttachStderr:true,Tty:g,Cmd:t})};a("preparing to exec:",t)}else{a("preparing to attach");l=t||{};g=l.tty}delete l.tty;var y=null;function b(e){u.connected=false;if(g)p=new i(u,e);else p=new s(u,e)}function m(){if(!h){return w("POST /v1.15/containers/"+encodeURIComponent(r)+"/attach?logs=1&stream=1&stdin=1&stdout=1&stderr=1 HTTP/1.0\r\n"+"Content-Length: 0\r\n\r\n")}var n=o.request(e.extend({},l,h)).always(function(){n=null}).done(function(e){var n=JSON.parse(e);var r=JSON.stringify({Detach:false,Tty:g});return w("POST /v1.15/exec/"+encodeURIComponent(n.Id)+"/start HTTP/1.0\r\n"+"Content-Length: "+r.length+"\r\n\r\n"+r)}).fail(function(e){b(e.message)})}function w(t){u.connected=true;if(p)p.close();p=null;var o=e.extend({},l,{payload:"stream",unix:"/var/run/docker.sock",superuser:true,binary:true});v=n.channel(o);a(t);v.send(t);e(v).on("close.attach",function(n,t){a(r+": console close: ",t);u.connected=false;e(v).off(".attach");v=null});var d=null;var h=v.buffer();h.callback=function(e){var t=0;var o=0;var l;if(d===null){o=c(e,[13,10,13,10]);if(o==-1)return t;if(e.subarray)d=n.utf8_decoder().decode(e.subarray(0,o));else d=n.utf8_decoder().decode(e.slice(0,o));a(r+": console headers: ",d);l=d.split("\r\n",1)[0].split(" ");if(l[1]!="200"){b(l.slice(2).join(" "));h.callback=null;return}else if(e.subarray){e=e.subarray(o+4);t+=o+4}else{e=e.slice(o+4);t+=o+4}}if(g===undefined||g===null){if(e.length<2)return t;g=!((e[0]===0||e[0]===1||e[0]===2)&&e[1]===0);a(r+": mode tty: "+g)}if(g)p=new i(u,v);else p=new s(u,v);u.typeable(f);h.callback=p.process;var y=p.process(e);return t+y}}u.close=function T(e){if(y)y.close(e);if(u.connected)v.close(e);if(p){if(p.close)p.close();p=null}};u.connect=function S(){u.close("disconnected");m()};function k(){if(p&&p.typeable)p.typeable(f&&d)}e(u).on("focusin",function(){d=true;k()}).on("focusout",function(){d=false;k()});u.typeable=function x(e){f=e;k()};return u};t.json_skip=function(e,n){var r=false;var t=e.length;var a=0;var o=false;var i=false;var s=' 	\n\r\x0B[{}]"';var c=" 	\n\r\x0B";var l;if(n===undefined)n=0;for(t=e.length;n!=t;n++){if(r&&a<=0)break;l=e[n];if(o){if(s.indexOf(l)!=-1){o=false;a--;n--}continue}if(c.indexOf(l)!=-1)continue;if(i){switch(l){case"\\":if(n+1==t)continue;n++;break;case'"':i=false;a--;break;default:break}continue}r=true;switch(l){case"[":case"{":a++;break;case"]":case"}":a--;break;case'"':i=true;a++;break;default:o=true;a++;break}}if(o&&a==1)a=0;if(!r||a>0)return 0;return n};t.quote_cmdline=function v(e){var n;e=e||[];function r(e){return e==" "}function t(e){var n="";var t="";var a;for(a=0;a<e.length;a++){if(e[a]=="\\"||e[a]==t)n+="\\";else if(t===""){if(e[a]=="'"||r(e[a]))t='"';else if(e[a]=='"')t="'"}n+=e[a]}return t+n+t}return e.map(t).join(" ")};t.unquote_cmdline=function p(e){var n=[];var r;function t(e){return e==" "}function a(){while(r<e.length&&t(e[r]))r++}function o(){var n="";var a=null;while(r<e.length){if(e[r]=="\\"){r++;if(r<e.length){n+=e[r]}}else if(e[r]==a){a=null}else if(a){n+=e[r]}else if(e[r]=='"'||e[r]=="'"){a=e[r]}else if(t(e[r])){break}else n+=e[r];r++}return n}r=0;a();while(r<e.length){n.push(o());a()}return n};var l=[null,"KB","MB","GB","TB","PB","EB","ZB"];t.bytes_from_format=function h(e,n){var r=1024;if(n===undefined)n=" ";var t=e.split(n).pop().toUpperCase();var a=l.indexOf(t);var o=parseFloat(e);if(a>0&&!isNaN(o))return o*Math.pow(r,a);return o};return t});

//# sourceURL=docker/docker.min.js

require(["jquery","base1/cockpit","base1/mustache","docker/client","docker/overview","docker/details","docker/image","system/service","translated!base1/po"],function(e,n,o,t,i,c,a,r,l){n.locale(l);var d=n.gettext;var s=n.gettext;var u;var f=r.proxy("docker");function h(t,i){u=e("#curtain-tmpl").html();o.parse(u);e(t).on("failure",function(e,n){v(n)});e("#curtain").on("click","[data-action=docker-start]",function(){v(null);f.start().done(function(){t.close();t.connect().done(i)}).fail(function(e){v(n.format(d("Failed to start Docker: $0"),e))})});e("#curtain").on("click","[data-action=docker-connect]",function(){v(null);t.close();t.connect().done(i)})}function v(n){var t={};if(n===null){t.connecting=true}else if(typeof n=="string"){t.other=n;console.warn(n)}else if(n.problem=="not-found"){t.notfound=true}else if(n.problem=="access-denied"){t.denied=true}else{t.other=n.toString();console.warn(n)}e("#curtain").html(o.render(u,t));e("body > div").hide();e("#curtain").show();e("body").show()}function g(){e("#curtain").hide()}function k(){var o;var r;var l;var d;function s(){var o=n.location.path;e("body").show();g();if(o.length===0){l.hide();d.hide();r.show()}else if(o.length===1){r.hide();d.hide();l.show(o[0])}else if(o.length===2&&o[0]=="image"){r.hide();l.hide();d.show(o[1])}else{console.warn("not a containers location: "+o);n.location=""}}n.translate();o=t.init();h(o,s);r=i.init(o);l=c.init(o);d=a.init(o);v(null);o.connect().done(s);e(n).on("locationchanged",s)}e(k)});

//# sourceURL=docker/containers.min.js

define("docker/image", ["jquery","base1/cockpit","base1/mustache","docker/docker","docker/util","docker/run"],function(e,t,i,a,n,o){var d=t.gettext;var r=t.gettext;s.prototype={_init:function(e){this.client=e;this.danger_enabled=false},getTitle:function(){return r("page-title","Containers")},toggle_danger:function(t){var i=this;i.danger_enabled=t;e("#image-details-containers button.enable-danger").toggleClass("active",i.danger_enabled);e("#image-details-containers td.container-col-actions").toggle(!i.danger_enabled);e("#image-details-containers td.container-col-danger").toggle(i.danger_enabled)},setup:function(){var i=this;e("#image-details .breadcrumb a").on("click",function(){t.location.go("/")});n.setup_danger_button("#image-details-containers","#image-details",function(){i.toggle_danger(!i.danger_enabled)});e("#image-details-run").on("click",e.proxy(this,"run_image"));e("#image-details-delete").on("click",e.proxy(this,"delete_image"))},enter:function(i){var a=this;this.image_id=i;this.name=t.format(d("Image $0"),this.image_id.slice(0,12));e("#image-details-containers table tbody tr").remove();e("#image-details-containers button.enable-danger").toggle(false);e(this.client).on("image.image-details",function(e,t,i){if(t==a.image_id)a.update()});e(this.client).on("container.image-details",function(e,t,i){if(!i||i.Config&&i.Config.Image==a.image_id)a.render_container(t,i)});for(var n in this.client.containers){var o=this.client.containers[n];if(o.Config&&o.Config.Image==a.image_id)a.render_container(o.Id,o)}this.update()},update:function(){e("#image-details-id").text("");e("#image-details-entrypoint").text("");e("#image-details-command").text("");e("#image-details-created").text("");e("#image-details-author").text("");e("#image-details-ports").text("");var t=this.client.images[this.image_id];n.docker_debug("image-details",this.image_id,t);if(!t){e("#image-details-id").text(d("Not found"));return}var i=!!this.client.waiting[this.image_id];e("#image-details-buttons div.waiting").toggle(i);e("#image-details-buttons button").toggle(!i);if(t.RepoTags&&t.RepoTags.length>0)this.name=t.RepoTags[0];e("#image-details .breadcrumb .active").text(this.name);e("#image-details-id").text(t.Id);e("#image-details-tags").html(n.multi_line(t.RepoTags));e("#image-details-created").text(t.Created);e("#image-details-author").text(t.Author);var a=t.Config;if(a){var o=[];for(var r in a.ExposedPorts){o.push(r)}e("#image-details-entrypoint").text(n.quote_cmdline(a.Entrypoint));e("#image-details-command").text(n.quote_cmdline(a.Cmd));e("#image-details-ports").text(o.join(", "))}},render_container:function(t,i){n.render_container(this.client,e("#image-details-containers"),"I",t,i,this.danger_enabled)},run_image:function(){o(this.client,this.image_id)},delete_image:function(){var e=this;var i=t.location;n.confirm(t.format(d("Please confirm deletion of $0"),e.name),d("Deleting an image will delete it, but you can probably download it again if you need it later.  Unless this image has never been pushed to a repository, that is, in which case you probably can't download it again."),d("Delete")).done(function(){e.client.rmi(e.image_id).fail(function(e){n.show_unexpected_error(e)}).done(function(){i.go("/")})})}};function s(e){this._init(e)}function g(t){var i=new s(t);i.setup();function a(){e("#image-details").hide()}function n(t){i.enter(t);e("#image-details").show()}return{show:n,hide:a}}return{init:g}});

//# sourceURL=docker/image.min.js

define("docker/overview", ["jquery","base1/cockpit","base1/mustache","docker/util","docker/run","docker/search","docker/docker","shell/controls","shell/shell","shell/plot"],function(t,e,a,n,o,i,r,s,c){var l=e.gettext;var u=e.gettext;function g(a){var u=false;function g(e){u=e;t("#containers-containers button.enable-danger").toggleClass("active",u);t("#containers-containers td.container-col-actions").toggle(!u);t("#containers-containers td.container-col-danger").toggle(u)}n.setup_danger_button("#containers-containers","#containers",function(){g(!u)});t("#containers-containers-filter a").on("click",function(){var e=t(this);t("#containers-containers-filter button span").text(e.text());t("#containers-containers table").toggleClass("filter-unimportant",e.attr("value")==="running")});t("#containers-images-search").on("click",function(){i(a);return false});function f(e,n){n=a.container_from_cgroup(n)||n;t("#containers-containers tr").removeClass("highlight");t("#"+n).addClass("highlight")}var d={internal:"cgroup.cpu.usage",units:"millisec",derive:"rate",factor:.1};var m=c.plot_simple_template();t.extend(m.yaxis,{tickFormatter:function(t){return t.toFixed(0)}});t.extend(m.grid,{hoverable:true,autoHighlight:false});m.setup_hook=function(t){var e=t.getAxes();if(e.yaxis.datamax)e.yaxis.options.max=Math.ceil(e.yaxis.datamax/100)*100;else e.yaxis.options.max=100;e.yaxis.options.min=0};var v=c.plot(t("#containers-cpu-graph"),300);v.set_options(m);var p=v.add_metrics_stacked_instances_series(d,{});t(p).on("value",function(e,a){t("#containers-cpu-text").text(n.format_cpu_usage(a))});v.start_walking();t(p).on("hover",f);var h={internal:"cgroup.memory.usage",units:"bytes"};var _=c.plot_simple_template();t.extend(_.yaxis,{ticks:c.memory_ticks,tickFormatter:c.format_bytes_tick_no_unit});t.extend(_.grid,{hoverable:true,autoHighlight:false});_.setup_hook=function(e){var a=e.getAxes();if(a.yaxis.datamax<1.5*1024*1024)a.yaxis.options.max=1.5*1024*1024;else a.yaxis.options.max=null;a.yaxis.options.min=0;t("#containers-mem-unit").text(c.bytes_tick_unit(a.yaxis))};var x=c.plot(t("#containers-mem-graph"),300);x.set_options(_);var b=x.add_metrics_stacked_instances_series(h,{});t(b).on("value",function(a,n){t("#containers-mem-text").text(e.format_bytes(n,1024))});x.start_walking();t(b).on("hover",f);t(window).on("resize",function(){v.resize();x.resize()});function y(e,o){if(o&&o.CGroup){p.add_instance(o.CGroup);b.add_instance(o.CGroup)}n.render_container(a,t("#containers-containers"),"",e,o,u)}function k(i,r){var s=t(document.getElementById(i));if(!r||!r.RepoTags||r.RepoTags[0]=="<none>:<none>"){s.remove();return}var c=false;if(!s.length){var u=t('<button class="btn btn-default btn-control fa fa-play">').attr("title",l("Run image")).on("click",function(){o(a,i);return false});s=t("<tr>",{id:i}).append(t('<td class="image-col-tags">'),t('<td class="image-col-created">'),t('<td class="image-col-size-graph">'),t('<td class="image-col-size-text">'),t('<td class="cell-buttons">').append(u));s.on("click",function(t){e.location.go(["image",i])});c=true}var g=s.children("td");t(g[0]).html(n.multi_line(r.RepoTags));var f=new Date(r.Created*1e3);f.setDate(f.getDate()+2);if(f>new Date){t(g[1]).text(new Date(r.Created*1e3).toLocaleString())}else{var d=new Date(r.Created*1e3);t(g[1]).text(d.toLocaleDateString()).attr("title",d.toLocaleString())}t(g[2]).children("div").attr("value",r.VirtualSize);t(g[3]).text(e.format_bytes(r.VirtualSize,1024));if(c){n.insert_table_sorted(t("#containers-images table"),s)}}t("#containers-containers table tbody tr").remove();t("#containers-images table tbody tr").remove();t(a).on("container.containers",function(t,e,a){y(e,a)});t(a).on("image.containers",function(t,e,a){k(e,a)});var w;t("#containers-containers button.enable-danger").toggle(false);for(w in a.containers){y(w,a.containers[w])}for(w in a.images){k(w,a.images[w])}function D(){a.info().done(function(a){var n=a&&JSON.parse(a);if(n["Driver"]!=="devicemapper"){t("#containers-storage .bar").html();t("#containers-storage .data").html("Unknown")}var o;var i;var c;t.each(n["DriverStatus"],function(t,e){if(e&&e[0]=="Data Space Total")i=e[1];else if(e&&e[0]=="Data Space Used")o=e[1];else if(e&&e[0]=="Data Space Available")c=e[1]});if(o&&i&&r){var u=r.bytes_from_format(o);var g=r.bytes_from_format(i);if(c){t("#containers-storage").tooltip("destroy");g=r.bytes_from_format(c);i=e.format_bytes(u+g)}else{var f=l("WARNING: Docker may be reporting the size it has allocated to it's storage pool using sparse files, not the actual space available to the underlying storage device.");t("#containers-storage").tooltip({title:f,placement:"auto"})}var d=o+" / "+i;var m=s.BarRow();m.attr("value",u+"/"+g);m.toggleClass("bar-row-danger",o>.95*i);t("#containers-storage .bar").html(m);t("#containers-storage .data").html(d)}else{t("#containers-storage .bar").html();t("#containers-storage .data").html("Unknown")}})}function C(){var t=this;var e=null;var n=false;var o=function(){if(!e){D();e=window.setTimeout(function(){var t=n;n=false;e=null;if(t&&a)o()},1e4)}else{n=true}};return o}D();t(a).on("event.containers",C());function z(){t("#containers").hide()}function S(){t("#containers").show();v.resize();x.resize()}return{show:S,hide:z}}return{init:g}});

//# sourceURL=docker/overview.min.js

define("docker/run", ["jquery","base1/cockpit","base1/mustache","docker/util"],function(e,n,r,t){var i=n.gettext;o.prototype={_init:function(){this.error_timeout=null;this.id="containers_run_image_dialog"},setup:function(){e("#containers-run-image-run").on("click",e.proxy(this,"run"));e("#containers-run-image-command").on("keydown",e.proxy(this,"update","keydown","command"));e("#containers-run-image-command").on("input",e.proxy(this,"update","input","command"));e("#containers-run-image-command").on("focusout change",e.proxy(this,"update","changeFocus","command"));this.memory_slider=new t.MemorySlider(e("#containers-run-image-memory"),10*1024*1024,2*1024*1024*1024);this.cpu_slider=new t.CpuSlider(e("#containers-run-image-cpu"),2,1e6);var n=e("#containers_run_image_dialog .modal-body table");var r=this.port_renderer();var i=this;e("#expose-ports").on("change",function(){var n=e("#select-exposed-ports");if(e(this).prop("checked")){if(n.children().length===0){r()}n.show()}else{n.hide()}i.update("changeFocus","ports")});var o=this.link_renderer();e("#link-containers").change(function(){var n=e("#select-linked-containers");if(e(this).prop("checked")){if(n.children().length===0){o()}n.show()}else{n.hide()}i.update("changeFocus","links")});this.validator=this.configuration_validator()},update:function(e,n){if(this.perform_checks!==true&&e!=="clear")return;this.validator(e,n)},enter:function(){var n=this;var r=o.image_info;t.docker_debug("run-image",r);var i;var a;o.client.machine_info().done(function(e){n.memory_slider.max=e.memory});n.containers=[];var s;for(s in o.client.containers){n.containers.push(t.render_container_name(o.client.containers[s].Name))}this.perform_checks=false;this.update("clear");e("#select-linked-containers").empty();e("#link-containers").prop("checked",false);if(r.ContainerConfig.Memory){this.memory_slider.value=r.ContainerConfig.Memory}else{this.memory_slider.value=512*1024*1024;this.memory_slider.value=undefined}if(r.ContainerConfig.CpuShares){this.cpu_slider.value=r.ContainerConfig.CpuShares}else{this.cpu_slider.value=1024;this.cpu_slider.value=undefined}var c=["happy","jolly","dreamy","sad","angry","pensive","focused","sleepy","grave","distracted","determined","stoic","stupefied","sharp","agitated","cocky","tender","goofy","furious","desperate","hopeful","compassionate","silly","lonely","condescending","naughty","kickass","drunk","boring","nostalgic","ecstatic","insane","cranky","mad","jovial","sick","hungry","thirsty","elegant","backstabbing","clever","trusting","loving","suspicious","berserk","high","romantic","prickly","evil"];var l=["lovelace","franklin","tesla","einstein","bohr","davinci","pasteur","nobel","curie","darwin","turing","ritchie","torvalds","pike","thompson","wozniak","galileo","euclid","newton","fermat","archimedes","poincare","heisenberg","feynman","hawking","fermi","pare","mccarthy","engelbart","babbage","albattani","ptolemy","bell","wright","lumiere","morse","mclean","brown","bardeen","brattain","shockley"];function u(){function e(e){return e[Math.round(Math.random()*(e.length-1))]}return e(c)+"_"+e(l)}e("#containers-run-image").text(o.image_info.RepoTags[0]);e("#containers-run-image-name").val(u());var d=e("#containers-run-image-command");d.val(t.quote_cmdline(o.image_info.Config.Cmd));var p=e("#select-exposed-ports");p.empty();var f=this.port_renderer();for(var h in o.image_info.Config.ExposedPorts)f(parseInt(h),h.slice(-3),false);if(p.children().length>0){e("#expose-ports").prop("checked",true);p.show()}else{e("#expose-ports").prop("checked",false)}},configuration_validator:function(){var n=this;function r(){e("#containers-run-image-run").prop("disabled",e("#containers_run_image_dialog").find(".has-error").length>0)}function t(n,r){if(r===undefined)return e(n.closest(".form-inline").find(".help-block"));else return e(n.closest(".form-inline").find(".help-block")[r])}function o(e){if(e===undefined)return"";else if(e===0)return i("Container")+": ";else return i("Host")+": "}function a(e,n,r,i){e.parent().addClass(n);var a=t(e,i);a.text(o(i)+r);var s=a.parent();s.addClass(n);s.show()}function s(e,n){e.parent().removeClass("has-error");var r=t(e,n).parent();r.removeClass("has-error");r.hide()}function c(e,n,r,t){var o=e[r];var c=o.val();s(o,t);if(c==="")return;if(/\D/.test(c)||c<0||c>65535){a(o,"has-error",i("Invalid port"),t);return}for(var l=0;l<e.length;++l){if(l===r)continue;var u=e[l];if(c===u.val()&&n[r]===n[l]){a(o,"has-error",i("Duplicate port"),t);return}}}function l(){e("#select-exposed-ports").children("form").each(function(){var n=e(this);var r=n.find("input");r=[e(r[0]),e(r[1])];s(r[0],0);s(r[1],1)})}function u(){if(!e("#expose-ports").prop("checked")){l();r();return}var n={container:[],host:[],protocol:[]};e("#select-exposed-ports").children("form").each(function(){var r=e(this);var t=r.find("input");t=[e(t[0]),e(t[1])];if(t[0].val()!==""||t[1].val()!==""){n.container.push(t[0]);n.host.push(t[1]);n.protocol.push(r.find("button span").text().toLowerCase())}else{s(t[0],0);s(t[1],1)}});for(var t=0;t<n.container.length;++t){c(n.container,n.protocol,t,0);c(n.host,n.protocol,t,1)}r()}function d(){e("#containers-run-image-command-note").hide();e("#containers-run-image-command").parent().removeClass("has-error")}function p(){if(e("#containers-run-image-command").val()===""){e("#containers-run-image-command-note").show();e("#containers-run-image-command").parent().addClass("has-error")}else{d()}r()}function f(e,n,r,i){e.parent().addClass(n);var o=t(e,i);o.text(r);var a=o.parent();a.addClass(n);a.show()}function h(e,n){var r=e[n];var t=r.val();s(r,1);if(t===""){f(r,"has-error",i("No alias specified"),1);return}for(var o=0;o<e.length;++o){if(o===n)continue;var a=e[o];if(t===a.val()){f(r,"has-error",i("Duplicate alias"),1);return}}}function m(){e("#select-linked-containers").children("form").each(function(){var n=e(this);var r=n.find("select");var t=n.find('input[name="alias"]');s(r,0);s(t,1)})}function v(){if(!e("#link-containers").prop("checked")){m();r();return}var n=[];var t=[];e("#select-linked-containers").children("form").each(function(){var r=e(this);var t=r.find("button span");var o=t[0].nodeValue;var a=r.find('input[name="alias"]');if(a.val()!==""||o!==""){if(o==="")f(t,"has-error",i("No container specified"),0);else s(t,0);n.push(a)}else{s(t,0);s(a,1)}});for(var o=0;o<n.length;++o)h(n,o);r()}function g(e,t){window.clearTimeout(n.error_timeout);n.error_timeout=null;if(e==="clear"){d();l();m();r()}else if(e==="all"){p();u();v()}else if(e==="changeFocus"||e==="changeOption"){if(t==="command")p();else if(t==="ports")u();else if(t==="links")v()}else if(e==="input"||e==="keydown"){if(t==="command")n.error_timeout=window.setTimeout(p,2e3);else if(t==="ports")n.error_timeout=window.setTimeout(u,2e3);else if(t==="links")n.error_timeout=window.setTimeout(v,2e3);n.setTimeout=null}}return g},port_renderer:function(){var n=this;var t=e("#port-expose-tmpl").html();r.parse(t);function o(){s()}function a(r){var t=e(r.target).closest("form");t.remove();if(e("#select-exposed-ports").children().length===0){e("#expose-ports").attr("checked",false)}n.validator("changeFocus","ports")}function s(s,c,l){if(s===undefined)s="";if(c===undefined)c="TCP";if(l===undefined)l=true;var u=e(r.render(t,{host_port_label:i("to host port"),placeholder:i("none")}));u.children("button.fa-plus").on("click",o);if(l){u.children("button.pficon-close").on("click",a)}else{u.children("button.pficon-close").attr("disabled",true)}var d=u.find('input[name="container"]');d.val(s);if(l){d.on("keydown",e.proxy(n,"update","keydown","ports"));d.on("input",e.proxy(n,"update","input","ports"));d.on("focusout change",e.proxy(n,"update","changeFocus","ports"))}else{d.attr("disabled",true)}var p=u.find('input[name="host"]');p.on("keydown",e.proxy(n,"update","keydown","ports"));p.on("input",e.proxy(n,"update","input","ports"));p.on("focusout change",e.proxy(n,"update","changeFocus","ports"));var f=u.find("div .port-expose-protocol");if(l){f.find("a").on("click",function(){f.find("button span").text(e(this).text());n.update("changeOption","ports")})}else{f.attr("disabled",true)}f.find("button span").text(c.toUpperCase());e("#select-exposed-ports").append(u)}return s},link_renderer:function(){var n=this;var t=e("#container-link-tmpl").html();r.parse(t);function o(){s()}function a(r){var t=e(r.target).closest("form");t.remove();if(e("#select-linked-containers").children().length===0){e("#link-containers").attr("checked",false)}n.update("changeFocus","links")}function s(){var s=e(r.render(t,{containers:n.containers,alias_label:i("alias"),placeholder:i("none")}));s.children("button.fa-plus").on("click",o);s.children("button.pficon-close").on("click",a);var c=s.find("input");c.on("keydown",e.proxy(n,"update","keydown","links"));c.on("input",e.proxy(n,"update","input","links"));c.on("focusout change",e.proxy(n,"update","changeFocus","links"));var l=s.find("div .link-container");l.find("a").on("click",function(){l.find("button span").text(e(this).text());n.update("changeOption","links")});e("#select-linked-containers").append(s)}return s},run:function(){this.perform_checks=true;this.update("all");if(e("#containers-run-image-run").prop("disabled"))return;var n=e("#containers-run-image-name").val();var r=e("#containers-run-image-command").val();var i={};var a,s;var c,l,u;var d=[];var p={};if(e("#expose-ports").prop("checked")){e("#select-exposed-ports").children("form").each(function(){var n=e(this).find("input").map(function(n,r){return e(r).val()}).get();c=n[0];l=n[1];u=e(this).find("button span").text().toLowerCase();if(c===""||l==="")return;i[c+"/"+u]=[{HostPort:l}];p[c+"/"+u]={}})}if(e("#link-containers").prop("checked")){e("#select-linked-containers form").each(function(){var n=e(this);var r=n.find("button span").text();var t=n.find('input[name="alias"]').val();if(!r||!t){return}d.push(r+":"+t)})}e("#containers_run_image_dialog").modal("hide");var f=e("#containers-run-image-with-terminal").prop("checked");var h={Cmd:t.unquote_cmdline(r),Image:o.image_info.Id,Memory:this.memory_slider.value||0,MemorySwap:this.memory_slider.value*2||0,CpuShares:this.cpu_slider.value||0,Tty:f,ExposedPorts:p,HostConfig:{Links:d}};if(f){e.extend(h,{AttachStderr:true,AttachStdin:true,AttachStdout:true,OpenStdin:true,StdinOnce:true})}o.client.create(n,h).fail(function(e){t.show_unexpected_error(e)}).done(function(e){o.client.start(e.Id,{PortBindings:i}).fail(function(e){t.show_unexpected_error(e)})})}};function o(){this._init()}var a=new o;a.setup();function s(n,r){o.image_info=n.images[r];o.client=n;a.enter();e("#containers_run_image_dialog").modal("show")}return s});

//# sourceURL=docker/run.min.js

define("docker/search", ["jquery","base1/cockpit","docker/util","docker/docker"],function(e,a,t,r){var s=a.gettext;var n=a.gettext;i.prototype={_init:function(){this.id="containers-search-image-dialog"},show:function(){e("#containers-search-image-search").focus()},leave:function(){this.cancel_search();e(this.client).off(".containers-search-image-dialog");this.client=null},setup:function(){e("#containers-search-image-search").on("keypress",e.proxy(this,"input"));e("#containers-search-image-search").attr("placeholder","search by name, namespace or description");e("#containers-search-download").on("click",e.proxy(this,"start_download"));e("#containers-search-tag").prop("disabled",true);e("#containers-search-download").prop("disabled",true);this.search_timeout=null;this.search_request=null},enter:function(){this.client=i.client;e("#containers-search-image-results tbody tr").remove();e("#containers-search-image-results").hide();e("#containers-search-image-no-results").hide();e("#containers-search-image-search")[0].value=""},input:function(e){this.cancel_search();if(e.target.value.length<3&&e.which!=13)return;var a=this;this.search_timeout=window.setTimeout(function(){a.perform_search(a.client)},e.which==13?0:2e3)},start_download:function(a){var n=e("#containers-search-download").data("repo");var i=e("#containers-search-download").data("registry")||undefined;var o=e("#containers-search-tag").val();e("#containers-search-tag").prop("disabled",true);e("#containers-search-download").data("repo","");e("#containers-search-download").prop("disabled",true);var c=e('<tr id="imagedl_'+n.replace("/","_")+'">').append(e('<td class="container-col-tags">').text(n+":"+o),e('<td class="container-col-created">').text("Downloading"),e('<td class="image-col-size-graph">').append(e('<div class="progress progress-striped active">').append(e('<div class="progress-bar" role="progressbar" aria-valuenow="1" aria-valuemin="0" aria-valuemax="1" style="width: 100%">'))),e('<td class="image-col-size-text">'),e('<td class="cell-buttons">'));t.insert_table_sorted(e("#containers-images table"),c);var l=c.children("td.container-col-created");var d=c.children("td.image-col-size-text");var h=false;var u={};r.pull(n,o,i).progress(function(e,a){if("id"in a){var t=a["status"];if(a["status"]=="Downloading"){t+=": "+a["progressDetail"]["current"]+"/"+a["progressDetail"]["total"]}u[a["id"]]=t;if(a["status"]=="Download complete"){delete u[a["id"]]}}var r="";for(var s in u){r+=s+": "+u[s]+"&nbsp;&nbsp;&nbsp;&nbsp;"}d.html(r)}).fail(function(e){console.warn("pull failed:",e);h=true;l.text(s("Error downloading"));d.text(e.message).attr("title",e.message);c.on("click",function(){c.remove()})}).always(function(){if(!h)c.remove()});e("#containers-search-image-dialog").modal("hide")},perform_search:function(a){var r=e("#containers-search-image-search")[0].value;e("#containers-search-image-waiting").addClass("spinner");e("#containers-search-image-no-results").hide();e("#containers-search-image-results").hide();e("#containers-search-image-results tbody tr").remove();this.search_request=a.search(r).done(function(a){var s=a&&JSON.parse(a);e("#containers-search-image-waiting").removeClass("spinner");if(s&&s.length>0){e("#containers-search-image-results").show();s.forEach(function(a){var r=e("<tr>").append(e("<td>").text(a.name),e("<td>").text(a.description));r.on("click",function(t){e("#containers-search-image-results tr").each(function(){e(this).removeClass("active")});r.addClass("active");e("#containers-search-tag").val("latest");e("#containers-search-tag").prop("disabled",false);e("#containers-search-download").data("repo",a.name);e("#containers-search-download").data("registry",a.registry_name);e("#containers-search-download").prop("disabled",false)});r.data("entry",a);t.insert_table_sorted_generic(e("#containers-search-image-results"),r,function(e,a){if(e.data("entry").is_official&&!a.data("entry").is_official)return-1;if(!e.data("entry").is_official&&a.data("entry").is_official)return 1;if(e.data("entry").is_automated&&!a.data("entry").is_automated)return-1;if(!e.data("entry").is_automated&&a.data("entry").is_automated)return 1;if(e.data("entry").star_count!=a.data("entry").star_count)return a.data("entry").star_count-e.data("entry").star_count;return e.data("entry").name.localeCompare(a.data("entry").name)})})}else{e("#containers-search-image-no-results").html("No results for "+r+"<br />Please try another term");e("#containers-search-image-no-results").show()}})},cancel_search:function(){window.clearTimeout(this.search_timeout);e("#containers-search-image-no-results").hide();e("#containers-search-image-results").hide();e("#containers-search-image-results tbody tr").remove();if(this.search_request!==null){this.search_request.close();this.search_request=null}e("#containers-search-image-waiting").removeClass("waiting");e("#containers-search-tag").prop("disabled",true);e("#containers-search-download").prop("disabled",true)}};function i(){this._init()}var o=new i;o.setup();e("#containers-search-image-dialog").on("show.bs.modal",function(){o.enter()}).on("shown.bs.modal",function(){o.show()}).on("hidden.bs.modal",function(){o.leave()});function c(a){i.client=a;e("#containers-search-image-dialog").modal("show")}return c});

//# sourceURL=docker/search.min.js

define("docker/util", ["jquery","base1/cockpit","base1/mustache","docker/docker","shell/controls"],function(e,n,t,r,i){var o=n.gettext;var a=n.gettext;var c={};c.resource_debug=function l(){if(window.debugging=="all"||window.debugging=="resource")console.debug.apply(console,arguments)};c.docker_debug=function d(){if(window.debugging=="all"||window.debugging=="docker")console.debug.apply(console,arguments)};c.quote_cmdline=function s(e){return r.quote_cmdline(e||[])};c.unquote_cmdline=function u(e){return r.unquote_cmdline(e)};c.render_container_cmdline=function f(e){if(e.Config)return c.quote_cmdline((e.Config.Entrypoint||[]).concat(e.Config.Cmd||[]));else return e.Command};c.render_container_name=function g(e){if(e.length>0&&e[0]=="/")return e.slice(1);else return e};c.render_container_state=function m(e){if(e.Running)return n.format(o("Up since $StartedAt"),e);else return n.format(o("Exited $ExitCode"),e)};c.multi_line=function p(e){return e.map(function(e){return t.render("{{.}}",e)}).join("<br/>")};c.format_cpu_shares=function h(e){if(!e)return o("default");return n.format(o("$0 shares"),Math.round(e))};c.format_cpu_usage=function b(e){if(e===undefined||isNaN(e))return"";return Math.round(e)+"%"};c.update_memory_bar=function _(n,t,r){var i=[t];if(r)i.push(r);e(n).attr("value",i.join("/")).toggleClass("bar-row-danger",!!(r&&t>.9*r))};c.format_memory_and_limit=function v(e,t){var r="";var i=1024;var o;if(t){o=n.format_bytes(t,i,true);r=" / "+o.join(" ");i=o[1]}if(e){o=n.format_bytes(e,i,true);if(r)return o[0]+r;else return o.join(" ")}else{return"?"+r}};c.insert_table_sorted=function y(e,n){c.insert_table_sorted_generic(e,n,function(e,n){return e.text().localeCompare(n.text())})};c.insert_table_sorted_generic=function x(n,t,r){var i=e(n).find("tbody tr");for(var o=0;o<i.length;o++){if(r(e(i[o]),t)>0){e(t).insertBefore(i[o]);t=null;break}}if(t!==null)e(n).find("tbody").append(t)};c.setup_danger_button=function k(n,t,r){var i=e('<button class="btn btn-default btn-control fa fa-check enable-danger">').toggle(false).on("click",r);e(n+" th.container-col-actions").append(i);e(t)[0].addEventListener("click",function(t){if(e(t.target).parents(n).length===0&&e(n+" button.enable-danger").hasClass("active"))r()},true)};c.render_container=function w(t,r,a,l,d,s){var u=e(document.getElementById(a+l));if(!d){u.remove();if(!r.find("table > tbody > tr").length){r.find("button.enable-danger").toggle(false)}return}var f;var g,m;var p,h,b;var _;if(d.State&&d.State.Running){f=c.format_cpu_usage(d.CpuUsage);g=d.MemoryUsage;m=d.MemoryLimit;h=c.format_memory_and_limit(g,m);p=true;b={color:"inherit"}}else{f="";p=false;h=o("Stopped");b={color:"grey","text-align":"right"}}var v=false;if(!u.length){r.find("button.enable-danger").toggle(true);var y=e('<div class="spinner">');var x=e('<button class="btn btn-danger pficon pficon-delete btn-delete">').on("click",function(){var n=this;e(n).hide().siblings("div.spinner").show();c.docker_container_delete(t,l,function(){},function(){e(n).show().siblings("div.spinner").hide()});return false});var k=e('<button class="btn btn-default btn-control fa fa-play">').on("click",function(){e(this).hide().siblings("div.spinner").show();t.start(l).fail(function(e){c.handle_scope_start_container(t,l,e.message)});return false});var w=e('<button class="btn btn-default btn-control fa fa-stop">').on("click",function(){e(this).hide().siblings("div.spinner").show();t.stop(l).fail(function(e){c.show_unexpected_error(e)});return false});u=e("<tr>",{id:a+l}).append(e('<td class="container-col-name">'),e('<td class="container-col-image">'),e('<td class="container-col-command">'),e('<td class="container-col-cpu">'),e('<td class="container-col-memory-graph">').append(i.BarRow("containers-containers")),e('<td class="container-col-memory-text">'),e('<td class="container-col-danger cell-buttons">').append(x,y),e('<td class="container-col-actions cell-buttons">').append(k,w,y.clone()));u.on("click",function(e){n.location.go([l])});v=true}var C=u.children("td");e(C[0]).text(c.render_container_name(d.Name));e(C[1]).text(d.Image);e(C[2]).text(c.render_container_cmdline(d));e(C[3]).text(f);c.update_memory_bar(e(C[4]).children("div").toggle(p),g,m);e(C[5]).css(b).text(h);var S=l in t.waiting;e(C[6]).children("div.spinner").toggle(S);e(C[6]).children("button.btn-delete").toggle(!S).toggleClass("disabled",d.State.Running);var M=S||d.State.Running?"You can only delete<br/> stopped containers":"Delete immediately";e(C[6]).children("button.btn-delete").tooltip("destroy").attr("title",M).tooltip({html:true});e(C[7]).children("div.spinner").toggle(S);e(C[7]).children("button.fa-play").toggle(!S&&!d.State.Running);e(C[7]).children("button.fa-stop").toggle(!S&&d.State.Running);e(C[6]).toggle(s);e(C[7]).toggle(!s);u.toggleClass("unimportant",!d.State.Running);if(v)c.insert_table_sorted(r.find("table"),u)};c.MemorySlider=function C(t,r,i){var a=this;var c,l;var d;function s(){if(c.disabled){d=undefined;return o("unlimited")}d=Math.round(c.value*i);if(d<r)d=r;return n.format_bytes(d,1024)}c=t.find("div.slider").on("change",function(){e(l).text(s())})[0];l=t.find("span")[0];var u=t.find("input[type='checkbox']").on("change",function(){e(c).attr("disabled",!this.checked);e(l).toggleClass("disabled",!this.checked);e(l).text(s())})[0];Object.defineProperty(this,"value",{get:function(){return d},set:function(n){if(n!==undefined){e(c).prop("value",n/i).trigger("change")}e(u).prop("checked",n!==undefined).trigger("change")}});Object.defineProperty(this,"max",{get:function(){return i},set:function(n){var t=i;i=n;e(c).prop("value",c.value*t/i).trigger("change")}});return this};c.CpuSlider=function S(n,t,r){var i=this;var o,a;var l;var d=Math.log(t);var s=Math.log(r);var u=s-d;function f(){if(o.disabled)l=undefined;else l=Math.round(Math.exp(d+u*o.value));return c.format_cpu_shares(l)}o=n.find("div.slider").on("change",function(){e(a).text(f())})[0];a=n.find("span")[0];var g=n.find("input[type='checkbox']").on("change",function(){e(o).attr("disabled",!this.checked);e(a).toggleClass("disabled",!this.checked);e(a).text(f())});Object.defineProperty(this,"value",{get:function(){return l},set:function(n){if(n!==undefined){e(o).prop("value",(Math.log(n)-d)/u).trigger("change")}e(g).prop("checked",n!==undefined).trigger("change")}});return this};c.docker_container_delete=function M(e,t,r,i){e.rm(t).fail(function(a){if(a.message.indexOf("remove a running container")>-1){var l=e.containers[t];var d;if(l.State.Running){d=o("Container is currently running.")}else{d=o("Container is currently marked as not running, but regular stopping failed.")+" "+o("Error message from Docker:")+" '"+a.message+"'"}var s;if(l.Name)s=l.Name;else s=t;if(s.charAt(0)==="/")s=s.substring(1);c.confirm(n.format(o("Please confirm forced deletion of $0"),s),d,o("Force Delete")).done(function(){e.rm(t,true).fail(function(e){c.show_unexpected_error(e);i()}).done(r)}).fail(i);return}c.show_unexpected_error(a);i()}).done(r)};c.handle_scope_start_container=function j(e,t,r,i,a){var l=".scope already exists";var d=r.indexOf(l);if(d>-1){var s="Unit docker-";var u=r.indexOf(s)+s.length;var f=r.substring(u,d);n.spawn(["systemctl","stop","docker-"+f+".scope"],{superuser:"try"}).done(function(){e.start(t).fail(function(e){if(a)a()}).done(function(){if(i)i()});return}).fail(function(e){c.show_unexpected_error(n.format(o("Failed to stop Docker scope: $0"),e));if(a)a()});return}c.show_unexpected_error(r);if(a)a()};c.show_unexpected_error=function R(n){e("#error-popup-message").text(n.message||n||"???");e('.modal[role="dialog"]').modal("hide");e("#error-popup").modal("show")};c.confirm=function q(n,t,r){var i=e.Deferred();e("#confirmation-dialog-title").text(n);if(typeof t=="string")e("#confirmation-dialog-body").text(t);else e("#confirmation-dialog-body").html(t);e("#confirmation-dialog-confirm").text(r);function o(){e("#confirmation-dialog button").off("click");e("#confirmation-dialog").modal("hide")}e("#confirmation-dialog-confirm").click(function(){o();i.resolve()});e("#confirmation-dialog-cancel").click(function(){o();i.reject()});e("#confirmation-dialog").modal("show");return i.promise()};return c});

//# sourceURL=docker/util.min.js
