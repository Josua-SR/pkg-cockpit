define(["jquery","base1/cockpit","base1/mustache","docker/docker","docker/util","docker/run"],function(e,t,i,a,n,o){var d=t.gettext;var r=t.gettext;s.prototype={_init:function(e){this.client=e;this.danger_enabled=false},getTitle:function(){return r("page-title","Containers")},toggle_danger:function(t){var i=this;i.danger_enabled=t;e("#image-details-containers button.enable-danger").toggleClass("active",i.danger_enabled);e("#image-details-containers td.container-col-actions").toggle(!i.danger_enabled);e("#image-details-containers td.container-col-danger").toggle(i.danger_enabled)},setup:function(){var i=this;e("#image-details .breadcrumb a").on("click",function(){t.location.go("/")});n.setup_danger_button("#image-details-containers","#image-details",function(){i.toggle_danger(!i.danger_enabled)});e("#image-details-run").on("click",e.proxy(this,"run_image"));e("#image-details-delete").on("click",e.proxy(this,"delete_image"))},enter:function(i){var a=this;this.image_id=i;this.name=t.format(d("Image $0"),this.image_id.slice(0,12));e("#image-details-containers table tbody tr").remove();e("#image-details-containers button.enable-danger").toggle(false);e(this.client).on("image.image-details",function(e,t,i){if(t==a.image_id)a.update()});e(this.client).on("container.image-details",function(e,t,i){if(!i||i.Config&&i.Config.Image==a.image_id)a.render_container(t,i)});for(var n in this.client.containers){var o=this.client.containers[n];if(o.Config&&o.Config.Image==a.image_id)a.render_container(o.Id,o)}this.update()},update:function(){e("#image-details-id").text("");e("#image-details-entrypoint").text("");e("#image-details-command").text("");e("#image-details-created").text("");e("#image-details-author").text("");e("#image-details-ports").text("");var t=this.client.images[this.image_id];n.docker_debug("image-details",this.image_id,t);if(!t){e("#image-details-id").text(d("Not found"));return}var i=!!this.client.waiting[this.image_id];e("#image-details-buttons div.waiting").toggle(i);e("#image-details-buttons button").toggle(!i);if(t.RepoTags&&t.RepoTags.length>0)this.name=t.RepoTags[0];e("#image-details .breadcrumb .active").text(this.name);e("#image-details-id").text(t.Id);e("#image-details-tags").html(n.multi_line(t.RepoTags));e("#image-details-created").text(t.Created);e("#image-details-author").text(t.Author);var a=t.Config;if(a){var o=[];for(var r in a.ExposedPorts){o.push(r)}e("#image-details-entrypoint").text(n.quote_cmdline(a.Entrypoint));e("#image-details-command").text(n.quote_cmdline(a.Cmd));e("#image-details-ports").text(o.join(", "))}},render_container:function(t,i){n.render_container(this.client,e("#image-details-containers"),"I",t,i,this.danger_enabled)},run_image:function(){o(this.client,this.image_id)},delete_image:function(){var e=this;var i=t.location;n.confirm(t.format(d("Please confirm deletion of $0"),e.name),d("Deleting an image will delete it, but you can probably download it again if you need it later.  Unless this image has never been pushed to a repository, that is, in which case you probably can't download it again."),d("Delete")).done(function(){e.client.rmi(e.image_id).fail(function(e){n.show_unexpected_error(e)}).done(function(){i.go("/")})})}};function s(e){this._init(e)}function g(t){var i=new s(t);i.setup();function a(){e("#image-details").hide()}function n(t){i.enter(t);e("#image-details").show()}return{show:n,hide:a}}return{init:g}});
