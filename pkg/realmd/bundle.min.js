
define("domain/operation", ["jquery","base1/cockpit","shell/controls","data!./operation.html","base1/bootstrap-select"],function(e,r,a,o){var s={};var i=r.gettext;var t="/org/freedesktop/realmd";var n="org.freedesktop.realmd.Service";var l="org.freedesktop.realmd.Provider";var d="org.freedesktop.realmd.KerberosMembership";var m="org.freedesktop.realmd.Realm";function p(a,s,p,u){var f=e.parseHTML(o)[0];var c=function(r,a){return new e.fn.init(r,a||f)};c.fn=c.prototype=e.fn;e.extend(c,e);var v=null;var h=null;var w=null;var g=null;c(".realms-op-cancel").on("click",function(){if(!A())c(f).modal("hide")});c(f).on("hide.bs.modal",function(){A()});c(".realms-op-apply").on("click",J);c(".realms-op-field").on("keydown",function(e){if(e.which==13)J()});c(f).on("click",".realms-op-more-diagnostics",function(){c(".realms-op-error").hide();c(".realms-op-diagnostics").show()});var b=null;c(".realms-op-address").on("keyup change",function(){if(c(".realms-op-address").val()!=w){c(".realms-op-address-error").hide();window.clearTimeout(b);b=window.setTimeout(j,1e3)}});c("select.realms-op-auth").selectpicker().on("change",function(){var e=(c("select.realms-op-auth").val()||"").split("/");var r=e[0];var a=e[1];c(".realms-op-admin-row").hide();c(".realms-op-admin-password-row").hide();c(".realms-op-user-row").hide();c(".realms-op-user-password-row").hide();c(".realms-op-otp-row").hide();if(r=="password"&&a=="administrator"){c(".realms-op-admin-row").show();c(".realms-op-admin-password-row").show()}else if(r=="password"&&a=="user"){c(".realms-op-user-row").show();c(".realms-op-user-password-row").show()}else if(r=="secret"){c(".realms-op-otp-row").show()}});var y,k;if(s=="join"){y=i("page-title","Join a Domain");k=i("Join");c(".realms-op-join-only-row").show();j("")}else{y=i("page-title","Leave Domain");k=i("Leave");c(".realms-op-join-only-row").hide()}c(".realms-op-title").text(y);c(".realms-op-apply").text(k);c(".realms-op-field").val("");function j(e){var o=c.Deferred();if(e===undefined)e=c(".realms-op-address").val();if(e)c(".realms-op-address-spinner").show();o.always(function(){if(e)c(".realms-op-address-spinner").hide()});a.call(t,l,"Discover",[e,{}]).always(function(){if(c(".realms-op-address").val()!=e){o.reject();j();return}var s,t=[],n;if(this.state()=="rejected"){s=arguments[0];c(".realms-op-error").empty().text(s.message);o.reject(s)}var l;if(arguments[0][1])t=arguments[0][1];n=t[0];if(!n){if(e){l=r.format(i("Domain $0 could not be contacted"),e);c(".realms-op-address-error").show().attr("title",l)}p=null;g=null;o.reject(new Error(l))}else{g=a.proxy(d,n);c(g).on("changed",D);p=a.proxy(m,n);c(p).on("changed",D);p.wait(function(){o.resolve(p)})}D()});h=o.promise();w=e;return h}function x(){if(s!="join"){var e=c.Deferred();e.resolve(p);return e.promise()}if(c(".realms-op-address").val()===w){if(h)return h}return j()}function D(){var e=0;var a;c(".realms-op-spinner").toggle(!!v);c(".realms-op-wait-message").toggle(!!v);c(".realms-op-field").prop("disabled",!!v);c(".realms-op-apply").prop("disabled",!!v);if(p&&g&&!g.valid){a=r.format(i("Domain $0 is not supported"),p.Name);c(".realms-op-address-spinner").hide();c(".realms-op-address-error").show().attr("title",a)}if(v)u.attr("disabled","disabled");else u.removeAttr("disabled");if(s!="join")return;if(p&&p.Name&&!c(".realms-op-address")[0].placeholder){c(".realms-op-address")[0].placeholder=r.format(i('e.g. "$0"'),p.Name)}var o="";if(g){if(g.SuggestedAdministrator)o=r.format(i('e.g. "$0"'),g.SuggestedAdministrator)}c(".realms-op-admin")[0].placeholder=o;var t=c("select.realms-op-auth");var n=g&&g.SupportedJoinCredentials||[];n.push(["password","administrator"]);var l=null;var d=0;function m(e,r,a){var o,s,i=n.length;for(s=0;s<i;s++){if((!e||e==n[s][1])&&r==n[s][0]){o=r+"/"+n[s][1];t.append(c("<option>").attr("value",o).text(a));if(!l)l=o;d+=1;break}}}t.empty();m("administrator","password",i("Administrator Password"));m("user","password",i("User Password"));m(null,"secret",i("One Time Password"));m(null,"automatic",i("Automatic"));c(".realms-authentification-row").toggle(d>1);t.prop("disabled",!!v).val(l);t.triggerHandler("change");t.selectpicker("refresh")}function C(){var e,a;var o=(c("select.realms-op-auth").val()||"").split("/");var s=o[0];var i=o[1];if(i=="user"&&s=="password"){e=[s,i,r.variant("(ss)",[c(".realms-op-user").val(),c(".realms-op-user-password").val()])]}else if(i=="administrator"&&s=="password"){e=[s,i,r.variant("(ss)",[c(".realms-op-admin").val(),c(".realms-op-admin-password").val()])]}else if(s=="secret"){a=c(".realms-op-ot-password").val();e=[s,i,r.variant("ay",r.utf8_encoder().encode(a))]}else{e=["automatic",i,r.variant("s","")]}return e}var T=1;function J(){var e="cockpit-"+T;T+=1;_(e);x().fail(function(){_(null)}).done(function(o){var t={operation:r.variant("s",e)};c(".realms-op-error").empty().show();c(".realms-op-diagnostics").empty().hide();var n="";var l=a.subscribe({member:"Diagnostics"},function(r,a,o,s){if(s[1]===e){console.log(String(s[0]).trim());n+=s[0]}});var d,m;if(s=="join"){m=c(".realms-join-computer-ou").val();if(m)t["computer-ou"]=r.variant("s",m);if(g.valid){d=g.call("Join",[C(),t])}else{_(null);c(".realms-op-error").empty().text(i("Joining this domain is not supported")).show()}}else if(s=="leave"){d=o.Deconfigure(t)}if(!d){l.remove();return}d.fail(function(e){_(null);if(e.name!="com.redhat.Cockpit.Error.Cancelled"){console.log("Failed to join domain: "+o.Name+": "+e);c(".realms-op-error").empty().text(e+" ").show();if(n){c(".realms-op-error").append('<a class="realms-op-more-diagnostics">'+i("More")+"</a>");c(".realms-op-diagnostics").text(n)}}}).done(function(){_(null);c(f).modal("hide")}).always(function(){l.remove()})})}function _(e){v=e;D()}function A(){if(v){a.call(n,t,"Cancel",[v]);_(null);return true}return false}D();return f}s.button=function u(){var o=e;var s=r.dbus("org.freedesktop.realmd");s.watch(t);var n=s.proxies("org.freedesktop.realmd.Realm");var l=null;var d=null;var m=o("<button>").addClass("btn btn-default").attr("id","system_information_realms_button");o(s).on("close",function(e,a){var o;if(a.problem=="not-found")o=i("Cannot join a domain because realmd is not available on this system");else o=r.message(a);m.addClass("disabled").attr("title",o).tooltip({container:"body"}).tooltip("fixTitle");s=null});n.wait(function(){if(!s)return;d=r.permission({admin:true});function e(){a.update_privileged_ui(d,m,r.format(i("The user <b>$0</b> is not permitted to modify realms"),r.user.name))}o(d).on("changed",e)});function u(){var e,r,a;l=[];for(r in n){a=n[r];if(a.Configured)l.push(a)}if(!l||!l.length)e=i("Join Domain");else e=l.map(function(e){return e.Name}).join(", ");m.text(e)}o(n).on("changed",u);u();var f=null;m.on("click",function(){if(f)o(f).remove();if(l&&l.length)f=p(s,"leave",l[0],m);else f=p(s,"join",null,m);o(f).attr("id","realms-op").appendTo("body").modal("show")});m.close=function c(){if(f)f.cancel();m.remove();if(s)s.close();if(d)d.close()};return m};return s});

//# sourceURL=domain/operation.min.js

define("domain/operation.html_text", "<div class=\"modal\" tabindex=\"-1\" role=\"dialog\" data-backdrop=\"static\">\n  <div class=\"modal-dialog\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h4 class=\"modal-title realms-op-title\"></h4>\n      </div>\n      <div class=\"modal-body\">\n        <div class=\"realms-op-fields\">\n          <table class=\"cockpit-form-table realms-op-form\">\n            <tr class=\"realms-op-join-only-row\">\n              <td><label class=\"control-label\" translatable=\"yes\">Domain Address</label></td>\n              <td>\n                <input class=\"realms-op-field form-control realms-op-address\" type=\"text\" value=\"\"/>\n              </td>\n              <td style=\"width:0px\">\n                <div class=\"realms-op-address-spinner\" hidden>\n                  <span class=\"spinner spinner-xs spinner-inline\"></span>\n                </div>\n                <div class=\"realms-op-address-error\" hidden>\n                  <span class=\"fa fa-lg fa-exclamation\"></span>\n                </div>\n              </td>\n            </tr>\n            <tr class=\"realms-op-join-only-row\">\n              <td class=\"header\"></td>\n            </tr>\n            <tr class=\"realms-op-join-only-row\">\n              <td><label class=\"control-label\" translatable=\"yes\">Computer OU</label></td>\n              <td>\n                <input class=\"realms-op-field form-control realms-op-computer-ou\" type=\"text\" value=\"\"/>\n              </td>\n            </tr>\n            <tr class=\"realms-op-join-only-row realms-authentification-row\">\n              <td><label class=\"control-label\" translatable=\"yes\">Authentication</label></td>\n              <td>\n                <select class=\"form-control realms-op-auth\">\n                </select>\n              </td>\n            </tr>\n            <tr class=\"realms-op-join-only-row realms-op-user-row\">\n              <td><label class=\"control-label\" translatable=\"yes\">User Name</label></td>\n              <td>\n                <input class=\"realms-op-field form-control realms-op-user\" type=\"text\" value=\"\"/>\n              </td>\n            </tr>\n            <tr class=\"realms-op-join-only-row realms-op-user-password-row\">\n              <td><label class=\"control-label\" translatable=\"yes\">User Password</label></td>\n              <td>\n                <input class=\"realms-op-field form-control realms-op-user-password\" type=\"password\" value=\"\"/>\n              </td>\n            </tr>\n            <tr class=\"realms-op-join-only-row realms-op-admin-row\">\n              <td><label class=\"control-label\" translatable=\"yes\">Domain Administrator Name</label></td>\n              <td>\n                <input class=\"realms-op-field form-control realms-op-admin\" type=\"text\" value=\"\"/>\n              </td>\n            </tr>\n            <tr class=\"realms-op-join-only-row realms-op-admin-password-row\">\n              <td><label class=\"control-label\" translatable=\"yes\">Domain Administrator Password</label></td>\n              <td>\n                <input class=\"realms-op-field form-control realms-op-admin-password\" type=\"password\" value=\"\"/>\n              </td>\n            </tr>\n            <tr class=\"realms-op-join-only-row realms-op-otp-row\">\n              <td><label class=\"control-label\" translatable=\"yes\">One Time Password</label></td>\n              <td>\n                <input class=\"realms-op-field form-control realms-op-ot-password\" type=\"password\" value=\"\"/>\n              </td>\n            </tr>\n            <tr style=\"height:50px\">\n              <td colspan=\"3\">\n                <div class=\"realms-op-error\" style=\"text-align:left;font-weight:bold\" hidden></div>\n                  <pre class=\"realms-op-diagnostics\" style=\"text-align:left;\" hidden>\n                  </pre>\n                </div>\n              </td>\n            </tr>\n          </table>\n        </div>\n      </div>\n      <div class=\"modal-footer\">\n        <div class=\"realms-op-spinner spinner\" style=\"float: left\"></div>\n        <span class=\"realms-op-wait-message\" style=\"float: left; margin-top: 3px;\"\n            translatable=\"yes\" hidden>This may take a while</span>\n        <button class=\"btn btn-default realms-op-cancel\" translatable=\"yes\">Cancel</button>\n        <button class=\"btn btn-primary realms-op-apply\" translatable=\"yes\">Next</button>\n      </div>\n    </div>\n  </div>\n</div>\n");
//# sourceURL=domain/operation.html
