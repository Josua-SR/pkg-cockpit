define([],function(){(function(){"use strict";var s=this,t=this.document;function e(){this._events=this._events||{}}e.prototype.addListener=function(s,t){this._events[s]=this._events[s]||[];this._events[s].push(t)};e.prototype.on=e.prototype.addListener;e.prototype.removeListener=function(s,t){if(!this._events[s])return;var e=this._events[s],i=e.length;while(i--){if(e[i]===t||e[i].listener===t){e.splice(i,1);return}}};e.prototype.off=e.prototype.removeListener;e.prototype.removeAllListeners=function(s){if(this._events[s])delete this._events[s]};e.prototype.once=function(s,t){function e(){var i=Array.prototype.slice.call(arguments);this.removeListener(s,e);return t.apply(this,i)}e.listener=t;return this.on(s,e)};e.prototype.emit=function(s){if(!this._events[s])return;var t=Array.prototype.slice.call(arguments,1),e=this._events[s],i=e.length,r=0;for(;r<i;r++){e[r].apply(this,t)}};e.prototype.listeners=function(s){return this._events[s]=this._events[s]||[]};var i=0,r=1,h=2,a=3,o=4,n=5,l=6;function c(s){var i=this;if(!(this instanceof c)){return new c(arguments[0],arguments[1],arguments[2])}e.call(this);if(typeof s==="number"){s={cols:arguments[0],rows:arguments[1],handler:arguments[2]}}s=s||{};g(M(c.defaults),function(t){if(s[t]==null){s[t]=c.options[t];if(c[t]!==c.defaults[t]){s[t]=c[t]}}i[t]=s[t]});if(s.colors.length===8){s.colors=s.colors.concat(c._colors.slice(8))}else if(s.colors.length===16){s.colors=s.colors.concat(c._colors.slice(16))}else if(s.colors.length===10){s.colors=s.colors.slice(0,-2).concat(c._colors.slice(8,-2),s.colors.slice(-2))}else if(s.colors.length===18){s.colors=s.colors.concat(c._colors.slice(16,-2),s.colors.slice(-2))}this.colors=s.colors;this.options=s;this.parent=s.body||s.parent||(t?t.getElementsByTagName("body")[0]:null);this.cols=s.cols||s.geometry[0];this.rows=s.rows||s.geometry[1];if(s.handler){this.on("data",s.handler)}this.ybase=0;this.ydisp=0;this.x=0;this.y=0;this.cursorState=0;this.cursorHidden=false;this.convertEol;this.state=0;this.queue="";this.scrollTop=0;this.scrollBottom=this.rows-1;this.applicationKeypad=false;this.applicationCursor=false;this.originMode=false;this.insertMode=false;this.wraparoundMode=false;this.normal=null;this.prefixMode=false;this.selectMode=false;this.visualMode=false;this.searchMode=false;this.searchDown;this.entry="";this.entryPrefix="";this._real;this._selected;this._textarea;this.charset=null;this.gcharset=null;this.glevel=0;this.charsets=[null];this.decLocator;this.x10Mouse;this.vt200Mouse;this.vt300Mouse;this.normalMouse;this.mouseEvents;this.sendFocus;this.utfMouse;this.sgrMouse;this.urxvtMouse;this.element;this.children;this.refreshStart;this.refreshEnd;this.savedX;this.savedY;this.savedCols;this.readable=true;this.writable=true;this.defAttr=0<<18|257<<9|256<<0;this.curAttr=this.defAttr;this.params=[];this.currentParam=0;this.prefix="";this.postfix="";this.lines=[];var r=this.rows;while(r--){this.lines.push(this.blankLine())}this.tabs;this.setupStops()}y(c,e);c.prototype.eraseAttr=function(){return this.defAttr&~511|this.curAttr&511};c.tangoColors=["#2e3436","#cc0000","#4e9a06","#c4a000","#3465a4","#75507b","#06989a","#d3d7cf","#555753","#ef2929","#8ae234","#fce94f","#729fcf","#ad7fa8","#34e2e2","#eeeeec"];c.xtermColors=["#000000","#cd0000","#00cd00","#cdcd00","#0000ee","#cd00cd","#00cdcd","#e5e5e5","#7f7f7f","#ff0000","#00ff00","#ffff00","#5c5cff","#ff00ff","#00ffff","#ffffff"];c.colors=function(){var s=c.tangoColors.slice(),t=[0,95,135,175,215,255],e;e=0;for(;e<216;e++){i(t[e/36%6|0],t[e/6%6|0],t[e%6])}e=0;for(;e<24;e++){t=8+e*10;i(t,t,t)}function i(t,e,i){s.push("#"+r(t)+r(e)+r(i))}function r(s){s=s.toString(16);return s.length<2?"0"+s:s}return s}();c.colors[256]="#000000";c.colors[257]="#f0f0f0";c._colors=c.colors.slice();c.vcolors=function(){var s=[],t=c.colors,e=0,i;for(;e<256;e++){i=parseInt(t[e].substring(1),16);s.push([i>>16&255,i>>8&255,i&255])}return s}();c.defaults={colors:c.colors,convertEol:false,termName:"xterm",geometry:[80,24],cursorBlink:true,visualBell:false,popOnBell:false,scrollback:1e3,screenKeys:false,debug:false,useStyle:false};c.options={};g(M(c.defaults),function(s){c[s]=c.defaults[s];c.options[s]=c.defaults[s]});c.focus=null;c.prototype.focus=function(){if(c.focus===this)return;if(c.focus){c.focus.blur()}if(this.sendFocus)this.send("[I");this.showCursor();c.focus=this};c.prototype.blur=function(){if(c.focus!==this)return;this.cursorState=0;this.refresh(this.y,this.y);if(this.sendFocus)this.send("[O");c.focus=null};c.prototype.initGlobal=function(){var s=this.document;c._boundDocs=c._boundDocs||[];if(~m(c._boundDocs,s)){return}c._boundDocs.push(s);c.bindPaste(s);c.bindKeys(s);c.bindCopy(s);if(this.isIpad){c.fixIpad(s)}if(this.useStyle){c.insertStyle(s,this.colors[256],this.colors[257])}};c.bindPaste=function(s){var t=s.defaultView;f(t,"paste",function(s){var t=c.focus;if(!t)return;if(s.clipboardData){t.send(s.clipboardData.getData("text/plain"))}else if(t.context.clipboardData){t.send(t.context.clipboardData.getData("Text"))}t.element.contentEditable="inherit";return p(s)})};c.bindKeys=function(s){f(s,"keydown",function(s){if(!c.focus)return;var t=s.target||s.srcElement;if(!t)return;if(t===c.focus.element||t===c.focus.context||t===c.focus.document||t===c.focus.body||t===c._textarea||t===c.focus.parent){return c.focus.keyDown(s)}},true);f(s,"keypress",function(s){if(!c.focus)return;var t=s.target||s.srcElement;if(!t)return;if(t===c.focus.element||t===c.focus.context||t===c.focus.document||t===c.focus.body||t===c._textarea||t===c.focus.parent){return c.focus.keyPress(s)}},true);f(s,"mousedown",function(s){if(!c.focus)return;var t=s.target||s.srcElement;if(!t)return;do{if(t===c.focus.element)return}while(t=t.parentNode);c.focus.blur()})};c.bindCopy=function(s){var t=s.defaultView;f(t,"copy",function(s){var t=c.focus;if(!t)return;if(!t._selected)return;var e=t.getCopyTextarea();var i=t.grabText(t._selected.x1,t._selected.x2,t._selected.y1,t._selected.y2);t.emit("copy",i);e.focus();e.textContent=i;e.value=i;e.setSelectionRange(0,i.length);v(function(){t.element.focus();t.focus()},1)})};c.fixIpad=function(s){var t=s.createElement("textarea");t.style.position="absolute";t.style.left="-32000px";t.style.top="-32000px";t.style.width="0px";t.style.height="0px";t.style.opacity="0";t.style.backgroundColor="transparent";t.style.borderStyle="none";t.style.outlineStyle="none";s.getElementsByTagName("body")[0].appendChild(t);c._textarea=t;v(function(){t.focus()},1e3)};c.insertStyle=function(s,t,e){var i=s.getElementById("term-style");if(i)return;var r=s.getElementsByTagName("head")[0];if(!r)return;var i=s.createElement("style");i.id="term-style";i.innerHTML=""+".terminal {\n"+"  float: left;\n"+"  border: "+t+" solid 5px;\n"+'  font-family: "DejaVu Sans Mono", "Liberation Mono", monospace;\n'+"  font-size: 11px;\n"+"  color: "+e+";\n"+"  background: "+t+";\n"+"}\n"+"\n"+".terminal-cursor {\n"+"  color: "+t+";\n"+"  background: "+e+";\n"+"}\n";r.insertBefore(i,r.firstChild)};c.prototype.open=function(s){var t=this,e=0,i;this.parent=s||this.parent;if(!this.parent){throw new Error("Terminal requires a parent element.")}this.context=this.parent.ownerDocument.defaultView;this.document=this.parent.ownerDocument;this.body=this.document.getElementsByTagName("body")[0];if(this.context.navigator&&this.context.navigator.userAgent){this.isMac=!!~this.context.navigator.userAgent.indexOf("Mac");this.isIpad=!!~this.context.navigator.userAgent.indexOf("iPad");this.isMSIE=!!~this.context.navigator.userAgent.indexOf("MSIE")}this.element=this.document.createElement("div");this.element.className="terminal";this.element.style.outline="none";this.element.setAttribute("tabindex",0);this.element.style.backgroundColor=this.colors[256];this.element.style.color=this.colors[257];this.children=[];for(;e<this.rows;e++){i=this.document.createElement("div");this.element.appendChild(i);this.children.push(i)}this.parent.appendChild(this.element);this.refresh(0,this.rows-1);this.initGlobal();this.focus();this.startBlink();f(this.element,"focus",function(){t.focus();if(t.isIpad){c._textarea.focus()}});f(this.element,"mousedown",function(){t.focus()});f(this.element,"mousedown",function(s){var e=s.button!=null?+s.button:s.which!=null?s.which-1:null;if(t.isMSIE){e=e===1?0:e===4?1:e}if(e!==2)return;t.element.contentEditable="true";v(function(){t.element.contentEditable="inherit"},1)},true);this.bindMouse();if(c.brokenBold==null){c.brokenBold=d(this.document)}v(function(){t.element.focus()},100)};c.prototype.bindMouse=function(){var s=this.element,t=this,e=32;var i="onmousewheel"in this.context?"mousewheel":"DOMMouseScroll";function r(s){var t,r;t=n(s);r=l(s);if(!r)return;o(t,r);switch(s.type){case"mousedown":e=t;break;case"mouseup":e=32;break;case i:break}}function h(s){var t=e,i;i=l(s);if(!i)return;t+=32;o(t,i)}function a(s,e){if(!t.utfMouse){if(e===255)return s.push(0);if(e>127)e=127;s.push(e)}else{if(e===2047)return s.push(0);if(e<127){s.push(e)}else{if(e>2047)e=2047;s.push(192|e>>6);s.push(128|e&63)}}}function o(s,e){if(t.vt300Mouse){s&=3;e.x-=32;e.y-=32;var i="[24";if(s===0)i+="1";else if(s===1)i+="3";else if(s===2)i+="5";else if(s===3)return;else i+="0";i+="~["+e.x+","+e.y+"]\r";t.send(i);return}if(t.decLocator){s&=3;e.x-=32;e.y-=32;if(s===0)s=2;else if(s===1)s=4;else if(s===2)s=6;else if(s===3)s=3;t.send("["+s+";"+(s===3?4:0)+";"+e.y+";"+e.x+";"+(e.page||0)+"&w");return}if(t.urxvtMouse){e.x-=32;e.y-=32;e.x++;e.y++;t.send("["+s+";"+e.x+";"+e.y+"M");return}if(t.sgrMouse){e.x-=32;e.y-=32;t.send("[<"+((s&3)===3?s&~3:s)+";"+e.x+";"+e.y+((s&3)===3?"m":"M"));return}var i=[];a(i,s);a(i,e.x);a(i,e.y);t.send("[M"+b.fromCharCode.apply(b,i))}function n(s){var e,i,r,h,a;switch(s.type){case"mousedown":e=s.button!=null?+s.button:s.which!=null?s.which-1:null;if(t.isMSIE){e=e===1?0:e===4?1:e}break;case"mouseup":e=3;break;case"DOMMouseScroll":e=s.detail<0?64:65;break;case"mousewheel":e=s.wheelDeltaY>0?64:65;break}i=s.shiftKey?4:0;r=s.metaKey?8:0;h=s.ctrlKey?16:0;a=i|r|h;if(t.vt200Mouse){a&=h}else if(!t.normalMouse){a=0}e=32+(a<<2)+e;return e}function l(s){var e,r,h,a,o;if(s.pageX==null)return;e=s.pageX;r=s.pageY;o=t.element;while(o&&o!==t.document.documentElement){e-=o.offsetLeft;r-=o.offsetTop;o="offsetParent"in o?o.offsetParent:o.parentNode}h=t.element.clientWidth;a=t.element.clientHeight;e=Math.round(e/h*t.cols);r=Math.round(r/a*t.rows);if(e<0)e=0;if(e>t.cols)e=t.cols;if(r<0)r=0;if(r>t.rows)r=t.rows;e+=32;r+=32;return{x:e,y:r,type:s.type===i?"mousewheel":s.type}}f(s,"mousedown",function(s){if(!t.mouseEvents)return;r(s);t.focus();if(t.vt200Mouse){r({__proto__:s,type:"mouseup"});return p(s)}if(t.normalMouse)f(t.document,"mousemove",h);if(!t.x10Mouse){f(t.document,"mouseup",function e(s){r(s);if(t.normalMouse)u(t.document,"mousemove",h);u(t.document,"mouseup",e);return p(s)})}return p(s)});f(s,i,function(s){if(!t.mouseEvents)return;if(t.x10Mouse||t.vt300Mouse||t.decLocator)return;r(s);return p(s)});f(s,i,function(s){if(t.mouseEvents)return;if(t.applicationKeypad)return;if(s.type==="DOMMouseScroll"){t.scrollDisp(s.detail<0?-5:5)}else{t.scrollDisp(s.wheelDeltaY>0?-5:5)}return p(s)})};c.prototype.destroy=function(){this.readable=false;this.writable=false;this._events={};this.handler=function(){};this.write=function(){};if(this.element.parentNode){this.element.parentNode.removeChild(this.element)}};c.prototype.refresh=function(s,t){var e,i,r,h,a,o,n,l,f,u,p,y,d,b;if(t-s>=this.rows/2){b=this.element.parentNode;if(b)b.removeChild(this.element)}n=this.cols;i=s;if(t>=this.lines.length){this.log("`end` is too large. Most likely a bad CSR.");t=this.lines.length-1}for(;i<=t;i++){d=i+this.ydisp;h=this.lines[d];a="";if(i===this.y&&this.cursorState&&(this.ydisp===this.ybase||this.selectMode)&&!this.cursorHidden){e=this.x}else{e=-1}f=this.defAttr;r=0;for(;r<n;r++){l=h[r][0];o=h[r][1];if(r===e)l=-1;if(l!==f){if(f!==this.defAttr){a+="</span>"}if(l!==this.defAttr){if(l===-1){a+='<span class="reverse-video terminal-cursor">'}else{a+='<span style="';p=l&511;u=l>>9&511;y=l>>18;if(y&1){if(!c.brokenBold){a+="font-weight:bold;"}if(u<8)u+=8}if(y&2){a+="text-decoration:underline;"}if(y&4){if(y&2){a=a.slice(0,-1);a+=" blink;"}else{a+="text-decoration:blink;"}}if(y&8){p=l>>9&511;u=l&511;if(y&1&&u<8)u+=8}if(y&16){a+="visibility:hidden;"}if(p!==256){a+="background-color:"+this.colors[p]+";"}if(u!==257){a+="color:"+this.colors[u]+";"}a+='">'}}}switch(o){case"&":a+="&amp;";break;case"<":a+="&lt;";break;case">":a+="&gt;";break;default:if(o<=" "){a+="&nbsp;"}else{if(x(o))r++;a+=o}break}f=l}if(f!==this.defAttr){a+="</span>"}this.children[i].innerHTML=a}if(b)b.appendChild(this.element)};c.prototype._cursorBlink=function(){if(c.focus!==this)return;this.cursorState^=1;this.refresh(this.y,this.y)};c.prototype.showCursor=function(){if(!this.cursorState){this.cursorState=1;this.refresh(this.y,this.y)}else{}};c.prototype.startBlink=function(){if(!this.cursorBlink)return;var s=this;this._blinker=function(){s._cursorBlink()};this._blink=k(this._blinker,500)};c.prototype.refreshBlink=function(){if(!this.cursorBlink)return;clearInterval(this._blink);this._blink=k(this._blinker,500)};c.prototype.scroll=function(){var s;if(++this.ybase===this.scrollback){this.ybase=this.ybase/2|0;this.lines=this.lines.slice(-(this.ybase+this.rows)+1)}this.ydisp=this.ybase;s=this.ybase+this.rows-1;s-=this.rows-1-this.scrollBottom;if(s===this.lines.length){this.lines.push(this.blankLine())}else{this.lines.splice(s,0,this.blankLine())}if(this.scrollTop!==0){if(this.ybase!==0){this.ybase--;this.ydisp=this.ybase}this.lines.splice(this.ybase+this.scrollTop,1)}this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};c.prototype.scrollDisp=function(s){this.ydisp+=s;if(this.ydisp>this.ybase){this.ydisp=this.ybase}else if(this.ydisp<0){this.ydisp=0}this.refresh(0,this.rows-1)};c.prototype.write=function(s){var t=s.length,e=0,f,u,p;this.refreshStart=this.y;this.refreshEnd=this.y;if(this.ybase!==this.ydisp){this.ydisp=this.ybase;this.maxRange()}for(;e<t;e++){p=s[e];switch(this.state){case i:switch(p){case"":this.bell();break;case"\n":case"":case"\f":if(this.convertEol){this.x=0}this.y++;if(this.y>this.scrollBottom){this.y--;this.scroll()}break;case"\r":this.x=0;break;case"\b":if(this.x>0){this.x--}break;case"	":this.x=this.nextStop();break;case"":this.setgLevel(1);break;case"":this.setgLevel(0);break;case"":this.state=r;break;default:if(p>=" "){if(this.charset&&this.charset[p]){p=this.charset[p]}if(this.x>=this.cols){this.x=0;this.y++;if(this.y>this.scrollBottom){this.y--;this.scroll()}}this.lines[this.y+this.ybase][this.x]=[this.curAttr,p];this.x++;this.updateRange(this.y);if(x(p)){f=this.y+this.ybase;if(this.cols<2||this.x>=this.cols){this.lines[f][this.x-1]=[this.curAttr," "];break}this.lines[f][this.x]=[this.curAttr," "];this.x++}}break}break;case r:switch(p){case"[":this.params=[];this.currentParam=0;this.state=h;break;case"]":this.params=[];this.currentParam=0;this.state=a;break;case"P":this.params=[];this.currentParam=0;this.state=n;break;case"_":this.state=l;break;case"^":this.state=l;break;case"c":this.reset();break;case"E":this.x=0;case"D":this.index();break;case"M":this.reverseIndex();break;case"%":this.setgLevel(0);this.setgCharset(0,c.charsets.US);this.state=i;e++;break;case"(":case")":case"*":case"+":case"-":case".":switch(p){case"(":this.gcharset=0;break;case")":this.gcharset=1;break;case"*":this.gcharset=2;break;case"+":this.gcharset=3;break;case"-":this.gcharset=1;break;case".":this.gcharset=2;break}this.state=o;break;case"/":this.gcharset=3;this.state=o;e--;break;case"N":break;case"O":break;case"n":this.setgLevel(2);break;case"o":this.setgLevel(3);break;case"|":this.setgLevel(3);break;case"}":this.setgLevel(2);break;case"~":this.setgLevel(1);break;case"7":this.saveCursor();this.state=i;break;case"8":this.restoreCursor();this.state=i;break;case"#":this.state=i;e++;break;case"H":this.tabSet();break;case"=":this.log("Serial port requested application keypad.");this.applicationKeypad=true;this.state=i;break;case">":this.log("Switching back to normal keypad.");this.applicationKeypad=false;this.state=i;break;default:this.state=i;this.error("Unknown ESC control: %s.",p);break}break;case o:switch(p){case"0":u=c.charsets.SCLD;break;case"A":u=c.charsets.UK;break;case"B":u=c.charsets.US;break;case"4":u=c.charsets.Dutch;break;case"C":case"5":u=c.charsets.Finnish;break;case"R":u=c.charsets.French;break;case"Q":u=c.charsets.FrenchCanadian;break;case"K":u=c.charsets.German;break;case"Y":u=c.charsets.Italian;break;case"E":case"6":u=c.charsets.NorwegianDanish;break;case"Z":u=c.charsets.Spanish;break;case"H":case"7":u=c.charsets.Swedish;break;case"=":u=c.charsets.Swiss;break;case"/":u=c.charsets.ISOLatin;e++;break;default:u=c.charsets.US;break}this.setgCharset(this.gcharset,u);this.gcharset=null;this.state=i;break;case a:if(p===""||p===""){if(p==="")e++;this.params.push(this.currentParam);switch(this.params[0]){case 0:case 1:case 2:if(this.params[1]){this.title=this.params[1];this.handleTitle(this.title)}break;case 3:break;case 4:case 5:break;case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:break;case 46:break;case 50:break;case 51:break;case 52:break;case 104:case 105:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:break}this.params=[];this.currentParam=0;this.state=i}else{if(!this.params.length){if(p>="0"&&p<="9"){this.currentParam=this.currentParam*10+p.charCodeAt(0)-48}else if(p===";"){this.params.push(this.currentParam);this.currentParam=""}}else{this.currentParam+=p}}break;case h:if(p==="?"||p===">"||p==="!"){this.prefix=p;break}if(p>="0"&&p<="9"){this.currentParam=this.currentParam*10+p.charCodeAt(0)-48;break}if(p==="$"||p==='"'||p===" "||p==="'"){this.postfix=p;break}this.params.push(this.currentParam);this.currentParam=0;if(p===";")break;this.state=i;switch(p){case"A":this.cursorUp(this.params);break;case"B":this.cursorDown(this.params);break;case"C":this.cursorForward(this.params);break;case"D":this.cursorBackward(this.params);break;case"H":this.cursorPos(this.params);break;case"J":this.eraseInDisplay(this.params);break;case"K":this.eraseInLine(this.params);break;case"m":this.charAttributes(this.params);break;case"n":this.deviceStatus(this.params);break;case"@":this.insertChars(this.params);break;case"E":this.cursorNextLine(this.params);break;case"F":this.cursorPrecedingLine(this.params);break;case"G":this.cursorCharAbsolute(this.params);break;case"L":this.insertLines(this.params);break;case"M":this.deleteLines(this.params);break;case"P":this.deleteChars(this.params);break;case"X":this.eraseChars(this.params);break;case"`":this.charPosAbsolute(this.params);break;case"a":this.HPositionRelative(this.params);break;case"c":this.sendDeviceAttributes(this.params);break;case"d":this.linePosAbsolute(this.params);break;case"e":this.VPositionRelative(this.params);break;case"f":this.HVPosition(this.params);break;case"h":this.setMode(this.params);break;case"l":this.resetMode(this.params);break;case"r":this.setScrollRegion(this.params);break;case"s":this.saveCursor(this.params);break;case"u":this.restoreCursor(this.params);break;case"I":this.cursorForwardTab(this.params);break;case"S":this.scrollUp(this.params);break;case"T":if(this.params.length<2&&!this.prefix){this.scrollDown(this.params)}break;case"Z":this.cursorBackwardTab(this.params);break;case"b":this.repeatPrecedingCharacter(this.params);break;case"g":this.tabClear(this.params);break;case"p":switch(this.prefix){case"!":this.softReset(this.params);break}break;default:this.error("Unknown CSI code: %s.",p);break}this.prefix="";this.postfix="";break;case n:if(p===""||p===""){if(p==="")e++;switch(this.prefix){case"":break;case"$q":var y=this.currentParam,d=false;switch(y){case'"q':y='0"q';break;case'"p':y='61"p';break;case"r":y=""+(this.scrollTop+1)+";"+(this.scrollBottom+1)+"r";break;case"m":y="0m";break;default:this.error("Unknown DCS Pt: %s.",y);y="";break}this.send("P"+ +d+"$r"+y+"\\");break;case"+p":break;case"+q":var y=this.currentParam,d=false;this.send("P"+ +d+"+r"+y+"\\");break;default:this.error("Unknown DCS prefix: %s.",this.prefix);break}this.currentParam=0;this.prefix="";this.state=i}else if(!this.currentParam){if(!this.prefix&&p!=="$"&&p!=="+"){this.currentParam=p}else if(this.prefix.length===2){this.currentParam=p}else{this.prefix+=p}}else{this.currentParam+=p}break;case l:if(p===""||p===""){if(p==="")e++;this.state=i}break}}this.updateRange(this.y);this.refresh(this.refreshStart,this.refreshEnd)};c.prototype.writeln=function(s){this.write(s+"\r\n")};c.prototype.keyDown=function(s){var t=this,e;switch(s.keyCode){case 8:if(s.shiftKey){e="\b";break}e="";break;case 9:if(s.shiftKey){e="[Z";break}e="	";break;case 13:e="\r";break;case 27:e="";break;case 37:if(this.applicationCursor){e="OD";break}e="[D";break;case 39:if(this.applicationCursor){e="OC";break}e="[C";break;case 38:if(this.applicationCursor){e="OA";break}if(s.ctrlKey){this.scrollDisp(-1);return p(s)}else{e="[A"}break;case 40:if(this.applicationCursor){e="OB";break}if(s.ctrlKey){this.scrollDisp(1);return p(s)}else{e="[B"}break;case 46:e="[3~";break;case 45:e="[2~";break;case 36:if(this.applicationKeypad){e="OH";break}e="OH";break;case 35:if(this.applicationKeypad){e="OF";break}e="OF";break;case 33:if(s.shiftKey){this.scrollDisp(-(this.rows-1));return p(s)}else{e="[5~"}break;case 34:if(s.shiftKey){this.scrollDisp(this.rows-1);return p(s)}else{e="[6~"}break;case 112:e="OP";break;case 113:e="OQ";break;case 114:e="OR";break;case 115:e="OS";break;case 116:e="[15~";break;case 117:e="[17~";break;case 118:e="[18~";break;case 119:e="[19~";break;case 120:e="[20~";break;case 121:e="[21~";break;case 122:e="[23~";break;case 123:e="[24~";break;default:if(s.ctrlKey){if(s.keyCode>=65&&s.keyCode<=90){if(this.screenKeys){if(!this.prefixMode&&!this.selectMode&&s.keyCode===65){this.enterPrefix();return p(s)}}if(this.prefixMode&&s.keyCode===86){this.leavePrefix();return}if((this.prefixMode||this.selectMode)&&s.keyCode===67){if(this.visualMode){v(function(){t.leaveVisual()},1)}return}e=b.fromCharCode(s.keyCode-64)}else if(s.keyCode===32){e=b.fromCharCode(0)}else if(s.keyCode>=51&&s.keyCode<=55){e=b.fromCharCode(s.keyCode-51+27)}else if(s.keyCode===56){e=b.fromCharCode(127)}else if(s.keyCode===219){e=b.fromCharCode(27)}else if(s.keyCode===221){e=b.fromCharCode(29)}}else if(!this.isMac&&s.altKey||this.isMac&&s.metaKey){if(s.keyCode>=65&&s.keyCode<=90){e=""+b.fromCharCode(s.keyCode+32)}else if(s.keyCode===192){e="`"}else if(s.keyCode>=48&&s.keyCode<=57){e=""+(s.keyCode-48)}}break}if(!e)return true;if(this.prefixMode){this.leavePrefix();return p(s)}if(this.selectMode){this.keySelect(s,e);return p(s)}this.emit("keydown",s);this.emit("key",e,s);this.showCursor();this.handler(e);return p(s)};c.prototype.setgLevel=function(s){this.glevel=s;this.charset=this.charsets[s]};c.prototype.setgCharset=function(s,t){this.charsets[s]=t;if(this.glevel===s){this.charset=t}};c.prototype.keyPress=function(s){var t;p(s);if(s.charCode){t=s.charCode}else if(s.which==null){t=s.keyCode}else if(s.which!==0&&s.charCode!==0){t=s.which}else{return false}if(!t||s.ctrlKey||s.altKey||s.metaKey)return false;t=b.fromCharCode(t);if(this.prefixMode){this.leavePrefix();this.keyPrefix(s,t);return false}if(this.selectMode){this.keySelect(s,t);return false}this.emit("keypress",t,s);this.emit("key",t,s);this.showCursor();this.handler(t);return false};c.prototype.send=function(s){var t=this;if(!this.queue){v(function(){t.handler(t.queue);t.queue=""},1)}this.queue+=s};c.prototype.bell=function(){if(!this.visualBell)return;var s=this;this.element.style.borderColor="white";v(function(){s.element.style.borderColor=""},10);if(this.popOnBell)this.focus()};c.prototype.log=function(){if(!this.debug)return;if(!this.context.console||!this.context.console.log)return;var s=Array.prototype.slice.call(arguments);this.context.console.log.apply(this.context.console,s)};c.prototype.error=function(){if(!this.debug)return;if(!this.context.console||!this.context.console.error)return;var s=Array.prototype.slice.call(arguments);this.context.console.error.apply(this.context.console,s)};c.prototype.resize=function(s,t){var e,i,r,h,a;if(s<1)s=1;if(t<1)t=1;h=this.cols;if(h<s){a=[this.defAttr," "];r=this.lines.length;while(r--){while(this.lines[r].length<s){this.lines[r].push(a)}}}else if(h>s){r=this.lines.length;while(r--){while(this.lines[r].length>s){this.lines[r].pop()}}}this.setupStops(h);this.cols=s;h=this.rows;if(h<t){i=this.element;while(h++<t){if(this.lines.length<t+this.ybase){this.lines.push(this.blankLine())}if(this.children.length<t){e=this.document.createElement("div");i.appendChild(e);this.children.push(e)}}}else if(h>t){while(h-->t){if(this.lines.length>t+this.ybase){this.lines.pop()}if(this.children.length>t){i=this.children.pop();if(!i)continue;i.parentNode.removeChild(i)}}}this.rows=t;if(this.y>=t)this.y=t-1;if(this.x>=s)this.x=s-1;this.scrollTop=0;this.scrollBottom=t-1;this.refresh(0,this.rows-1);this.normal=null};c.prototype.updateRange=function(s){if(s<this.refreshStart)this.refreshStart=s;if(s>this.refreshEnd)this.refreshEnd=s};c.prototype.maxRange=function(){this.refreshStart=0;this.refreshEnd=this.rows-1};c.prototype.setupStops=function(s){if(s!=null){if(!this.tabs[s]){s=this.prevStop(s)}}else{this.tabs={};s=0}for(;s<this.cols;s+=8){this.tabs[s]=true}};c.prototype.prevStop=function(s){if(s==null)s=this.x;while(!this.tabs[--s]&&s>0);return s>=this.cols?this.cols-1:s<0?0:s};c.prototype.nextStop=function(s){if(s==null)s=this.x;while(!this.tabs[++s]&&s<this.cols);return s>=this.cols?this.cols-1:s<0?0:s};c.prototype.eraseRight=function(s,t){var e=this.lines[this.ybase+t],i=[this.eraseAttr()," "];for(;s<this.cols;s++){e[s]=i}this.updateRange(t)};c.prototype.eraseLeft=function(s,t){var e=this.lines[this.ybase+t],i=[this.eraseAttr()," "];s++;while(s--)e[s]=i;this.updateRange(t)};c.prototype.eraseLine=function(s){this.eraseRight(0,s)};c.prototype.blankLine=function(s){var t=s?this.eraseAttr():this.defAttr;var e=[t," "],i=[],r=0;for(;r<this.cols;r++){i[r]=e}return i};c.prototype.ch=function(s){return s?[this.eraseAttr()," "]:[this.defAttr," "]};c.prototype.is=function(s){var t=this.termName;return(t+"").indexOf(s)===0};c.prototype.handler=function(s){this.emit("data",s)};c.prototype.handleTitle=function(s){this.emit("title",s)};c.prototype.index=function(){this.y++;if(this.y>this.scrollBottom){this.y--;this.scroll()}this.state=i};c.prototype.reverseIndex=function(){var s;this.y--;if(this.y<this.scrollTop){this.y++;this.lines.splice(this.y+this.ybase,0,this.blankLine(true));s=this.rows-1-this.scrollBottom;this.lines.splice(this.rows-1+this.ybase-s+1,1);this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)}this.state=i};c.prototype.reset=function(){c.call(this,this.options);this.refresh(0,this.rows-1)};c.prototype.tabSet=function(){this.tabs[this.x]=true;this.state=i};c.prototype.cursorUp=function(s){var t=s[0];if(t<1)t=1;this.y-=t;if(this.y<0)this.y=0};c.prototype.cursorDown=function(s){var t=s[0];if(t<1)t=1;this.y+=t;if(this.y>=this.rows){this.y=this.rows-1}};c.prototype.cursorForward=function(s){var t=s[0];if(t<1)t=1;this.x+=t;if(this.x>=this.cols){this.x=this.cols-1}};c.prototype.cursorBackward=function(s){var t=s[0];if(t<1)t=1;this.x-=t;if(this.x<0)this.x=0};c.prototype.cursorPos=function(s){var t,e;t=s[0]-1;if(s.length>=2){e=s[1]-1}else{e=0}if(t<0){t=0}else if(t>=this.rows){t=this.rows-1}if(e<0){e=0}else if(e>=this.cols){e=this.cols-1}this.x=e;this.y=t};c.prototype.eraseInDisplay=function(s){var t;switch(s[0]){case 0:this.eraseRight(this.x,this.y);t=this.y+1;for(;t<this.rows;t++){this.eraseLine(t)}break;case 1:this.eraseLeft(this.x,this.y);t=this.y;while(t--){this.eraseLine(t)}break;case 2:t=this.rows;while(t--)this.eraseLine(t);break;case 3:;break}};c.prototype.eraseInLine=function(s){switch(s[0]){case 0:this.eraseRight(this.x,this.y);break;case 1:this.eraseLeft(this.x,this.y);break;case 2:this.eraseLine(this.y);break}};c.prototype.charAttributes=function(s){if(s.length===1&&s[0]===0){this.curAttr=this.defAttr;return}var t=s.length,e=0,i=this.curAttr>>18,r=this.curAttr>>9&511,h=this.curAttr&511,a;for(;e<t;e++){a=s[e];if(a>=30&&a<=37){r=a-30}else if(a>=40&&a<=47){h=a-40}else if(a>=90&&a<=97){a+=8;r=a-90}else if(a>=100&&a<=107){a+=8;h=a-100}else if(a===0){i=this.defAttr>>18;r=this.defAttr>>9&511;h=this.defAttr&511}else if(a===1){i|=1}else if(a===4){i|=2}else if(a===5){i|=4}else if(a===7){i|=8}else if(a===8){i|=16}else if(a===22){i&=~1}else if(a===24){i&=~2}else if(a===25){i&=~4}else if(a===27){i&=~8}else if(a===28){i&=~16}else if(a===39){r=this.defAttr>>9&511}else if(a===49){h=this.defAttr&511}else if(a===38){if(s[e+1]===2){e+=2;r=w(s[e]&255,s[e+1]&255,s[e+2]&255);if(r===-1)r=511;e+=2}else if(s[e+1]===5){e+=2;a=s[e]&255;r=a}}else if(a===48){if(s[e+1]===2){e+=2;h=w(s[e]&255,s[e+1]&255,s[e+2]&255);if(h===-1)h=511;e+=2}else if(s[e+1]===5){e+=2;a=s[e]&255;h=a}}else if(a===100){r=this.defAttr>>9&511;h=this.defAttr&511}else{this.error("Unknown SGR attribute: %d.",a)}}this.curAttr=i<<18|r<<9|h};c.prototype.deviceStatus=function(s){if(!this.prefix){switch(s[0]){case 5:this.send("[0n");break;case 6:this.send("["+(this.y+1)+";"+(this.x+1)+"R");break}}else if(this.prefix==="?"){switch(s[0]){case 6:this.send("[?"+(this.y+1)+";"+(this.x+1)+"R");break;case 15:break;case 25:break;case 26:break;case 53:break}}};c.prototype.insertChars=function(s){var t,e,i,r;t=s[0];if(t<1)t=1;e=this.y+this.ybase;i=this.x;r=[this.eraseAttr()," "];while(t--&&i<this.cols){this.lines[e].splice(i++,0,r);this.lines[e].pop()}};c.prototype.cursorNextLine=function(s){var t=s[0];if(t<1)t=1;this.y+=t;if(this.y>=this.rows){this.y=this.rows-1}this.x=0};c.prototype.cursorPrecedingLine=function(s){var t=s[0];if(t<1)t=1;this.y-=t;if(this.y<0)this.y=0;this.x=0};c.prototype.cursorCharAbsolute=function(s){var t=s[0];if(t<1)t=1;this.x=t-1};c.prototype.insertLines=function(s){var t,e,i;t=s[0];if(t<1)t=1;e=this.y+this.ybase;i=this.rows-1-this.scrollBottom;i=this.rows-1+this.ybase-i+1;while(t--){this.lines.splice(e,0,this.blankLine(true));this.lines.splice(i,1)}this.updateRange(this.y);this.updateRange(this.scrollBottom)};c.prototype.deleteLines=function(s){var t,e,i;t=s[0];if(t<1)t=1;e=this.y+this.ybase;i=this.rows-1-this.scrollBottom;i=this.rows-1+this.ybase-i;while(t--){this.lines.splice(i+1,0,this.blankLine(true));this.lines.splice(e,1)}this.updateRange(this.y);this.updateRange(this.scrollBottom)};c.prototype.deleteChars=function(s){var t,e,i;t=s[0];if(t<1)t=1;e=this.y+this.ybase;i=[this.eraseAttr()," "];while(t--){this.lines[e].splice(this.x,1);this.lines[e].push(i)}};c.prototype.eraseChars=function(s){var t,e,i,r;t=s[0];if(t<1)t=1;e=this.y+this.ybase;i=this.x;r=[this.eraseAttr()," "];while(t--&&i<this.cols){this.lines[e][i++]=r}};c.prototype.charPosAbsolute=function(s){var t=s[0];if(t<1)t=1;this.x=t-1;if(this.x>=this.cols){this.x=this.cols-1}};c.prototype.HPositionRelative=function(s){var t=s[0];if(t<1)t=1;this.x+=t;if(this.x>=this.cols){this.x=this.cols-1}};c.prototype.sendDeviceAttributes=function(s){if(s[0]>0)return;if(!this.prefix){if(this.is("xterm")||this.is("rxvt-unicode")||this.is("screen")){this.send("[?1;2c")}else if(this.is("linux")){this.send("[?6c")}}else if(this.prefix===">"){if(this.is("xterm")){this.send("[>0;276;0c")}else if(this.is("rxvt-unicode")){this.send("[>85;95;0c")}else if(this.is("linux")){this.send(s[0]+"c")}else if(this.is("screen")){this.send("[>83;40003;0c")}}};c.prototype.linePosAbsolute=function(s){var t=s[0];if(t<1)t=1;this.y=t-1;if(this.y>=this.rows){this.y=this.rows-1}};c.prototype.VPositionRelative=function(s){var t=s[0];if(t<1)t=1;this.y+=t;if(this.y>=this.rows){this.y=this.rows-1}};c.prototype.HVPosition=function(s){if(s[0]<1)s[0]=1;if(s[1]<1)s[1]=1;this.y=s[0]-1;if(this.y>=this.rows){this.y=this.rows-1}this.x=s[1]-1;if(this.x>=this.cols){this.x=this.cols-1}};c.prototype.setMode=function(s){if(typeof s==="object"){var t=s.length,e=0;
for(;e<t;e++){this.setMode(s[e])}return}if(!this.prefix){switch(s){case 4:this.insertMode=true;break;case 20:break}}else if(this.prefix==="?"){switch(s){case 1:this.applicationCursor=true;break;case 2:this.setgCharset(0,c.charsets.US);this.setgCharset(1,c.charsets.US);this.setgCharset(2,c.charsets.US);this.setgCharset(3,c.charsets.US);break;case 3:this.savedCols=this.cols;this.resize(132,this.rows);break;case 6:this.originMode=true;break;case 7:this.wraparoundMode=true;break;case 12:break;case 66:this.log("Serial port requested application keypad.");this.applicationKeypad=true;break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=s===9;this.vt200Mouse=s===1e3;this.normalMouse=s>1e3;this.mouseEvents=true;this.element.style.cursor="default";this.log("Binding to mouse events.");break;case 1004:this.sendFocus=true;break;case 1005:this.utfMouse=true;break;case 1006:this.sgrMouse=true;break;case 1015:this.urxvtMouse=true;break;case 25:this.cursorHidden=false;break;case 1049:;case 47:case 1047:if(!this.normal){var i={lines:this.lines,ybase:this.ybase,ydisp:this.ydisp,x:this.x,y:this.y,scrollTop:this.scrollTop,scrollBottom:this.scrollBottom,tabs:this.tabs};this.reset();this.normal=i;this.showCursor()}break}}};c.prototype.resetMode=function(s){if(typeof s==="object"){var t=s.length,e=0;for(;e<t;e++){this.resetMode(s[e])}return}if(!this.prefix){switch(s){case 4:this.insertMode=false;break;case 20:break}}else if(this.prefix==="?"){switch(s){case 1:this.applicationCursor=false;break;case 3:if(this.cols===132&&this.savedCols){this.resize(this.savedCols,this.rows)}delete this.savedCols;break;case 6:this.originMode=false;break;case 7:this.wraparoundMode=false;break;case 12:break;case 66:this.log("Switching back to normal keypad.");this.applicationKeypad=false;break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=false;this.vt200Mouse=false;this.normalMouse=false;this.mouseEvents=false;this.element.style.cursor="";break;case 1004:this.sendFocus=false;break;case 1005:this.utfMouse=false;break;case 1006:this.sgrMouse=false;break;case 1015:this.urxvtMouse=false;break;case 25:this.cursorHidden=true;break;case 1049:;case 47:case 1047:if(this.normal){this.lines=this.normal.lines;this.ybase=this.normal.ybase;this.ydisp=this.normal.ydisp;this.x=this.normal.x;this.y=this.normal.y;this.scrollTop=this.normal.scrollTop;this.scrollBottom=this.normal.scrollBottom;this.tabs=this.normal.tabs;this.normal=null;this.refresh(0,this.rows-1);this.showCursor()}break}}};c.prototype.setScrollRegion=function(s){if(this.prefix)return;this.scrollTop=(s[0]||1)-1;this.scrollBottom=(s[1]||this.rows)-1;this.x=0;this.y=0};c.prototype.saveCursor=function(s){this.savedX=this.x;this.savedY=this.y};c.prototype.restoreCursor=function(s){this.x=this.savedX||0;this.y=this.savedY||0};c.prototype.cursorForwardTab=function(s){var t=s[0]||1;while(t--){this.x=this.nextStop()}};c.prototype.scrollUp=function(s){var t=s[0]||1;while(t--){this.lines.splice(this.ybase+this.scrollTop,1);this.lines.splice(this.ybase+this.scrollBottom,0,this.blankLine())}this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};c.prototype.scrollDown=function(s){var t=s[0]||1;while(t--){this.lines.splice(this.ybase+this.scrollBottom,1);this.lines.splice(this.ybase+this.scrollTop,0,this.blankLine())}this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};c.prototype.initMouseTracking=function(s){};c.prototype.resetTitleModes=function(s){};c.prototype.cursorBackwardTab=function(s){var t=s[0]||1;while(t--){this.x=this.prevStop()}};c.prototype.repeatPrecedingCharacter=function(s){var t=s[0]||1,e=this.lines[this.ybase+this.y],i=e[this.x-1]||[this.defAttr," "];while(t--)e[this.x++]=i};c.prototype.tabClear=function(s){var t=s[0];if(t<=0){delete this.tabs[this.x]}else if(t===3){this.tabs={}}};c.prototype.mediaCopy=function(s){};c.prototype.setResources=function(s){};c.prototype.disableModifiers=function(s){};c.prototype.setPointerMode=function(s){};c.prototype.softReset=function(s){this.cursorHidden=false;this.insertMode=false;this.originMode=false;this.wraparoundMode=false;this.applicationKeypad=false;this.applicationCursor=false;this.scrollTop=0;this.scrollBottom=this.rows-1;this.curAttr=this.defAttr;this.x=this.y=0;this.charset=null;this.glevel=0;this.charsets=[null]};c.prototype.requestAnsiMode=function(s){};c.prototype.requestPrivateMode=function(s){};c.prototype.setConformanceLevel=function(s){};c.prototype.loadLEDs=function(s){};c.prototype.setCursorStyle=function(s){};c.prototype.setCharProtectionAttr=function(s){};c.prototype.restorePrivateValues=function(s){};c.prototype.setAttrInRectangle=function(s){var t=s[0],e=s[1],i=s[2],r=s[3],h=s[4];var a,o;for(;t<i+1;t++){a=this.lines[this.ybase+t];for(o=e;o<r;o++){a[o]=[h,a[o][1]]}}this.updateRange(s[0]);this.updateRange(s[2])};c.prototype.savePrivateValues=function(s){};c.prototype.manipulateWindow=function(s){};c.prototype.reverseAttrInRectangle=function(s){};c.prototype.setTitleModeFeature=function(s){};c.prototype.setWarningBellVolume=function(s){};c.prototype.setMarginBellVolume=function(s){};c.prototype.copyRectangle=function(s){};c.prototype.enableFilterRectangle=function(s){};c.prototype.requestParameters=function(s){};c.prototype.selectChangeExtent=function(s){};c.prototype.fillRectangle=function(s){var t=s[0],e=s[1],i=s[2],r=s[3],h=s[4];var a,o;for(;e<r+1;e++){a=this.lines[this.ybase+e];for(o=i;o<h;o++){a[o]=[a[o][0],b.fromCharCode(t)]}}this.updateRange(s[1]);this.updateRange(s[3])};c.prototype.enableLocatorReporting=function(s){var t=s[0]>0};c.prototype.eraseRectangle=function(s){var t=s[0],e=s[1],i=s[2],r=s[3];var h,a,o;o=[this.eraseAttr()," "];for(;t<i+1;t++){h=this.lines[this.ybase+t];for(a=e;a<r;a++){h[a]=o}}this.updateRange(s[0]);this.updateRange(s[2])};c.prototype.setLocatorEvents=function(s){};c.prototype.selectiveEraseRectangle=function(s){};c.prototype.requestLocatorPosition=function(s){};c.prototype.insertColumns=function(){var s=params[0],t=this.ybase+this.rows,e=[this.eraseAttr()," "],i;while(s--){for(i=this.ybase;i<t;i++){this.lines[i].splice(this.x+1,0,e);this.lines[i].pop()}}this.maxRange()};c.prototype.deleteColumns=function(){var s=params[0],t=this.ybase+this.rows,e=[this.eraseAttr()," "],i;while(s--){for(i=this.ybase;i<t;i++){this.lines[i].splice(this.x,1);this.lines[i].push(e)}}this.maxRange()};c.prototype.enterPrefix=function(){this.prefixMode=true};c.prototype.leavePrefix=function(){this.prefixMode=false};c.prototype.enterSelect=function(){this._real={x:this.x,y:this.y,ydisp:this.ydisp,ybase:this.ybase,cursorHidden:this.cursorHidden,lines:this.copyBuffer(this.lines),write:this.write};this.write=function(){};this.selectMode=true;this.visualMode=false;this.cursorHidden=false;this.refresh(this.y,this.y)};c.prototype.leaveSelect=function(){this.x=this._real.x;this.y=this._real.y;this.ydisp=this._real.ydisp;this.ybase=this._real.ybase;this.cursorHidden=this._real.cursorHidden;this.lines=this._real.lines;this.write=this._real.write;delete this._real;this.selectMode=false;this.visualMode=false;this.refresh(0,this.rows-1)};c.prototype.enterVisual=function(){this._real.preVisual=this.copyBuffer(this.lines);this.selectText(this.x,this.x,this.ydisp+this.y,this.ydisp+this.y);this.visualMode=true};c.prototype.leaveVisual=function(){this.lines=this._real.preVisual;delete this._real.preVisual;delete this._selected;this.visualMode=false;this.refresh(0,this.rows-1)};c.prototype.enterSearch=function(s){this.entry="";this.searchMode=true;this.searchDown=s;this._real.preSearch=this.copyBuffer(this.lines);this._real.preSearchX=this.x;this._real.preSearchY=this.y;this.entryPrefix="Search: ";var t=this.ydisp+this.rows-1;for(var e=0;e<this.entryPrefix.length;e++){this.lines[t][e]=[this.defAttr&~511|4,this.entryPrefix[e]]}this.y=this.rows-1;this.x=this.entryPrefix.length;this.refresh(this.rows-1,this.rows-1)};c.prototype.leaveSearch=function(){this.searchMode=false;if(this._real.preSearch){this.lines=this._real.preSearch;this.x=this._real.preSearchX;this.y=this._real.preSearchY;delete this._real.preSearch;delete this._real.preSearchX;delete this._real.preSearchY}this.refresh(this.rows-1,this.rows-1)};c.prototype.copyBuffer=function(s){var s=s||this.lines,t=[];for(var e=0;e<s.length;e++){t[e]=[];for(var i=0;i<s[e].length;i++){t[e][i]=[s[e][i][0],s[e][i][1]]}}return t};c.prototype.getCopyTextarea=function(s){var t=this._copyTextarea,e=this.document;if(!t){t=e.createElement("textarea");t.style.position="absolute";t.style.left="-32000px";t.style.top="-32000px";t.style.width="0px";t.style.height="0px";t.style.opacity="0";t.style.backgroundColor="transparent";t.style.borderStyle="none";t.style.outlineStyle="none";e.getElementsByTagName("body")[0].appendChild(t);this._copyTextarea=t}return t};c.prototype.copyText=function(s){var t=this,e=this.getCopyTextarea();this.emit("copy",s);e.focus();e.textContent=s;e.value=s;e.setSelectionRange(0,s.length);v(function(){t.element.focus();t.focus()},1)};c.prototype.selectText=function(s,t,e,i){var r,h,a,o,n,l,c,f,u;if(this._selected){r=this._selected.x1;h=this._selected.x2;a=this._selected.y1;o=this._selected.y2;if(o<a){n=h;h=r;r=n;n=o;o=a;a=n}if(h<r&&a===o){n=h;h=r;r=n}for(c=a;c<=o;c++){l=0;f=this.cols-1;if(c===a){l=r}if(c===o){f=h}for(;l<=f;l++){if(this.lines[c][l].old!=null){u=this.lines[c][l].old;delete this.lines[c][l].old;this.lines[c][l]=[u,this.lines[c][l][1]]}}}e=this._selected.y1;s=this._selected.x1}e=Math.max(e,0);e=Math.min(e,this.ydisp+this.rows-1);i=Math.max(i,0);i=Math.min(i,this.ydisp+this.rows-1);this._selected={x1:s,x2:t,y1:e,y2:i};if(i<e){n=t;t=s;s=n;n=i;i=e;e=n}if(t<s&&e===i){n=t;t=s;s=n}for(c=e;c<=i;c++){l=0;f=this.cols-1;if(c===e){l=s}if(c===i){f=t}for(;l<=f;l++){u=this.lines[c][l][0];this.lines[c][l]=[u&~511|(511<<9|4),this.lines[c][l][1]];this.lines[c][l].old=u}}e=e-this.ydisp;i=i-this.ydisp;e=Math.max(e,0);e=Math.min(e,this.rows-1);i=Math.max(i,0);i=Math.min(i,this.rows-1);this.refresh(0,this.rows-1)};c.prototype.grabText=function(s,t,e,i){var r="",h="",a,o,n,l,c;if(i<e){c=t;t=s;s=c;c=i;i=e;e=c}if(t<s&&e===i){c=t;t=s;s=c}for(n=e;n<=i;n++){o=0;l=this.cols-1;if(n===e){o=s}if(n===i){l=t}for(;o<=l;o++){a=this.lines[n][o][1];if(a===" "){h+=a;continue}if(h){r+=h;h=""}r+=a;if(x(a))o++}h="";r+="\n"}for(o=t,n=i;o<this.cols;o++){if(this.lines[n][o][1]!==" "){r=r.slice(0,-1);break}}return r};c.prototype.keyPrefix=function(s,t){if(t==="k"||t==="&"){this.destroy()}else if(t==="p"||t==="]"){this.emit("request paste")}else if(t==="c"){this.emit("request create")}else if(t>="0"&&t<="9"){t=+t-1;if(!~t)t=9;this.emit("request term",t)}else if(t==="n"){this.emit("request term next")}else if(t==="P"){this.emit("request term previous")}else if(t===":"){this.emit("request command mode")}else if(t==="["){this.enterSelect()}};c.prototype.keySelect=function(s,t){this.showCursor();if(this.searchMode||t==="n"||t==="N"){return this.keySearch(s,t)}if(t===""){var e=this.ydisp+this.y;if(this.ydisp===this.ybase){this.y=Math.min(this.y+(this.rows-1)/2|0,this.rows-1);this.refresh(0,this.rows-1)}else{this.scrollDisp((this.rows-1)/2|0)}if(this.visualMode){this.selectText(this.x,this.x,e,this.ydisp+this.y)}return}if(t===""){var e=this.ydisp+this.y;if(this.ydisp===0){this.y=Math.max(this.y-(this.rows-1)/2|0,0);this.refresh(0,this.rows-1)}else{this.scrollDisp(-(this.rows-1)/2|0)}if(this.visualMode){this.selectText(this.x,this.x,e,this.ydisp+this.y)}return}if(t===""){var e=this.ydisp+this.y;this.scrollDisp(this.rows-1);if(this.visualMode){this.selectText(this.x,this.x,e,this.ydisp+this.y)}return}if(t===""){var e=this.ydisp+this.y;this.scrollDisp(-(this.rows-1));if(this.visualMode){this.selectText(this.x,this.x,e,this.ydisp+this.y)}return}if(t==="k"){var e=this.ydisp+this.y;this.y--;if(this.y<0){this.y=0;this.scrollDisp(-1)}if(this.visualMode){this.selectText(this.x,this.x,e,this.ydisp+this.y)}else{this.refresh(this.y,this.y+1)}return}if(t==="j"){var e=this.ydisp+this.y;this.y++;if(this.y>=this.rows){this.y=this.rows-1;this.scrollDisp(1)}if(this.visualMode){this.selectText(this.x,this.x,e,this.ydisp+this.y)}else{this.refresh(this.y-1,this.y)}return}if(t==="h"){var i=this.x;this.x--;if(this.x<0){this.x=0}if(this.visualMode){this.selectText(this.x,i,this.ydisp+this.y,this.ydisp+this.y)}else{this.refresh(this.y,this.y)}return}if(t==="l"){var i=this.x;this.x++;if(this.x>=this.cols){this.x=this.cols-1}if(this.visualMode){this.selectText(i,this.x,this.ydisp+this.y,this.ydisp+this.y)}else{this.refresh(this.y,this.y)}return}if(t==="v"||t===" "){if(!this.visualMode){this.enterVisual()}else{this.leaveVisual()}return}if(t==="y"){if(this.visualMode){var r=this.grabText(this._selected.x1,this._selected.x2,this._selected.y1,this._selected.y2);this.copyText(r);this.leaveVisual()}return}if(t==="q"){if(this.visualMode){this.leaveVisual()}else{this.leaveSelect()}return}if(t==="w"||t==="W"){var h=this.x;var a=this.y;var o=this.ydisp;var i=this.x;var e=this.y;var n=this.ydisp;var l=false;for(;;){var c=this.lines[n+e];while(i<this.cols){if(c[i][1]<=" "){l=true}else if(l){break}i++}if(i>=this.cols)i=this.cols-1;if(i===this.cols-1&&c[i][1]<=" "){i=0;if(++e>=this.rows){e--;if(++n>this.ybase){n=this.ybase;i=this.x;break}}continue}break}this.x=i,this.y=e;this.scrollDisp(-this.ydisp+n);if(this.visualMode){this.selectText(h,this.x,a+o,this.ydisp+this.y)}return}if(t==="b"||t==="B"){var h=this.x;var a=this.y;var o=this.ydisp;var i=this.x;var e=this.y;var n=this.ydisp;for(;;){var c=this.lines[n+e];var l=i>0&&c[i][1]>" "&&c[i-1][1]>" ";while(i>=0){if(c[i][1]<=" "){if(l&&(i+1<this.cols&&c[i+1][1]>" ")){i++;break}else{l=true}}i--}if(i<0)i=0;if(i===0&&(c[i][1]<=" "||!l)){i=this.cols-1;if(--e<0){e++;if(--n<0){n++;i=0;break}}continue}break}this.x=i,this.y=e;this.scrollDisp(-this.ydisp+n);if(this.visualMode){this.selectText(this.x,h,this.ydisp+this.y,a+o)}return}if(t==="e"||t==="E"){var i=this.x+1;var e=this.y;var n=this.ydisp;if(i>=this.cols)i--;for(;;){var c=this.lines[n+e];while(i<this.cols){if(c[i][1]<=" "){i++}else{break}}while(i<this.cols){if(c[i][1]<=" "){if(i-1>=0&&c[i-1][1]>" "){i--;break}}i++}if(i>=this.cols)i=this.cols-1;if(i===this.cols-1&&c[i][1]<=" "){i=0;if(++e>=this.rows){e--;if(++n>this.ybase){n=this.ybase;break}}continue}break}this.x=i,this.y=e;this.scrollDisp(-this.ydisp+n);if(this.visualMode){this.selectText(h,this.x,a+o,this.ydisp+this.y)}return}if(t==="^"||t==="0"){var h=this.x;if(t==="0"){this.x=0}else if(t==="^"){var c=this.lines[this.ydisp+this.y];var i=0;while(i<this.cols){if(c[i][1]>" "){break}i++}if(i>=this.cols)i=this.cols-1;this.x=i}if(this.visualMode){this.selectText(this.x,h,this.ydisp+this.y,this.ydisp+this.y)}else{this.refresh(this.y,this.y)}return}if(t==="$"){var h=this.x;var c=this.lines[this.ydisp+this.y];var i=this.cols-1;while(i>=0){if(c[i][1]>" "){if(this.visualMode&&i<this.cols-1)i++;break}i--}if(i<0)i=0;this.x=i;if(this.visualMode){this.selectText(h,this.x,this.ydisp+this.y,this.ydisp+this.y)}else{this.refresh(this.y,this.y)}return}if(t==="g"||t==="G"){var h=this.x;var a=this.y;var o=this.ydisp;if(t==="g"){this.x=0,this.y=0;this.scrollDisp(-this.ydisp)}else if(t==="G"){this.x=0,this.y=this.rows-1;this.scrollDisp(this.ybase)}if(this.visualMode){this.selectText(h,this.x,a+o,this.ydisp+this.y)}return}if(t==="H"||t==="M"||t==="L"){var h=this.x;var a=this.y;if(t==="H"){this.x=0,this.y=0}else if(t==="M"){this.x=0,this.y=this.rows/2|0}else if(t==="L"){this.x=0,this.y=this.rows-1}if(this.visualMode){this.selectText(h,this.x,this.ydisp+a,this.ydisp+this.y)}else{this.refresh(a,a);this.refresh(this.y,this.y)}return}if(t==="{"||t==="}"){var h=this.x;var a=this.y;var o=this.ydisp;var c;var f=false;var u=false;var p=-1;var e=this.y+(t==="{"?-1:1);var n=this.ydisp;var y;if(t==="{"){if(e<0){e++;if(n>0)n--}}else if(t==="}"){if(e>=this.rows){e--;if(n<this.ybase)n++}}for(;;){c=this.lines[n+e];for(y=0;y<this.cols;y++){if(c[y][1]>" "){if(p===-1){p=0}f=true;break}else if(y===this.cols-1){if(p===-1){p=1}else if(p===0){u=true}else if(p===1){if(f)u=true}break}}if(u)break;if(t==="{"){e--;if(e<0){e++;if(n>0)n--;else break}}else if(t==="}"){e++;if(e>=this.rows){e--;if(n<this.ybase)n++;else break}}}if(!u){if(t==="{"){e=0;n=0}else if(t==="}"){e=this.rows-1;n=this.ybase}}this.x=0,this.y=e;this.scrollDisp(-this.ydisp+n);if(this.visualMode){this.selectText(h,this.x,a+o,this.ydisp+this.y)}return}if(t==="/"||t==="?"){if(!this.visualMode){this.enterSearch(t==="/")}return}return false};c.prototype.keySearch=function(s,t){if(t===""){this.leaveSearch();return}if(t==="\r"||!this.searchMode&&(t==="n"||t==="N")){this.leaveSearch();var e=this.entry;if(!e){this.refresh(0,this.rows-1);return}var i=this.x;var r=this.y;var h=this.ydisp;var a;var o=false;var n=false;var l=this.x+1;var c=this.ydisp+this.y;var f,u;var p=t==="N"?this.searchDown:!this.searchDown;for(;;){a=this.lines[c];while(l<this.cols){for(u=0;u<e.length;u++){if(l+u>=this.cols)break;if(a[l+u][1]!==e[u]){break}else if(a[l+u][1]===e[u]&&u===e.length-1){o=true;break}}if(o)break;l+=u+1}if(o)break;l=0;if(!p){c++;if(c>this.ybase+this.rows-1){if(n)break;n=true;c=0}}else{c--;if(c<0){if(n)break;n=true;c=this.ybase+this.rows-1}}}if(o){if(c-this.ybase<0){f=c;c=0;if(f>this.ybase){c=f-this.ybase;f=this.ybase}}else{f=this.ybase;c-=this.ybase}this.x=l,this.y=c;this.scrollDisp(-this.ydisp+f);if(this.visualMode){this.selectText(i,this.x,r+h,this.ydisp+this.y)}return}this.refresh(0,this.rows-1);return}if(t==="\b"||t===""){if(this.entry.length===0)return;var y=this.ydisp+this.rows-1;this.entry=this.entry.slice(0,-1);var u=this.entryPrefix.length+this.entry.length;this.lines[y][u]=[this.lines[y][u][0]," "];this.x--;this.refresh(this.rows-1,this.rows-1);this.refresh(this.y,this.y);return}if(t.length===1&&t>=" "&&t<="~"){var y=this.ydisp+this.rows-1;this.entry+=t;var u=this.entryPrefix.length+this.entry.length-1;this.lines[y][u]=[this.defAttr&~511|4,t];this.x++;this.refresh(this.rows-1,this.rows-1);this.refresh(this.y,this.y);return}return false};c.charsets={};c.charsets.SCLD={"`":"◆",a:"▒",b:"	",c:"\f",d:"\r",e:"\n",f:"°",g:"±",h:"␤",i:"",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"};c.charsets.UK=null;c.charsets.US=null;c.charsets.Dutch=null;c.charsets.Finnish=null;c.charsets.French=null;c.charsets.FrenchCanadian=null;c.charsets.German=null;c.charsets.Italian=null;c.charsets.NorwegianDanish=null;c.charsets.Spanish=null;c.charsets.Swedish=null;c.charsets.Swiss=null;c.charsets.ISOLatin=null;function f(s,t,e,i){s.addEventListener(t,e,i||false)}function u(s,t,e,i){s.removeEventListener(t,e,i||false)}function p(s){if(s.preventDefault)s.preventDefault();s.returnValue=false;if(s.stopPropagation)s.stopPropagation();s.cancelBubble=true;return false}function y(s,t){function e(){this.constructor=s}e.prototype=t.prototype;s.prototype=new e}function d(s){var t=s.getElementsByTagName("body")[0];var e=s.createElement("span");e.innerHTML="hello world";t.appendChild(e);var i=e.scrollWidth;e.style.fontWeight="bold";var r=e.scrollWidth;t.removeChild(e);return i!==r}var b=this.String;var v=this.setTimeout;var k=this.setInterval;function m(s,t){var e=s.length;while(e--){if(s[e]===t)return e}return-1}function x(s){if(s<="＀")return false;return s>="！"&&s<="ﾾ"||s>="ￂ"&&s<="ￇ"||s>="ￊ"&&s<="ￏ"||s>="ￒ"&&s<="ￗ"||s>="ￚ"&&s<="ￜ"||s>="￠"&&s<="￦"||s>="￨"&&s<="￮"}function w(s,t,e){var i=s<<16|t<<8|e;if(w._cache[i]!=null){return w._cache[i]}var r=Infinity,h=-1,a=0,o,n,l,f,u;for(;a<c.vcolors.length;a++){o=c.vcolors[a];n=o[0];l=o[1];f=o[2];u=w.distance(s,t,e,n,l,f);if(u===0){h=a;break}if(u<r){r=u;h=a}}return w._cache[i]=h}w._cache={};w.distance=function(s,t,e,i,r,h){return Math.pow(30*(s-i),2)+Math.pow(59*(t-r),2)+Math.pow(11*(e-h),2)};function g(s,t,e){if(s.forEach)return s.forEach(t,e);for(var i=0;i<s.length;i++){t.call(e,s[i],i,s)}}function M(s){if(Object.keys)return Object.keys(s);var t,e=[];for(t in s){if(Object.prototype.hasOwnProperty.call(s,t)){e.push(t)}}return e}c.EventEmitter=e;c.inherits=y;c.on=f;c.off=u;c.cancel=p;if(typeof module!=="undefined"){module.exports=c}else{this.Terminal=c}}).call(function(){return this||(typeof window!=="undefined"?window:global)}());return window.Terminal});
