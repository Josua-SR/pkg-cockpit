(function(){"use strict";var t=this,e=this.document;function s(){this._events=this._events||{}}s.prototype.addListener=function(t,e){this._events[t]=this._events[t]||[];this._events[t].push(e)};s.prototype.on=s.prototype.addListener;s.prototype.removeListener=function(t,e){if(!this._events[t])return;var s=this._events[t],i=s.length;while(i--){if(s[i]===e||s[i].listener===e){s.splice(i,1);return}}};s.prototype.off=s.prototype.removeListener;s.prototype.removeAllListeners=function(t){if(this._events[t])delete this._events[t]};s.prototype.once=function(t,e){function s(){var i=Array.prototype.slice.call(arguments);this.removeListener(t,s);return e.apply(this,i)}s.listener=e;return this.on(t,s)};s.prototype.emit=function(t){if(!this._events[t])return;var e=Array.prototype.slice.call(arguments,1),s=this._events[t],i=s.length,r=0;for(;r<i;r++){s[r].apply(this,e)}};s.prototype.listeners=function(t){return this._events[t]=this._events[t]||[]};function i(){s.call(this)}b(i,s);i.prototype.pipe=function(t,e){var s=this,i,r,h;function a(){s.removeListener("data",i);s.removeListener("error",r);s.removeListener("end",h);t.removeListener("error",r);t.removeListener("close",a)}s.on("data",i=function(e){t.write(e)});s.on("error",r=function(t){a();if(!this.listeners("error").length){throw t}});s.on("end",h=function(){t.end();a()});t.on("error",r);t.on("close",a);t.emit("pipe",s);return t};var r=0,h=1,a=2,o=3,n=4,l=5,c=6,f={type:"udk"};function u(t){var s=this;if(!(this instanceof u)){return new u(arguments[0],arguments[1],arguments[2])}i.call(this);if(typeof t==="number"){t={cols:arguments[0],rows:arguments[1],handler:arguments[2]}}t=t||{};C(S(u.defaults),function(e){if(t[e]==null){t[e]=u.options[e];if(u[e]!==u.defaults[e]){t[e]=u[e]}}s[e]=t[e]});if(t.colors.length===8){t.colors=t.colors.concat(u._colors.slice(8))}else if(t.colors.length===16){t.colors=t.colors.concat(u._colors.slice(16))}else if(t.colors.length===10){t.colors=t.colors.slice(0,-2).concat(u._colors.slice(8,-2),t.colors.slice(-2))}else if(t.colors.length===18){t.colors=t.colors.slice(0,-2).concat(u._colors.slice(16,-2),t.colors.slice(-2))}this.colors=t.colors;this.options=t;this.parent=t.body||t.parent||(e?e.getElementsByTagName("body")[0]:null);this.cols=t.cols||t.geometry[0];this.rows=t.rows||t.geometry[1];this.setRawMode;this.isTTY=true;this.isRaw=true;this.columns=this.cols;this.rows=this.rows;if(t.handler){this.on("data",t.handler)}this.ybase=0;this.ydisp=0;this.x=0;this.y=0;this.cursorState=0;this.cursorHidden=false;this.convertEol;this.state=0;this.queue="";this.scrollTop=0;this.scrollBottom=this.rows-1;this.applicationKeypad=false;this.applicationCursor=false;this.originMode=false;this.insertMode=false;this.wraparoundMode=false;this.normal=null;this.prefixMode=false;this.selectMode=false;this.visualMode=false;this.searchMode=false;this.searchDown;this.entry="";this.entryPrefix="Search: ";this._real;this._selected;this._textarea;this.charset=null;this.gcharset=null;this.glevel=0;this.charsets=[null];this.decLocator;this.x10Mouse;this.vt200Mouse;this.vt300Mouse;this.normalMouse;this.mouseEvents;this.sendFocus;this.utfMouse;this.sgrMouse;this.urxvtMouse;this.element;this.children;this.refreshStart;this.refreshEnd;this.savedX;this.savedY;this.savedCols;this.readable=true;this.writable=true;this.defAttr=0<<18|257<<9|256<<0;this.curAttr=this.defAttr;this.params=[];this.currentParam=0;this.prefix="";this.postfix="";this.lines=[];var r=this.rows;while(r--){this.lines.push(this.blankLine())}this.tabs;this.setupStops()}b(u,i);u.tangoColors=["#2e3436","#cc0000","#4e9a06","#c4a000","#3465a4","#75507b","#06989a","#d3d7cf","#555753","#ef2929","#8ae234","#fce94f","#729fcf","#ad7fa8","#34e2e2","#eeeeec"];u.xtermColors=["#000000","#cd0000","#00cd00","#cdcd00","#0000ee","#cd00cd","#00cdcd","#e5e5e5","#7f7f7f","#ff0000","#00ff00","#ffff00","#5c5cff","#ff00ff","#00ffff","#ffffff"];u.colors=function(){var t=u.tangoColors.slice(),e=[0,95,135,175,215,255],s;s=0;for(;s<216;s++){i(e[s/36%6|0],e[s/6%6|0],e[s%6])}s=0;for(;s<24;s++){e=8+s*10;i(e,e,e)}function i(e,s,i){t.push("#"+r(e)+r(s)+r(i))}function r(t){t=t.toString(16);return t.length<2?"0"+t:t}return t}();u.colors[256]="#000000";u.colors[257]="#f0f0f0";u._colors=u.colors.slice();u.vcolors=function(){var t=[],e=u.colors,s=0,i;for(;s<256;s++){i=parseInt(e[s].substring(1),16);t.push([i>>16&255,i>>8&255,i&255])}return t}();u.defaults={colors:u.colors,convertEol:false,termName:"xterm",geometry:[80,24],cursorBlink:true,visualBell:false,popOnBell:false,scrollback:1e3,screenKeys:false,debug:false,useStyle:false};u.options={};C(S(u.defaults),function(t){u[t]=u.defaults[t];u.options[t]=u.defaults[t]});u.focus=null;u.prototype.focus=function(){if(u.focus===this)return;if(u.focus){u.focus.blur()}if(this.sendFocus)this.send("[I");this.showCursor();u.focus=this};u.prototype.blur=function(){if(u.focus!==this)return;this.cursorState=0;this.refresh(this.y,this.y);if(this.sendFocus)this.send("[O");u.focus=null};u.prototype.initGlobal=function(){var t=this.document;u._boundDocs=u._boundDocs||[];if(~w(u._boundDocs,t)){return}u._boundDocs.push(t);u.bindPaste(t);u.bindKeys(t);u.bindCopy(t);if(this.isMobile){this.fixMobile(t)}if(this.useStyle){u.insertStyle(t,this.colors[256],this.colors[257])}};u.bindPaste=function(t){var e=t.defaultView;p(e,"paste",function(t){var e=u.focus;if(!e)return;if(t.clipboardData){e.send(t.clipboardData.getData("text/plain"))}else if(e.context.clipboardData){e.send(e.context.clipboardData.getData("Text"))}e.element.contentEditable="inherit";return d(t)})};u.bindKeys=function(t){p(t,"keydown",function(t){if(!u.focus)return;var e=t.target||t.srcElement;if(!e)return;if(e===u.focus.element||e===u.focus.context||e===u.focus.document||e===u.focus.body||e===u._textarea||e===u.focus.parent){return u.focus.keyDown(t)}},true);p(t,"keypress",function(t){if(!u.focus)return;var e=t.target||t.srcElement;if(!e)return;if(e===u.focus.element||e===u.focus.context||e===u.focus.document||e===u.focus.body||e===u._textarea||e===u.focus.parent){return u.focus.keyPress(t)}},true);p(t,"mousedown",function(t){if(!u.focus)return;var e=t.target||t.srcElement;if(!e)return;do{if(e===u.focus.element)return}while(e=e.parentNode);u.focus.blur()})};u.bindCopy=function(t){var e=t.defaultView;p(e,"copy",function(t){var e=u.focus;if(!e)return;if(!e._selected)return;var s=e.getCopyTextarea();var i=e.grabText(e._selected.x1,e._selected.x2,e._selected.y1,e._selected.y2);e.emit("copy",i);s.focus();s.textContent=i;s.value=i;s.setSelectionRange(0,i.length);k(function(){e.element.focus();e.focus()},1)})};u.prototype.fixMobile=function(t){var e=this;var s=t.createElement("textarea");s.style.position="absolute";s.style.left="-32000px";s.style.top="-32000px";s.style.width="0px";s.style.height="0px";s.style.opacity="0";s.style.backgroundColor="transparent";s.style.borderStyle="none";s.style.outlineStyle="none";s.autocapitalize="none";s.autocorrect="off";t.getElementsByTagName("body")[0].appendChild(s);u._textarea=s;k(function(){s.focus()},1e3);if(this.isAndroid){p(s,"change",function(){var t=s.textContent||s.value;s.value="";s.textContent="";e.send(t+"\r")})}};u.insertStyle=function(t,e,s){var i=t.getElementById("term-style");if(i)return;var r=t.getElementsByTagName("head")[0];if(!r)return;var i=t.createElement("style");i.id="term-style";i.innerHTML=""+".terminal {\n"+"  float: left;\n"+"  border: "+e+" solid 5px;\n"+'  font-family: "DejaVu Sans Mono", "Liberation Mono", monospace;\n'+"  font-size: 11px;\n"+"  color: "+s+";\n"+"  background: "+e+";\n"+"}\n"+"\n"+".terminal-cursor {\n"+"  color: "+e+";\n"+"  background: "+s+";\n"+"}\n";var h="";C(u.colors,function(t,e){if(e===256){h+="\n.term-bg-color-default { background-color: "+t+"; }"}if(e===257){h+="\n.term-fg-color-default { color: "+t+"; }"}h+="\n.term-bg-color-"+e+" { background-color: "+t+"; }";h+="\n.term-fg-color-"+e+" { color: "+t+"; }"});h+="\n.term-bold { font-weight: bold; }";h+="\n.term-underline { text-decoration: underline; }";h+="\n.term-blink { text-decoration: blink; }";h+="\n.term-hidden { visibility: hidden; }";i.innerHTML+=h+"\n";r.insertBefore(i,r.firstChild)};u.prototype.open=function(t){var e=this,s=0,i;this.parent=t||this.parent;if(!this.parent){throw new Error("Terminal requires a parent element.")}this.context=this.parent.ownerDocument.defaultView;this.document=this.parent.ownerDocument;this.body=this.document.getElementsByTagName("body")[0];if(this.context.navigator&&this.context.navigator.userAgent){this.isMac=!!~this.context.navigator.userAgent.indexOf("Mac");this.isIpad=!!~this.context.navigator.userAgent.indexOf("iPad");this.isIphone=!!~this.context.navigator.userAgent.indexOf("iPhone");this.isAndroid=!!~this.context.navigator.userAgent.indexOf("Android");this.isMobile=this.isIpad||this.isIphone||this.isAndroid;this.isMSIE=!!~this.context.navigator.userAgent.indexOf("MSIE")}this.element=this.document.createElement("div");this.element.className="terminal";this.element.style.outline="none";this.element.setAttribute("tabindex",0);this.element.setAttribute("spellcheck","false");this.element.style.backgroundColor=this.colors[256];this.element.style.color=this.colors[257];this.children=[];for(;s<this.rows;s++){i=this.document.createElement("div");this.element.appendChild(i);this.children.push(i)}this.parent.appendChild(this.element);this.refresh(0,this.rows-1);if(!("useEvents"in this.options)||this.options.useEvents){this.initGlobal()}if(!("useFocus"in this.options)||this.options.useFocus){this.focus();this.startBlink();p(this.element,"focus",function(){e.focus();if(e.isMobile){u._textarea.focus()}});p(this.element,"mousedown",function(){e.focus()});p(this.element,"mousedown",function(t){var s=t.button!=null?+t.button:t.which!=null?t.which-1:null;if(e.isMSIE){s=s===1?0:s===4?1:s}if(s!==2)return;e.element.contentEditable="true";k(function(){e.element.contentEditable="inherit"},1)},true)}if(!("useMouse"in this.options)||this.options.useMouse){this.bindMouse()}if(!("useFocus"in this.options)||this.options.useFocus){k(function(){e.element.focus()},100)}if(u.brokenBold==null){u.brokenBold=m(this.document)}this.emit("open")};u.prototype.setRawMode=function(t){this.isRaw=!!t};u.prototype.bindMouse=function(){var t=this.element,e=this,s=32;var i="onmousewheel"in this.context?"mousewheel":"DOMMouseScroll";function r(t){var e,r;e=n(t);r=l(t);if(!r)return;o(e,r);switch(t.type){case"mousedown":s=e;break;case"mouseup":s=32;break;case i:break}}function h(t){var e=s,i;i=l(t);if(!i)return;e+=32;o(e,i)}function a(t,s){if(!e.utfMouse){if(s===255)return t.push(0);if(s>127)s=127;t.push(s)}else{if(s===2047)return t.push(0);if(s<127){t.push(s)}else{if(s>2047)s=2047;t.push(192|s>>6);t.push(128|s&63)}}}function o(t,s){if(e.vt300Mouse){t&=3;s.x-=32;s.y-=32;var i="[24";if(t===0)i+="1";else if(t===1)i+="3";else if(t===2)i+="5";else if(t===3)return;else i+="0";i+="~["+s.x+","+s.y+"]\r";e.send(i);return}if(e.decLocator){t&=3;s.x-=32;s.y-=32;if(t===0)t=2;else if(t===1)t=4;else if(t===2)t=6;else if(t===3)t=3;e.send("["+t+";"+(t===3?4:0)+";"+s.y+";"+s.x+";"+(s.page||0)+"&w");return}if(e.urxvtMouse){s.x-=32;s.y-=32;s.x++;s.y++;e.send("["+t+";"+s.x+";"+s.y+"M");return}if(e.sgrMouse){s.x-=32;s.y-=32;e.send("[<"+((t&3)===3?t&~3:t)+";"+s.x+";"+s.y+((t&3)===3?"m":"M"));return}var i=[];a(i,t);a(i,s.x);a(i,s.y);e.send("[M"+v.fromCharCode.apply(v,i))}function n(t){var s,i,r,h,a;switch(t.type){case"mousedown":s=t.button!=null?+t.button:t.which!=null?t.which-1:null;if(e.isMSIE){s=s===1?0:s===4?1:s}break;case"mouseup":s=3;break;case"DOMMouseScroll":s=t.detail<0?64:65;break;case"mousewheel":s=t.wheelDeltaY>0?64:65;break}i=t.shiftKey?4:0;r=t.metaKey?8:0;h=t.ctrlKey?16:0;a=i|r|h;if(e.vt200Mouse){a&=h}else if(!e.normalMouse){a=0}s=32+(a<<2)+s;return s}function l(t){var s,r,h,a,o;if(t.pageX==null)return;s=t.pageX;r=t.pageY;o=e.element;while(o&&o!==e.document.documentElement){s-=o.offsetLeft;r-=o.offsetTop;o="offsetParent"in o?o.offsetParent:o.parentNode}h=e.element.clientWidth;a=e.element.clientHeight;s=Math.round(s/h*e.cols);r=Math.round(r/a*e.rows);if(s<0)s=0;if(s>e.cols)s=e.cols;if(r<0)r=0;if(r>e.rows)r=e.rows;s+=32;r+=32;return{x:s,y:r,type:t.type===i?"mousewheel":t.type}}p(t,"mousedown",function(t){if(!e.mouseEvents)return;r(t);e.focus();if(e.normalMouse)p(e.document,"mousemove",h);if(!e.x10Mouse){p(e.document,"mouseup",function s(t){r(t);if(e.normalMouse)y(e.document,"mousemove",h);y(e.document,"mouseup",s);return d(t)})}return d(t)});p(t,i,function(t){if(!e.mouseEvents)return;if(e.x10Mouse||e.vt300Mouse||e.decLocator)return;r(t);return d(t)});p(t,i,function(t){if(e.mouseEvents)return;if(e.applicationKeypad)return;if(t.type==="DOMMouseScroll"){e.scrollDisp(t.detail<0?-5:5)}else{e.scrollDisp(t.wheelDeltaY>0?-5:5)}return d(t)})};u.prototype.close=u.prototype.destroySoon=u.prototype.destroy=function(){if(this.destroyed){return}if(this._blink){clearInterval(this._blink);delete this._blink}this.readable=false;this.writable=false;this.destroyed=true;this._events={};this.handler=function(){};this.write=function(){};this.end=function(){};if(this.element.parentNode){this.element.parentNode.removeChild(this.element)}this.emit("end");this.emit("close");this.emit("finish");this.emit("destroy")};u.prototype.refresh=function(t,e){var s,i,r,h,a,o,n,l,c,f,p,y,d,b;if(e-t>=this.rows/2){b=this.element.parentNode;if(b)b.removeChild(this.element)}n=this.cols;i=t;if(e>=this.lines.length){this.log("`end` is too large. Most likely a bad CSR.");e=this.lines.length-1}for(;i<=e;i++){d=i+this.ydisp;h=this.lines[d];a="";if(i===this.y&&this.cursorState&&(this.ydisp===this.ybase||this.selectMode)&&!this.cursorHidden){s=this.x}else{s=-1}c=this.defAttr;r=0;for(;r<n;r++){l=h[r][0];o=h[r][1];if(r===s)l=-1;if(l!==c){if(c!==this.defAttr){a+="</span>"}if(l!==this.defAttr){if(l===-1){a+='<span class="reverse-video terminal-cursor">'}else{if(this.useStyle){a+='<span class="'}else{a+='<span style="'}f=l&511;p=l>>9&511;y=l>>18;if(y&1){if(!u.brokenBold){if(this.useStyle){a+="term-bold "}else{a+="font-weight:bold;"}}if(p<8)p+=8}if(y&2){if(this.useStyle){a+="term-underline "}else{a+="text-decoration:underline;"}}if(y&4){if(this.useStyle){a+="term-blink "}else{if(y&2){a=a.slice(0,-1);a+=" blink;"}else{a+="text-decoration:blink;"}}}if(y&8){f=l>>9&511;p=l&511;if(y&1&&p<8)p+=8}if(y&16){if(this.useStyle){a+="term-hidden "}else{a+="visibility:hidden;"}}if(f!==256){if(this.useStyle){a+="term-bg-color-"+f+" "}else{a+="background-color:"+this.colors[f]+";"}}if(p!==257){if(this.useStyle){a+="term-fg-color-"+p+" "}else{a+="color:"+this.colors[p]+";"}}a+='">'}}}switch(o){case"&":a+="&amp;";break;case"<":a+="&lt;";break;case">":a+="&gt;";break;default:if(o<=" "){a+="&nbsp;"}else{if(g(o))r++;a+=o}break}c=l}if(c!==this.defAttr){a+="</span>"}this.children[i].innerHTML=a}if(b)b.appendChild(this.element)};u.prototype._cursorBlink=function(){if(u.focus!==this)return;this.cursorState^=1;this.refresh(this.y,this.y)};u.prototype.showCursor=function(){if(!this.cursorState){this.cursorState=1;this.refresh(this.y,this.y)}else{}};u.prototype.startBlink=function(){if(!this.cursorBlink)return;var t=this;this._blinker=function(){t._cursorBlink()};this._blink=x(this._blinker,500)};u.prototype.refreshBlink=function(){if(!this.cursorBlink||!this._blink)return;clearInterval(this._blink);this._blink=x(this._blinker,500)};u.prototype.scroll=function(){var t;if(++this.ybase===this.scrollback){this.ybase=this.ybase/2|0;this.lines=this.lines.slice(-(this.ybase+this.rows)+1)}this.ydisp=this.ybase;t=this.ybase+this.rows-1;t-=this.rows-1-this.scrollBottom;if(t===this.lines.length){this.lines.push(this.blankLine())}else{this.lines.splice(t,0,this.blankLine())}if(this.scrollTop!==0){if(this.ybase!==0){this.ybase--;this.ydisp=this.ybase}this.lines.splice(this.ybase+this.scrollTop,1)}this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};u.prototype.scrollDisp=function(t){this.ydisp+=t;if(this.ydisp>this.ybase){this.ydisp=this.ybase}else if(this.ydisp<0){this.ydisp=0}this.refresh(0,this.rows-1)};u.prototype.write=function(t){var e=t.length,s=0,i,p,y;this.refreshStart=this.y;this.refreshEnd=this.y;if(this.ybase!==this.ydisp){this.ydisp=this.ybase;this.maxRange()}for(;s<e;s++,this.lch=y){y=t[s];switch(this.state){case r:switch(y){case"":this.bell();break;case"\n":case"\x0B":case"\f":if(this.convertEol){this.x=0}this.y++;if(this.y>this.scrollBottom){this.y--;this.scroll()}break;case"\r":this.x=0;break;case"\b":if(this.x>0){this.x--}break;case"	":this.x=this.nextStop();break;case"":this.setgLevel(1);break;case"":this.setgLevel(0);break;case"":this.state=h;break;default:if(y>=" "){if(this.charset&&this.charset[y]){y=this.charset[y]}if(this.x>=this.cols){this.x=0;this.y++;if(this.y>this.scrollBottom){this.y--;this.scroll()}}this.lines[this.y+this.ybase][this.x]=[this.curAttr,y];this.x++;this.updateRange(this.y);if(g(y)){i=this.y+this.ybase;if(this.cols<2||this.x>=this.cols){this.lines[i][this.x-1]=[this.curAttr," "];break}this.lines[i][this.x]=[this.curAttr," "];this.x++}}break}break;case h:switch(y){case"[":this.params=[];this.currentParam=0;this.state=a;break;case"]":this.params=[];this.currentParam=0;this.state=o;break;case"P":this.params=[];this.prefix="";this.currentParam="";this.state=l;break;case"_":this.state=c;break;case"^":this.state=c;break;case"c":this.reset();break;case"E":this.x=0;case"D":this.index();break;case"M":this.reverseIndex();break;case"%":this.setgLevel(0);this.setgCharset(0,u.charsets.US);this.state=r;s++;break;case"(":case")":case"*":case"+":case"-":case".":switch(y){case"(":this.gcharset=0;break;case")":this.gcharset=1;break;case"*":this.gcharset=2;break;case"+":this.gcharset=3;break;case"-":this.gcharset=1;break;case".":this.gcharset=2;break}this.state=n;break;case"/":this.gcharset=3;this.state=n;s--;break;case"N":break;case"O":break;case"n":this.setgLevel(2);break;case"o":this.setgLevel(3);break;case"|":this.setgLevel(3);break;case"}":this.setgLevel(2);break;case"~":this.setgLevel(1);break;case"7":this.saveCursor();this.state=r;break;case"8":this.restoreCursor();this.state=r;break;case"#":this.state=r;s++;break;case"H":this.tabSet();break;case"=":this.log("Serial port requested application keypad.");this.applicationKeypad=true;this.state=r;break;case">":this.log("Switching back to normal keypad.");this.applicationKeypad=false;this.state=r;break;default:this.state=r;this.error("Unknown ESC control: %s.",y);break}break;case n:switch(y){case"0":p=u.charsets.SCLD;break;case"A":p=u.charsets.UK;break;case"B":p=u.charsets.US;break;case"4":p=u.charsets.Dutch;break;case"C":case"5":p=u.charsets.Finnish;break;case"R":p=u.charsets.French;break;case"Q":p=u.charsets.FrenchCanadian;break;case"K":p=u.charsets.German;break;case"Y":p=u.charsets.Italian;break;case"E":case"6":p=u.charsets.NorwegianDanish;break;case"Z":p=u.charsets.Spanish;break;case"H":case"7":p=u.charsets.Swedish;break;case"=":p=u.charsets.Swiss;break;case"/":p=u.charsets.ISOLatin;s++;break;default:p=u.charsets.US;break}this.setgCharset(this.gcharset,p);this.gcharset=null;this.state=r;break;case o:if(this.lch===""&&y==="\\"||y===""){if(this.lch===""){if(typeof this.currentParam==="string"){this.currentParam=this.currentParam.slice(0,-1)}else if(typeof this.currentParam=="number"){this.currentParam=(this.currentParam-("".charCodeAt(0)-48))/10}}this.params.push(this.currentParam);switch(this.params[0]){case 0:case 1:case 2:if(this.params[1]){this.title=this.params[1];this.handleTitle(this.title)}break;case 3:break;case 4:case 5:break;case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:break;case 46:break;case 50:break;case 51:break;case 52:break;case 104:case 105:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:break}this.params=[];this.currentParam=0;this.state=r}else{if(!this.params.length){if(y>="0"&&y<="9"){this.currentParam=this.currentParam*10+y.charCodeAt(0)-48}else if(y===";"){this.params.push(this.currentParam);this.currentParam=""}}else{this.currentParam+=y}}break;case a:if(y==="?"||y===">"||y==="!"){this.prefix=y;break}if(y>="0"&&y<="9"){this.currentParam=this.currentParam*10+y.charCodeAt(0)-48;break}if(y==="$"||y==='"'||y===" "||y==="'"){this.postfix=y;break}this.params.push(this.currentParam);this.currentParam=0;if(y===";")break;this.state=r;switch(y){case"A":this.cursorUp(this.params);break;case"B":this.cursorDown(this.params);break;case"C":this.cursorForward(this.params);break;case"D":this.cursorBackward(this.params);break;case"H":this.cursorPos(this.params);break;case"J":this.eraseInDisplay(this.params);break;case"K":this.eraseInLine(this.params);break;case"m":if(!this.prefix){this.charAttributes(this.params)}break;case"n":if(!this.prefix){this.deviceStatus(this.params)}break;case"@":this.insertChars(this.params);break;case"E":this.cursorNextLine(this.params);break;case"F":this.cursorPrecedingLine(this.params);break;case"G":this.cursorCharAbsolute(this.params);break;case"L":this.insertLines(this.params);break;case"M":this.deleteLines(this.params);break;case"P":this.deleteChars(this.params);break;case"X":this.eraseChars(this.params);break;case"`":this.charPosAbsolute(this.params);break;case"a":this.HPositionRelative(this.params);break;case"c":this.sendDeviceAttributes(this.params);break;case"d":this.linePosAbsolute(this.params);break;case"e":this.VPositionRelative(this.params);break;case"f":this.HVPosition(this.params);break;case"h":this.setMode(this.params);break;case"l":this.resetMode(this.params);break;case"r":this.setScrollRegion(this.params);break;case"s":this.saveCursor(this.params);break;case"u":this.restoreCursor(this.params);break;case"I":this.cursorForwardTab(this.params);break;case"S":this.scrollUp(this.params);break;case"T":if(this.params.length<2&&!this.prefix){this.scrollDown(this.params)}break;case"Z":this.cursorBackwardTab(this.params);break;case"b":this.repeatPrecedingCharacter(this.params);break;case"g":this.tabClear(this.params);break;case"p":switch(this.prefix){case"!":this.softReset(this.params);break}break;default:this.error("Unknown CSI code: %s.",y);break}this.prefix="";this.postfix="";break;case l:if(this.lch===""&&y==="\\"||y===""){if(this.prefix==="tmux;"){if(y===""){this.currentParam+=y;continue}}if(this.lch===""){if(typeof this.currentParam==="string"){this.currentParam=this.currentParam.slice(0,-1)}else if(typeof this.currentParam=="number"){this.currentParam=(this.currentParam-("".charCodeAt(0)-48))/10}}this.params.push(this.currentParam);var d=this.params[this.params.length-1];switch(this.prefix){case f:this.emit("udk",{clearAll:this.params[0]===0,eraseBelow:this.params[0]===1,lockKeys:this.params[1]===0,dontLockKeys:this.params[1]===1,keyList:(this.params[2]+"").split(";").map(function(t){t=t.split("/");return{keyCode:t[0],hexKeyValue:t[1]}})});break;case"$q":var b=0;switch(d){case'"q':d='0"q';b=1;break;case'"p':d='61;0"p';b=1;break;case"r":d=""+(this.scrollTop+1)+";"+(this.scrollBottom+1)+"r";b=1;break;case"m":b=0;break;default:this.error("Unknown DCS Pt: %s.",d);b=0;break}this.send("P"+b+"$r"+d+"\\");break;case"+p":this.emit("set terminfo",{name:this.params[0]});break;case"+q":var b=false;this.send("P"+ +b+"+r"+d+"\\");break;case"tmux;":this.emit("passthrough",d);break;default:this.error("Unknown DCS prefix: %s.",d);break}this.currentParam=0;this.prefix="";this.state=r}else{this.currentParam+=y;if(!this.prefix){if(/^\d*;\d*\|/.test(this.currentParam)){this.prefix=f;this.params=this.currentParam.split(/[;|]/).map(function(t){if(!t.length)return 0;return+t}).slice(0,-1);this.currentParam=""}else if(/^[$+][a-zA-Z]/.test(this.currentParam)||/^\w+;\x1b/.test(this.currentParam)){this.prefix=this.currentParam;this.currentParam=""}}}break;case c:if(this.lch===""&&y==="\\"||y===""){this.state=r}break}}this.updateRange(this.y);this.refresh(this.refreshStart,this.refreshEnd);return true};u.prototype.writeln=function(t){return this.write(t+"\r\n")};u.prototype.end=function(t){var e=true;if(t){e=this.write(t)}this.destroySoon();return e};u.prototype.resume=function(){};u.prototype.pause=function(){};u.prototype.keyDown=function(t){var e=this,s;switch(t.keyCode){case 8:if(t.altKey){s="";break}if(t.shiftKey){s="\b";break}s="";break;case 9:if(t.shiftKey){s="[Z";break}s="	";break;case 13:s="\r";break;case 27:s="";break;case 32:s=" ";break;case 37:if(this.applicationCursor){s="OD";break}if(t.ctrlKey){s="[5D";break}s="[D";break;case 39:if(this.applicationCursor){s="OC";break}if(t.ctrlKey){s="[5C";break}s="[C";break;case 38:if(this.applicationCursor){s="OA";break}if(t.ctrlKey){this.scrollDisp(-1);return d(t)}else{s="[A"}break;case 40:if(this.applicationCursor){s="OB";break}if(t.ctrlKey){this.scrollDisp(1);return d(t)}else{s="[B"}break;case 46:s="[3~";break;case 45:s="[2~";break;case 36:if(this.applicationKeypad){s="OH";break}s="OH";break;case 35:if(this.applicationKeypad){s="OF";break}s="OF";break;case 33:if(t.shiftKey){this.scrollDisp(-(this.rows-1));return d(t)}else{s="[5~"}break;case 34:if(t.shiftKey){this.scrollDisp(this.rows-1);return d(t)}else{s="[6~"}break;case 112:s="OP";break;case 113:s="OQ";break;case 114:s="OR";break;case 115:s="OS";break;case 116:s="[15~";break;case 117:s="[17~";break;case 118:s="[18~";break;case 119:s="[19~";break;case 120:s="[20~";break;case 121:s="[21~";break;case 122:s="[23~";break;case 123:s="[24~";break;default:if(t.ctrlKey){if(t.keyCode>=65&&t.keyCode<=90){if(this.screenKeys){if(!this.prefixMode&&!this.selectMode&&t.keyCode===65){this.enterPrefix();return d(t)}}if(this.prefixMode&&t.keyCode===86){this.leavePrefix();return}if((this.prefixMode||this.selectMode)&&t.keyCode===67){if(this.visualMode){k(function(){e.leaveVisual()},1)}return}s=v.fromCharCode(t.keyCode-64)}else if(t.keyCode===32){s=v.fromCharCode(0)}else if(t.keyCode>=51&&t.keyCode<=55){s=v.fromCharCode(t.keyCode-51+27)}else if(t.keyCode===56){s=v.fromCharCode(127)}else if(t.keyCode===219){s=v.fromCharCode(27)}else if(t.keyCode===221){s=v.fromCharCode(29)}}else if(t.altKey){if(t.keyCode>=65&&t.keyCode<=90){s=""+v.fromCharCode(t.keyCode+32)}else if(t.keyCode===192){s="`"}else if(t.keyCode>=48&&t.keyCode<=57){s=""+(t.keyCode-48)}}break}if(!s)return true;if(this.prefixMode){this.leavePrefix();return d(t)}if(this.selectMode){this.keySelect(t,s);return d(t)}this.emit("keydown",t);this.emit("key",s,t);this.showCursor();this.handler(s);return d(t)};u.prototype.setgLevel=function(t){this.glevel=t;this.charset=this.charsets[t]};u.prototype.setgCharset=function(t,e){this.charsets[t]=e;if(this.glevel===t){this.charset=e}};u.prototype.keyPress=function(t){var e;d(t);if(t.charCode){e=t.charCode}else if(t.which==null){e=t.keyCode}else if(t.which!==0&&t.charCode!==0){e=t.which}else{return false}if(!e||t.ctrlKey||t.altKey||t.metaKey)return false;e=v.fromCharCode(e);if(this.prefixMode){this.leavePrefix();this.keyPrefix(t,e);return false}if(this.selectMode){this.keySelect(t,e);return false}this.emit("keypress",e,t);this.emit("key",e,t);this.showCursor();this.handler(e);return false};u.prototype.send=function(t){var e=this;if(!this.queue){k(function(){e.handler(e.queue);e.queue=""},1)}this.queue+=t};u.prototype.bell=function(){this.emit("bell");if(!this.visualBell)return;var t=this;this.element.style.borderColor="white";k(function(){t.element.style.borderColor=""},10);if(this.popOnBell)this.focus()};u.prototype.log=function(){if(!this.debug)return;if(!this.context.console||!this.context.console.log)return;var t=Array.prototype.slice.call(arguments);this.context.console.log.apply(this.context.console,t)};u.prototype.error=function(){if(!this.debug)return;if(!this.context.console||!this.context.console.error)return;var t=Array.prototype.slice.call(arguments);this.context.console.error.apply(this.context.console,t)};u.prototype.resize=function(t,e){var s,i,r,h,a;if(t<1)t=1;if(e<1)e=1;h=this.cols;if(h<t){a=[this.defAttr," "];r=this.lines.length;while(r--){while(this.lines[r].length<t){this.lines[r].push(a)}}}else if(h>t){r=this.lines.length;while(r--){while(this.lines[r].length>t){this.lines[r].pop()}}}this.setupStops(h);this.cols=t;this.columns=t;h=this.rows;if(h<e){i=this.element;while(h++<e){if(this.lines.length<e+this.ybase){this.lines.push(this.blankLine())}if(this.children.length<e){s=this.document.createElement("div");i.appendChild(s);this.children.push(s)}}}else if(h>e){while(h-- >e){if(this.lines.length>e+this.ybase){this.lines.pop()}if(this.children.length>e){i=this.children.pop();if(!i)continue;i.parentNode.removeChild(i)}}}this.rows=e;if(this.y>=e)this.y=e-1;if(this.x>=t)this.x=t-1;this.scrollTop=0;this.scrollBottom=e-1;this.refresh(0,this.rows-1);this.normal=null;this.emit("resize")};u.prototype.updateRange=function(t){if(t<this.refreshStart)this.refreshStart=t;if(t>this.refreshEnd)this.refreshEnd=t};u.prototype.maxRange=function(){this.refreshStart=0;this.refreshEnd=this.rows-1};u.prototype.setupStops=function(t){if(t!=null){if(!this.tabs[t]){t=this.prevStop(t)}}else{this.tabs={};t=0}for(;t<this.cols;t+=8){this.tabs[t]=true}};u.prototype.prevStop=function(t){if(t==null)t=this.x;while(!this.tabs[--t]&&t>0);return t>=this.cols?this.cols-1:t<0?0:t};u.prototype.nextStop=function(t){if(t==null)t=this.x;while(!this.tabs[++t]&&t<this.cols);return t>=this.cols?this.cols-1:t<0?0:t};u.prototype.eraseAttr=function(){return this.defAttr&~511|this.curAttr&511};u.prototype.eraseRight=function(t,e){var s=this.lines[this.ybase+e],i=[this.eraseAttr()," "];for(;t<this.cols;t++){s[t]=i}this.updateRange(e)};u.prototype.eraseLeft=function(t,e){var s=this.lines[this.ybase+e],i=[this.eraseAttr()," "];t++;while(t--)s[t]=i;this.updateRange(e)};u.prototype.eraseLine=function(t){this.eraseRight(0,t)};u.prototype.blankLine=function(t){var e=t?this.eraseAttr():this.defAttr;var s=[e," "],i=[],r=0;for(;r<this.cols;r++){i[r]=s}return i};u.prototype.ch=function(t){return t?[this.eraseAttr()," "]:[this.defAttr," "]};u.prototype.is=function(t){var e=this.termName;return(e+"").indexOf(t)===0};u.prototype.handler=function(t){this.emit("data",t)};u.prototype.handleTitle=function(t){this.emit("title",t)};u.prototype.index=function(){this.y++;if(this.y>this.scrollBottom){this.y--;this.scroll()}this.state=r};u.prototype.reverseIndex=function(){var t;this.y--;if(this.y<this.scrollTop){this.y++;this.lines.splice(this.y+this.ybase,0,this.blankLine(true));t=this.rows-1-this.scrollBottom;this.lines.splice(this.rows-1+this.ybase-t+1,1);this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)}this.state=r};u.prototype.reset=function(){this.options.rows=this.rows;this.options.cols=this.cols;u.call(this,this.options);this.refresh(0,this.rows-1)};u.prototype.tabSet=function(){this.tabs[this.x]=true;this.state=r};u.prototype.cursorUp=function(t){var e=t[0];if(e<1)e=1;this.y-=e;if(this.y<0)this.y=0};u.prototype.cursorDown=function(t){var e=t[0];if(e<1)e=1;this.y+=e;if(this.y>=this.rows){this.y=this.rows-1}};u.prototype.cursorForward=function(t){var e=t[0];if(e<1)e=1;this.x+=e;if(this.x>=this.cols){this.x=this.cols-1}};u.prototype.cursorBackward=function(t){var e=t[0];if(e<1)e=1;this.x-=e;if(this.x<0)this.x=0};u.prototype.cursorPos=function(t){var e,s;e=t[0]-1;if(t.length>=2){s=t[1]-1}else{s=0}if(e<0){e=0}else if(e>=this.rows){e=this.rows-1}if(s<0){s=0}else if(s>=this.cols){s=this.cols-1}this.x=s;this.y=e};u.prototype.eraseInDisplay=function(t){var e;switch(t[0]){case 0:this.eraseRight(this.x,this.y);e=this.y+1;for(;e<this.rows;e++){this.eraseLine(e)}break;case 1:this.eraseLeft(this.x,this.y);e=this.y;while(e--){this.eraseLine(e)}break;case 2:e=this.rows;while(e--)this.eraseLine(e);break;case 3:;break}};u.prototype.eraseInLine=function(t){switch(t[0]){case 0:this.eraseRight(this.x,this.y);break;case 1:this.eraseLeft(this.x,this.y);break;case 2:this.eraseLine(this.y);break}};u.prototype.charAttributes=function(t){if(t.length===1&&t[0]===0){this.curAttr=this.defAttr;return}var e=t.length,s=0,i=this.curAttr>>18,r=this.curAttr>>9&511,h=this.curAttr&511,a;for(;s<e;s++){a=t[s];if(a>=30&&a<=37){r=a-30}else if(a>=40&&a<=47){
h=a-40}else if(a>=90&&a<=97){a+=8;r=a-90}else if(a>=100&&a<=107){a+=8;h=a-100}else if(a===0){i=this.defAttr>>18;r=this.defAttr>>9&511;h=this.defAttr&511}else if(a===1){i|=1}else if(a===4){i|=2}else if(a===5){i|=4}else if(a===7){i|=8}else if(a===8){i|=16}else if(a===22){i&=~1}else if(a===24){i&=~2}else if(a===25){i&=~4}else if(a===27){i&=~8}else if(a===28){i&=~16}else if(a===39){r=this.defAttr>>9&511}else if(a===49){h=this.defAttr&511}else if(a===38){if(t[s+1]===2){s+=2;r=M(t[s]&255,t[s+1]&255,t[s+2]&255);if(r===-1)r=511;s+=2}else if(t[s+1]===5){s+=2;a=t[s]&255;r=a}}else if(a===48){if(t[s+1]===2){s+=2;h=M(t[s]&255,t[s+1]&255,t[s+2]&255);if(h===-1)h=511;s+=2}else if(t[s+1]===5){s+=2;a=t[s]&255;h=a}}else if(a===100){r=this.defAttr>>9&511;h=this.defAttr&511}else{this.error("Unknown SGR attribute: %d.",a)}}this.curAttr=i<<18|r<<9|h};u.prototype.deviceStatus=function(t){if(!this.prefix){switch(t[0]){case 5:this.send("[0n");break;case 6:this.send("["+(this.y+1)+";"+(this.x+1)+"R");break}}else if(this.prefix==="?"){switch(t[0]){case 6:this.send("[?"+(this.y+1)+";"+(this.x+1)+"R");break;case 15:break;case 25:break;case 26:break;case 53:break}}};u.prototype.insertChars=function(t){var e,s,i,r;e=t[0];if(e<1)e=1;s=this.y+this.ybase;i=this.x;r=[this.eraseAttr()," "];while(e--&&i<this.cols){this.lines[s].splice(i++,0,r);this.lines[s].pop()}};u.prototype.cursorNextLine=function(t){var e=t[0];if(e<1)e=1;this.y+=e;if(this.y>=this.rows){this.y=this.rows-1}this.x=0};u.prototype.cursorPrecedingLine=function(t){var e=t[0];if(e<1)e=1;this.y-=e;if(this.y<0)this.y=0;this.x=0};u.prototype.cursorCharAbsolute=function(t){var e=t[0];if(e<1)e=1;this.x=e-1};u.prototype.insertLines=function(t){var e,s,i;e=t[0];if(e<1)e=1;s=this.y+this.ybase;i=this.rows-1-this.scrollBottom;i=this.rows-1+this.ybase-i+1;while(e--){this.lines.splice(s,0,this.blankLine(true));this.lines.splice(i,1)}this.updateRange(this.y);this.updateRange(this.scrollBottom)};u.prototype.deleteLines=function(t){var e,s,i;e=t[0];if(e<1)e=1;s=this.y+this.ybase;i=this.rows-1-this.scrollBottom;i=this.rows-1+this.ybase-i;while(e--){this.lines.splice(i+1,0,this.blankLine(true));this.lines.splice(s,1)}this.updateRange(this.y);this.updateRange(this.scrollBottom)};u.prototype.deleteChars=function(t){var e,s,i;e=t[0];if(e<1)e=1;s=this.y+this.ybase;i=[this.eraseAttr()," "];while(e--){this.lines[s].splice(this.x,1);this.lines[s].push(i)}};u.prototype.eraseChars=function(t){var e,s,i,r;e=t[0];if(e<1)e=1;s=this.y+this.ybase;i=this.x;r=[this.eraseAttr()," "];while(e--&&i<this.cols){this.lines[s][i++]=r}};u.prototype.charPosAbsolute=function(t){var e=t[0];if(e<1)e=1;this.x=e-1;if(this.x>=this.cols){this.x=this.cols-1}};u.prototype.HPositionRelative=function(t){var e=t[0];if(e<1)e=1;this.x+=e;if(this.x>=this.cols){this.x=this.cols-1}};u.prototype.sendDeviceAttributes=function(t){if(t[0]>0)return;if(!this.prefix){if(this.is("xterm")||this.is("rxvt-unicode")||this.is("screen")){this.send("[?1;2c")}else if(this.is("linux")){this.send("[?6c")}}else if(this.prefix===">"){if(this.is("xterm")){this.send("[>0;276;0c")}else if(this.is("rxvt-unicode")){this.send("[>85;95;0c")}else if(this.is("linux")){this.send(t[0]+"c")}else if(this.is("screen")){this.send("[>83;40003;0c")}}};u.prototype.linePosAbsolute=function(t){var e=t[0];if(e<1)e=1;this.y=e-1;if(this.y>=this.rows){this.y=this.rows-1}};u.prototype.VPositionRelative=function(t){var e=t[0];if(e<1)e=1;this.y+=e;if(this.y>=this.rows){this.y=this.rows-1}};u.prototype.HVPosition=function(t){if(t[0]<1)t[0]=1;if(t[1]<1)t[1]=1;this.y=t[0]-1;if(this.y>=this.rows){this.y=this.rows-1}this.x=t[1]-1;if(this.x>=this.cols){this.x=this.cols-1}};u.prototype.setMode=function(t){if(typeof t==="object"){var e=t.length,s=0;for(;s<e;s++){this.setMode(t[s])}return}if(!this.prefix){switch(t){case 4:this.insertMode=true;break;case 20:break}}else if(this.prefix==="?"){switch(t){case 1:this.applicationCursor=true;break;case 2:this.setgCharset(0,u.charsets.US);this.setgCharset(1,u.charsets.US);this.setgCharset(2,u.charsets.US);this.setgCharset(3,u.charsets.US);break;case 3:this.savedCols=this.cols;this.resize(132,this.rows);break;case 6:this.originMode=true;break;case 7:this.wraparoundMode=true;break;case 12:break;case 66:this.log("Serial port requested application keypad.");this.applicationKeypad=true;break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=t===9;this.vt200Mouse=t===1e3;this.normalMouse=t>1e3;this.mouseEvents=true;this.element.style.cursor="default";this.log("Binding to mouse events.");break;case 1004:this.sendFocus=true;break;case 1005:this.utfMouse=true;break;case 1006:this.sgrMouse=true;break;case 1015:this.urxvtMouse=true;break;case 25:this.cursorHidden=false;break;case 1049:;case 47:case 1047:if(!this.normal){var i={lines:this.lines,ybase:this.ybase,ydisp:this.ydisp,x:this.x,y:this.y,scrollTop:this.scrollTop,scrollBottom:this.scrollBottom,tabs:this.tabs};this.reset();this.normal=i;this.showCursor()}break}}};u.prototype.resetMode=function(t){if(typeof t==="object"){var e=t.length,s=0;for(;s<e;s++){this.resetMode(t[s])}return}if(!this.prefix){switch(t){case 4:this.insertMode=false;break;case 20:break}}else if(this.prefix==="?"){switch(t){case 1:this.applicationCursor=false;break;case 3:if(this.cols===132&&this.savedCols){this.resize(this.savedCols,this.rows)}delete this.savedCols;break;case 6:this.originMode=false;break;case 7:this.wraparoundMode=false;break;case 12:break;case 66:this.log("Switching back to normal keypad.");this.applicationKeypad=false;break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=false;this.vt200Mouse=false;this.normalMouse=false;this.mouseEvents=false;this.element.style.cursor="";break;case 1004:this.sendFocus=false;break;case 1005:this.utfMouse=false;break;case 1006:this.sgrMouse=false;break;case 1015:this.urxvtMouse=false;break;case 25:this.cursorHidden=true;break;case 1049:;case 47:case 1047:if(this.normal){this.lines=this.normal.lines;this.ybase=this.normal.ybase;this.ydisp=this.normal.ydisp;this.x=this.normal.x;this.y=this.normal.y;this.scrollTop=this.normal.scrollTop;this.scrollBottom=this.normal.scrollBottom;this.tabs=this.normal.tabs;this.normal=null;this.refresh(0,this.rows-1);this.showCursor()}break}}};u.prototype.setScrollRegion=function(t){if(this.prefix)return;this.scrollTop=(t[0]||1)-1;this.scrollBottom=(t[1]||this.rows)-1;this.x=0;this.y=0};u.prototype.saveCursor=function(t){this.savedX=this.x;this.savedY=this.y};u.prototype.restoreCursor=function(t){this.x=this.savedX||0;this.y=this.savedY||0};u.prototype.cursorForwardTab=function(t){var e=t[0]||1;while(e--){this.x=this.nextStop()}};u.prototype.scrollUp=function(t){var e=t[0]||1;while(e--){this.lines.splice(this.ybase+this.scrollTop,1);this.lines.splice(this.ybase+this.scrollBottom,0,this.blankLine())}this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};u.prototype.scrollDown=function(t){var e=t[0]||1;while(e--){this.lines.splice(this.ybase+this.scrollBottom,1);this.lines.splice(this.ybase+this.scrollTop,0,this.blankLine())}this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};u.prototype.initMouseTracking=function(t){};u.prototype.resetTitleModes=function(t){};u.prototype.cursorBackwardTab=function(t){var e=t[0]||1;while(e--){this.x=this.prevStop()}};u.prototype.repeatPrecedingCharacter=function(t){var e=t[0]||1,s=this.lines[this.ybase+this.y],i=s[this.x-1]||[this.defAttr," "];while(e--)s[this.x++]=i};u.prototype.tabClear=function(t){var e=t[0];if(e<=0){delete this.tabs[this.x]}else if(e===3){this.tabs={}}};u.prototype.mediaCopy=function(t){};u.prototype.setResources=function(t){};u.prototype.disableModifiers=function(t){};u.prototype.setPointerMode=function(t){};u.prototype.softReset=function(t){this.cursorHidden=false;this.insertMode=false;this.originMode=false;this.wraparoundMode=false;this.applicationKeypad=false;this.applicationCursor=false;this.scrollTop=0;this.scrollBottom=this.rows-1;this.curAttr=this.defAttr;this.x=this.y=0;this.charset=null;this.glevel=0;this.charsets=[null]};u.prototype.requestAnsiMode=function(t){};u.prototype.requestPrivateMode=function(t){};u.prototype.setConformanceLevel=function(t){};u.prototype.loadLEDs=function(t){};u.prototype.setCursorStyle=function(t){};u.prototype.setCharProtectionAttr=function(t){};u.prototype.restorePrivateValues=function(t){};u.prototype.setAttrInRectangle=function(t){var e=t[0],s=t[1],i=t[2],r=t[3],h=t[4];var a,o;for(;e<i+1;e++){a=this.lines[this.ybase+e];for(o=s;o<r;o++){a[o]=[h,a[o][1]]}}this.updateRange(t[0]);this.updateRange(t[2])};u.prototype.savePrivateValues=function(t){};u.prototype.manipulateWindow=function(t){};u.prototype.reverseAttrInRectangle=function(t){};u.prototype.setTitleModeFeature=function(t){};u.prototype.setWarningBellVolume=function(t){};u.prototype.setMarginBellVolume=function(t){};u.prototype.copyRectangle=function(t){};u.prototype.enableFilterRectangle=function(t){};u.prototype.requestParameters=function(t){};u.prototype.selectChangeExtent=function(t){};u.prototype.fillRectangle=function(t){var e=t[0],s=t[1],i=t[2],r=t[3],h=t[4];var a,o;for(;s<r+1;s++){a=this.lines[this.ybase+s];for(o=i;o<h;o++){a[o]=[a[o][0],v.fromCharCode(e)]}}this.updateRange(t[1]);this.updateRange(t[3])};u.prototype.enableLocatorReporting=function(t){var e=t[0]>0};u.prototype.eraseRectangle=function(t){var e=t[0],s=t[1],i=t[2],r=t[3];var h,a,o;o=[this.eraseAttr()," "];for(;e<i+1;e++){h=this.lines[this.ybase+e];for(a=s;a<r;a++){h[a]=o}}this.updateRange(t[0]);this.updateRange(t[2])};u.prototype.setLocatorEvents=function(t){};u.prototype.selectiveEraseRectangle=function(t){};u.prototype.requestLocatorPosition=function(t){};u.prototype.insertColumns=function(){var t=params[0],e=this.ybase+this.rows,s=[this.eraseAttr()," "],i;while(t--){for(i=this.ybase;i<e;i++){this.lines[i].splice(this.x+1,0,s);this.lines[i].pop()}}this.maxRange()};u.prototype.deleteColumns=function(){var t=params[0],e=this.ybase+this.rows,s=[this.eraseAttr()," "],i;while(t--){for(i=this.ybase;i<e;i++){this.lines[i].splice(this.x,1);this.lines[i].push(s)}}this.maxRange()};u.prototype.enterPrefix=function(){this.prefixMode=true};u.prototype.leavePrefix=function(){this.prefixMode=false};u.prototype.enterSelect=function(){this._real={x:this.x,y:this.y,ydisp:this.ydisp,ybase:this.ybase,cursorHidden:this.cursorHidden,lines:this.copyBuffer(this.lines),write:this.write};this.write=function(){};this.selectMode=true;this.visualMode=false;this.cursorHidden=false;this.refresh(this.y,this.y)};u.prototype.leaveSelect=function(){this.x=this._real.x;this.y=this._real.y;this.ydisp=this._real.ydisp;this.ybase=this._real.ybase;this.cursorHidden=this._real.cursorHidden;this.lines=this._real.lines;this.write=this._real.write;delete this._real;this.selectMode=false;this.visualMode=false;this.refresh(0,this.rows-1)};u.prototype.enterVisual=function(){this._real.preVisual=this.copyBuffer(this.lines);this.selectText(this.x,this.x,this.ydisp+this.y,this.ydisp+this.y);this.visualMode=true};u.prototype.leaveVisual=function(){this.lines=this._real.preVisual;delete this._real.preVisual;delete this._selected;this.visualMode=false;this.refresh(0,this.rows-1)};u.prototype.enterSearch=function(t){this.entry="";this.searchMode=true;this.searchDown=t;this._real.preSearch=this.copyBuffer(this.lines);this._real.preSearchX=this.x;this._real.preSearchY=this.y;var e=this.ydisp+this.rows-1;for(var s=0;s<this.entryPrefix.length;s++){this.lines[e][s]=[this.defAttr&~511|4,this.entryPrefix[s]]}this.y=this.rows-1;this.x=this.entryPrefix.length;this.refresh(this.rows-1,this.rows-1)};u.prototype.leaveSearch=function(){this.searchMode=false;if(this._real.preSearch){this.lines=this._real.preSearch;this.x=this._real.preSearchX;this.y=this._real.preSearchY;delete this._real.preSearch;delete this._real.preSearchX;delete this._real.preSearchY}this.refresh(this.rows-1,this.rows-1)};u.prototype.copyBuffer=function(t){var t=t||this.lines,e=[];for(var s=0;s<t.length;s++){e[s]=[];for(var i=0;i<t[s].length;i++){e[s][i]=[t[s][i][0],t[s][i][1]]}}return e};u.prototype.getCopyTextarea=function(t){var e=this._copyTextarea,s=this.document;if(!e){e=s.createElement("textarea");e.style.position="absolute";e.style.left="-32000px";e.style.top="-32000px";e.style.width="0px";e.style.height="0px";e.style.opacity="0";e.style.backgroundColor="transparent";e.style.borderStyle="none";e.style.outlineStyle="none";s.getElementsByTagName("body")[0].appendChild(e);this._copyTextarea=e}return e};u.prototype.copyText=function(t){var e=this,s=this.getCopyTextarea();this.emit("copy",t);s.focus();s.textContent=t;s.value=t;s.setSelectionRange(0,t.length);k(function(){e.element.focus();e.focus()},1)};u.prototype.selectText=function(t,e,s,i){var r,h,a,o,n,l,c,f,u;if(this._selected){r=this._selected.x1;h=this._selected.x2;a=this._selected.y1;o=this._selected.y2;if(o<a){n=h;h=r;r=n;n=o;o=a;a=n}if(h<r&&a===o){n=h;h=r;r=n}for(c=a;c<=o;c++){l=0;f=this.cols-1;if(c===a){l=r}if(c===o){f=h}for(;l<=f;l++){if(this.lines[c][l].old!=null){u=this.lines[c][l].old;delete this.lines[c][l].old;this.lines[c][l]=[u,this.lines[c][l][1]]}}}s=this._selected.y1;t=this._selected.x1}s=Math.max(s,0);s=Math.min(s,this.ydisp+this.rows-1);i=Math.max(i,0);i=Math.min(i,this.ydisp+this.rows-1);this._selected={x1:t,x2:e,y1:s,y2:i};if(i<s){n=e;e=t;t=n;n=i;i=s;s=n}if(e<t&&s===i){n=e;e=t;t=n}for(c=s;c<=i;c++){l=0;f=this.cols-1;if(c===s){l=t}if(c===i){f=e}for(;l<=f;l++){u=this.lines[c][l][0];this.lines[c][l]=[u&~511|(511<<9|4),this.lines[c][l][1]];this.lines[c][l].old=u}}s=s-this.ydisp;i=i-this.ydisp;s=Math.max(s,0);s=Math.min(s,this.rows-1);i=Math.max(i,0);i=Math.min(i,this.rows-1);this.refresh(0,this.rows-1)};u.prototype.grabText=function(t,e,s,i){var r="",h="",a,o,n,l,c;if(i<s){c=e;e=t;t=c;c=i;i=s;s=c}if(e<t&&s===i){c=e;e=t;t=c}for(n=s;n<=i;n++){o=0;l=this.cols-1;if(n===s){o=t}if(n===i){l=e}for(;o<=l;o++){a=this.lines[n][o][1];if(a===" "){h+=a;continue}if(h){r+=h;h=""}r+=a;if(g(a))o++}h="";r+="\n"}for(o=e,n=i;o<this.cols;o++){if(this.lines[n][o][1]!==" "){r=r.slice(0,-1);break}}return r};u.prototype.keyPrefix=function(t,e){if(e==="k"||e==="&"){this.destroy()}else if(e==="p"||e==="]"){this.emit("request paste")}else if(e==="c"){this.emit("request create")}else if(e>="0"&&e<="9"){e=+e-1;if(!~e)e=9;this.emit("request term",e)}else if(e==="n"){this.emit("request term next")}else if(e==="P"){this.emit("request term previous")}else if(e===":"){this.emit("request command mode")}else if(e==="["){this.enterSelect()}};u.prototype.keySelect=function(t,e){this.showCursor();if(this.searchMode||e==="n"||e==="N"){return this.keySearch(t,e)}if(e===""){var s=this.ydisp+this.y;if(this.ydisp===this.ybase){this.y=Math.min(this.y+(this.rows-1)/2|0,this.rows-1);this.refresh(0,this.rows-1)}else{this.scrollDisp((this.rows-1)/2|0)}if(this.visualMode){this.selectText(this.x,this.x,s,this.ydisp+this.y)}return}if(e===""){var s=this.ydisp+this.y;if(this.ydisp===0){this.y=Math.max(this.y-(this.rows-1)/2|0,0);this.refresh(0,this.rows-1)}else{this.scrollDisp(-(this.rows-1)/2|0)}if(this.visualMode){this.selectText(this.x,this.x,s,this.ydisp+this.y)}return}if(e===""){var s=this.ydisp+this.y;this.scrollDisp(this.rows-1);if(this.visualMode){this.selectText(this.x,this.x,s,this.ydisp+this.y)}return}if(e===""){var s=this.ydisp+this.y;this.scrollDisp(-(this.rows-1));if(this.visualMode){this.selectText(this.x,this.x,s,this.ydisp+this.y)}return}if(e==="k"||e==="[A"){var s=this.ydisp+this.y;this.y--;if(this.y<0){this.y=0;this.scrollDisp(-1)}if(this.visualMode){this.selectText(this.x,this.x,s,this.ydisp+this.y)}else{this.refresh(this.y,this.y+1)}return}if(e==="j"||e==="[B"){var s=this.ydisp+this.y;this.y++;if(this.y>=this.rows){this.y=this.rows-1;this.scrollDisp(1)}if(this.visualMode){this.selectText(this.x,this.x,s,this.ydisp+this.y)}else{this.refresh(this.y-1,this.y)}return}if(e==="h"||e==="[D"){var i=this.x;this.x--;if(this.x<0){this.x=0}if(this.visualMode){this.selectText(i,this.x,this.ydisp+this.y,this.ydisp+this.y)}else{this.refresh(this.y,this.y)}return}if(e==="l"||e==="[C"){var i=this.x;this.x++;if(this.x>=this.cols){this.x=this.cols-1}if(this.visualMode){this.selectText(i,this.x,this.ydisp+this.y,this.ydisp+this.y)}else{this.refresh(this.y,this.y)}return}if(e==="v"||e===" "){if(!this.visualMode){this.enterVisual()}else{this.leaveVisual()}return}if(e==="y"){if(this.visualMode){var r=this.grabText(this._selected.x1,this._selected.x2,this._selected.y1,this._selected.y2);this.copyText(r);this.leaveVisual()}return}if(e==="q"||e===""){if(this.visualMode){this.leaveVisual()}else{this.leaveSelect()}return}if(e==="w"||e==="W"){var h=this.x;var a=this.y;var o=this.ydisp;var i=this.x;var s=this.y;var n=this.ydisp;var l=false;for(;;){var c=this.lines[n+s];while(i<this.cols){if(c[i][1]<=" "){l=true}else if(l){break}i++}if(i>=this.cols)i=this.cols-1;if(i===this.cols-1&&c[i][1]<=" "){i=0;if(++s>=this.rows){s--;if(++n>this.ybase){n=this.ybase;i=this.x;break}}continue}break}this.x=i,this.y=s;this.scrollDisp(-this.ydisp+n);if(this.visualMode){this.selectText(h,this.x,a+o,this.ydisp+this.y)}return}if(e==="b"||e==="B"){var h=this.x;var a=this.y;var o=this.ydisp;var i=this.x;var s=this.y;var n=this.ydisp;for(;;){var c=this.lines[n+s];var l=i>0&&c[i][1]>" "&&c[i-1][1]>" ";while(i>=0){if(c[i][1]<=" "){if(l&&(i+1<this.cols&&c[i+1][1]>" ")){i++;break}else{l=true}}i--}if(i<0)i=0;if(i===0&&(c[i][1]<=" "||!l)){i=this.cols-1;if(--s<0){s++;if(--n<0){n++;i=0;break}}continue}break}this.x=i,this.y=s;this.scrollDisp(-this.ydisp+n);if(this.visualMode){this.selectText(h,this.x,a+o,this.ydisp+this.y)}return}if(e==="e"||e==="E"){var i=this.x+1;var s=this.y;var n=this.ydisp;if(i>=this.cols)i--;for(;;){var c=this.lines[n+s];while(i<this.cols){if(c[i][1]<=" "){i++}else{break}}while(i<this.cols){if(c[i][1]<=" "){if(i-1>=0&&c[i-1][1]>" "){i--;break}}i++}if(i>=this.cols)i=this.cols-1;if(i===this.cols-1&&c[i][1]<=" "){i=0;if(++s>=this.rows){s--;if(++n>this.ybase){n=this.ybase;break}}continue}break}this.x=i,this.y=s;this.scrollDisp(-this.ydisp+n);if(this.visualMode){this.selectText(h,this.x,a+o,this.ydisp+this.y)}return}if(e==="^"||e==="0"){var h=this.x;if(e==="0"){this.x=0}else if(e==="^"){var c=this.lines[this.ydisp+this.y];var i=0;while(i<this.cols){if(c[i][1]>" "){break}i++}if(i>=this.cols)i=this.cols-1;this.x=i}if(this.visualMode){this.selectText(h,this.x,this.ydisp+this.y,this.ydisp+this.y)}else{this.refresh(this.y,this.y)}return}if(e==="$"){var h=this.x;var c=this.lines[this.ydisp+this.y];var i=this.cols-1;while(i>=0){if(c[i][1]>" "){if(this.visualMode&&i<this.cols-1)i++;break}i--}if(i<0)i=0;this.x=i;if(this.visualMode){this.selectText(h,this.x,this.ydisp+this.y,this.ydisp+this.y)}else{this.refresh(this.y,this.y)}return}if(e==="g"||e==="G"){var h=this.x;var a=this.y;var o=this.ydisp;if(e==="g"){this.x=0,this.y=0;this.scrollDisp(-this.ydisp)}else if(e==="G"){this.x=0,this.y=this.rows-1;this.scrollDisp(this.ybase)}if(this.visualMode){this.selectText(h,this.x,a+o,this.ydisp+this.y)}return}if(e==="H"||e==="M"||e==="L"){var h=this.x;var a=this.y;if(e==="H"){this.x=0,this.y=0}else if(e==="M"){this.x=0,this.y=this.rows/2|0}else if(e==="L"){this.x=0,this.y=this.rows-1}if(this.visualMode){this.selectText(h,this.x,this.ydisp+a,this.ydisp+this.y)}else{this.refresh(a,a);this.refresh(this.y,this.y)}return}if(e==="{"||e==="}"){var h=this.x;var a=this.y;var o=this.ydisp;var c;var f=false;var u=false;var p=-1;var s=this.y+(e==="{"?-1:1);var n=this.ydisp;var y;if(e==="{"){if(s<0){s++;if(n>0)n--}}else if(e==="}"){if(s>=this.rows){s--;if(n<this.ybase)n++}}for(;;){c=this.lines[n+s];for(y=0;y<this.cols;y++){if(c[y][1]>" "){if(p===-1){p=0}f=true;break}else if(y===this.cols-1){if(p===-1){p=1}else if(p===0){u=true}else if(p===1){if(f)u=true}break}}if(u)break;if(e==="{"){s--;if(s<0){s++;if(n>0)n--;else break}}else if(e==="}"){s++;if(s>=this.rows){s--;if(n<this.ybase)n++;else break}}}if(!u){if(e==="{"){s=0;n=0}else if(e==="}"){s=this.rows-1;n=this.ybase}}this.x=0,this.y=s;this.scrollDisp(-this.ydisp+n);if(this.visualMode){this.selectText(h,this.x,a+o,this.ydisp+this.y)}return}if(e==="/"||e==="?"){if(!this.visualMode){this.enterSearch(e==="/")}return}return false};u.prototype.keySearch=function(t,e){if(e===""){this.leaveSearch();return}if(e==="\r"||!this.searchMode&&(e==="n"||e==="N")){this.leaveSearch();var s=this.entry;if(!s){this.refresh(0,this.rows-1);return}var i=this.x;var r=this.y;var h=this.ydisp;var a;var o=false;var n=false;var l=this.x+1;var c=this.ydisp+this.y;var f,u;var p=e==="N"?this.searchDown:!this.searchDown;for(;;){a=this.lines[c];while(l<this.cols){for(u=0;u<s.length;u++){if(l+u>=this.cols)break;if(a[l+u][1]!==s[u]){break}else if(a[l+u][1]===s[u]&&u===s.length-1){o=true;break}}if(o)break;l+=u+1}if(o)break;l=0;if(!p){c++;if(c>this.ybase+this.rows-1){if(n)break;n=true;c=0}}else{c--;if(c<0){if(n)break;n=true;c=this.ybase+this.rows-1}}}if(o){if(c-this.ybase<0){f=c;c=0;if(f>this.ybase){c=f-this.ybase;f=this.ybase}}else{f=this.ybase;c-=this.ybase}this.x=l,this.y=c;this.scrollDisp(-this.ydisp+f);if(this.visualMode){this.selectText(i,this.x,r+h,this.ydisp+this.y)}return}this.refresh(0,this.rows-1);return}if(e==="\b"||e===""){if(this.entry.length===0)return;var y=this.ydisp+this.rows-1;this.entry=this.entry.slice(0,-1);var u=this.entryPrefix.length+this.entry.length;this.lines[y][u]=[this.lines[y][u][0]," "];this.x--;this.refresh(this.rows-1,this.rows-1);this.refresh(this.y,this.y);return}if(e.length===1&&e>=" "&&e<="~"){var y=this.ydisp+this.rows-1;this.entry+=e;var u=this.entryPrefix.length+this.entry.length-1;this.lines[y][u]=[this.defAttr&~511|4,e];this.x++;this.refresh(this.rows-1,this.rows-1);this.refresh(this.y,this.y);return}return false};u.charsets={};u.charsets.SCLD={"`":"◆",a:"▒",b:"	",c:"\f",d:"\r",e:"\n",f:"°",g:"±",h:"␤",i:"\x0B",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"};u.charsets.UK=null;u.charsets.US=null;u.charsets.Dutch=null;u.charsets.Finnish=null;u.charsets.French=null;u.charsets.FrenchCanadian=null;u.charsets.German=null;u.charsets.Italian=null;u.charsets.NorwegianDanish=null;u.charsets.Spanish=null;u.charsets.Swedish=null;u.charsets.Swiss=null;u.charsets.ISOLatin=null;function p(t,e,s,i){t.addEventListener(e,s,i||false)}function y(t,e,s,i){t.removeEventListener(e,s,i||false)}function d(t){if(t.preventDefault)t.preventDefault();t.returnValue=false;if(t.stopPropagation)t.stopPropagation();t.cancelBubble=true;return false}function b(t,e){function s(){this.constructor=t}s.prototype=e.prototype;t.prototype=new s}function m(t){var e=t.getElementsByTagName("body")[0];var s=t.createElement("div");s.className="terminal";var i=t.createElement("div");var r=t.createElement("span");r.innerHTML="hello world";i.appendChild(r);s.appendChild(i);e.appendChild(s);var h=r.scrollWidth;r.style.fontWeight="bold";var a=r.scrollWidth;e.removeChild(s);return h!==a}var v=this.String;var k=this.setTimeout;var x=this.setInterval;function w(t,e){var s=t.length;while(s--){if(t[s]===e)return s}return-1}function g(t){if(t<="＀")return false;return t>="！"&&t<="ﾾ"||t>="ￂ"&&t<="ￇ"||t>="ￊ"&&t<="ￏ"||t>="ￒ"&&t<="ￗ"||t>="ￚ"&&t<="ￜ"||t>="￠"&&t<="￦"||t>="￨"&&t<="￮"}function M(t,e,s){var i=t<<16|e<<8|s;if(M._cache[i]!=null){return M._cache[i]}var r=Infinity,h=-1,a=0,o,n,l,c,f;for(;a<u.vcolors.length;a++){o=u.vcolors[a];n=o[0];l=o[1];c=o[2];f=M.distance(t,e,s,n,l,c);if(f===0){h=a;break}if(f<r){r=f;h=a}}return M._cache[i]=h}M._cache={};M.distance=function(t,e,s,i,r,h){return Math.pow(30*(t-i),2)+Math.pow(59*(e-r),2)+Math.pow(11*(s-h),2)};function C(t,e,s){if(t.forEach)return t.forEach(e,s);for(var i=0;i<t.length;i++){e.call(s,t[i],i,t)}}function S(t){if(Object.keys)return Object.keys(t);var e,s=[];for(e in t){if(Object.prototype.hasOwnProperty.call(t,e)){s.push(e)}}return s}u.EventEmitter=s;u.Stream=i;u.inherits=b;u.on=p;u.off=y;u.cancel=d;if(typeof define==="function"&&define.amd){define([],function(){return u})}else if(typeof module!=="undefined"){module.exports=u}else{this.Terminal=u}}).call(function(){return this||(typeof window!=="undefined"?window:global)}());
