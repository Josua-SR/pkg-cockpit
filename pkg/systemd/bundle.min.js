
define("system/journal_day_header.mustache_text", "<div class=\"panel-heading\">{{day}}</div>\n");
//# sourceURL=system/journal_day_header.mustache

define("system/journal_line.mustache_text", "<div class=\"cockpit-logline\" data-cursor=\"{{cursor}}\">\n  <div class=\"cockpit-log-warning\">{{#warning}}\n    <i class=\"fa fa-exclamation-triangle\"></i>\n  {{/warning}}</div>\n  <div class=\"cockpit-log-time\">{{time}}</div>\n  <span class=\"cockpit-log-message\">{{message}}</span>\n  {{! if we have count (repeated messages), show service name and badge - otherwise just the service }}\n  {{#count}}\n  <div class=\"cockpit-log-service-container\">\n    <div class=\"cockpit-log-service-reduced\">{{service}}</div>\n    <span class=\"badge\">{{count}}&#160;<i class=\"fa fa-caret-right\"></i></span>\n  </div>\n  {{/count}}{{^count}}\n  <div class=\"cockpit-log-service\">{{service}}</div>\n  {{/count}}\n</div>\n");
//# sourceURL=system/journal_line.mustache

define("system/journal_reboot.mustache_text", "<div class=\"cockpit-logline\">\n  {{! placeholders for correct message alignment }}\n  <div class=\"cockpit-log-warning\"></div>\n  <span class=\"cockpit-log-message cockpit-logmsg-reboot\">{{message}}</span>\n</div>\n");
//# sourceURL=system/journal_reboot.mustache

define("system/host", ["jquery","base1/cockpit","base1/mustache","domain/operation","shell/controls","shell/shell","system/server","system/service","shell/plot","shell/cockpit-plot","shell/cockpit-util","base1/bootstrap-datepicker","base1/bootstrap-combobox","base1/patterns"],function(e,t,s,i,n,r,o,a){"use strict";var l=t.gettext;var c=t.gettext;var m=t.permission({group:"wheel"});e(m).on("changed",u);function u(){n.update_privileged_ui(m,".hostname-privileged",t.format(l("The user <b>$0</b> is not permitted to modify hostnames"),t.user.name))}function p(){if(window.debugging=="all"||window.debugging=="system")console.debug.apply(console,arguments)}function _(){var s=this;var i=t.dbus("org.freedesktop.timedate1");var n=i.proxy();var r=null;var o=null;s.timedate=n;s.timedate1_service=a.proxy("dbus-org.freedesktop.timedate1.service");s.timesyncd_service=a.proxy("systemd-timesyncd.service");Object.defineProperty(s,"now",{enumerable:true,get:function m(){var e=r+o;return new Date(e+(new Date).valueOf())}});s.format=function u(e){var t=s.now.toISOString();if(!e)return t.split("T")[0];var i=t.lastIndexOf(":");if(i!==-1)t=t.substring(0,i);return t.replace("T"," ")};var l=window.setInterval(function(){e(s).triggerHandler("changed")},3e4);function c(t,i){var n=new Date;r=t-n.valueOf();o=i;e(s).triggerHandler("changed")}s.update=function p(){t.spawn(["/usr/bin/date","+%s:%:z"]).done(function(e){var t=e.trim().split(":").map(function(e){return parseInt(e,10)});if(t[1]<0)t[2]=-t[2];c(t[0]*1e3,t[1]*36e5+t[2]*6e4)})};s.change_time=function _(i,r,o){var a=e.Deferred();t.spawn(["/usr/bin/date","--date="+i+" "+r+":"+o,"+%s"]).fail(function(e){a.reject(e)}).done(function(e){var t=parseInt(e.trim(),10);n.call("SetTime",[t*1e3*1e3,false,true]).fail(function(e){a.reject(e)}).done(function(){s.update();a.resolve()})});return a};s.poll_ntp_synchronized=function d(){i.call(n.path,"org.freedesktop.DBus.Properties","Get",["org.freedesktop.timedate1","NTPSynchronized"]).fail(function(e){if(e.name!="org.freedesktop.DBus.Error.UnknownProperty"&&e.problem!="not-found")console.log("can't get NTPSynchronized property",e)}).done(function(e){var t={"org.freedesktop.timedate1":{NTPSynchronized:e[0].v}};var s={};s[n.path]=t;i.notify(s)})};s.close=function h(){i.close()};s.update()}var d;h.prototype={_init:function(){this.id="server";this.server_time=null;this.os_file_name="/etc/os-release";this.client=null;this.hostname_proxy=null},getTitle:function(){return null},setup:function(){var n=this;u();e("#shutdown-group").append(r.action_btn(function(e){n.shutdown(e)},[{title:l("Restart"),action:"default"},{title:l("Shutdown"),action:"shutdown"}]));e("#system_information_hostname_button").on("click",function(){f.client=n.client;e("#system_information_change_hostname").modal("show")});e("#system_information_systime_button").on("click",function(){d.display(n.server_time)});n.domain_button=i.button();e("#system-info-realms td.button-location").append(n.domain_button);n.server_time=new _;e(n.server_time).on("changed",function(){e("#system_information_systime_button").text(n.server_time.format(true))});n.ntp_status_tmpl=e("#ntp-status-tmpl").html();s.parse(this.ntp_status_tmpl);n.ntp_status_icon_tmpl=e("#ntp-status-icon-tmpl").html();s.parse(this.ntp_status_icon_tmpl);function o(){var t=e("#system_information_systime_ntp_status");if(!n.server_time.timedate.NTP){t.hide();t.popover("hide");return}t.show();var i={Synched:n.server_time.timedate.NTPSynchronized,service:null};var r=/.*time server (.*)\./i;var o=n.server_time.timesyncd_service.state=="running"&&n.server_time.timesyncd_service.service&&n.server_time.timesyncd_service.service.StatusText;if(n.server_time.timesyncd_service.state=="running")i.service="systemd-timesyncd.service";if(o){var a=o.match(r);if(a)i.Server=a[1];else if(o!="Idle."&&o!=="")i.SubStatus=o}var l=s.render(n.ntp_status_tmpl,i);if(l!=t.attr("data-content")){t.attr("data-content",l);if(t.data("bs.popover").tip().hasClass("in"))t.popover("show")}var c=s.render(n.ntp_status_icon_tmpl,i);t.html(c)}e("#system_information_systime_ntp_status").popover();e(n.server_time.timesyncd_service).on("changed",o);e(n.server_time.timedate).on("changed",o);o();window.setInterval(function(){n.server_time.poll_ntp_synchronized()},5e3);e("#server").on("click","[data-goto-service]",function(){var s=e(this).attr("data-goto-service");t.jump("/system/services/#/"+window.encodeURIComponent(s))});n.plot_controls=r.setup_plot_controls(e("#server"),e("#server-graph-toolbar"));var c=a.proxy("pmcd");var m=a.proxy("pmlogger");var p;e("#server-pmlogger-switch").on("change",function(t){var s=e(this).onoff("value");if(m.exists){if(s){p=e.when(c.enable(),c.start(),m.enable(),m.start()).fail(function(e){console.warn("Enabling pmlogger failed",e)})}else{p=e.when(m.disable(),m.stop()).fail(function(e){console.warn("Disabling pmlogger failed",e)})}p.always(function(){p=null;h()})}});function h(){if(!m.exists)e("#server-pmlogger-onoff-row").hide();else if(!p){e("#server-pmlogger-switch").onoff("value",m.enabled);e("#server-pmlogger-onoff-row").show()}}e(m).on("changed",h);h()},enter:function(){var s=this;s.client=t.dbus("org.freedesktop.hostname1");s.hostname_proxy=s.client.proxy("org.freedesktop.hostname1","/org/freedesktop/hostname1");s.kernel_hostname=null;function i(t,s,i){if(i){console.warn("couldn't load os data: "+i);t=""}var n=t.split("\n");for(var r=0;r<n.length;r++){var o=n[r].split("=");if(o[0]==="PRETTY_NAME"){var a=o[1];try{a=JSON.parse(a)}catch(l){}e("#system_information_os_text").text(a);break}}}s.os_file=t.file(s.os_file_name);s.os_file.watch(i);var n;var o={direct:["kernel.all.cpu.nice","kernel.all.cpu.user","kernel.all.cpu.sys"],internal:["cpu.basic.nice","cpu.basic.user","cpu.basic.system"],units:"millisec",derive:"rate",factor:.1};var a=r.plot_simple_template();e.extend(a.yaxis,{tickFormatter:function(e){return e.toFixed(0)},max:100});s.cpu_plot=r.plot(e("#server_cpu_graph"),300);s.cpu_plot.set_options(a);n=s.cpu_plot.add_metrics_sum_series(o,{});var c={direct:["mem.util.used"],internal:["memory.used"],units:"bytes"};var m=r.plot_simple_template();e.extend(m.yaxis,{ticks:r.memory_ticks,tickFormatter:r.format_bytes_tick_no_unit});m.setup_hook=function y(t){var s=t.getAxes();e("#server_memory_unit").text(r.bytes_tick_unit(s.yaxis))};s.memory_plot=r.plot(e("#server_memory_graph"),300);s.memory_plot.set_options(m);n=s.memory_plot.add_metrics_sum_series(c,{});var u={direct:["network.interface.total.bytes"],internal:["network.all.tx","network.all.rx"],units:"bytes",derive:"rate"};var _=r.plot_simple_template();e.extend(_.yaxis,{tickFormatter:r.format_bits_per_sec_tick_no_unit});_.setup_hook=function g(t){var s=t.getAxes();if(s.yaxis.datamax<1e5)s.yaxis.options.max=1e5;else s.yaxis.options.max=null;s.yaxis.options.min=0;e("#server_network_traffic_unit").text(r.bits_per_sec_tick_unit(s.yaxis))};s.network_plot=r.plot(e("#server_network_traffic_graph"),300);s.network_plot.set_options(_);n=s.network_plot.add_metrics_sum_series(u,{});var d={direct:["disk.dev.total_bytes"],internal:["block.device.read","block.device.written"],units:"bytes",derive:"rate"};var h=r.plot_simple_template();e.extend(h.yaxis,{ticks:r.memory_ticks,tickFormatter:r.format_bytes_per_sec_tick_no_unit});h.setup_hook=function b(t){var s=t.getAxes();if(s.yaxis.datamax<1e5)s.yaxis.options.max=1e5;else s.yaxis.options.max=null;s.yaxis.options.min=0;e("#server_disk_io_unit").text(r.bytes_per_sec_tick_unit(s.yaxis))};s.disk_plot=r.plot(e("#server_disk_io_graph"),300);s.disk_plot.set_options(h);n=s.disk_plot.add_metrics_sum_series(d,{});r.util.machine_info(null).done(function(e){a.yaxis.max=e.cpus*100;s.cpu_plot.set_options(a);m.yaxis.max=e.memory;s.memory_plot.set_options(m)});s.plot_controls.reset([s.cpu_plot,s.memory_plot,s.network_plot,s.disk_plot]);e(window).on("resize.server",function(){s.cpu_plot.resize();s.memory_plot.resize();s.network_plot.resize();s.disk_plot.resize()});function f(t){var s={};e.each(t.split("\n"),function(e,t){var i=t.indexOf(":");if(i!==-1)s[t.substring(0,i)]=t.substring(i+1)});return s}t.spawn(["grep","\\w","bios_vendor","bios_version","bios_date","sys_vendor","product_name"],{directory:"/sys/devices/virtual/dmi/id",err:"ignore"}).done(function(t){var s=f(t);e("#system_information_bios_text").text(s.bios_vendor+" "+s.bios_version+" ("+s.bios_date+")");e("#system_information_hardware_text").text(s.sys_vendor+" "+s.product_name)}).fail(function(e){p("couldn't read dmi info: "+e)});t.spawn(["grep","\\w","product_serial","chassis_serial"],{directory:"/sys/devices/virtual/dmi/id",superuser:"try",err:"ignore"}).done(function(t){var s=f(t);e("#system_information_asset_tag_text").text(s.product_serial||s.chassis_serial)}).fail(function(e){p("couldn't read serial dmi info: "+e)});function v(){if(!s.hostname_proxy)return;var t=s.hostname_proxy.PrettyHostname;var i=s.hostname_proxy.StaticHostname;var n=s.kernel_hostname;if(t&&i&&i!=t)n=t+" ("+i+")";else if(i)n=i;if(!n)n=l("Set Host name");e("#system_information_hostname_button").text(n)}t.spawn(["hostname"],{err:"ignore"}).done(function(t){s.kernel_hostname=e.trim(t);v()}).fail(function(e){v();p("couldn't read kernel hostname: "+e)});e(s.hostname_proxy).on("changed",v)},show:function(){this.cpu_plot.start_walking();this.memory_plot.start_walking();this.disk_plot.start_walking();this.network_plot.start_walking()},leave:function(){var s=this;s.cpu_plot.destroy();s.memory_plot.destroy();s.disk_plot.destroy();s.network_plot.destroy();s.os_file.close();s.os_file=null;e(s.hostname_proxy).off();s.hostname_proxy=null;s.client.close();s.client=null;e(t).off(".server")},shutdown:function(t){y.type=t;e("#shutdown-dialog").modal("show")}};function h(){this._init()}f.prototype={_init:function(){this.id="system_information_change_hostname"},setup:function(){e("#sich-pretty-hostname").on("input change",e.proxy(this._on_full_name_changed,this));e("#sich-hostname").on("input change",e.proxy(this._on_name_changed,this));e("#sich-apply-button").on("click",e.proxy(this._on_apply_button,this))},enter:function(){var t=this;t.hostname_proxy=f.client.proxy();t._initial_hostname=t.hostname_proxy.StaticHostname||"";t._initial_pretty_hostname=t.hostname_proxy.PrettyHostname||"";e("#sich-pretty-hostname").val(t._initial_pretty_hostname);e("#sich-hostname").val(t._initial_hostname);this._always_update_from_pretty=false;this._update()},show:function(){e("#sich-pretty-hostname").focus()},leave:function(){this.hostname_proxy=null},_on_apply_button:function(t){var s=this;var i=e("#sich-pretty-hostname").val();var n=e("#sich-hostname").val();var r=s.hostname_proxy.call("SetStaticHostname",[n,true]);var o=s.hostname_proxy.call("SetPrettyHostname",[i,true]);e("#system_information_change_hostname").dialog("promise",e.when(r,o))},_on_full_name_changed:function(t){var s=e("#sich-pretty-hostname").val();if(this._always_update_from_pretty||this._initial_pretty_hostname!=s){var i=e("#sich-hostname").val();var n=i.indexOf(".");var r=s.toLowerCase().replace(/['".]+/g,"").replace(/[^a-zA-Z0-9]+/g,"-");r=r.substr(0,64);if(n>=0)r=r+i.substr(n);e("#sich-hostname").val(r);this._always_update_from_pretty=true}this._update()},_on_name_changed:function(e){this._update()},_update:function(){var t=e("#sich-apply-button");var s=e("#sich-note-1");var i=e("#sich-note-2");var n=false;var r=false;var o=false;var a="Real host name can only contain lower-case characters, digits, dashes, and periods (with populated subdomains)";var l="Real host name must be 64 characters or less";var c=e("#sich-hostname").val().length<=64;var m=e("#sich-hostname").val();var u=e("#sich-pretty-hostname").val();var p=true;var _=0;for(var d=0;d<e("#sich-hostname").val().length;d++){if(e("#sich-hostname").val()[d]==".")_++;else _=0;if(_>1){p=false;break}}var h=m.match(/[.a-z0-9-]*/)==m&&p;if((m!=this._initial_hostname||u!=this._initial_pretty_hostname)&&(m!==""||u!==""))n=true;if(c&&h)r=true;if(n&&r)o=true;if(r){e(s).css("visibility","hidden");e(i).css("visibility","hidden");e("#sich-hostname-error").removeClass("has-error")}else if(!c&&h){e("#sich-hostname-error").addClass("has-error");e(s).text(l);e(s).css("visibility","visible");e(i).css("visibility","hidden")}else if(c&&!h){e("#sich-hostname-error").addClass("has-error");e(s).text(a);e(s).css("visibility","visible");e(i).css("visibility","hidden")}else{e("#sich-hostname-error").addClass("has-error");if(e(s).text()===l)e(i).text(a);else if(e(s).text()===a)e(i).text(l);else{e(s).text(l);e(i).text(a)}e(s).css("visibility","visible");e(i).css("visibility","visible")}t.prop("disabled",!o)}};function f(){this._init()}v.prototype={_init:function(){this.id="system_information_change_systime";this.date=""},setup:function(){var t=this;function i(){e("#systime-apply-button").prop("disabled",false)}e("#systime-apply-button").on("click",e.proxy(this._on_apply_button,this));e("#change_systime").on("change",e.proxy(this,"update"));e("#systime-time-minutes").on("focusout",e.proxy(this,"update_minutes"));e("#systime-date-input").datepicker({autoclose:true,todayHighlight:true,format:"yyyy-mm-dd"});e("#systime-timezones").css("max-height","10em");e("#systime-timezones").combobox();e("#systime-time-minutes").on("input",i);e("#systime-time-hours").on("input",i);e("#systime-date-input").on("input",i);e("#systime-timezones").on("change",i);e("#systime-date-input").on("focusin",e.proxy(this,"store_date"));e("#systime-date-input").on("focusout",e.proxy(this,"restore_date"));t.ntp_servers_tmpl=e("#ntp-servers-tmpl").html();s.parse(this.ntp_servers_tmpl);e("#systime-ntp-servers").on("click",'[data-action="add"]',function(){var s=e(this).attr("data-index");t.sync_ntp_servers();t.custom_ntp_servers.splice(s+1,0,"");t.update_ntp_servers();return false});e("#systime-ntp-servers").on("click",'[data-action="del"]',function(){var s=e(this).attr("data-index");t.sync_ntp_servers();t.custom_ntp_servers.splice(s,1);t.update_ntp_servers();return false})},enter:function(){var t=this;e("#systime-date-input").val(t.server_time.format());e("#systime-time-minutes").val(t.server_time.now.getUTCMinutes());e("#systime-time-hours").val(t.server_time.now.getUTCHours());e("#change_systime").val(t.server_time.timedate.NTP?t.custom_ntp_enabled?"ntp_time_custom":"ntp_time":"manual_time");e('#change_systime [value="ntp_time"]').attr("disabled",!t.server_time.timedate.CanNTP?"disabled":null);e('#change_systime [value="ntp_time_custom"]').attr("disabled",!(t.server_time.timedate.CanNTP&&t.custom_ntp_supported)?"disabled":null);e("#change_systime").selectpicker("refresh");e("#systime-parse-error").parents("tr").hide();e("#systime-timezone-error").parents("tr").hide();e("#systime-apply-button").prop("disabled",false);e("#systime-timezones").prop("disabled","disabled");t.update();t.update_minutes();t.update_ntp_servers();t.get_timezones()},display:function(t){var s=this;if(s.server_time){console.warn("change-systime dialog reentered");return}s.server_time=t;s.get_ntp_servers(function(){e("#system_information_change_systime").modal("show")})},get_timezones:function(){var s=this;function i(t){var i=[];var n=t.split("\n");var r=s.server_time.timedate.Timezone;e("#systime-timezones").empty();for(var o=0;o<n.length;o++){e("#systime-timezones").append(e("<option>",{value:n[o],text:n[o].replace(/_/g," "),selected:n[o]==r}))}e("#systime-timezones").prop("disabled",false);e("#systime-timezones").combobox("refresh")}t.spawn(["/usr/bin/timedatectl","list-timezones"]).done(i)},get_ntp_servers:function(s){var i=this;var n=i.server_time.timedate1_service;var r=i.server_time.timesyncd_service;i.custom_ntp_supported=false;i.custom_ntp_enabled=false;i.custom_ntp_servers=[];function o(){if((n.exists===false||n.unit)&&r.exists!==null){e([n,r]).off(".get_ntp_servers");if(!n.exists||n.unit.Id!=="systemd-timedated.service"){console.log("systemd-timedated not in use, ntp server configuration not supported");s();return}if(!r.exists){console.log("systemd-timesyncd not available, ntp server configuration not supported");s();return}i.custom_ntp_supported=true;if(!i.ntp_config_file)i.ntp_config_file=t.file("/etc/systemd/timesyncd.conf.d/50-cockpit.conf",{superuser:"try"});i.ntp_config_file.read().done(function(e){var t="";i.ntp_servers=null;if(e){i.custom_ntp_enabled=true;e.split("\n").forEach(function(e){if(e.indexOf("NTP=")===0){t=e.slice(4);i.custom_ntp_enabled=true}else if(e.indexOf("#NTP=")===0){t=e.slice(5);i.custom_ntp_enabled=false}});i.custom_ntp_servers=t.split(" ").filter(function(e){return e!==""});if(i.custom_ntp_servers.length===0)i.custom_ntp_enabled=false}s()}).fail(function(e){console.warn("failed to load time servers",e);s()})}}e([n,r]).on("changed.get_ntp_servers",o);o()},set_ntp_servers:function(e,s){var i=this;var n;var r;n=t.format("# This file is automatically generated by Cockpit\n\n[Time]\n${0}NTP=${1}\n",s?"":"#",e.join(" "));return t.spawn(["mkdir","-p","/etc/systemd/timesyncd.conf.d"],{superuser:"try"}).then(function(){return i.ntp_config_file.replace(n)})},show:function(){},leave:function(){var t=this;e(t.server_time.timedate1_service).off(".change_systime");e(t.server_time.timesyncd_service).off(".change_systime");t.server_time=null},_on_apply_button:function(t){var s=this;if(!s.check_input())return;var i=e("#change_systime").val()=="manual_time";var n=e("#change_systime").val()=="ntp_time_custom";s.sync_ntp_servers();var r=s.custom_ntp_servers.filter(function(e){return e!==""});function o(e,t){var s=new Error(e);s.target=t;return s}if(n&&r.length===0){var a=o(l("Need at least one NTP server"),"#systime-ntp-servers .systime-inline");e("#system_information_change_systime").dialog("failure",a);return}var c=[];if(!e("#systime-timezones").prop("disabled")){c.push(s.server_time.timedate.call("SetTimezone",[e("#systime-timezones").val(),true]))}function m(e){return s.server_time.timedate.call("SetNTP",[e,true])}if(i){c.push(m(false).then(function(){return s.server_time.change_time(e("#systime-date-input").val(),e("#systime-time-hours").val(),e("#systime-time-minutes").val())}))}else if(!s.custom_ntp_supported){c.push(m(true))}else{c.push(m(false).then(function(){return s.server_time.timedate.call("SetTime",[1,true,true])}).then(function(){return s.set_ntp_servers(r,n)}).then(function(){s.server_time.poll_ntp_synchronized();return m(true)}))}e("#system_information_change_systime").dialog("promise",e.when.apply(e,c))},check_input:function(){var t=false;var s=false;var i=false;var n;var r=parseInt(e("#systime-time-hours").val(),10);var o=parseInt(e("#systime-time-minutes").val(),10);if(isNaN(r)||r<0||r>23||isNaN(o)||o<0||o>59){t=true}n=new Date(e("#systime-date-input").val());if(isNaN(n.getTime())||n.getTime()<0)s=true;if(t&&s)e("#systime-parse-error").text(l("Invalid date format and invalid time format"));else if(t)e("#systime-parse-error").text(l("Invalid time format"));else if(s)e("#systime-parse-error").text(l("Invalid date format"));if(e("#systime-timezones").val()===""){i=true;e("#systime-timezone-error").css("visibility","visible")}else{e("#systime-timezone-error").css("visibility","hidden")}e("#systime-timezones").toggleClass("has-error",!i);e("#systime-time-hours").toggleClass("has-error",!t);e("#systime-time-minutes").toggleClass("has-error",!t);e("#systime-date-input").toggleClass("has-error",!s);e("#systime-parse-error").parents("tr").toggle(t||s);e("#systime-timezone-error").parents("tr").toggle(i);if(t||s||i){e("#systime-apply-button").prop("disabled",true);return false}else{e("#systime-apply-button").prop("disabled",false);return true}},update:function(){var t=e("#change_systime").val()==="manual_time";var s=e("#change_systime").val()==="ntp_time_custom";e("#systime-manual-row, #systime-manual-error-row").toggle(t);e("#systime-ntp-servers-row").toggle(s)},sync_ntp_servers:function(){var t=this;t.custom_ntp_servers=e("#systime-ntp-servers input").map(function(t,s){return e(s).val()}).get()},update_ntp_servers:function(){var t=this;if(t.custom_ntp_servers===null||t.custom_ntp_servers.length===0)t.custom_ntp_servers=[""];var i={NTPServers:t.custom_ntp_servers.map(function(e,t){return{index:t,Value:e,Placeholder:l("NTP Server")}})};e("#systime-ntp-servers").html(s.render(t.ntp_servers_tmpl,i))},update_minutes:function(){var t=parseInt(e("#systime-time-minutes").val(),10);if(t<10)e("#systime-time-minutes").val("0"+t)},store_date:function(){this.date=e("#systime-date-input").val()},restore_date:function(){if(e("#systime-date-input").val().length===0)e("#systime-date-input").val(this.date)}};function v(){this._init()}y.prototype={_init:function(){this.id="shutdown-dialog"},setup:function(){e("#shutdown-delay").html(this.delay_btn=r.select_btn(e.proxy(this,"update"),[{choice:"1",title:l("1 Minute")},{choice:"5",title:l("5 Minutes")},{choice:"20",title:l("20 Minutes")},{choice:"40",title:l("40 Minutes")},{choice:"60",title:l("60 Minutes")},{group:[{choice:"0",title:l("No Delay")},{choice:"x",title:l("Specific Time")}]}]).css("display","inline"));e("#shutdown-time input").change(e.proxy(this,"update"))},enter:function(t){e("#shutdown-message").val("").attr("placeholder",l("Message to logged in users")).attr("rows",5);r.select_btn_select(this.delay_btn,"1");if(y.type=="shutdown"){e("#shutdown-dialog .modal-title").text(l("Shutdown"));e("#shutdown-action").click(e.proxy(this,"shutdown"));e("#shutdown-action").text(l("Shutdown"))}else{e("#shutdown-dialog .modal-title").text(l("Restart"));e("#shutdown-action").click(e.proxy(this,"restart"));e("#shutdown-action").text(l("Restart"))}this.update()},show:function(e){},leave:function(){},update:function(){var t=false;var s=r.select_btn_selected(this.delay_btn);e("#shutdown-time").toggle(s=="x");if(s=="x"){var i=parseInt(e("#shutdown-time input:nth-child(1)").val(),10);var n=parseInt(e("#shutdown-time input:nth-child(3)").val(),10);var o=i>=0&&i<24&&(n>=0&&n<60);e("#shutdown-time").toggleClass("has-error",!o);if(!o)t=true}e("#shutdown-action").prop("disabled",t)},do_action:function(s){var i=r.select_btn_selected(this.delay_btn);var n=e("#shutdown-message").val();var o;if(i=="x")o=e("#shutdown-time input:nth-child(1)").val()+":"+e("#shutdown-time input:nth-child(3)").val();else o="+"+i;var a=s=="shutdown"?"--poweroff":"--reboot";var l=t.spawn(["shutdown",a,o,n],{superuser:"try"});e("#shutdown-dialog").dialog("promise",l);l.done(function(){if(s=="restart")t.hint("restart")})},restart:function(){this.do_action("restart")},shutdown:function(){this.do_action("shutdown")}};function y(){this._init()}g.prototype={_init:function(){this.id="cpu_status"},getTitle:function(){return c("page-title","CPU Status")},enter:function(){var e=this;var s={series:{shadowSize:0,lines:{lineWidth:0,fill:true}},yaxis:{min:0,max:100,show:true,ticks:5,tickFormatter:function(e){return e/10+"%"}},xaxis:{show:true,ticks:[[0*60,"5 min"],[1*60,"4 min"],[2*60,"3 min"],[3*60,"2 min"],[4*60,"1 min"]]},legend:{show:true},x_rh_stack_graphs:true};var i=[{name:"cpu.basic.iowait",derive:"rate"},{name:"cpu.basic.system",derive:"rate"},{name:"cpu.basic.user",derive:"rate"},{name:"cpu.basic.nice",derive:"rate"}];var n=[{color:"#e41a1c",label:l("I/O Wait")},{color:"#ff7f00",label:l("Kernel")},{color:"#377eb8",label:l("User")},{color:"#4daf4a",label:l("Nice")}];e.channel=t.metrics(1e3,{source:"internal",metrics:i,cache:"cpu-status-rate"});e.grid=t.grid(1e3,-300,-0);var o;for(o=0;o<n.length;o++){n[o].row=e.grid.add(e.channel,[i[o].name])}e.channel.follow();e.grid.walk();this.plot=r.setup_complicated_plot("#cpu_status_graph",e.grid,n,s);r.util.machine_info().done(function(t){e.plot.set_yaxis_max(t.cpus*1e3)})},show:function(){this.plot.start()},leave:function(){this.plot.destroy();this.channel.close();this.channel=null}};function g(){this._init()}b.prototype={_init:function(){this.id="memory_status"},getTitle:function(){return c("page-title","Memory")},enter:function(){var e=this;var s={series:{shadowSize:0,lines:{lineWidth:0,fill:true}},yaxis:{min:0,ticks:5,tickFormatter:function(e){return t.format_bytes(e)}},xaxis:{show:true,ticks:[[0*60,"5 min"],[1*60,"4 min"],[2*60,"3 min"],[3*60,"2 min"],[4*60,"1 min"]]},legend:{show:true},x_rh_stack_graphs:true};var i=[{name:"memory.swap-used"},{name:"memory.cached"},{name:"memory.used"},{name:"memory.free"}];var n=[{color:"#e41a1c",label:l("Swap Used")},{color:"#ff7f00",label:l("Cached")},{color:"#377eb8",label:l("Used")},{color:"#4daf4a",label:l("Free")}];e.channel=t.metrics(1e3,{source:"internal",metrics:i,cache:"memory-status"});e.grid=t.grid(1e3,-300,-0);var o;for(o=0;o<n.length;o++){n[o].row=e.grid.add(e.channel,[i[o].name])}e.channel.follow();e.grid.walk();this.plot=r.setup_complicated_plot("#memory_status_graph",e.grid,n,s)},show:function(){this.plot.start()},leave:function(){this.plot.destroy();this.channel.close();this.channel=null}};function b(){this._init()}e("#link-cpu").on("click",function(){t.location.go(["cpu"]);return false});e("#link-memory").on("click",function(){t.location.go(["memory"]);return false});e("#link-network").on("click",function(){t.jump("/network");return false});e("#link-disk").on("click",function(){t.jump("/storage");return false});function w(t){t.setup();var s=false;e("#"+t.id).on("show.bs.modal",function(e){if(e.target.id===t.id)t.enter()}).on("shown.bs.modal",function(e){if(e.target.id===t.id)t.show()}).on("hidden.bs.modal",function(e){if(e.target.id===t.id)t.leave()})}function x(t,s){if(!t._entered_)t.enter(s);t._entered_=true;e("#"+t.id).show().removeAttr("hidden");t.show()}function k(t){e("#"+t.id).hide()}function z(){var s;var i;var n;function r(){var r=t.location.path;if(r.length===0){k(n);k(i);x(s)}else if(r.length===1&&r[0]=="cpu"){k(s);k(i);x(n)}else if(r.length===1&&r[0]=="memory"){k(s);k(n);x(i)}else{console.warn("not a system location: "+r);t.location=""}e("body").removeAttr("hidden")}t.translate();s=new h;s.setup();n=new g;i=new b;w(new f);w(d=new v);w(new y);e(t).on("locationchanged",r);r()}return z});

//# sourceURL=system/host.min.js

define("system/init", ["jquery","base1/cockpit","base1/mustache","system/server","translated!base1/po"],function(e,t,i,n,a){t.locale(a);t.translate();var r=t.gettext;function o(e,t){return e.indexOf(t)===0}function s(e){function t(e){var t=/[0-9a-zA-Z:-_.\\]/;var i="";var n;for(n=0;n<e.length;n++){var a=e[n];if(a=="/")i+="-";else if(a=="-"||a=="\\"||!t.test(a)){i+="\\x";var r=a.charCodeAt(0).toString(16);while(r.length<2)r="0"+r;i+=r}else i+=a}return i}function i(e){e=e.replace(/\/+/g,"/");if(e.length>1)e=e.replace(/\/$/,"").replace(/^\//,"");return e}function n(e){e=i(e);if(e=="/")return"-";else return t(e)}if(e.length>0&&e[0]=="/")return n(e);else return t(e)}var l=t.dbus("org.freedesktop.systemd1",{superuser:"try"});var c=l.proxy("org.freedesktop.systemd1.Manager","/org/freedesktop/systemd1");var f=false;function d(){if(!f){f=true;u()}}function u(){var n={};var a={};function s(e){var t=n[e];if(!t){t={aliases:[],path:e};n[e]=t}return t}function f(e,t){function i(i){if(t[i])e[i]=t[i].v}i("Id");i("Description");i("LoadState");i("ActiveState");i("SubState");if(t["Id"])a[e.Id]=e.path;d(e)}function d(e){var t=e.LoadState;var i=e.ActiveState;var n=e.SubState;if(t=="loaded")t="";e.HasFailed=i=="failed"||t!=="";t=r(t);i=r(i);n=r(n);if(n!==""&&n!=i)i=i+" ("+n+")";if(t!=="")i=t+" / "+i;e.CombinedState=i}function u(e,t){l.call(e,"org.freedesktop.DBus.Properties","GetAll",["org.freedesktop.systemd1.Unit"]).fail(function(e){console.log(e)}).done(function(i){var n=s(e);f(n,i[0]);if(t)t(n);h()})}var v=e("#services-units-tmpl").html();i.parse(v);function p(){var t=e("#services-filter button.active").attr("data-pattern");function a(e,t){return n[e].Id.localeCompare(n[t].Id)}var s=Object.keys(n).sort(a);var l=[],c=[],f=[];s.forEach(function(e){var i=n[e];if(!(i.Id&&t&&i.Id.match(t)))return;if(i.UnitFileState&&o(i.UnitFileState,"enabled"))l.push(i);else if(i.UnitFileState&&o(i.UnitFileState,"disabled"))c.push(i);else f.push(i)});function d(e,t,n){var a=i.render(v,{heading:t,units:n});e.html(a)}d(e("#services-list-enabled"),r("Enabled"),l);d(e("#services-list-disabled"),r("Disabled"),c);d(e("#services-list-static"),r("Static"),f)}var g;var m;function h(){if(!g){p();g=window.setTimeout(b,200)}else{m=true}}function b(){g=null;if(m){m=false;p()}}var U=0;function S(){var e=++U;var i={};function o(e){console.log(e)}function l(e){i[e[0]]=true;var t=s(e[6]);t.Id=e[0];t.Description=e[1];t.LoadState=e[2];t.ActiveState=e[3];t.SubState=e[4];a[t.Id]=t.path;d(t)}function f(e){var o=e[0].split("/").pop();i[o]=true;if(o.indexOf("@")!=-1){n[o]={Id:o,Description:t.format(r("$0 Template"),o),UnitFileState:e[1]};a[o]=o;return}if(a[o])s(a[o]);else{c.LoadUnit(o).fail(function(e){console.log(e)}).done(s)}function s(t){var i=n[t];if(i)a(i);else u(t,a);function a(t){if(t.Id==o){t.UnitFileState=e[1]}else{t.aliases.push(o)}d(t)}}}c.ListUnits().fail(o).done(function(t){if(e!=U)return;for(var a=0;a<t.length;a++)l(t[a]);c.ListUnitFiles().fail(o).done(function(t){var a,r;if(e!=U)return;for(a=0;a<t.length;a++)f(t[a]);r=Object.keys(n);for(a=0;a<r;a++){if(!i[n[r[a]].Id]){console.log("R",r[a]);delete n[r[a]]}}h()})})}e(c).on("UnitNew",function(e,t,i){a[t]=i});e(c).on("JobNew JobRemoved",function(e,t,i,n,r){var o=a[n];if(o)u(o)});l.subscribe({"interface":"org.freedesktop.DBus.Properties",member:"PropertiesChanged"},function(e,t,i,a){var r=n[e];if(r){f(r,a[1]);h()}});e(c).on("UnitFilesChanged",function(e){S()});e("#services-filter button").on("click",function(){e("#services-filter button").removeClass("active");e(this).addClass("active");h()});S()}var v;var p;var g;var m;var h;var b;var U;var S=e("#action-btn-tmpl").html();i.parse(S);var k=e("#service-unit-tmpl").html();i.parse(k);var y=e("#service-template-tmpl").html();i.parse(y);var F=[{title:r("Start"),action:"StartUnit"},{title:r("Stop"),action:"StopUnit"},{title:r("Restart"),action:"RestartUnit"},{title:r("Reload"),action:"ReloadUnit"},{title:r("Reload or Restart"),action:"ReloadOrRestartUnit"},{title:r("Try Restart"),action:"TryRestartUnit"},{title:r("Reload or Try Restart"),action:"ReloadOrTryRestartUnit"},{title:r("Isolate"),action:"StartUnit:isolate"}];function w(){var t=e(this).attr("data-action").split(":");var i=t[0];var n=t[1];if(p){c.call(i,[v,n||"fail"]).fail(function(t){e("#service-error-dialog-message").text(t.toString());e("#service-error-dialog").modal("show")})}}var I=[{title:r("Enable"),action:"EnableUnitFiles:false"},{title:r("Enable Forcefully"),action:"EnableUnitFiles:true"},{title:r("Disable"),action:"DisableUnitFiles"},{title:r("Preset"),action:"PresetUnitFiles:false"},{title:r("Preset Forcefully"),action:"PresetUnitFiles:true"},{title:r("Mask"),action:"MaskUnitFiles:false"},{title:r("Mask Forcefully"),action:"MaskUnitFiles:true"},{title:r("Unmask"),action:"UnmaskUnitFiles"}];function R(){var t=e(this).attr("data-action").split(":");var i=t[0];var n=t[1];if(p){var a=[[v],false];if(n!==undefined)a.push(n=="true");c.call(i,a).done(function(){if(arguments.length==2&&!arguments[0])e("#service-no-install-info-dialog").modal("show");c.Reload()}).fail(function(t){e("#service-error-dialog-message").text(t.toString());e("#service-error-dialog").modal("show")})}}function x(a){if(p){e(p).off("changed");p=null;g=null}if(U){U.stop();U=null}function o(){if(!p.valid)return;var n;var a=p.ActiveState;if(a=="active"||a=="reloading"||a=="activating")n=1;else n=0;var o;var s=p.LoadState;var l=p.UnitFileState;if(s=="masked")o=7;else if(l=="static")o=5;else if(l=="enabled")o=2;else o=0;var c;if(a=="active"||a=="reloading")c=p.ActiveEnterTimestamp;else if(a=="inactive"||a=="failed")c=p.InactiveEnterTimestamp;else if(a=="activating")c=p.InactiveExitTimestamp;else c=p.ActiveExitTimestamp;var f="";if(c)f=t.format(r("Since $0"),new Date(c/1e3).toLocaleString());var d=i.render(S,{id:"service-unit-action",def:F[n],actions:F});var u=i.render(S,{id:"service-file-action",def:I[o],actions:I});var v=null;if(h){var m=i.render('<a data-goto-unit="{{unit}}">{{unit}}</a>',{unit:h});v=t.format(r("This unit is an instance of the $0 template."),m)}var b=i.render(k,{Unit:p,Since:f,HasLoadError:p.LoadState!=="loaded",LoadError:p.LoadError[1],UnitFileState:g,TemplateDescription:v,UnitButton:d,FileButton:u});e("#service-unit").html(b);e("#service-unit-action").on("click","[data-action]",w);e("#service-file-action").on("click","[data-action]",R)}function s(){var n=i.render(y,{Description:t.format(r("$0 Template"),v)});e("#service-template").html(n)}e("#service-valid").hide();e("#service-template").hide();e("#service-invalid").hide();e("#service").hide();v=a;if(!v)return;e("#service .breadcrumb .active").text(a);var f=v.indexOf("@");var d=v.lastIndexOf(".");m=f!=-1&&(f+1==d||f+1==v.length);h=undefined;if(f!=-1&&!m){h=v.substring(0,f+1);if(d!=-1)h=h+v.substring(d)}if(m){s();e("#service-template").show();e("#service").show();return}c.LoadUnit(a).done(function(t){if(v==a){var i=l.proxy("org.freedesktop.systemd1.Unit",t);p=i;i.wait(function(){if(p==i){o();e(p).on("changed",o);e("#service-valid").show();e("#service").show()}})}}).fail(function(t){e("#service-error-message").text(t.toString());e("#service-invalid").show();e("#service").show()});L();U=n.logbox(["_SYSTEMD_UNIT="+v,"+","COREDUMP_UNIT="+v,"+","UNIT="+v],10);e("#service-log").empty().append(U)}function E(){t.location.go([e(this).attr("data-goto-unit")])}function T(e){if(v){var i=v.indexOf("@");var n=v.lastIndexOf(".");if(i!=-1){var a=v.substring(0,i+1);a=a+s(e);if(n!=-1)a=a+v.substring(n);t.location.go([a])}}}function D(){var e=p;if(e){l.call(e.path,"org.freedesktop.DBus.Properties","GetAll",["org.freedesktop.systemd1.Unit"]).fail(function(e){console.log(e)}).done(function(t){var i={};for(var n in t[0])i[n]=t[0][n].v;var a={};a["org.freedesktop.systemd1.Unit"]=i;var r={};r[e.path]=a;l.notify(r)})}}function L(){var t=v;if(t){c.GetUnitFileState(t).done(function(i){if(v==t){g=i;if(p)e(p).triggerHandler("changed")}})}}e(c).on("Reloading",function(e,t){if(!t)D()});e(c).on("JobNew JobRemoved",function(e,t,i,n,a){if(v==n)D()});e(c).on("UnitFilesChanged",function(e){L()});function A(){var i=t.location.path;if(i.length===0){x(null);d();e("#services").show()}else if(i.length==1){e("#services").hide();x(t.location.path[0])}else{console.warn("not a init location: "+i);t.location=""}e("body").show()}function O(){c.wait(function(){c.Subscribe().fail(function(e){if(e.name!="org.freedesktop.systemd1.AlreadySubscribed"&&e.name!="org.freedesktop.DBus.Error.FileExists")console.warn("Subscribing to systemd signals failed",e)});A()})}e(t).on("locationchanged",A);e("#service-navigate-home").on("click",function(){t.location.go("/")});e("body").on("click","[data-goto-unit]",E);e("#service-template").on("click","button",function(){T(e("#service-template input").val())});return O});

//# sourceURL=system/init.min.js

define("system/server", ["jquery","base1/cockpit","system/journalctl","system/renderer"],function(e,t,r,n){"use strict";var o=t.gettext;var a=t.gettext;var u={};u.journal=r;u.logbox=function c(t,r){var o=[];var a=e("<div>");function c(){var e=n.journal_renderer(n.output_funcs_for_box(a));a.empty();for(var t=0;t<o.length;t++){e.prepend(o[t])}e.prepend_flush();a.toggle(o.length>0)}c();var s=u.journal(t,{count:r}).stream(function(e){o=o.concat(e);if(o.length>r)o=o.slice(-r);c()}).fail(function(e){a.append(document.createTextNode(e.message));a.show()});return s.promise(a)};return u});

//# sourceURL=system/server.min.js

define("system/terminal", ["jquery","base1/cockpit","base1/term","translated!base1/po"],function(e,n,r,i){n.locale(i);n.translate();var t=null;var l=null;var o=n.user;var s=null;var a=null;function u(){if(a===null)a=new Date;if(o.shell===undefined&&new Date-a<1e3){s=window.setTimeout(u,50);return}a=null;t=new r({cols:80,rows:24,screenKeys:true});var i=e("#terminal");t.open(i[0]);i.children().first().css("margin",0);var c="/bin/bash";if(o.shell!==undefined)c=o.shell;l=n.channel({payload:"stream",spawn:[c,"-i"],environ:["TERM=xterm-256color","PATH=/sbin:/bin:/usr/sbin:/usr/bin"],directory:o.home||"/",pty:true});e(l).on("close",function(e,n){if(t){var r=n.problem||"disconnected";t.write("[31m"+r+"[m\r\n");t.cursorHidden=true;t.refresh(t.y,t.y)}}).on("message",function(e,n){if(t)t.write(n)});t.on("data",function(e){if(l&&l.valid)l.send(e)});t.on("title",function(n){e("#terminal-title").text(n)})}function c(){e("#terminal-reset").on("click",function(){if(l){l.close()}e("#terminal").empty();u()});u();e("body").show()}return c});

//# sourceURL=system/terminal.min.js

define("system/journal", ["jquery","base1/cockpit","translated!base1/po","base1/mustache","system/journalctl","system/renderer"],function(t,o,n,a,e,r){"use strict";o.locale(n);o.translate();var i=o.gettext;var l;function c(){if(l)l.stop()}function s(){c();var n=[];var a=o.location.options["prio"]||"3";var e=parseInt(a,10);t("#journal-prio button").each(function(){var o=parseInt(t(this).attr("data-prio"),10);t(this).toggleClass("active",isNaN(e)||o<=e)});if(e){for(var i=0;i<=e;i++)n.push("PRIORITY="+i.toString())}var l=o.location.options;if(l["service"])n.push("_SYSTEMD_UNIT="+l["service"]);else if(l["tag"])n.push("SYSLOG_IDENTIFIER="+l["tag"]);var s=o.location.options["start"]||"recent";if(s=="recent")t(window).scrollTop(t(document).height());r.journalbox(t("#journal-box"),s,n,t("#journal-current-day"))}function u(){var n=o.location.path[0];var a=t("#journal-entry-fields");a.empty();function r(o){t("#journal-entry-message").text(o["MESSAGE"]);var n=new Date(o["__REALTIME_TIMESTAMP"]/1e3);t("#journal-entry-date").text(n.toString());var e;if(o["SYSLOG_IDENTIFIER"])e=o["SYSLOG_IDENTIFIER"];else if(o["_SYSTEMD_UNIT"])e=o["_SYSTEMD_UNIT"];else e=i("Journal entry");t("#journal-entry-id").text(e);var r=Object.keys(o).sort();t.each(r,function(n,e){if(e!="MESSAGE"){a.append(t("<tr>").append(t('<td style="text-align:right">').text(e),t('<td style="text-align:left">').text(o[e])))}})}function l(o){a.append(t("<tr>").append(t("<td>").text(o)))}e({cursor:n,count:1,follow:false}).done(function(t){if(t.length>=1&&t[0]["__CURSOR"]==n)r(t[0]);else l(i("Journal entry not found"))}).fail(function(t){l(t)})}function f(){var n=o.location.path;if(n.length===0){t("#journal-entry").hide();s();t("#journal").show()}else if(n.length==1){c();t("#journal").hide();u();t("#journal-entry").show()}else{console.warn("not a journal location: "+n);o.location=""}t("body").show()}t(o).on("locationchanged",f);t("#journal-current-day-menu a").on("click",function(){o.location.go([],t.extend(o.location.options,{start:t(this).attr("data-op")}))});t("#journal-box").on("click",".cockpit-logline",function(){var n=t(this).attr("data-cursor");if(n)o.location.go([n])});t("#journal-prio button").on("click",function(){var n=o.location.options;var a=t(this).attr("data-prio");if(a)n.prio=a;else delete n.prio;o.location.go([],n)});t("#journal-navigate-home").on("click",function(){o.location.go("/")});return f});

//# sourceURL=system/journal.min.js

define("system/journalctl", ["jquery","base1/cockpit"],function(e,r){"use strict";var n=r.gettext;return function t(){var n=[];var t={follow:true};for(var s=0;s<arguments.length;s++){var i=arguments[s];if(typeof i=="string"){n.push(i)}else if(typeof i=="object"){if(i instanceof Array)n.push.apply(n,i);else e.extend(t,i)}else{console.warn("server.journal called with invalid argument:",i)}}if(t.count===undefined){if(t.follow)t.count=10;else t.count=null}var o=["journalctl","-q","--output=json"];if(!t.count)o.push("--no-tail");else o.push("--lines="+t.count);if(t.directory)o.push("--directory="+t.directory);if(t.boot)o.push("--boot="+t.boot);else if(t.boot!==undefined)o.push("--boot");if(t.since)o.push("--since="+t.since);if(t.until)o.push("--until="+t.until);if(t.cursor)o.push("--cursor="+t.cursor);if(t.after)o.push("--after="+t.after);if(t.reverse)o.push("--reverse");else if(t.follow)o.push("--follow");o.push("--");o.push.apply(o,n);var l=new e.Deferred;var u;var a="";var f=[];var c=null;var p=null;var h;function v(){if(c&&f.length>0){var e=f;f=[];c.fireWith(u,[e])}else{window.clearInterval(p);p=null}}var d=r.spawn(o,{host:t.host,batch:8192,latency:300,superuser:"try"}).stream(function(r){var n=0;var t;if(a)r=a+r;a="";var s=r.split("\n");var i=s.length-1;e.each(s,function(e,r){if(e==i){a=r}else if(r&&r.indexOf("-- ")!==0){try{f.push(JSON.parse(r))}catch(n){console.warn(n,r)}}});if(c&&p===null)p=window.setInterval(v,300)}).done(function(){v();l.resolve(f)}).fail(function(e){if(e.problem=="cancelled"||e.exit_status===1){v();l.resolve(f)}else{l.reject(e)}}).always(function(){window.clearInterval(p)});var w=l.promise;l.promise=function(){return e.extend(w.apply(this,arguments),{stream:function r(n){if(c===null)c=e.Callbacks("");c.add(n);return this},stop:function n(){d.close("cancelled")},promise:this.promise})};u=l.promise();return u}});

//# sourceURL=system/journalctl.min.js

define("system/renderer", ["jquery","base1/cockpit","base1/mustache","system/journalctl","data!./journal_day_header.mustache","data!./journal_line.mustache","data!./journal_reboot.mustache"],function(e,t,n,r,a,i,o){"use strict";var u=t.gettext;var s=t.gettext;var l={};l.output_funcs_for_box=function d(t){n.parse(a);n.parse(i);n.parse(o);function r(e,t,r,a,o,u){var s={cursor:u["__CURSOR"],time:o,message:r,service:e};if(a>1)s["count"]=a;if(t<4)s["warning"]=true;return n.render(i,s)}var s=u("Reboot");var l=n.render(o,{message:s});function f(){return l}function d(e){return n.render(a,{day:e})}return{render_line:r,render_day_header:d,render_reboot_separator:f,append:function(n){t.append(e(n))},prepend:function(n){t.prepend(e(n))},remove_last:function(){e(t[0].lastChild).remove()},remove_first:function(){e(t[0].firstChild).remove()}}};l.journalbox=function p(t,n,a,i){var o=e('<div class="panel panel-default cockpit-log-panel">');var s=e('<div class="journal-start">');t.empty().append(o,s);var f=5e3;var d=1e3;var p=l.journal_renderer(l.output_funcs_for_box(o));var c=null;var _=[];function y(e){}function h(e){for(var t=0;t<e.length;t++)p.prepend(e[t]);p.prepend_flush();c=null}function v(e){for(var t=0;t<e.length;t++)p.append(e[t]);p.append_flush();c=null}function m(t){var n=e('<button id="journal-load-earlier" class="btn btn-default" data-inline="true" data-mini="true">'+u("Load earlier entries")+"</button>");s.html(n);n.click(function(){var e=0;var n=null;s.text(u("Loading..."));_.push(r(a,{follow:false,reverse:true,cursor:t}).fail(y).stream(function(r){if(r[0]["__CURSOR"]==t)r.shift();e+=r.length;v(r);if(e>=d){n=r[r.length-1]["__CURSOR"];m(n);this.stop()}}).done(function(){if(s.text()==u("Loading..."))s.empty()}))})}function b(e){_.push(r(a,{follow:true,count:0,cursor:e}).fail(y).stream(function(t){if(t[0]["__CURSOR"]==e)t.shift();h(t);g()}))}function g(){if(c===null){c=[];for(var t=o[0].firstChild;t;t=t.nextSibling){if(e(t).hasClass("panel-heading"))c.push([e(t).offset().top,e(t).text()])}}if(c.length>0){var n=0;var r=window.scrollY;while(n+1<c.length&&c[n+1][0]<r){n++}i.text(c[n][1])}else{i.text(u("Go to"))}}s.text(u("Loading..."));e(window).on("scroll",g);var R={follow:false,reverse:true};var x=false;if(n=="boot"){R["boot"]=null}else if(n=="last-24h"){R["since"]="-1days"}else if(n=="last-week"){R["since"]="-7days"}else{x=true}var w=null;var S=0;var O=null;_.push(r(a,R).fail(y).stream(function(e){if(!w){w=e[0]["__CURSOR"];b(w);g()}S+=e.length;v(e);if(S>=f){O=e[e.length-1]["__CURSOR"];m(O);this.stop()}}).done(function(){if(s.text()==u("Loading..."))s.empty();if(!w){_.push(r(a,{follow:true,count:0,boot:R["boot"],since:R["since"]}).fail(y).stream(function(e){h(e);g()}))}if(!x||O)m()}));t.stop=function C(){e(window).off("scroll",g);e.each(_,function(e,t){t.stop()})};return t};var f=["January","February","March","April","May","June","July","August","September","October","November","December"];l.journal_renderer=function c(e){function t(e){var t={};for(var n in e)t[n]=e[n];return t}function n(e){function t(e){var t=e.toFixed();if(t.length==1)t="0"+t;return t}var n=new Date(e["__REALTIME_TIMESTAMP"]/1e3);return{cursor:e["__CURSOR"],full:e,day:s("month-name",f[n.getMonth()])+" "+n.getDate().toFixed()+", "+n.getFullYear().toFixed(),time:t(n.getHours())+":"+t(n.getMinutes()),bootid:e["_BOOT_ID"],ident:e["SYSLOG_IDENTIFIER"]||e["_COMM"],prio:e["PRIORITY"],message:e["MESSAGE"]}}function r(e,t){return e&&t&&e.day==t.day&&e.bootid==t.bootid&&e.ident==t.ident&&e.prio==t.prio&&e.message==t.message}function a(t){return e.render_line(t.entry.ident,t.entry.prio,t.entry.message,t.count,t.last_time,t.entry.full)}var i,o;i=o={};function u(){if(i===o&&i.entry){i=t(o)}}function l(){if(i.header_present){e.remove_first();i.header_present=false}if(i.line_present){e.remove_first();i.line_present=false}if(i.entry){e.prepend(a(i));i.line_present=true}}function d(t){var a=n(t);if(r(i.entry,a)){i.count+=1;i.first_time=a.time}else{l();if(i.entry){if(a.bootid!=i.entry.bootid)e.prepend(e.render_reboot_separator());if(a.day!=i.entry.day)e.prepend(e.render_day_header(i.entry.day))}u();i.entry=a;i.count=1;i.first_time=i.last_time=a.time;i.line_present=false}}function p(){l();if(i.entry){e.prepend(e.render_day_header(i.entry.day));i.header_present=true}}function c(){if(o.line_present){e.remove_last();o.line_present=false}if(o.entry){e.append(a(o));o.line_present=true}}function _(t){var a=n(t);if(r(o.entry,a)){o.count+=1;o.last_time=a.time}else{c();if(!o.entry||a.day!=o.entry.day){e.append(e.render_day_header(a.day));o.header_present=true}if(o.entry&&a.bootid!=o.entry.bootid)e.append(e.render_reboot_separator());u();o.entry=a;o.count=1;o.first_time=o.last_time=a.time;o.line_present=false}}function y(){c()}return{prepend:d,prepend_flush:p,append:_,append_flush:y}};return l});

//# sourceURL=system/renderer.min.js
