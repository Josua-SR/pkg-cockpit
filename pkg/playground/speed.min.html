<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <title>Cockpit Speed Tests</title> <meta name="viewport" content="width=device-width,initial-scale=1"> <link href="../base1/cockpit.css" type="text/css" rel="stylesheet"> <script src="../base1/require.js"></script></head><body hidden> <div class="container-fluid"> <h1>Speed Tests</h1> <table class="cockpit-form-table"> <tr> <td><label class="control-label" for="message">Message</label></td> <td><input class="form-control" id="message" value="100000" style="max-width: 100px"></td> </tr> <tr> <td><label class="control-label" for="batch">Batch</label></td> <td><input class="form-control" id="batch" value="1" style="max-width: 100px"></td> </tr> <tr> <td><label class="control-label" for="interval">Interval</label></td> <td><input class="form-control" id="interval" value="100" style="max-width: 100px"></td> </tr> <tr> <td><label class="control-label" for="binary">Binary</label></td> <td><div class="checkbox"><input type="checkbox" id="binary"></div></td> </tr> <tr> <td><button class="btn btn-default btn-primary" id="normal">Normal Channel</button></td> <td><button class="btn btn-default btn-primary" id="sideband">Sideband Channel</button></td> </tr> <tr> <td><label class="control-label">Round Trip</label></td> <td><span id="speed"></span></td> </tr> </table> </div> <script>require(["jquery","base1/cockpit"],function(n,e){function a(a,r,o){var t=Date.now();o=o||"",n("#speed").text(e.format_bytes_per_sec(1e3*a/(t-r))+o)}function r(n,e){return e?new window.ArrayBuffer(n):new Array(n).join("x")}function o(){n("#speed").empty();var o=parseInt(n("#message").val(),10),t=parseInt(n("#batch").val(),10),i=parseInt(n("#interval").val(),10);if(isNaN(o)||isNaN(i)||isNaN(t))return void window.alert("Bad value");var s=n("#binary").prop("checked"),c={payload:"echo"};s&&(c.binary=!0);var l=e.channel(c),w=0;n(l).on("message",function(n,e){w+=e.length}),n(l).on("close",function(n,e){e.problem&&window.alert(e.problem)});for(var d=r(o,s),v=Date.now(),f=0;t>f;f++)l.send(d);var u=window.setInterval(function(){a(w,v,"...")},500),p=window.setInterval(function(){for(var n=0;t>n;n++)l.send(d)},i);window.setTimeout(function(){window.clearInterval(p),window.clearInterval(u),l.close(),a(w,v)},1e4)}function t(){n("#speed").empty();var o=parseInt(n("#message").val(),10),t=parseInt(n("#batch").val(),10),i=parseInt(n("#interval").val(),10);if(isNaN(o)||isNaN(i)||isNaN(t))return void window.alert("Bad value");var s=n("#binary").prop("checked"),c={payload:"echo"};s&&(c.binary="raw");var l=new window.WebSocket(e.transport.uri()+"?"+JSON.stringify(c));l.binaryType="arraybuffer";var w,d,v=r(o,s),f=!1,u=0;l.onopen=function(){w=new Date;for(var n=0;t>n;n++)l.send(v);d=window.setInterval(function(){for(var n=0;t>n;n++)l.send(v)},i)},l.onmessage=function(n){u+=s?n.data.byteLength:n.data.length};var p=window.setInterval(function(){a(u,w,"...")},500);l.onclose=function(n){f||window.alert("channel closed")},window.setTimeout(function(){f=!0,window.clearInterval(d),window.clearInterval(p),l.close(),a(u,w)},1e4)}n("#normal").on("click",o),n("#sideband").on("click",t),n("body").show()});</script></body></html>