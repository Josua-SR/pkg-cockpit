<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <title>Cockpit terminal</title> <meta name="viewport" content="width=device-width,initial-scale=1"> <link href="../base1/cockpit.css" type="text/css" rel="stylesheet"> <script src="../base1/require.js"></script></head><body style="display: none"> <div id="internal" class="container-fluid"> <button style="float: right" onclick="cockpit.logout(!0)">Reload</button> <img src="hammer.gif" style="float: right" onclick="$(this).hide()"> <div id="nav"></div> <button class="btn btn-default" id="go-down">Go down</button> <br> <br> <div class="cockpit-internal-reauthorize"> <button class="btn btn-default">Priveleged Action</button> <span></span> </div> <div class="super-channel"> <button class="btn btn-default">Superuser</button> <span></span> </div> <p>Translated text: <span translatable="yes">Networking</span></p> <p>On the fly: <span id="translation"></span> <span id="reverse"></span></p> <br> <button class="btn btn-default" id="modify-file">Increment /tmp/counter atomically</button> <div id="file-content"></div> <div id="file-error" style="color:red"></div> <br> <div> <button class="btn btn-default" id="load-file">Load /tmp/counter</button> <button class="btn btn-default" id="save-file">Overwrite /tmp/counter</button> <button class="btn btn-default" id="delete-file">Delete /tmp/counter</button> </div> <textarea id="edit-file"></textarea> </div> <script>require(["jquery","base1/cockpit","translated!playground/po"],function(n,t,e){function o(){n("#nav").empty();var e=["top"].concat(t.location.path);n(e).each(function(o,c){o<e.length-1?n("#nav").append(n("<a>").text(c).click(function(){t.location.go(e.slice(1,o+1))})," >> "):n("#nav").append(n("<span>").text(c))})}function c(n){return n=n||{},n.counter=n.counter||0,n}function i(t){n("#file-error").text(t.toString())}function a(t,e,o){return o?i(o):(n("#file-content").text(c(t).counter),void n("#file-error").empty())}function r(){t.file("/tmp/counter").read().done(function(t){n("#edit-file").val(t)})}function l(){t.file("/tmp/counter").replace(n("#edit-file").val())}t.locale(e);var u=t.gettext,p=t.gettext;n("#translation").text(u("Translation")),n("#reverse").text(p("reverse","Translation")),n(".cockpit-internal-reauthorize .btn").on("click",function(){n(".cockpit-internal-reauthorize span").text("checking...");var e="pkcheck --action-id org.freedesktop.policykit.exec --process $$ -u 2>&1";t.spawn(["sh","-c",e]).stream(function(n){console.debug(n)}).done(function(){n(".cockpit-internal-reauthorize span").text("result: authorized")}).fail(function(){n(".cockpit-internal-reauthorize span").text("result: access-denied")})}),n(".super-channel .btn").on("click",function(){n(".super-channel span").text("checking..."),t.spawn(["id"],{superuser:!0}).done(function(t){console.log("done"),n(".super-channel span").text("result: "+t)}).fail(function(t){console.log("fail"),n(".super-channel span").text("result: "+t.problem)})}),n(t).on("locationchanged",o),o(),n("#go-down").click(function(){var n=t.location.path.length;t.location.go(t.location.path.concat(n.toString()),{length:n.toString()})});var f=t.file("/tmp/counter",{syntax:JSON});f.watch(a),n("#modify-file").click(function(){f.modify(function(n){return n=c(n),n.counter+=1,n}).fail(i)}),n("#load-file").click(r),n("#save-file").click(l),r(),n("#delete-file").click(function(){t.spawn(["rm","-f","tmp/counter"])}),n("body").show()});</script></body></html>