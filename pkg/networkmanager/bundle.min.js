
define("network/interfaces", ["jquery","base1/cockpit","base1/mustache","shell/controls","shell/shell","system/server","shell/cockpit-util","shell/plot","base1/patterns"],function(e,t,n,i,r,o){"use strict";var a=t.gettext;var s=t.gettext;function c(){if(window.debugging=="all"||window.debugging=="nm")console.debug.apply(console,arguments)}function d(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})}function l(t){e("#error-popup-message").text(t.message||t||"???");e('.modal[role="dialog"]').modal("hide");e("#error-popup").modal("show")}function f(){var n=this;var i=null;var r=t.dbus("org.freedesktop.NetworkManager");n.client=r;var o={};function s(){console.warn.apply(console,arguments)}function c(e){return function(t){return g(t,e)}}function d(e){return function(t){return t.map(e)}}function l(e){return e[" priv"]}var f=0;function u(){f+=1}function p(){f-=1;if(f===0)A()}function g(e,t){if(e=="/")return null;function n(){this[" priv"]={};l(this).type=t;l(this).path=e;for(var n in t.props)this[n]=t.props[n].def}if(!o[e]){n.prototype=t.prototype;o[e]=new n;if(t.refresh)t.refresh(o[e]);if(t.exporters&&t.exporters[0])t.exporters[0](o[e])}return o[e]}function v(e){return o[e]||null}function h(e){var t=o[e];if(t){if(l(t).type.drop)l(t).type.drop(t);delete o[e];A()}}function _(e,t){var n,i,r;i=l(e).type.props;for(n in i){r=t[i[n].prop||n];if(r!==undefined){if(i[n].conv)r=i[n].conv(r);if(r!==e[n]){e[n]=r;if(i[n].trigger)i[n].trigger(e)}}}}function m(e){var t={};for(var n in e){if(e.hasOwnProperty(n)){t[n]=e[n].v}}return t}function b(e){if(e&&l(e).path)return l(e).path;else return"/"}function k(t,n,i){var o=new e.Deferred;r.call(b(t),n,i,Array.prototype.slice.call(arguments,3)).fail(function(e){o.reject(e)}).done(function(e){o.resolve.apply(o,e)});return o.promise()}var w={};function x(e){e.forEach(function(e){if(e.exporters&&e.exporters.length>N)N=e.exporters.length;e.interfaces.forEach(function(t){w[t]=e})})}function y(e,t,n,i){var r=v(e);if(r){var o=l(r).type;if(n=="PropertiesChanged"){u();_(r,m(i[0]));p()}else if(o.signals&&o.signals[n])o.signals[n](r,i)}}function S(e,t,n){var i=w[t];if(i)_(g(e,i),n)}function D(e,t){h(e)}var N=0;var C;function A(){function t(){var t,i,r,a;for(t=0;t<N;t++){for(i in o){r=o[i];a=l(r).type.exporters;if(a&&a[t])a[t](r)}}e(n).trigger("changed")}if(!C){C=true;window.setTimeout(function(){C=false;t()},300)}}r.call("/org/freedesktop/NetworkManager","org.freedesktop.DBus.Properties","Get",["org.freedesktop.NetworkManager","State"],{flags:""}).fail(s).done(function(e,t){if(t.flags){if(t.flags.indexOf(">")!==-1)i="be";else if(t.flags.indexOf("<")!==-1)i="le"}});var I=r.subscribe({},y);var M=r.watch({});e(r).on("notify",function(t,n){e.each(n,function(t,n){e.each(n,function(e,n){if(n)S(t,e,n);else D(t,e)})})});n.close=function pe(){I.remove();M.remove();e(r).off("notify");r.close("unused")};function T(e){return e.toString(10)}function E(e){var t=[],n;if(i=="be"){for(n=3;n>=0;n--){t[n]=e&255;e=e>>>8}}else{for(n=0;n<4;n++){t[n]=e&255;e=e>>>8}}return t}function z(e){var t=0,n;if(i=="be"){for(n=0;n<4;n++){t=256*t+e[n]}}else{for(n=3;n>=0;n--){t=256*t+e[n]}}return t}function P(e){return E(e).map(T).join(".")}function $(e){var t=e.split(".");if(t.length==4)return z(t.map(function(e){return parseInt(e,10)}));else return 0}var O={255:8,254:7,252:6,248:5,240:4,224:3,192:2,128:1,0:0};function B(e){if(/^[0-9]+$/.test(e.trim()))return parseInt(e,10);var t=e.split(".");if(t.length!=4)return-1;var n=0;var i;for(i=0;i<4;i++){var r=O[t[i].trim()];if(r!==undefined){n+=r;if(r<8)break}else return-1}for(i+=1;i<4;i++){if(/^0+$/.test(t[i].trim())===false)return-1}return n}function U(e){return[P(e[0]),e[1].toString(),P(e[2])]}function j(e){return[$(e[0]),B(e[1]),$(e[2])]}function H(e){return[P(e[0]),e[1].toString(),P(e[2]),e[3].toString()]}function R(e){return[$(e[0]),B(e[1]),$(e[2]),parseInt(e[3],10)||0]}function F(e){var n=e.split(":");var i=[];for(var r=0;r<8;r++){var o=parseInt(n[r],16)||0;i[2*r]=o>>8;i[2*r+1]=o&255}return t.base64_encode(i)}function V(e){var n=[];var i=t.base64_decode(e);for(var r=0;r<8;r++)n[r]=((i[2*r]<<8)+i[2*r+1]).toString(16);return n.join(":")}function L(e){return[V(e[0]),e[1].toString(),V(e[2])]}function G(e){return[F(e[0]),parseInt(e[1],10)||64,F(e[2])]}function W(e){return[V(e[0]),e[1].toString(),V(e[2]),e[3].toString()]}function Y(e){return[F(e[0]),parseInt(e[1],10)||64,F(e[2]),parseInt(e[3],10)||0]}function q(t){function n(e,n,i){if(t[e]&&t[e][n])return t[e][n].v;else return i}function i(e,t,i,r){return{method:n(e,"method","auto"),ignore_auto_dns:n(e,"ignore-auto-dns",false),ignore_auto_routes:n(e,"ignore-auto-routes",false),addresses:n(e,"addresses",[]).map(t),dns:n(e,"dns",[]).map(r),dns_search:n(e,"dns-search",[]),routes:n(e,"routes",[]).map(i)}}var r={connection:{type:n("connection","type"),uuid:n("connection","uuid"),interface_name:n("connection","interface-name"),timestamp:n("connection","timestamp",0),id:n("connection","id",a("Unknown")),autoconnect:n("connection","autoconnect",true),slave_type:n("connection","slave-type"),master:n("connection","master")}};if(!t.connection.master){r.ipv4=i("ipv4",U,H,P);r.ipv6=i("ipv6",L,W,V)}if(t.bond){r.bond={options:e.extend({},n("bond","options",{})),interface_name:n("bond","interface-name")}}if(t.bridge){r.bridge={interface_name:n("bridge","interface-name"),stp:n("bridge","stp",true),priority:n("bridge","priority",32768),forward_delay:n("bridge","forward-delay",15),hello_time:n("bridge","hello-time",2),max_age:n("bridge","max-age",20),ageing_time:n("bridge","ageing-time",300)}}if(t["bridge-port"]||r.connection.slave_type=="bridge"){r.bridge_port={priority:n("bridge-port","priority",32),path_cost:n("bridge-port","path-cost",100),hairpin_mode:n("bridge-port","hairpin-mode",false)}}if(t.vlan){r.vlan={parent:n("vlan","parent"),id:n("vlan","id"),interface_name:n("vlan","interface-name")}}return r}function X(n,i){var r=e.extend(true,{},i);function o(e,n,i,o,a){if(o===undefined)o=a;if(!r[e])r[e]={};if(o!==undefined)r[e][n]=t.variant(i,o);else delete r[e][n]}function a(e,t,i,a,s,c,d){o(e,"method","s",n[e].method);o(e,"ignore-auto-dns","b",n[e].ignore_auto_dns);o(e,"ignore-auto-routes","b",n[e].ignore_auto_routes);o(e,"addresses",t,n[e].addresses.map(i));o(e,"dns",c,n[e].dns.map(d));o(e,"dns-search","as",n[e].dns_search);o(e,"routes",a,n[e].routes.map(s));delete r[e]["address-labels"]}o("connection","id","s",n.connection.id);o("connection","autoconnect","b",n.connection.autoconnect);o("connection","uuid","s",n.connection.uuid);o("connection","interface-name","s",n.connection.interface_name);o("connection","type","s",n.connection.type);o("connection","slave-type","s",n.connection.slave_type);o("connection","master","s",n.connection.master);delete r.ipv4;if(n.ipv4)a("ipv4","aau",j,"aau",R,"au",$);delete r.ipv6;if(n.ipv6)a("ipv6","a(ayuay)",G,"a(ayuayu)",Y,"aay",F);delete r.bond;if(n.bond){o("bond","options","a{ss}",n.bond.options);o("bond","interface-name","s",n.bond.interface_name)}delete r.bridge;if(n.bridge){o("bridge","interface-name","s",n.bridge.interface_name);o("bridge","stp","b",n.bridge.stp);o("bridge","priority","u",n.bridge.priority);o("bridge","forward-delay","u",n.bridge.forward_delay);o("bridge","hello-time","u",n.bridge.hello_time);o("bridge","max-age","u",n.bridge.max_age);o("bridge","ageing-time","u",n.bridge.ageing_time)}delete r["bridge-port"];if(n.bridge_port){o("bridge-port","priority","u",n.bridge_port.priority);o("bridge-port","path-cost","u",n.bridge_port.path_cost);o("bridge-port","hairpin-mode","b",n.bridge_port.hairpin_mode)}delete r.vlan;if(n.vlan){o("vlan","parent","s",n.vlan.parent);o("vlan","id","u",n.vlan.id);o("vlan","interface-name","s",n.vlan.interface_name)}if(n["802-3-ethernet"]){if(!r["802-3-ethernet"])r["802-3-ethernet"]={}}return r}function J(e){switch(e){case 0:return"unknown";case 1:return"ethernet";case 2:return"wifi";case 3:return"unused1";case 4:return"unused2";case 5:return"bt";case 6:return"olpc_mesh";case 7:return"wimax";case 8:return"modem";case 9:return"infiniband";case 10:return"bond";case 11:return"vlan";case 12:return"adsl";case 13:return"bridge";default:return""}}function K(e){switch(e){case 0:return"?";case 10:return"";case 20:return a("Not available");case 30:return a("Inactive");case 40:return a("Preparing");case 50:return a("Configuring");case 60:return a("Authenticating");case 70:return a("Configuring IP");case 80:return a("Checking IP");case 90:return a("Waiting");case 100:return a("Active");case 110:return a("Deactivating");case 120:return a("Failed");default:return""}}var Q={};function Z(e,t){if(e.Settings&&e.Settings.connection&&e.Settings.connection.uuid)delete Q[e.Settings.connection.uuid];e.Settings=t;if(e.Settings&&e.Settings.connection&&e.Settings.connection.uuid)Q[e.Settings.connection.uuid]=e}function ee(e){u();r.call(b(e),"org.freedesktop.NetworkManager.Settings.Connection","GetSettings").always(p).fail(s).done(function(t){var n=t[0];if(n){l(e).orig=n;if(!l(e).frozen){Z(e,q(n))}}})}function te(e){if(e.Udi.indexOf("/sys/")!==0)return;u();t.spawn(["udevadm","info",e.Udi]).done(function(t){var n={};function i(e,t,i){var r="E: "+t+"=";if(e.indexOf(r)===0){n[i]=e.substr(r.length)}}t.split("\n").forEach(function(e){i(e,"ID_MODEL_FROM_DATABASE","IdModel");i(e,"ID_VENDOR_FROM_DATABASE","IdVendor")});_(e,n)}).fail(function(e){console.warn(e)}).always(p)}function ne(e){ee(e)}var ie={interfaces:["org.freedesktop.NetworkManager.IP4Config"],props:{Addresses:{conv:d(U),def:[]}}};var re={interfaces:["org.freedesktop.NetworkManager.IP6Config"],props:{Addresses:{conv:d(L),def:[]}}};var oe={interfaces:["org.freedesktop.NetworkManager.Settings.Connection"],props:{Unsaved:{}},signals:{Updated:ne},refresh:ee,drop:function(e){Z(e,null)},prototype:{freeze:function(){l(this).frozen=true},apply:function(){var e=this;return k(this,"org.freedesktop.NetworkManager.Settings.Connection","Update",X(this.Settings,l(this).orig)).done(function(){l(e).frozen=false})},reset:function(){Z(this,q(l(this).orig));l(this).frozen=false;A()},activate:function(e,t){return k(g("/org/freedesktop/NetworkManager",ue),"org.freedesktop.NetworkManager","ActivateConnection",b(this),b(e),b(t))},delete_:function(){return k(this,"org.freedesktop.NetworkManager.Settings.Connection","Delete")}},exporters:[function(e){e.Slaves=[];e.Interfaces=[]},null,function(e){var t,n;function i(t){if(t.Settings.connection.type==e.Settings.connection.slave_type){e.Masters.push(t);t.Slaves.push(e)}}e.Masters=[];if(e.Settings&&e.Settings.connection&&e.Settings.connection.slave_type){t=Q[e.Settings.connection.master];if(t){e.Masters.push(t);t.Slaves.push(e)}else{n=le(e.Settings.connection.master);if(n){if(n.Device)n.Device.AvailableConnections.forEach(i);else n.Connections.forEach(i)}}}}]};var ae={interfaces:["org.freedesktop.NetworkManager.Connection.Active"],props:{Connection:{conv:c(oe)},Ip4Config:{conv:c(ie)},Ip6Config:{conv:c(re)}},prototype:{deactivate:function(){return k(g("/org/freedesktop/NetworkManager",ue),"org.freedesktop.NetworkManager","DeactivateConnection",b(this))}}};var se={interfaces:["org.freedesktop.NetworkManager.Device","org.freedesktop.NetworkManager.Device.Wired","org.freedesktop.NetworkManager.Device.Bond","org.freedesktop.NetworkManager.Device.Bridge","org.freedesktop.NetworkManager.Device.Vlan"],props:{DeviceType:{conv:J},Interface:{},StateText:{prop:"State",conv:K,def:a("Unknown")},State:{},HwAddress:{},AvailableConnections:{conv:d(c(oe)),def:[]},ActiveConnection:{conv:c(ae)},Udi:{trigger:te},IdVendor:{def:""},IdModel:{def:""},Driver:{def:""},Carrier:{def:true},Speed:{}},prototype:{activate:function(e,t){return k(g("/org/freedesktop/NetworkManager",ue),"org.freedesktop.NetworkManager","ActivateConnection",b(e),b(this),b(t))},disconnect:function(){return k(this,"org.freedesktop.NetworkManager.Device","Disconnect")}}};var ce={interfaces:[],exporters:[function(e){e.Device=null;e.Connections=[]},null,function(e){if(!e.Device&&e.Connections.length===0){h(l(e).path);return}if(e.Device){e.Device.AvailableConnections.forEach(function(t){t.Interfaces.push(e)})}else{e.Connections.forEach(function(t){t.Interfaces.push(e)})}}]};function de(e){var t=g(":interface:"+e,ce);t.Name=e;return t}function le(e){return v(":interface:"+e)}var fe={interfaces:["org.freedesktop.NetworkManager.Settings"],props:{Connections:{conv:d(c(oe)),def:[]}},prototype:{add_connection:function(t){var n=e.Deferred();k(this,"org.freedesktop.NetworkManager.Settings","AddConnection",X(t,{})).done(function(e){n.resolve(g(e,oe))}).fail(function(e){n.reject(e)});return n.promise()}},exporters:[null,function(e){if(e.Connections){e.Connections.forEach(function(e){function t(t){de(t).Connections.push(e)}if(e.Settings){if(e.Settings.bond)t(e.Settings.bond.interface_name);if(e.Settings.bridge)t(e.Settings.bridge.interface_name);if(e.Settings.vlan)t(e.Settings.vlan.interface_name)}})}}]};var ue={interfaces:["org.freedesktop.NetworkManager"],props:{Devices:{conv:d(c(se)),def:[]},ActiveConnections:{conv:d(c(ae)),def:[]}},exporters:[null,function(e){e.Devices.forEach(function(e){if(e.Interface){var t=de(e.Interface);t.Device=e}})}]};ae.props.Master={conv:c(se)};se.props.Slaves={conv:d(c(se)),def:[]};n.list_interfaces=function ge(){var e,t;var n=[];for(e in o){t=o[e];if(l(t).type===ce)n.push(t)}return n.sort(function(e,t){return e.Name.localeCompare(t.Name)})};n.find_interface=le;n.get_manager=function(){return g("/org/freedesktop/NetworkManager",ue)};n.get_settings=function(){return g("/org/freedesktop/NetworkManager/Settings",fe)};x([ue,fe,se,ie,re,oe,ae]);g("/org/freedesktop/NetworkManager",ue);g("/org/freedesktop/NetworkManager/Settings",fe);return n}function u(n){return e("<a>").text(n).click(function(){t.location.go([n])})}function p(e){if(!e)return a("Inactive");if(e.State==100&&e.Carrier===false)return a("No carrier");return e.StateText}function g(n){var i=e("<span>").append(v(n.Interfaces.map(function(n){return e("<a>").text(n.Name).click(function(){t.location.go([n.Name])})}),", "));return i}function v(e,t){var n=[];for(var i=0;i<e.length;i++){n.push(e[i]);if(i<e.length-1)n.push(t)}return n}function h(t,n,i){var r=[];var o;if(!t)return"";o=t.ActiveConnection;if(o&&o.Master){return e("<span>").append(e("<span>").text(a("Part of ")),n?u(o.Master.Interface):o.Master.Interface)}if(o&&o.Ip4Config){o.Ip4Config.Addresses.forEach(function(e){r.push(e[0]+"/"+e[1])})}function s(e){return e.indexOf("fe8")===0||e.indexOf("fe9")===0||e.indexOf("fea")===0||e.indexOf("feb")===0}if(o&&o.Ip6Config){o.Ip6Config.Addresses.forEach(function(e){if(!(i&&s(e[0])))r.push(e[0]+"/"+e[1])})}return e("<span>").text(r.join(", "))}function _(t){return function(n){var i=n.getAxes();if(i.yaxis.datamax<1e5)i.yaxis.options.max=1e5;else i.yaxis.options.max=null;i.yaxis.options.min=0;e(t).text(r.bits_per_sec_tick_unit(i.yaxis))}}var m=t.permission({group:"wheel"});e(m).on("changed",b);function b(){i.update_privileged_ui(m,".network-privileged",t.format(a("The user <b>$0</b> is not permitted to modify network settings"),t.user.name))}var k;var w;var x;function y(){if(k)return;w={};k=t.metrics(1e3,[{source:"direct",metrics:[{name:"network.interface.in.bytes",units:"bytes",derive:"rate"},{name:"network.interface.out.bytes",units:"bytes",derive:"rate"}],metrics_path_names:["rx","tx"]},{source:"internal",metrics:[{name:"network.all.rx",units:"bytes",derive:"rate"},{name:"network.all.tx",units:"bytes",derive:"rate"}],metrics_path_names:["rx","tx"]}]);x=t.grid(1e3,-1,-0);k.follow();x.walk()}function S(e){w[e]=[x.add(k,["rx",e]),x.add(k,["tx",e])]}D.prototype={_init:function(e){this.id="networking";this.model=e},getTitle:function(){return s("page-title","Networking")},setup:function(){var n=this;b();e("#networking-add-bond").click(e.proxy(this,"add_bond"));e("#networking-add-bridge").click(e.proxy(this,"add_bridge"));e("#networking-add-vlan").click(e.proxy(this,"add_vlan"));function i(t,n){e("#networking-interfaces tr").removeClass("highlight");if(n){e('#networking-interfaces tr[data-interface="'+r.esc(n)+'"]').addClass("highlight")}}var o={direct:"network.interface.in.bytes",internal:"network.all.rx",units:"bytes",derive:"rate",threshold:200};var a=r.plot_simple_template();e.extend(a.yaxis,{tickFormatter:r.format_bits_per_sec_tick_no_unit});e.extend(a.grid,{hoverable:true,autoHighlight:false});a.setup_hook=_("#networking-rx-unit");this.rx_plot=r.plot(e("#networking-rx-graph"),300);this.rx_plot.set_options(a);this.rx_series=this.rx_plot.add_metrics_stacked_instances_series(o,{});this.rx_plot.start_walking();e(this.rx_series).on("hover",i);var s={direct:"network.interface.out.bytes",internal:"network.all.tx",units:"bytes",derive:"rate",threshold:200};var c=r.plot_simple_template();e.extend(c.yaxis,{tickFormatter:r.format_bits_per_sec_tick_no_unit});e.extend(c.grid,{hoverable:true,autoHighlight:false});c.setup_hook=_("#networking-tx-unit");this.tx_plot=r.plot(e("#networking-tx-graph"),300);this.tx_plot.set_options(c);this.tx_series=this.tx_plot.add_metrics_stacked_instances_series(s,{});this.tx_plot.start_walking();e(this.tx_series).on("hover",i);e(t).on("resize",function(){n.rx_plot.resize();n.tx_plot.resize()});var d=r.setup_plot_controls(e("#networking"),e("#networking-graph-toolbar"));d.reset([this.rx_plot,this.tx_plot]);y();e(x).on("notify",function(e,t,n){l()});function l(){for(var n in w){var i=w[n];var o=i[0][0];var a=i[1][0];var s=e('#networking-interfaces tr[data-sample-id="'+r.esc(n)+'"]');if(o!==undefined&&a!==undefined&&s.length>0){s.find("td:nth-child(3)").text(t.format_bits_per_sec(a*8));s.find("td:nth-child(4)").text(t.format_bits_per_sec(o*8))}}}e(window).on("resize",function(){n.rx_plot.resize();n.tx_plot.resize()})},enter:function(){var t=this;this.log_box=o.logbox(["_SYSTEMD_UNIT=NetworkManager.service","_SYSTEMD_UNIT=firewalld.service"],10);e("#networking-log").empty().append(this.log_box);e(this.model).on("changed.networking",e.proxy(this,"update_devices"));this.update_devices()},show:function(){this.rx_plot.resize();this.tx_plot.resize()},leave:function(){if(this.log_box)this.log_box.stop();e(this.model).off(".networking")},update_devices:function(){var n=this;var i;i=e("#networking-interfaces tbody");i.empty();n.model.list_interfaces().forEach(function(r){function o(e){var t=e.Device?e.Device.AvailableConnections:e.Connections;return t.some(function(e){return e.Masters.length>0})}if(o(r))return;if(r.Device&&r.Device.DeviceType!="ethernet"&&r.Device.DeviceType!="bond"&&r.Device.DeviceType!="vlan"&&r.Device.DeviceType!="bridge")return;var a=r.Device;var s=a&&a.State==100&&a.Carrier===true;n.rx_series.add_instance(r.Name);n.tx_series.add_instance(r.Name);S(r.Name);i.append(e("<tr>",{"data-interface":r.Name,"data-sample-id":s?r.Name:null}).append(e("<td>").text(r.Name),e("<td>").html(h(a,false,true)),s?[e("<td>").text(""),e("<td>").text("")]:e('<td colspan="2">').text(p(a))).click(function(){t.location.go([r.Name])}))})},add_bond:function(){var t,n,i;i=d();for(n=0;n<100;n++){t="bond"+n;if(!this.model.find_interface(t))break}L.model=this.model;L.done=null;L.connection=null;L.settings={connection:{id:i,autoconnect:false,type:"bond",uuid:i,interface_name:t},bond:{options:{mode:"balance-rr"},interface_name:t}};e("#network-bond-settings-dialog").modal("show")},add_bridge:function(){var t,n,i;i=d();for(n=0;n<100;n++){t="bridge"+n;if(!this.model.find_interface(t))break}G.model=this.model;G.done=null;G.connection=null;G.settings={connection:{id:i,autoconnect:false,type:"bridge",uuid:i,interface_name:t},bridge:{interface_name:t,stp:false,priority:32768,forward_delay:15,hello_time:2,max_age:20,ageing_time:300}};e("#network-bridge-settings-dialog").modal("show")},add_vlan:function(){var t,n,i;i=d();Y.model=this.model;Y.done=null;Y.connection=null;Y.settings={connection:{id:i,autoconnect:false,type:"vlan",uuid:i,interface_name:""},vlan:{interface_name:"",parent:""}};e("#network-vlan-settings-dialog").modal("show")}};function D(e){this._init(e)}var N=[{choice:"auto",title:a("Automatic (DHCP)")},{choice:"link-local",title:a("Link local")},{choice:"manual",title:a("Manual")},{choice:"shared",title:a("Shared")},{choice:"disabled",title:a("Disabled")}];var C=[{choice:"auto",title:a("Automatic")},{choice:"dhcp",title:a("Automatic (DHCP only)")},{choice:"link-local",title:a("Link local")},{choice:"manual",title:a("Manual")},{choice:"ignore",title:a("Ignore")}];var A=[{choice:"balance-rr",title:a("Round Robin")},{choice:"active-backup",title:a("Active Backup")},{choice:"balance-xor",title:a("XOR")},{choice:"broadcast",title:a("Broadcast")},{choice:"802.3ad",title:a("802.3ad")},{choice:"balance-tlb",title:a("Adaptive transmit load balancing")},{choice:"balance-alb",title:a("Adaptive load balancing")}];var I=[{choice:"mii",title:a("MII (Recommended)")},{choice:"arp",title:a("ARP")}];function M(e,t,n){for(var i=0;i<e.length;i++){if(e[i].choice==t)return e[i].title}return n}T.prototype={_init:function(e){this.id="network-interface";this.model=e},getTitle:function(){return s("page-title","Networking")},setup:function(){var n=this;e("#network-interface .breadcrumb a").on("click",function(){t.location.go("/")});e("#network-interface-delete").click(e.proxy(this,"delete_connections"));this.device_onoff=e("#network-interface-delete-switch").on("change",function(){var t=e(this).onoff("value");if(t)n.connect();else n.disconnect()});function i(t,n){e("#network-interface-slaves tr").removeClass("highlight");if(n){e('#network-interface-slaves tr[data-interface="'+r.esc(n)+'"]').addClass("highlight")}}var o={direct:"network.interface.in.bytes",internal:"network.all.rx",units:"bytes",derive:"rate"};var a=r.plot_simple_template();e.extend(a.yaxis,{tickFormatter:r.format_bits_per_sec_tick_no_unit});e.extend(a.grid,{hoverable:true,autoHighlight:false});a.setup_hook=_("#network-interface-rx-unit");this.rx_plot=r.plot(e("#network-interface-rx-graph"),300);this.rx_plot.set_options(a);this.rx_series=this.rx_plot.add_metrics_stacked_instances_series(o,{});this.rx_plot.start_walking();e(this.rx_series).on("hover",i);var s={direct:"network.interface.out.bytes",internal:"network.all.tx",units:"bytes",derive:"rate"};var c=r.plot_simple_template();e.extend(c.yaxis,{tickFormatter:r.format_bits_per_sec_tick_no_unit});e.extend(c.grid,{hoverable:true,autoHighlight:false});c.setup_hook=_("#network-interface-tx-unit");this.tx_plot=r.plot(e("#network-interface-tx-graph"),300);this.tx_plot.set_options(c);this.tx_series=this.tx_plot.add_metrics_stacked_instances_series(s,{});this.tx_plot.start_walking();e(this.tx_series).on("hover",i);e(t).on("resize",function(){n.rx_plot.resize();n.tx_plot.resize()});var d=r.setup_plot_controls(e("#network-interface"),e("#network-interface-graph-toolbar"));d.reset([this.rx_plot,this.tx_plot]);y();e(x).on("notify",function(e,t,n){l()});function l(){for(var n in w){var i=w[n];var o=i[0][0];var a=i[1][0];var s=e('#network-interface-slaves tr[data-sample-id="'+r.esc(n)+'"]');if(s.length>0){s.find("td:nth-child(2)").text(t.format_bits_per_sec(a*8));s.find("td:nth-child(3)").text(t.format_bits_per_sec(o*8))}}}e(window).on("resize",function(){n.rx_plot.resize();n.tx_plot.resize()})},enter:function(t){var n=this;e(n.model).on("changed.network-interface",e.proxy(n,"update"));n.dev_name=t;e("#network-interface .breadcrumb .active").text(n.dev_name);n.rx_series.clear_instances();n.tx_series.clear_instances();e("#network-interface-delete").hide();n.dev=null;n.update()},show:function(){this.rx_plot.resize();this.tx_plot.resize()},leave:function(){e(this.model).off(".network-interface");this.dev=null},delete_connections:function(){var n=this;function i(t){return e.when(t.delete_(),e.when.apply(e,t.Slaves.map(function(e){return R(e)})))}function r(t){return e.when.apply(e,t.map(i))}function o(e){if(e.Device)return r(e.Device.AvailableConnections);else return r(e.Connections)}if(this.iface){var a=t.location;o(this.iface).done(function(){a.go("/")}).fail(l)}},connect:function(){var e=this;var t=e.model.get_settings();function n(t){l(t);e.update()}function i(t){t.activate(e.dev,null).fail(n)}if(e.ghost_settings){t.add_connection(e.ghost_settings).done(i).fail(n)}else if(e.main_connection){i(e.main_connection)}else e.update()},disconnect:function(){var e=this;if(!e.dev){e.update();return}e.dev.disconnect().fail(function(t){l(t);e.update()})},update:function(){var n=this;var i=n.model.find_interface(n.dev_name);var r=i&&i.Device;n.iface=i;n.dev=r;var o;if(r){if(r.DeviceType=="ethernet"){o=t.format("$IdVendor $IdModel $Driver)",r)}else if(r.DeviceType=="bond"){o=a("Bond")}else if(r.DeviceType=="vlan"){o=a("VLAN")}else if(r.DeviceType=="bridge"){o=a("Bridge")}}else if(i){if(i.Connections[0]&&i.Connections[0].Settings.connection.type=="bond")o=a("Bond");else if(i.Connections[0]&&i.Connections[0].Settings.connection.type=="vlan")o=a("VLAN");else if(i.Connections[0]&&i.Connections[0].Settings.connection.type=="bridge")o=a("Bridge");else o=a("Unknown")}else o=a("Unknown");e("#network-interface-name").text(n.dev_name);e("#network-interface-hw").text(o);e("#network-interface-mac").text(r?r.HwAddress:"");this.device_onoff.prop("disabled",!r);this.device_onoff.onoff("value",!!(r&&r.ActiveConnection));e("#network-interface-disconnect").prop("disabled",!r||!r.ActiveConnection);var s=i&&!r||r&&(r.DeviceType=="bond"||r.DeviceType=="vlan"||r.DeviceType=="bridge");e("#network-interface-delete").toggle(!!s);function c(){if(r&&r.Carrier!==undefined){return e("<tr>").append(e("<td>").text(a("Carrier")),e("<td>").append(r.Carrier?r.Speed?t.format_bits_per_sec(r.Speed*1e6):a("Yes"):a("No")))}else return null}function f(){var t;if(n.main_connection&&n.main_connection.Masters.length>0)return null;if(!r)t=a("Inactive");else if(r.State!=100)t=r.StateText;else t=null;return e("<tr>").append(e("<td>").text(a("Status")),e("<td>").append(h(r,true,false)," ",t?e("<span>").text(t):null))}function u(i,o){if(!o)return[];function s(){if(i)i.apply().fail(l);else{var e=n.model.get_settings();e.add_connection(o).fail(l)}}function c(){if(i&&r&&r.ActiveConnection&&r.ActiveConnection.Connection===i){i.activate(r,null).fail(l)}}function d(n){var i=o[n];var r=[];if(i.method!="manual")r.push(M(n=="ipv4"?N:C,i.method,a("Unknown configuration")));var s=i.method!="manual";var c=[];i.addresses.forEach(function(e){var t=e[0]+"/"+e[1];if(e[2]&&e[2]!="0.0.0.0"&&e[2]!="0:0:0:0:0:0:0:0")t+=" via "+e[2];c.push(t)});if(c.length>0)r.push(t.format(s?"Additional address $val":"Address $val",{val:c.join(", ")}));var d=!i["ignore-auto-dns"]&&i.method!="manual";if(i.dns.length>0)r.push(t.format(d?"Additional DNS $val":"DNS $val",{val:i.dns.join(", ")}));if(i.dns_search.length>0)r.push(t.format(d?"Additional DNS Search Domains $val":"DNS Search Domains $val",{val:i.dns_search.join(", ")}));return r.map(function(t){return e("<div>").text(t)})}function f(t){z.model=n.model;z.connection=i;z.settings=e.extend({},o);z.topic=t;z.done=c;e("#network-ip-settings-dialog").modal("show")}function u(){L.model=n.model;L.connection=i;L.settings=o;L.done=c;e("#network-bond-settings-dialog").modal("show")}function p(){G.model=n.model;G.connection=i;G.settings=i.Settings;G.done=c;e("#network-bridge-settings-dialog").modal("show")}function h(){W.model=n.model;W.connection=i;W.settings=i.Settings;W.done=c;e("#network-bridgeport-settings-dialog").modal("show")}function _(){Y.model=n.model;Y.connection=i;Y.settings=i.Settings;Y.done=c;e("#network-vlan-settings-dialog").modal("show")}function m(t,n,i){return e("<tr>").append(e("<td>").text(t).css("vertical-align",n.length>1?"top":"center"),e("<td>").append(n),e('<td style="text-align:right;vertical-align:top">').append(e('<button class="btn btn-default network-privileged">').text(a("Configure")).click(function(){i()})))}function b(e,t){if(!o[e])return null;return m(t,d(e),function(){f(e)})}function k(){if(i&&i.Masters.length>0){return e("<tr>").append(e("<td>").text(a("Master")),e("<td>").append(v(i.Masters.map(g),", ")))}else return null}function w(){var t=[];var n=[];var i;if(!o.bond)return null;i=o.bond.options;t.push(M(A,i.mode,i.mode));if(i.arp_interval)t.push(a("ARP Monitoring"));if(t.length>0)n.push(e("<div>").text(t.join(", ")));return m(a("Bond"),n,u)}function x(){var n=[];var i=o.bridge;if(!i)return null;function r(i,r){n.push(e("<div>").text(t.format(i,r)))}if(i.stp){r(a("Spanning Tree Protocol"));if(i.priority!=32768)r(a("Priority $priority"),i);if(i.forward_delay!=15)r(a("Forward delay $forward_delay"),i);if(i.hello_time!=2)r(a("Hello time $hello_time"),i);if(i.max_age!=20)r(a("Maximum message age $max_age"),i)}return m(a("Bridge"),n,p)}function y(){var n=[];var i=o.bridge_port;if(!i)return null;function r(i,r){n.push(e("<div>").text(t.format(i,r)))}if(i.priority!=32)r(a("Priority $priority"),i);if(i.path_cost!=100)r(a("Path cost $path_cost"),i);if(i.hairpin_mode)r(a("Hairpin mode"));return m(a("Bridge port"),n,h)}function S(){var n=[];var i=o.vlan;if(!i)return null;function r(i,r){n.push(e("<div>").text(t.format(i,r)))}r(a("Parent $parent"),i);r(a("Id $id"),i);return m(a("VLAN"),n,_)}return[k(),e("<tr>").append(e("<td>").text(a("General")),e("<td>").append(e('<label style="font-weight:inherit">').append(e('<input type="checkbox" style="margin-left:0px">').prop("checked",o.connection.autoconnect).change(function(){o.connection.autoconnect=e(this).prop("checked");s()}),a("Connect automatically")))),b("ipv4",a("IPv4")),b("ipv6",a("IPv6")),S(),x(),y(),w()]}function _(){var e=d();return{connection:{id:e,uuid:e,autoconnect:false,type:"802-3-ethernet",interface_name:i.Name},"802-3-ethernet":{},ipv4:{method:"auto",addresses:[],dns:[],dns_search:[],routes:[]},ipv6:{method:"auto",addresses:[],dns:[],dns_search:[],routes:[]}}}n.ghost_settings=null;n.main_connection=null;n.connection_settings=null;function m(e){e.forEach(function(e){if(!n.main_connection||n.main_connection.Settings.connection.timestamp<e.Settings.connection.timestamp)n.main_connection=e});if(n.main_connection){n.connection_settings=n.main_connection.Settings}else{n.ghost_settings=_();n.connection_settings=n.ghost_settings}}if(i){if(i.Device)m(i.Device.AvailableConnections);else m(i.Connections)}e("#network-interface-settings").empty().append(f()).append(c()).append(u(n.main_connection,n.connection_settings));b();function k(i){var r=e("#network-interface-slaves tbody");var o={};var s={};r.empty();if(!i||i.Settings.connection.type!="bond"&&i.Settings.connection.type!="bridge"){n.rx_series.add_instance(n.dev_name);n.tx_series.add_instance(n.dev_name);e("#network-interface-slaves").hide();return}e("#network-interface-slaves thead th:first-child").text(i.Settings.connection.type=="bond"?a("Members"):a("Ports"));i.Slaves.forEach(function(i){i.Interfaces.forEach(function(r){var a=r.Device;var c=a&&a.State==100&&a.Carrier===true;n.rx_series.add_instance(r.Name);n.tx_series.add_instance(r.Name);s[r.Name]=true;o[r.Name]=e("<tr>",{"data-interface":r.Name,"data-sample-id":c?r.Name:null}).append(e("<td>").text(r.Name),c?[e("<td>").text(""),e("<td>").text("")]:e('<td colspan="2">').text(p(a)),e('<td style="text-align:right">').append(E(c,function(e){if(e){i.activate(r.Device).fail(l)}else if(a){a.disconnect().fail(l)}},"network-privileged")),e('<td width="28px">').append(e('<button class="btn btn-default btn-control network-privileged">').text("-").click(function(){i.delete_().fail(l);return false}))).click(function(){t.location.go([r.Name])})})});Object.keys(o).sort().forEach(function(e){r.append(o[e])});var c=e("<div>",{"class":"dropdown"}).append(e("<button>",{"class":"network-privileged btn btn-default btn-control dropdown-toggle","data-toggle":"dropdown"}).text("+"),e("<ul>",{"class":"dropdown-menu",style:"right:0px;left:auto;min-width:0;text-align:left",role:"menu"}).append(n.model.list_interfaces().map(function(t){if($(t)&&!s[t.Name]&&t!=n.iface){return e('<li role="presentation">').append(e('<a role="menuitem" class="network-privileged">').text(t.Name).click(function(){F(n.model,i,i.Settings,i.Settings.connection.type,t.Name,true).fail(l);
}))}return null})));e("#network-interface-slaves thead th:nth-child(5)").html(c);e("#network-interface-slaves").show();b()}k(n.main_connection)}};function T(e){this._init(e)}function E(t,n){var i=e('<div class="btn-onoff">').onoff();i.onoff("value",t);i.on("change",function(){n(i.onoff("value"))});return i}z.prototype={_init:function(){this.id="network-ip-settings-dialog"},setup:function(){e("#network-ip-settings-cancel").click(e.proxy(this,"cancel"));e("#network-ip-settings-apply").click(e.proxy(this,"apply"))},enter:function(){e("#network-ip-settings-error").text("");if(z.connection)z.connection.freeze();this.update()},show:function(){},leave:function(){},update:function(){var t=this;var n=z.connection;var i=z.settings;var o=z.topic;var s=i[o];var c,d;var l,f;var u,p;var g,v;function h(e,n){var i=r.select_btn(function(n){s[e]=n;t.update()},n);r.select_btn_select(i,s[e]);return i}function _(n,i){var r;var o=e("<span>").append(e('<span style="margin-right:10px">').text(n),r=E(!s[i],function(e){s[i]=!e;t.update()}));o.enable=function a(e){r.onoff("disabled",!e)};return o}function m(n,i,r,o,c){var d=false;var l;if(typeof r=="string"){d=true;r=[r]}function f(e,t){if(d)return s[i][e];else return s[i][e][t]}function u(e,t,n){if(d)s[i][e]=n;else s[i][e][t]=n}function p(){return function(){s[i].push(o);t.update()}}function g(e){return function(){s[i].splice(e,1);t.update()}}var v=e('<div class="network-ip-settings-row">').append(e("<div>").append(e('<span style="font-weight:bold">').text(n),e('<div style="float:right">').append(c,l=e('<button class="btn btn-default" style="width:2em">').text("+").css("margin-left","10px").click(p()))),e('<table width="100%">').append(s[i].map(function(t,n){return e("<tr>").append(r.map(function(t,i){return e("<td>").append(e('<input class="form-control">').val(f(n,i)).attr("placeholder",t).change(function(t){u(n,i,e(t.target).val())}))}),e('<td style="text-align:right; padding-right: 0;">').append(e('<button class="btn btn-default" style="width:2em">').text(a("-")).click(g(n))))})));v.attr("data-field",i);v.enable_add=function h(e){l.prop("disabled",!e)};return v}function b(){var t=o=="ipv4"?a("Prefix length or Netmask"):a("Prefix length");var n=e("<div>").append(d=m(a("Addresses"),"addresses",["Address",t,"Gateway"],["","",""],c=h("method",o=="ipv4"?N:C).css("display","inline-block")),e("<br>"),f=m(a("DNS"),"dns","Server","",l=_(a("Automatic"),"ignore_auto_dns")),e("<br>"),p=m(a("DNS Search Domains"),"dns_search","Search Domain","",u=_(a("Automatic"),"ignore_auto_dns")),e("<br>"),v=m(a("Routes"),"routes",["Address",t,"Gateway","Metric"],["","","",""],g=_(a("Automatic"),"ignore_auto_routes")));return n}if(s.method=="manual"&&s.addresses.length===0)s.addresses=[["","",""]];var k=s.method=="disabled"||s.method=="ignore";var w=!(s.method=="link-local"||s.method=="shared"||k);if(!w){s.addresses=[];s.dns=[];s.dns_search=[]}if(k){s.routes=[]}e("#network-ip-settings-dialog .modal-title").text(o=="ipv4"?a("IPv4 Settings"):a("IPv6 Settings"));e("#network-ip-settings-body").html(b());var x=s.method=="auto"||s.method=="dhcp";l.enable(x);u.enable(x);g.enable(x);d.enable_add(w);f.enable_add(w);p.enable_add(w);v.enable_add(!k)},cancel:function(){if(z.connection)z.connection.reset();e("#network-ip-settings-dialog").modal("hide")},apply:function(){function t(){if(z.connection)return z.connection.apply();else{var e=z.model.get_settings();return e.add_connection(z.settings)}}t().done(function(){e("#network-ip-settings-dialog").modal("hide");if(z.done)z.done()}).fail(function(t){e("#network-ip-settings-error").text(t.message||t.toString())})}};function z(){this._init()}function P(e,t){return t&&t.Interfaces.indexOf(e)!=-1}function $(e){return!e.Device||e.Device.DeviceType=="ethernet"||e.Device.DeviceType=="bond"||e.Device.DeviceType=="vlan"||e.Device.DeviceType=="bridge"}function O(e,t){if(e===null||e===undefined){throw new TypeError("Array.prototype.find called on null or undefined")}if(typeof t!=="function"){throw new TypeError("predicate must be a function")}var n=Object(e);var i=n.length>>>0;var r=arguments[1];var o;for(var a=0;a<i;a++){if(a in n){o=n[a];if(t.call(r,o,a,n)){return o}}}return undefined}function B(e,t){return e&&O(e.Slaves,function(e){return P(t,e)})}function U(e,t){return e.list_interfaces().filter(function(e){return!P(e,t)&&$(e)})}function j(t,n){return e('<ul class="list-group available-interfaces-group">').append(U(t,n).map(function(t){return e('<li class="list-group-item">').append(e('<div class="checkbox">').css("margin","0px").append(e("<label>").append(e("<input>",{type:"checkbox","data-iface":t.Name}).prop("checked",!!B(n,t)),e("<span>").text(t.Name))))}))}function H(t,n){var i=[{title:"-",choice:"",is_default:true}];n.find("input[data-iface]").each(function(t,n){var r=e(n).attr("data-iface");if(e(n).prop("checked"))i.push({title:r,choice:r})});return r.select_btn(t,i)}function R(e){if(e.Settings.connection.slave_type){delete e.Settings.connection.slave_type;delete e.Settings.connection.master;return e.apply()}}function F(e,t,n,i,r,o){var a,s;var c;a=e.find_interface(r);if(!a)return false;function l(e){e.forEach(function(e){if(!c||c.Settings.connection.timestamp<e.Settings.connection.timestamp)c=e})}if(a.Device)l(a.Device.AvailableConnections);else l(a.Connections);if(o){if(!c){s=d();return e.get_settings().add_connection({connection:{id:s,uuid:s,autoconnect:true,type:"802-3-ethernet",interface_name:a.Name,slave_type:i,master:n.connection.uuid},"802-3-ethernet":{}})}else if(c.Settings.connection.master!=n.connection.uuid){c.Settings.connection.slave_type=i;c.Settings.connection.master=n.connection.uuid;delete c.Settings.ipv4;delete c.Settings.ipv6;return c.apply().then(function(){var e=a.Device;if(e&&e.ActiveConnection&&e.ActiveConnection.Connection===c)return c.activate(e,null)})}}else{if(c&&c.Settings.connection.master==n.connection.uuid){R(c)}}return true}function V(t,n,i,r,o){var a=n.get_settings();function s(){var a=t.find("input[data-iface]").map(function(t,a){return F(n,i,r,o,e(a).attr("data-iface"),e(a).prop("checked"))});return e.when.apply(e,a.get())}function c(){if(i)return i.apply();else return a.add_connection(r)}return c().then(s)}L.prototype={_init:function(){this.id="network-bond-settings-dialog";this.bond_settings_template=e("#network-bond-settings-template").html();n.parse(this.bond_settings_template)},setup:function(){e("#network-bond-settings-cancel").click(e.proxy(this,"cancel"));e("#network-bond-settings-apply").click(e.proxy(this,"apply"))},enter:function(){e("#network-bond-settings-error").text("");if(L.connection)L.connection.freeze();this.update()},show:function(){},leave:function(){},find_slave_con:function(e){if(!L.connection)return null;return O(L.connection.Slaves,function(t){return t.Interfaces.indexOf(e)>=0})||null},update:function(){var t=this;var i=L.model;var o=L.connection;var a=L.settings;var s=a.bond.options;var c;var d,l;var f,u,p,g,v;function h(){var e=H(_,c);l.replaceWith(e);l=e;r.select_btn_select(l,s.primary);_()}function _(){s.mode=r.select_btn_selected(d);l.parents("tr").toggle(s.mode=="active-backup");if(s.mode=="active-backup")s.primary=r.select_btn_selected(l);else delete s.primary}function m(){var e=r.select_btn_selected(f)=="mii";p.parents("tr").toggle(!e);g.parents("tr").toggle(e);v.parents("tr").toggle(e);if(e){s.miimon=u.val();s.updelay=g.val();s.downdelay=v.val();delete s.arp_interval;delete s.arp_ip_target}else{delete s.miimon;delete s.updelay;delete s.downdelay;s.arp_interval=u.val();s.arp_ip_target=p.val()}}var b=e(n.render(t.bond_settings_template,{interface_name:a.bond.interface_name,monitoring_interval:s.miimon||s.arp_interval||"100",monitoring_targets:s.arp_ip_targets,link_up_delay:s.updelay||"0",link_down_delay:s.downdelay||"0"}));b.find("#network-bond-settings-interface-name-input").change(function(t){var n=e(t.target).val();a.bond.interface_name=n;a.connection.interface_name=n});b.find("#network-bond-settings-members").append(c=j(i,o).change(h));b.find("#network-bond-settings-mode-select").append(d=r.select_btn(_,A));b.find("#network-bond-settings-primary-select").append(l=H(_,c));b.find("#network-bond-settings-link-monitoring-select").append(f=r.select_btn(m,I));u=b.find("#network-bond-settings-monitoring-interval-input");u.change(m);p=b.find("#network-bond-settings-monitoring-targets-input");p.change(m);g=b.find("#network-bond-settings-link-up-delay-input");g.change(m);v=b.find("#network-bond-settings-link-down-delay-input");v.change(m);r.select_btn_select(d,s.mode);r.select_btn_select(f,s.miimon!==0?"mii":"arp");h();_();m();e("#network-bond-settings-body").html(b)},cancel:function(){if(L.connection)L.connection.reset();e("#network-bond-settings-dialog").modal("hide")},apply:function(){V(e("#network-bond-settings-body"),L.model,L.connection,L.settings,"bond").done(function(){e("#network-bond-settings-dialog").modal("hide");if(L.done)L.done()}).fail(function(t){e("#network-bond-settings-error").text(t.message||t.toString())})}};function L(){this._init()}G.prototype={_init:function(){this.id="network-bridge-settings-dialog";this.bridge_settings_template=e("#network-bridge-settings-template").html();n.parse(this.bridge_settings_template)},setup:function(){e("#network-bridge-settings-cancel").click(e.proxy(this,"cancel"));e("#network-bridge-settings-apply").click(e.proxy(this,"apply"))},enter:function(){e("#network-bridge-settings-error").text("");if(G.connection)G.connection.freeze();this.update()},show:function(){},leave:function(){},find_slave_con:function(e){if(!G.connection)return null;return O(G.connection.Slaves,function(t){return t.Interfaces.indexOf(e)>=0})||null},update:function(){var t=this;var i=G.model;var r=G.settings;var o=r.bridge;var a,s,c,d,l;function f(){o.stp=a.prop("checked");o.priority=parseInt(s.val(),10);o.forward_delay=parseInt(c.val(),10);o.hello_time=parseInt(d.val(),10);o.max_age=parseInt(l.val(),10);s.parents("tr").toggle(o.stp);c.parents("tr").toggle(o.stp);d.parents("tr").toggle(o.stp);l.parents("tr").toggle(o.stp)}var u=e(n.render(t.bridge_settings_template,{bridge_name:o.interface_name,stp_checked:o.stp,stp_priority:o.priority,stp_forward_delay:o.forward_delay,stp_hello_time:o.hello_time,stp_max_age:o.max_age}));u.find("#network-bridge-settings-name-input").change(function(t){var n=e(t.target).val();o.interface_name=n;r.connection.interface_name=n});u.find("#network-bridge-settings-slave-interfaces").append(j(i,G.connection)).parent().toggle(!G.connection);a=u.find("#network-bridge-settings-stp-enabled-input");a.change(f);s=u.find("#network-bridge-settings-stp-priority-input");s.change(f);c=u.find("#network-bridge-settings-stp-forward-delay-input");c.change(f);d=u.find("#network-bridge-settings-stp-hello-time-input");d.change(f);l=u.find("#network-bridge-settings-stp-max-age-input");l.change(f);f();e("#network-bridge-settings-body").html(u)},cancel:function(){if(G.connection)G.connection.reset();e("#network-bridge-settings-dialog").modal("hide")},apply:function(){V(e("#network-bridge-settings-body"),G.model,G.connection,G.settings,"bridge").done(function(){e("#network-bridge-settings-dialog").modal("hide");if(G.done)G.done()}).fail(function(t){e("#network-bridge-settings-error").text(t.message||t.toString())})}};function G(){this._init()}W.prototype={_init:function(){this.id="network-bridgeport-settings-dialog";this.bridge_port_settings_template=e("#network-bridge-port-settings-template").html();n.parse(this.bridge_port_settings_template)},setup:function(){e("#network-bridgeport-settings-cancel").click(e.proxy(this,"cancel"));e("#network-bridgeport-settings-apply").click(e.proxy(this,"apply"))},enter:function(){e("#network-bridgeport-settings-error").text("");if(W.connection)W.connection.freeze();this.update()},show:function(){},leave:function(){},update:function(){var t=this;var i=W.model;var r=W.settings;var o=r.bridge_port;var a,s,c;function d(){o.priority=parseInt(a.val(),10);o.path_cost=parseInt(s.val(),10);o.hairpin_mode=c.prop("checked")}var l=e(n.render(t.bridge_port_settings_template,{priority:o.priority,path_cost:o.path_cost,hairpin_mode_checked:o.hairpin_mode}));a=l.find("#network-bridge-port-settings-priority-input");a.change(d);s=l.find("#network-bridge-port-settings-path-cost-input");s.change(d);c=l.find("#network-bridge-port-settings-hairpin-mode-input");c.change(d);e("#network-bridgeport-settings-body").html(l)},cancel:function(){if(W.connection)W.connection.reset();e("#network-bridgeport-settings-dialog").modal("hide")},apply:function(){var t=this;var n=W.model;var i=W.settings;var r=n.get_settings();function o(t){e("#network-bridgeport-settings-error").text(t.message||t.toString())}function a(){if(W.connection)return W.connection.apply();else return r.add_connection(i)}a().done(function(){e("#network-bridgeport-settings-dialog").modal("hide");if(W.done)W.done()}).fail(o)}};function W(){this._init()}Y.prototype={_init:function(){this.id="network-vlan-settings-dialog";this.vlan_settings_template=e("#network-vlan-settings-template").html();n.parse(this.vlan_settings_template)},setup:function(){e("#network-vlan-settings-cancel").click(e.proxy(this,"cancel"));e("#network-vlan-settings-apply").click(e.proxy(this,"apply"))},enter:function(){e("#network-vlan-settings-error").text("");if(Y.connection)Y.connection.freeze();this.update()},show:function(){},leave:function(){},update:function(){var t=this;var i=Y.model;var o=Y.settings;var a=o.vlan;var s=true;var c,d,l;function f(){a.parent=r.select_btn_selected(c);e("#network-vlan-settings-apply").toggleClass("disabled",!a.parent);a.id=parseInt(d.val(),10);if(s&&a.parent&&a.id)l.val(a.parent+"."+a.id);a.interface_name=l.val();o.connection.interface_name=a.interface_name}function u(){s=false;f()}var p=[];i.list_interfaces().forEach(function(e){if(!P(e,Y.connection)&&$(e))p.push({title:e.Name,choice:e.Name})});var g=e(n.render(t.vlan_settings_template,{vlan_id:a.id||"1",interface_name:a.interface_name}));c=r.select_btn(f,p);g.find("#network-vlan-settings-parent-select").html(c);d=g.find("#network-vlan-settings-vlan-id-input").change(f).on("input",f);l=g.find("#network-vlan-settings-interface-name-input").change(u).on("input",u);r.select_btn_select(c,a.parent||(p[0]?p[0].choice:""));f();e("#network-vlan-settings-body").html(g)},cancel:function(){if(Y.connection)Y.connection.reset();e("#network-vlan-settings-dialog").modal("hide")},apply:function(){var t=this;var n=Y.model;var i=Y.settings;var r=n.get_settings();function o(t){e("#network-vlan-settings-error").text(t.message||t.toString())}function a(){if(Y.connection)return Y.connection.apply();else return r.add_connection(i)}a().done(function(){e("#network-vlan-settings-dialog").modal("hide");if(Y.done)Y.done()}).fail(o)}};function Y(){this._init()}function q(t){t.setup();e("#"+t.id).on("show.bs.modal",function(){t.enter()}).on("shown.bs.modal",function(){t.show()}).on("hidden.bs.modal",function(){t.leave()})}function X(t,n){if(t._entered_)t.leave();t.enter(n);t._entered_=true;e("#"+t.id).show();t.show()}function J(t){e("#"+t.id).hide();if(t._entered_){t.leave();t._entered_=false}}function K(){var n;var i;var r;function o(){var n=t.location.path;if(n.length===0){J(r);X(i)}else if(n.length===1){J(i);X(r,n[0])}else{console.warn("not a networking location: "+n);t.location=""}e("body").show()}t.translate();n=new f;i=new D(n);i.setup();r=new T(n);r.setup();q(new z);q(new L);q(new G);q(new W);q(new Y);e(t).on("locationchanged",o);o()}return K});

//# sourceURL=network/interfaces.min.js
