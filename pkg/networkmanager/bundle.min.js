
require(["jquery","base1/cockpit","base1/mustache","shell/controls","shell/shell","system/server","shell/plot","base1/patterns"],function(e,t,n,i,o,r){"use strict";var a=t.gettext;var s=t.gettext;function c(){if(window.debugging=="all"||window.debugging=="nm")console.debug.apply(console,arguments)}function d(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})}function l(t){e("#error-popup-message").text(t.message||t||"???");e('.modal[role="dialog"]').modal("hide");e("#error-popup").modal("show")}function f(t,n){var i=n[0].choice;function o(t){return e("<li>",{value:t.choice}).append(e("<a>").text(t.title))}var r=e('<button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">').append(e('<span class="pull-left"></span>'),e('<div class="caret"></div>'));var a=e('<div class="btn-group bootstrap-select dropdown form-control">').append(r,e('<ul class="dropdown-menu">').append(n.map(o)));a.on("click","li",function(){i=e(this).attr("value");s(i);t(i)});function s(t){e("button span",a).text(e("li[value='"+t+"']",a).text());i=t}function c(){return i}s(i);e.data(a[0],"cockpit-select-btn-funcs",{select:s,selected:c});return a}function u(t,n){e.data(t[0],"cockpit-select-btn-funcs").select(n)}function p(t){return e.data(t[0],"cockpit-select-btn-funcs").selected()}function g(){var n=this;var i=null;var o=t.dbus("org.freedesktop.NetworkManager");n.client=o;var r={};function s(){console.warn.apply(console,arguments)}function c(e){return function(t){return g(t,e)}}function d(e){return function(t){return t.map(e)}}function l(e){return e[" priv"]}var f=0;function u(){f+=1}function p(){f-=1;if(f===0)I()}function g(e,t){if(e=="/")return null;function n(){this[" priv"]={};l(this).type=t;l(this).path=e;for(var n in t.props)this[n]=t.props[n].def}if(!r[e]){n.prototype=t.prototype;r[e]=new n;if(t.refresh)t.refresh(r[e]);if(t.exporters&&t.exporters[0])t.exporters[0](r[e])}return r[e]}function v(e){return r[e]||null}function h(e){var t=r[e];if(t){if(l(t).type.drop)l(t).type.drop(t);delete r[e];I()}}function m(e,t){var n,i,o;i=l(e).type.props;for(n in i){o=t[i[n].prop||n];if(o!==undefined){if(i[n].conv)o=i[n].conv(o);if(o!==e[n]){e[n]=o;if(i[n].trigger)i[n].trigger(e)}}}}function _(e){var t={};for(var n in e){if(e.hasOwnProperty(n)){t[n]=e[n].v}}return t}function b(e){if(e&&l(e).path)return l(e).path;else return"/"}function k(t,n,i){var r=new e.Deferred;o.call(b(t),n,i,Array.prototype.slice.call(arguments,3)).fail(function(e){r.reject(e)}).done(function(e){r.resolve.apply(r,e)});return r.promise()}var w={};function x(e){e.forEach(function(e){if(e.exporters&&e.exporters.length>C)C=e.exporters.length;e.interfaces.forEach(function(t){w[t]=e})})}function y(e,t,n,i){var o=v(e);if(o){var r=l(o).type;if(n=="PropertiesChanged"){u();m(o,_(i[0]));p()}else if(r.signals&&r.signals[n])r.signals[n](o,i)}}function S(e,t,n){var i=w[t];if(i)m(g(e,i),n)}function D(e,t){h(e)}var C=0;var N;function I(){function t(){var t,i,o,a;for(t=0;t<C;t++){for(i in r){o=r[i];a=l(o).type.exporters;if(a&&a[t])a[t](o)}}e(n).trigger("changed")}if(!N){N=true;window.setTimeout(function(){N=false;t()},300)}}o.call("/org/freedesktop/NetworkManager","org.freedesktop.DBus.Properties","Get",["org.freedesktop.NetworkManager","State"],{flags:""}).fail(s).done(function(e,t){if(t.flags){if(t.flags.indexOf(">")!==-1)i="be";else if(t.flags.indexOf("<")!==-1)i="le"}});var M=o.subscribe({},y);var A=o.watch({});e(o).on("notify",function(t,n){e.each(n,function(t,n){e.each(n,function(e,n){if(n)S(t,e,n);else D(t,e)})})});n.close=function pe(){M.remove();A.remove();e(o).off("notify");o.close("unused")};function T(e){return e.toString(10)}function E(e){var t=[],n;if(i=="be"){for(n=3;n>=0;n--){t[n]=e&255;e=e>>>8}}else{for(n=0;n<4;n++){t[n]=e&255;e=e>>>8}}return t}function z(e){var t=0,n;if(i=="be"){for(n=0;n<4;n++){t=256*t+e[n]}}else{for(n=3;n>=0;n--){t=256*t+e[n]}}return t}function P(e){return E(e).map(T).join(".")}function U(e){var t=e.split(".");if(t.length==4)return z(t.map(function(e){return parseInt(e,10)}));else return 0}var $={255:8,254:7,252:6,248:5,240:4,224:3,192:2,128:1,0:0};function O(e){if(/^[0-9]+$/.test(e.trim()))return parseInt(e,10);var t=e.split(".");if(t.length!=4)return-1;var n=0;var i;for(i=0;i<4;i++){var o=$[t[i].trim()];if(o!==undefined){n+=o;if(o<8)break}else return-1}for(i+=1;i<4;i++){if(/^0+$/.test(t[i].trim())===false)return-1}return n}function R(e){return[P(e[0]),e[1].toString(),P(e[2])]}function B(e){return[U(e[0]),O(e[1]),U(e[2])]}function j(e){return[P(e[0]),e[1].toString(),P(e[2]),e[3].toString()]}function H(e){return[U(e[0]),O(e[1]),U(e[2]),parseInt(e[3],10)||0]}function F(e){var n=e.split(":");var i=[];for(var o=0;o<8;o++){var r=parseInt(n[o],16)||0;i[2*o]=r>>8;i[2*o+1]=r&255}return t.base64_encode(i)}function V(e){var n=[];var i=t.base64_decode(e);for(var o=0;o<8;o++)n[o]=((i[2*o]<<8)+i[2*o+1]).toString(16);return n.join(":")}function L(e){return[V(e[0]),e[1].toString(),V(e[2])]}function G(e){return[F(e[0]),parseInt(e[1],10)||64,F(e[2])]}function W(e){return[V(e[0]),e[1].toString(),V(e[2]),e[3].toString()]}function Y(e){return[F(e[0]),parseInt(e[1],10)||64,F(e[2]),parseInt(e[3],10)||0]}function q(t){function n(e,n,i){if(t[e]&&t[e][n])return t[e][n].v;else return i}function i(e,t,i,o){return{method:n(e,"method","auto"),ignore_auto_dns:n(e,"ignore-auto-dns",false),ignore_auto_routes:n(e,"ignore-auto-routes",false),addresses:n(e,"addresses",[]).map(t),dns:n(e,"dns",[]).map(o),dns_search:n(e,"dns-search",[]),routes:n(e,"routes",[]).map(i)}}var o={connection:{type:n("connection","type"),uuid:n("connection","uuid"),interface_name:n("connection","interface-name"),timestamp:n("connection","timestamp",0),id:n("connection","id",a("Unknown")),autoconnect:n("connection","autoconnect",true),slave_type:n("connection","slave-type"),master:n("connection","master")}};if(!t.connection.master){o.ipv4=i("ipv4",R,j,P);o.ipv6=i("ipv6",L,W,V)}if(t.bond){o.bond={options:e.extend({},n("bond","options",{})),interface_name:n("bond","interface-name")}}if(t.bridge){o.bridge={interface_name:n("bridge","interface-name"),stp:n("bridge","stp",true),priority:n("bridge","priority",32768),forward_delay:n("bridge","forward-delay",15),hello_time:n("bridge","hello-time",2),max_age:n("bridge","max-age",20),ageing_time:n("bridge","ageing-time",300)}}if(t["bridge-port"]||o.connection.slave_type=="bridge"){o.bridge_port={priority:n("bridge-port","priority",32),path_cost:n("bridge-port","path-cost",100),hairpin_mode:n("bridge-port","hairpin-mode",false)}}if(t.vlan){o.vlan={parent:n("vlan","parent"),id:n("vlan","id"),interface_name:n("vlan","interface-name")}}return o}function X(n,i){var o=e.extend(true,{},i);function r(e,n,i,r,a){if(r===undefined)r=a;if(!o[e])o[e]={};if(r!==undefined)o[e][n]=t.variant(i,r);else delete o[e][n]}function a(e,t,i,a,s,c,d){r(e,"method","s",n[e].method);r(e,"ignore-auto-dns","b",n[e].ignore_auto_dns);r(e,"ignore-auto-routes","b",n[e].ignore_auto_routes);r(e,"addresses",t,n[e].addresses.map(i));r(e,"dns",c,n[e].dns.map(d));r(e,"dns-search","as",n[e].dns_search);r(e,"routes",a,n[e].routes.map(s));delete o[e]["address-labels"]}r("connection","id","s",n.connection.id);r("connection","autoconnect","b",n.connection.autoconnect);r("connection","uuid","s",n.connection.uuid);r("connection","interface-name","s",n.connection.interface_name);r("connection","type","s",n.connection.type);r("connection","slave-type","s",n.connection.slave_type);r("connection","master","s",n.connection.master);delete o.ipv4;if(n.ipv4)a("ipv4","aau",B,"aau",H,"au",U);delete o.ipv6;if(n.ipv6)a("ipv6","a(ayuay)",G,"a(ayuayu)",Y,"aay",F);delete o.bond;if(n.bond){r("bond","options","a{ss}",n.bond.options);r("bond","interface-name","s",n.bond.interface_name)}delete o.bridge;if(n.bridge){r("bridge","interface-name","s",n.bridge.interface_name);r("bridge","stp","b",n.bridge.stp);r("bridge","priority","u",n.bridge.priority);r("bridge","forward-delay","u",n.bridge.forward_delay);r("bridge","hello-time","u",n.bridge.hello_time);r("bridge","max-age","u",n.bridge.max_age);r("bridge","ageing-time","u",n.bridge.ageing_time)}delete o["bridge-port"];if(n.bridge_port){r("bridge-port","priority","u",n.bridge_port.priority);r("bridge-port","path-cost","u",n.bridge_port.path_cost);r("bridge-port","hairpin-mode","b",n.bridge_port.hairpin_mode)}delete o.vlan;if(n.vlan){r("vlan","parent","s",n.vlan.parent);r("vlan","id","u",n.vlan.id);r("vlan","interface-name","s",n.vlan.interface_name)}if(n["802-3-ethernet"]){if(!o["802-3-ethernet"])o["802-3-ethernet"]={}}return o}function J(e){switch(e){case 0:return"unknown";case 1:return"ethernet";case 2:return"wifi";case 3:return"unused1";case 4:return"unused2";case 5:return"bt";case 6:return"olpc_mesh";case 7:return"wimax";case 8:return"modem";case 9:return"infiniband";case 10:return"bond";case 11:return"vlan";case 12:return"adsl";case 13:return"bridge";default:return""}}function K(e){switch(e){case 0:return"?";case 10:return"";case 20:return a("Not available");case 30:return a("Inactive");case 40:return a("Preparing");case 50:return a("Configuring");case 60:return a("Authenticating");case 70:return a("Configuring IP");case 80:return a("Checking IP");case 90:return a("Waiting");case 100:return a("Active");case 110:return a("Deactivating");case 120:return a("Failed");default:return""}}var Q={};function Z(e,t){if(e.Settings&&e.Settings.connection&&e.Settings.connection.uuid)delete Q[e.Settings.connection.uuid];e.Settings=t;if(e.Settings&&e.Settings.connection&&e.Settings.connection.uuid)Q[e.Settings.connection.uuid]=e}function ee(e){u();o.call(b(e),"org.freedesktop.NetworkManager.Settings.Connection","GetSettings").always(p).fail(s).done(function(t){var n=t[0];if(n){l(e).orig=n;if(!l(e).frozen){Z(e,q(n))}}})}function te(e){if(e.Udi.indexOf("/sys/")!==0)return;u();t.spawn(["udevadm","info",e.Udi],{err:"message"}).done(function(t){var n={};function i(e,t,i){var o="E: "+t+"=";if(e.indexOf(o)===0){n[i]=e.substr(o.length)}}t.split("\n").forEach(function(e){i(e,"ID_MODEL_FROM_DATABASE","IdModel");i(e,"ID_VENDOR_FROM_DATABASE","IdVendor")});m(e,n)}).fail(function(e){if(e.exit_status!==4){console.warn(e.message);console.warn(e)}}).always(p)}function ne(e){ee(e)}var ie={interfaces:["org.freedesktop.NetworkManager.IP4Config"],props:{Addresses:{conv:d(R),def:[]}}};var oe={interfaces:["org.freedesktop.NetworkManager.IP6Config"],props:{Addresses:{conv:d(L),def:[]}}};var re={interfaces:["org.freedesktop.NetworkManager.Settings.Connection"],props:{Unsaved:{}},signals:{Updated:ne},refresh:ee,drop:function(e){Z(e,null)},prototype:{freeze:function(){l(this).frozen=true},apply:function(){var e=this;return k(this,"org.freedesktop.NetworkManager.Settings.Connection","Update",X(this.Settings,l(this).orig)).done(function(){l(e).frozen=false})},reset:function(){Z(this,q(l(this).orig));l(this).frozen=false;I()},activate:function(e,t){return k(g("/org/freedesktop/NetworkManager",ue),"org.freedesktop.NetworkManager","ActivateConnection",b(this),b(e),b(t))},delete_:function(){return k(this,"org.freedesktop.NetworkManager.Settings.Connection","Delete")}},exporters:[function(e){e.Slaves=[];e.Interfaces=[]},null,function(e){var t,n;function i(t){if(t.Settings.connection.type==e.Settings.connection.slave_type){e.Masters.push(t);t.Slaves.push(e)}}e.Masters=[];if(e.Settings&&e.Settings.connection&&e.Settings.connection.slave_type){t=Q[e.Settings.connection.master];if(t){e.Masters.push(t);t.Slaves.push(e)}else{n=le(e.Settings.connection.master);if(n){if(n.Device)n.Device.AvailableConnections.forEach(i);else n.Connections.forEach(i)}}}}]};var ae={interfaces:["org.freedesktop.NetworkManager.Connection.Active"],props:{Connection:{conv:c(re)},Ip4Config:{conv:c(ie)},Ip6Config:{conv:c(oe)}},prototype:{deactivate:function(){return k(g("/org/freedesktop/NetworkManager",ue),"org.freedesktop.NetworkManager","DeactivateConnection",b(this))}}};var se={interfaces:["org.freedesktop.NetworkManager.Device","org.freedesktop.NetworkManager.Device.Wired","org.freedesktop.NetworkManager.Device.Bond","org.freedesktop.NetworkManager.Device.Bridge","org.freedesktop.NetworkManager.Device.Vlan"],props:{DeviceType:{conv:J},Interface:{},StateText:{prop:"State",conv:K,def:a("Unknown")},State:{},HwAddress:{},AvailableConnections:{conv:d(c(re)),def:[]},ActiveConnection:{conv:c(ae)},Udi:{trigger:te},IdVendor:{def:""},IdModel:{def:""},Driver:{def:""},Carrier:{def:true},Speed:{}},prototype:{activate:function(e,t){return k(g("/org/freedesktop/NetworkManager",ue),"org.freedesktop.NetworkManager","ActivateConnection",b(e),b(this),b(t))},disconnect:function(){return k(this,"org.freedesktop.NetworkManager.Device","Disconnect")}}};var ce={interfaces:[],exporters:[function(e){e.Device=null;e.Connections=[]},null,function(e){if(!e.Device&&e.Connections.length===0){h(l(e).path);return}if(e.Device){e.Device.AvailableConnections.forEach(function(t){t.Interfaces.push(e)})}else{e.Connections.forEach(function(t){t.Interfaces.push(e)})}}]};function de(e){var t=g(":interface:"+e,ce);t.Name=e;return t}function le(e){return v(":interface:"+e)}var fe={interfaces:["org.freedesktop.NetworkManager.Settings"],props:{Connections:{conv:d(c(re)),def:[]}},prototype:{add_connection:function(t){var n=e.Deferred();k(this,"org.freedesktop.NetworkManager.Settings","AddConnection",X(t,{})).done(function(e){n.resolve(g(e,re))}).fail(function(e){n.reject(e)});return n.promise()}},exporters:[null,function(e){if(e.Connections){e.Connections.forEach(function(e){function t(t){de(t).Connections.push(e)}if(e.Settings){if(e.Settings.bond)t(e.Settings.bond.interface_name);if(e.Settings.bridge)t(e.Settings.bridge.interface_name);if(e.Settings.vlan)t(e.Settings.vlan.interface_name)}})}}]};var ue={interfaces:["org.freedesktop.NetworkManager"],props:{Devices:{conv:d(c(se)),def:[]},ActiveConnections:{conv:d(c(ae)),def:[]}},exporters:[null,function(e){e.Devices.forEach(function(e){if(e.Interface){var t=de(e.Interface);t.Device=e}})}]};ae.props.Master={conv:c(se)};se.props.Slaves={conv:d(c(se)),def:[]};n.list_interfaces=function ge(){var e,t;var n=[];for(e in r){t=r[e];if(l(t).type===ce)n.push(t)}return n.sort(function(e,t){return e.Name.localeCompare(t.Name)})};n.find_interface=le;n.get_manager=function(){return g("/org/freedesktop/NetworkManager",ue)};n.get_settings=function(){return g("/org/freedesktop/NetworkManager/Settings",fe)};x([ue,fe,se,ie,oe,re,ae]);g("/org/freedesktop/NetworkManager",ue);g("/org/freedesktop/NetworkManager/Settings",fe);return n}function v(n){return e("<a>").text(n).click(function(){t.location.go([n])})}function h(e){if(!e)return a("Inactive");if(e.State==100&&e.Carrier===false)return a("No carrier");return e.StateText}function m(n){var i=e("<span>").append(_(n.Interfaces.map(function(n){return e("<a>").text(n.Name).click(function(){t.location.go([n.Name])})}),", "));return i}function _(e,t){var n=[];for(var i=0;i<e.length;i++){n.push(e[i]);if(i<e.length-1)n.push(t)}return n}function b(t,n,i){var o=[];var r;if(!t)return"";r=t.ActiveConnection;if(r&&r.Master){return e("<span>").append(e("<span>").text(a("Part of ")),n?v(r.Master.Interface):r.Master.Interface)}if(r&&r.Ip4Config){r.Ip4Config.Addresses.forEach(function(e){o.push(e[0]+"/"+e[1])})}function s(e){return e.indexOf("fe8")===0||e.indexOf("fe9")===0||e.indexOf("fea")===0||e.indexOf("feb")===0}if(r&&r.Ip6Config){r.Ip6Config.Addresses.forEach(function(e){if(!(i&&s(e[0])))o.push(e[0]+"/"+e[1])})}return e("<span>").text(o.join(", "))}function k(t){return function(n){var i=n.getAxes();if(i.yaxis.datamax<1e5)i.yaxis.options.max=1e5;else i.yaxis.options.max=null;i.yaxis.options.min=0;e(t).text(o.bits_per_sec_tick_unit(i.yaxis))}}var w=t.permission({admin:true});e(w).on("changed",x);function x(){i.update_privileged_ui(w,".network-privileged",t.format(a("The user <b>$0</b> is not permitted to modify network settings"),t.user.name))}var y;var S;var D;function C(){if(y)return;S={};y=t.metrics(1e3,[{source:"direct",metrics:[{name:"network.interface.in.bytes",units:"bytes",derive:"rate"},{name:"network.interface.out.bytes",units:"bytes",derive:"rate"}],metrics_path_names:["rx","tx"]},{source:"internal",metrics:[{name:"network.interface.rx",units:"bytes",derive:"rate"},{name:"network.interface.tx",units:"bytes",derive:"rate"}],metrics_path_names:["rx","tx"]}]);D=t.grid(1e3,-1,-0);y.follow();D.walk()}function N(e){S[e]=[D.add(y,["rx",e]),D.add(y,["tx",e])]}I.prototype={_init:function(e){this.id="networking";this.model=e},getTitle:function(){return s("page-title","Networking")},setup:function(){var n=this;x();e("#networking-add-bond").click(e.proxy(this,"add_bond"));e("#networking-add-bridge").click(e.proxy(this,"add_bridge"));e("#networking-add-vlan").click(e.proxy(this,"add_vlan"));function i(t,n){e("#networking-interfaces tr").removeClass("highlight");if(n){e('#networking-interfaces tr[data-interface="'+encodeURIComponent(n)+'"]').addClass("highlight")}}var r={direct:"network.interface.in.bytes",internal:"network.interface.rx",units:"bytes",derive:"rate",threshold:200};var a=o.plot_simple_template();e.extend(a.yaxis,{tickFormatter:o.format_bits_per_sec_tick_no_unit});e.extend(a.grid,{hoverable:true,autoHighlight:false});a.setup_hook=k("#networking-rx-unit");this.rx_plot=o.plot(e("#networking-rx-graph"),300);this.rx_plot.set_options(a);this.rx_series=this.rx_plot.add_metrics_stacked_instances_series(r,{});this.rx_plot.start_walking();e(this.rx_series).on("hover",i);var s={direct:"network.interface.out.bytes",internal:"network.interface.tx",units:"bytes",derive:"rate",threshold:200};var c=o.plot_simple_template();e.extend(c.yaxis,{tickFormatter:o.format_bits_per_sec_tick_no_unit});e.extend(c.grid,{hoverable:true,autoHighlight:false});c.setup_hook=k("#networking-tx-unit");this.tx_plot=o.plot(e("#networking-tx-graph"),300);this.tx_plot.set_options(c);this.tx_series=this.tx_plot.add_metrics_stacked_instances_series(s,{});this.tx_plot.start_walking();e(this.tx_series).on("hover",i);e(t).on("resize",function(){n.rx_plot.resize();n.tx_plot.resize()});var d=o.setup_plot_controls(e("#networking"),e("#networking-graph-toolbar"));d.reset([this.rx_plot,this.tx_plot]);C();e(D).on("notify",function(e,t,n){l()});function l(){for(var n in S){var i=S[n];var o=i[0][0];var r=i[1][0];var a=e('#networking-interfaces tr[data-sample-id="'+encodeURIComponent(n)+'"]');if(o!==undefined&&r!==undefined&&a.length>0){a.find("td:nth-child(3)").text(t.format_bits_per_sec(r*8));a.find("td:nth-child(4)").text(t.format_bits_per_sec(o*8))}}}e(window).on("resize",function(){n.rx_plot.resize();n.tx_plot.resize()})},enter:function(){var t=this;this.log_box=r.logbox(["_SYSTEMD_UNIT=NetworkManager.service","_SYSTEMD_UNIT=firewalld.service"],10);e("#networking-log").empty().append(this.log_box);e(this.model).on("changed.networking",e.proxy(this,"update_devices"));this.update_devices()},show:function(){this.rx_plot.resize();this.tx_plot.resize()},leave:function(){if(this.log_box)this.log_box.stop();e(this.model).off(".networking")},update_devices:function(){var n=this;var i;i=e("#networking-interfaces tbody");i.empty();n.model.list_interfaces().forEach(function(o){function r(e){var t=e.Device?e.Device.AvailableConnections:e.Connections;return t.some(function(e){return e.Masters&&e.Masters.length>0})}if(r(o))return;if(o.Device&&o.Device.DeviceType!="ethernet"&&o.Device.DeviceType!="bond"&&o.Device.DeviceType!="vlan"&&o.Device.DeviceType!="bridge")return;var a=o.Device;var s=a&&a.State==100&&a.Carrier===true;n.rx_series.add_instance(o.Name);n.tx_series.add_instance(o.Name);N(o.Name);i.append(e("<tr>",{"data-interface":encodeURIComponent(o.Name),"data-sample-id":s?encodeURIComponent(o.Name):null}).append(e("<td>").text(o.Name),e("<td>").html(b(a,false,true)),s?[e("<td>").text(""),e("<td>").text("")]:e('<td colspan="2">').text(h(a))).click(function(){t.location.go([o.Name])}))})},add_bond:function(){var t,n,i;i=d();for(n=0;n<100;n++){t="bond"+n;if(!this.model.find_interface(t))break}Y.model=this.model;Y.done=null;Y.connection=null;Y.settings={connection:{id:i,autoconnect:false,type:"bond",uuid:i,interface_name:t},bond:{options:{mode:"balance-rr"},interface_name:t}};e("#network-bond-settings-dialog").modal("show")},add_bridge:function(){var t,n,i;i=d();for(n=0;n<100;n++){t="bridge"+n;if(!this.model.find_interface(t))break}q.model=this.model;q.done=null;q.connection=null;q.settings={connection:{id:i,autoconnect:false,type:"bridge",uuid:i,interface_name:t},bridge:{interface_name:t,stp:false,priority:32768,forward_delay:15,hello_time:2,max_age:20,ageing_time:300}};e("#network-bridge-settings-dialog").modal("show")},add_vlan:function(){var t,n,i;i=d();J.model=this.model;J.done=null;J.connection=null;J.settings={connection:{id:i,autoconnect:false,type:"vlan",uuid:i,interface_name:""},vlan:{interface_name:"",parent:""}};e("#network-vlan-settings-dialog").modal("show")}};function I(e){this._init(e)}var M=[{choice:"auto",title:a("Automatic (DHCP)")},{choice:"link-local",title:a("Link local")},{choice:"manual",title:a("Manual")},{choice:"shared",title:a("Shared")},{choice:"disabled",title:a("Disabled")}];var A=[{choice:"auto",title:a("Automatic")},{choice:"dhcp",title:a("Automatic (DHCP only)")},{choice:"link-local",title:a("Link local")},{choice:"manual",title:a("Manual")},{choice:"ignore",title:a("Ignore")}];var T=[{choice:"balance-rr",title:a("Round Robin")},{choice:"active-backup",title:a("Active Backup")},{choice:"balance-xor",title:a("XOR")},{choice:"broadcast",title:a("Broadcast")},{choice:"802.3ad",title:a("802.3ad")},{choice:"balance-tlb",title:a("Adaptive transmit load balancing")},{choice:"balance-alb",title:a("Adaptive load balancing")}];var E=[{choice:"mii",title:a("MII (Recommended)")},{choice:"arp",title:a("ARP")}];function z(e,t,n){for(var i=0;i<e.length;i++){if(e[i].choice==t)return e[i].title}return n}P.prototype={_init:function(e){this.id="network-interface";this.model=e},getTitle:function(){return s("page-title","Networking")},setup:function(){var n=this;e("#network-interface .breadcrumb a").on("click",function(){t.location.go("/")});e("#network-interface-delete").click(e.proxy(this,"delete_connections"));this.device_onoff=e("#network-interface-delete-switch").on("change",function(){var t=e(this).onoff("value");if(t)n.connect();else n.disconnect()});function i(t,n){e("#network-interface-slaves tr").removeClass("highlight");if(n){e('#network-interface-slaves tr[data-interface="'+encodeURIComponent(n)+'"]').addClass("highlight")}}var r={direct:"network.interface.in.bytes",internal:"network.interface.rx",units:"bytes",derive:"rate"};var a=o.plot_simple_template();e.extend(a.yaxis,{tickFormatter:o.format_bits_per_sec_tick_no_unit});e.extend(a.grid,{hoverable:true,autoHighlight:false});a.setup_hook=k("#network-interface-rx-unit");this.rx_plot=o.plot(e("#network-interface-rx-graph"),300);this.rx_plot.set_options(a);this.rx_series=this.rx_plot.add_metrics_stacked_instances_series(r,{});this.rx_plot.start_walking();e(this.rx_series).on("hover",i);var s={direct:"network.interface.out.bytes",internal:"network.interface.tx",units:"bytes",derive:"rate"};var c=o.plot_simple_template();e.extend(c.yaxis,{tickFormatter:o.format_bits_per_sec_tick_no_unit});e.extend(c.grid,{hoverable:true,autoHighlight:false});c.setup_hook=k("#network-interface-tx-unit");this.tx_plot=o.plot(e("#network-interface-tx-graph"),300);this.tx_plot.set_options(c);this.tx_series=this.tx_plot.add_metrics_stacked_instances_series(s,{});this.tx_plot.start_walking();e(this.tx_series).on("hover",i);e(t).on("resize",function(){n.rx_plot.resize();n.tx_plot.resize()});var d=o.setup_plot_controls(e("#network-interface"),e("#network-interface-graph-toolbar"));d.reset([this.rx_plot,this.tx_plot]);C();e(D).on("notify",function(e,t,n){l()});function l(){for(var n in S){var i=S[n];var o=i[0][0];var r=i[1][0];var a=e('#network-interface-slaves tr[data-sample-id="'+encodeURIComponent(n)+'"]');if(a.length>0){a.find("td:nth-child(2)").text(t.format_bits_per_sec(r*8));a.find("td:nth-child(3)").text(t.format_bits_per_sec(o*8))}}}e(window).on("resize",function(){n.rx_plot.resize();n.tx_plot.resize()})},enter:function(t){var n=this;e(n.model).on("changed.network-interface",e.proxy(n,"update"));n.dev_name=t;e("#network-interface .breadcrumb .active").text(n.dev_name);n.rx_series.clear_instances();n.tx_series.clear_instances();e("#network-interface-delete").hide();n.dev=null;n.update()},show:function(){this.rx_plot.resize();this.tx_plot.resize()},leave:function(){e(this.model).off(".network-interface");this.dev=null},delete_connections:function(){var n=this;function i(t){return e.when(t.delete_(),e.when.apply(e,t.Slaves.map(function(e){return L(e)})))}function o(t){return e.when.apply(e,t.map(i))}function r(e){if(e.Device)return o(e.Device.AvailableConnections);else return o(e.Connections)}if(this.iface){var a=t.location;r(this.iface).done(function(){a.go("/")}).fail(l)}},connect:function(){var e=this;var t=e.model.get_settings();function n(t){l(t);e.update()}function i(t){t.activate(e.dev,null).fail(n)}if(e.ghost_settings){t.add_connection(e.ghost_settings).done(i).fail(n)}else if(e.main_connection){i(e.main_connection)}else e.update()},disconnect:function(){var e=this;if(!e.dev){e.update();return}e.dev.disconnect().fail(function(t){l(t);e.update()})},update:function(){var n=this;var i=n.model.find_interface(n.dev_name);var o=i&&i.Device;n.iface=i;n.dev=o;var r;if(o){if(o.DeviceType=="ethernet"){r=t.format("$IdVendor $IdModel $Driver)",o)}else if(o.DeviceType=="bond"){r=a("Bond")}else if(o.DeviceType=="vlan"){r=a("VLAN")}else if(o.DeviceType=="bridge"){r=a("Bridge")}}else if(i){if(i.Connections[0]&&i.Connections[0].Settings.connection.type=="bond")r=a("Bond");else if(i.Connections[0]&&i.Connections[0].Settings.connection.type=="vlan")r=a("VLAN");else if(i.Connections[0]&&i.Connections[0].Settings.connection.type=="bridge")r=a("Bridge");else r=a("Unknown")}else r=a("Unknown");e("#network-interface-name").text(n.dev_name);e("#network-interface-hw").text(r);e("#network-interface-mac").text(o?o.HwAddress:"");this.device_onoff.prop("disabled",!o);this.device_onoff.onoff("value",!!(o&&o.ActiveConnection));e("#network-interface-disconnect").prop("disabled",!o||!o.ActiveConnection);var s=i&&!o||o&&(o.DeviceType=="bond"||o.DeviceType=="vlan"||o.DeviceType=="bridge");e("#network-interface-delete").toggle(!!s);function c(){if(o&&o.Carrier!==undefined){return e("<tr>").append(e("<td>").text(a("Carrier")),e("<td>").append(o.Carrier?o.Speed?t.format_bits_per_sec(o.Speed*1e6):a("Yes"):a("No")))}else return null}function f(){var t;if(n.main_connection&&n.main_connection.Masters.length>0)return null;if(!o)t=a("Inactive");else if(o.State!=100)t=o.StateText;else t=null;return e("<tr>").append(e("<td>").text(a("Status")),e("<td>").append(b(o,true,false)," ",t?e("<span>").text(t):null))}function u(i,r){if(!r)return[];function s(){if(i)i.apply().fail(l);else{var e=n.model.get_settings();e.add_connection(r).fail(l)}}function c(){if(i&&o&&o.ActiveConnection&&o.ActiveConnection.Connection===i){i.activate(o,null).fail(l)}}function d(n){var i=r[n];var o=[];if(i.method!="manual")o.push(z(n=="ipv4"?M:A,i.method,a("Unknown configuration")));var s=i.method!="manual";var c=[];i.addresses.forEach(function(e){var t=e[0]+"/"+e[1];if(e[2]&&e[2]!="0.0.0.0"&&e[2]!="0:0:0:0:0:0:0:0")t+=" via "+e[2];c.push(t)});if(c.length>0)o.push(t.format(s?"Additional address $val":"Address $val",{val:c.join(", ")}));var d=!i["ignore-auto-dns"]&&i.method!="manual";if(i.dns.length>0)o.push(t.format(d?"Additional DNS $val":"DNS $val",{val:i.dns.join(", ")}));if(i.dns_search.length>0)o.push(t.format(d?"Additional DNS Search Domains $val":"DNS Search Domains $val",{val:i.dns_search.join(", ")}));return o.map(function(t){return e("<div>").text(t)})}function f(t){$.model=n.model;$.connection=i;$.settings=e.extend({},r);$.topic=t;$.done=c;e("#network-ip-settings-dialog").modal("show")}function u(){Y.model=n.model;Y.connection=i;Y.settings=r;Y.done=c;e("#network-bond-settings-dialog").modal("show")}function p(){q.model=n.model;q.connection=i;q.settings=i.Settings;q.done=c;e("#network-bridge-settings-dialog").modal("show")}function g(){X.model=n.model;X.connection=i;X.settings=i.Settings;X.done=c;e("#network-bridgeport-settings-dialog").modal("show")}function v(){J.model=n.model;J.connection=i;J.settings=i.Settings;J.done=c;e("#network-vlan-settings-dialog").modal("show")}function h(t,n,i){return e("<tr>").append(e("<td>").text(t).css("vertical-align",n.length>1?"top":"center"),e("<td>").append(n),e('<td class="networking-configure">').append(e('<button class="btn btn-default network-privileged">').text(a("Configure")).click(function(){i()})))}function b(e,t){if(!r[e])return null;return h(t,d(e),function(){f(e)})}function k(){if(i&&i.Masters.length>0){return e("<tr>").append(e("<td>").text(a("Master")),e("<td>").append(_(i.Masters.map(m),", ")))}else return null}function w(){var t=[];var n=[];var i;if(!r.bond)return null;i=r.bond.options;t.push(z(T,i.mode,i.mode));if(i.arp_interval)t.push(a("ARP Monitoring"));if(t.length>0)n.push(e("<div>").text(t.join(", ")));return h(a("Bond"),n,u)}function x(){var n=[];var i=r.bridge;if(!i)return null;function o(i,o){n.push(e("<div>").text(t.format(i,o)))}if(i.stp){o(a("Spanning Tree Protocol"));if(i.priority!=32768)o(a("Priority $priority"),i);if(i.forward_delay!=15)o(a("Forward delay $forward_delay"),i);if(i.hello_time!=2)o(a("Hello time $hello_time"),i);if(i.max_age!=20)o(a("Maximum message age $max_age"),i)}return h(a("Bridge"),n,p)}function y(){var n=[];var i=r.bridge_port;if(!i)return null;function o(i,o){n.push(e("<div>").text(t.format(i,o)))}if(i.priority!=32)o(a("Priority $priority"),i);if(i.path_cost!=100)o(a("Path cost $path_cost"),i);if(i.hairpin_mode)o(a("Hairpin mode"));return h(a("Bridge port"),n,g)}function S(){var n=[];var i=r.vlan;if(!i)return null;function o(i,o){n.push(e("<div>").text(t.format(i,o)))}o(a("Parent $parent"),i);o(a("Id $id"),i);return h(a("VLAN"),n,v)}return[k(),e("<tr>").append(e("<td>").text(a("General")),e('<td class="networking-controls">').append(e("<label>").append(e('<input type="checkbox">').prop("checked",r.connection.autoconnect).change(function(){r.connection.autoconnect=e(this).prop("checked");s()}),a("Connect automatically")))),b("ipv4",a("IPv4")),b("ipv6",a("IPv6")),S(),x(),y(),w()]}function p(){var e=d();return{connection:{id:e,uuid:e,autoconnect:false,type:"802-3-ethernet",interface_name:i.Name},"802-3-ethernet":{},ipv4:{method:"auto",addresses:[],dns:[],dns_search:[],routes:[]},ipv6:{method:"auto",addresses:[],dns:[],dns_search:[],routes:[]}}}n.ghost_settings=null;n.main_connection=null;n.connection_settings=null;function g(e){e.forEach(function(e){if(!n.main_connection||n.main_connection.Settings.connection.timestamp<e.Settings.connection.timestamp)n.main_connection=e});if(n.main_connection){n.connection_settings=n.main_connection.Settings}else{n.ghost_settings=p();n.connection_settings=n.ghost_settings}}if(i){if(i.Device)g(i.Device.AvailableConnections);else g(i.Connections)}e("#network-interface-settings").empty().append(f()).append(c()).append(u(n.main_connection,n.connection_settings));x();function v(i){var o=e("#network-interface-slaves tbody");var r={};var s={};o.empty();if(!i||i.Settings.connection.type!="bond"&&i.Settings.connection.type!="bridge"){n.rx_series.add_instance(n.dev_name);n.tx_series.add_instance(n.dev_name);e("#network-interface-slaves").hide();return}e("#network-interface-slaves thead th:first-child").text(i.Settings.connection.type=="bond"?a("Members"):a("Ports"));i.Slaves.forEach(function(i){i.Interfaces.forEach(function(o){var a=o.Device;var c=a&&a.State==100&&a.Carrier===true;n.rx_series.add_instance(o.Name);n.tx_series.add_instance(o.Name);s[o.Name]=true;r[o.Name]=e("<tr>",{"data-interface":encodeURIComponent(o.Name),"data-sample-id":c?encodeURIComponent(o.Name):null}).append(e("<td>").text(o.Name),c?[e("<td>").text(""),e("<td>").text("")]:e('<td colspan="2">').text(h(a)),e('<td class="networking-row-configure">').append(U(c,function(e){
if(e){i.activate(o.Device).fail(l)}else if(a){a.disconnect().fail(l)}},"network-privileged")),e('<td width="28px">').append(e('<button class="btn btn-default btn-control network-privileged">').text("-").click(function(){i.delete_().fail(l);return false}))).click(function(){t.location.go([o.Name])})})});Object.keys(r).sort().forEach(function(e){o.append(r[e])});var c=e("<div>",{"class":"dropdown"}).append(e("<button>",{"class":"network-privileged btn btn-default btn-control dropdown-toggle","data-toggle":"dropdown"}).text("+"),e("<ul>",{"class":"dropdown-menu add-button",role:"menu"}).append(n.model.list_interfaces().map(function(t){if(R(t)&&!s[t.Name]&&t!=n.iface){return e('<li role="presentation">').append(e('<a role="menuitem" class="network-privileged">').text(t.Name).click(function(){G(n.model,i,i.Settings,i.Settings.connection.type,t.Name,true).fail(l)}))}return null})));e("#network-interface-slaves thead th:nth-child(5)").html(c);e("#network-interface-slaves").show();x()}v(n.main_connection)}};function P(e){this._init(e)}function U(t,n){var i=e('<div class="btn-onoff">').onoff();i.onoff("value",t);i.on("change",function(){n(i.onoff("value"))});return i}$.prototype={_init:function(){this.id="network-ip-settings-dialog"},setup:function(){e("#network-ip-settings-cancel").click(e.proxy(this,"cancel"));e("#network-ip-settings-apply").click(e.proxy(this,"apply"))},enter:function(){e("#network-ip-settings-error").text("");if($.connection)$.connection.freeze();this.update()},show:function(){},leave:function(){},update:function(){var t=this;var n=$.connection;var i=$.settings;var o=$.topic;var r=i[o];var s,c;var d,l;var p,g;var v,h;function m(e,n){var i=f(function(n){r[e]=n;t.update()},n);u(i,r[e]);return i}function _(n,i){var o;var a=e("<span>").append(e('<span class="inverted-switchbox">').text(n),o=U(!r[i],function(e){r[i]=!e;t.update()}));a.enable=function s(e){o.onoff("disabled",!e)};return a}function b(n,i,o,s,c){var d=false;var l;if(typeof o=="string"){d=true;o=[o]}function f(e,t){if(d)return r[i][e];else return r[i][e][t]}function u(e,t,n){if(d)r[i][e]=n;else r[i][e][t]=n}function p(){return function(){r[i].push(s);t.update()}}function g(e){return function(){r[i].splice(e,1);t.update()}}var v=e('<div class="network-ip-settings-row">').append(e("<div>").append(e("<strong>").text(n),e('<div class="pull-right">').append(c,l=e('<button class="btn btn-default">').text("+").css("margin-left","10px").click(p()))),e('<table width="100%">').append(r[i].map(function(t,n){return e("<tr>").append(o.map(function(t,i){return e("<td>").append(e('<input class="form-control">').val(f(n,i)).attr("placeholder",t).change(function(t){u(n,i,e(t.target).val())}))}),e("<td>").append(e('<button class="btn btn-default">').text(a("-")).click(g(n))))})));v.attr("data-field",i);v.enable_add=function h(e){l.prop("disabled",!e)};return v}function k(){var t=o=="ipv4"?a("Prefix length or Netmask"):a("Prefix length");var n=e("<div>").append(c=b(a("Addresses"),"addresses",["Address",t,"Gateway"],["","",""],s=m("method",o=="ipv4"?M:A).css("display","inline-block")),e("<br>"),l=b(a("DNS"),"dns","Server","",d=_(a("Automatic"),"ignore_auto_dns")),e("<br>"),g=b(a("DNS Search Domains"),"dns_search","Search Domain","",p=_(a("Automatic"),"ignore_auto_dns")),e("<br>"),h=b(a("Routes"),"routes",["Address",t,"Gateway","Metric"],["","","",""],v=_(a("Automatic"),"ignore_auto_routes")));return n}if(r.method=="manual"&&r.addresses.length===0)r.addresses=[["","",""]];var w=r.method=="disabled"||r.method=="ignore";var x=!(r.method=="link-local"||r.method=="shared"||w);if(!x){r.addresses=[];r.dns=[];r.dns_search=[]}if(w){r.routes=[]}e("#network-ip-settings-dialog .modal-title").text(o=="ipv4"?a("IPv4 Settings"):a("IPv6 Settings"));e("#network-ip-settings-body").html(k());var y=r.method=="auto"||r.method=="dhcp";d.enable(y);p.enable(y);v.enable(y);c.enable_add(x);l.enable_add(x);g.enable_add(x);h.enable_add(!w)},cancel:function(){if($.connection)$.connection.reset();e("#network-ip-settings-dialog").modal("hide")},apply:function(){function t(){if($.connection)return $.connection.apply();else{var e=$.model.get_settings();return e.add_connection($.settings)}}t().done(function(){e("#network-ip-settings-dialog").modal("hide");if($.done)$.done()}).fail(function(t){e("#network-ip-settings-error").text(t.message||t.toString())})}};function $(){this._init()}function O(e,t){return t&&t.Interfaces.indexOf(e)!=-1}function R(e){return!e.Device||e.Device.DeviceType=="ethernet"||e.Device.DeviceType=="bond"||e.Device.DeviceType=="vlan"||e.Device.DeviceType=="bridge"}function B(e,t){if(e===null||e===undefined){throw new TypeError("Array.prototype.find called on null or undefined")}if(typeof t!=="function"){throw new TypeError("predicate must be a function")}var n=Object(e);var i=n.length>>>0;var o=arguments[1];var r;for(var a=0;a<i;a++){if(a in n){r=n[a];if(t.call(o,r,a,n)){return r}}}return undefined}function j(e,t){return e&&B(e.Slaves,function(e){return O(t,e)})}function H(e,t){return e.list_interfaces().filter(function(e){return!O(e,t)&&R(e)})}function F(t,n){return e('<ul class="list-group available-interfaces-group dialog-list">').append(H(t,n).map(function(t){return e('<li class="list-group-item">').append(e('<div class="checkbox">').css("margin","0px").append(e("<label>").append(e("<input>",{type:"checkbox","data-iface":t.Name}).prop("checked",!!j(n,t)),e("<span>").text(t.Name))))}))}function V(t,n){var i=[{title:"-",choice:"",is_default:true}];n.find("input[data-iface]").each(function(t,n){var o=e(n).attr("data-iface");if(e(n).prop("checked"))i.push({title:o,choice:o})});return f(t,i)}function L(e){if(e.Settings.connection.slave_type){delete e.Settings.connection.slave_type;delete e.Settings.connection.master;return e.apply()}}function G(e,t,n,i,o,r){var a,s;var c;a=e.find_interface(o);if(!a)return false;function l(e){e.forEach(function(e){if(!c||c.Settings.connection.timestamp<e.Settings.connection.timestamp)c=e})}if(a.Device)l(a.Device.AvailableConnections);else l(a.Connections);if(r){if(!c){s=d();return e.get_settings().add_connection({connection:{id:s,uuid:s,autoconnect:true,type:"802-3-ethernet",interface_name:a.Name,slave_type:i,master:n.connection.uuid},"802-3-ethernet":{}})}else if(c.Settings.connection.master!=n.connection.uuid){c.Settings.connection.slave_type=i;c.Settings.connection.master=n.connection.uuid;delete c.Settings.ipv4;delete c.Settings.ipv6;return c.apply().then(function(){var e=a.Device;if(e&&e.ActiveConnection&&e.ActiveConnection.Connection===c)return c.activate(e,null)})}}else{if(c&&c.Settings.connection.master==n.connection.uuid){L(c)}}return true}function W(t,n,i,o,r){var a=n.get_settings();function s(){var a=t.find("input[data-iface]").map(function(t,a){return G(n,i,o,r,e(a).attr("data-iface"),e(a).prop("checked"))});return e.when.apply(e,a.get())}function c(){if(i)return i.apply();else return a.add_connection(o)}return c().then(s)}Y.prototype={_init:function(){this.id="network-bond-settings-dialog";this.bond_settings_template=e("#network-bond-settings-template").html();n.parse(this.bond_settings_template)},setup:function(){e("#network-bond-settings-cancel").click(e.proxy(this,"cancel"));e("#network-bond-settings-apply").click(e.proxy(this,"apply"))},enter:function(){e("#network-bond-settings-error").text("");if(Y.connection)Y.connection.freeze();this.update()},show:function(){},leave:function(){},find_slave_con:function(e){if(!Y.connection)return null;return B(Y.connection.Slaves,function(t){return t.Interfaces.indexOf(e)>=0})||null},update:function(){var t=this;var i=Y.model;var o=Y.connection;var r=Y.settings;var a=r.bond.options;var s;var c,d;var l,g,v,h,m;function _(){var e=V(b,s);d.replaceWith(e);d=e;u(d,a.primary);b()}function b(){a.mode=p(c);d.parents("tr").toggle(a.mode=="active-backup");if(a.mode=="active-backup")a.primary=p(d);else delete a.primary}function k(){var e=p(l)=="mii";v.parents("tr").toggle(!e);h.parents("tr").toggle(e);m.parents("tr").toggle(e);if(e){a.miimon=g.val();a.updelay=h.val();a.downdelay=m.val();delete a.arp_interval;delete a.arp_ip_target}else{delete a.miimon;delete a.updelay;delete a.downdelay;a.arp_interval=g.val();a.arp_ip_target=v.val()}}var w=e(n.render(t.bond_settings_template,{interface_name:r.bond.interface_name,monitoring_interval:a.miimon||a.arp_interval||"100",monitoring_targets:a.arp_ip_targets,link_up_delay:a.updelay||"0",link_down_delay:a.downdelay||"0"}));w.find("#network-bond-settings-interface-name-input").change(function(t){var n=e(t.target).val();r.bond.interface_name=n;r.connection.interface_name=n});w.find("#network-bond-settings-members").append(s=F(i,o).change(_));w.find("#network-bond-settings-mode-select").append(c=f(b,T));w.find("#network-bond-settings-primary-select").append(d=V(b,s));w.find("#network-bond-settings-link-monitoring-select").append(l=f(k,E));g=w.find("#network-bond-settings-monitoring-interval-input");g.change(k);v=w.find("#network-bond-settings-monitoring-targets-input");v.change(k);h=w.find("#network-bond-settings-link-up-delay-input");h.change(k);m=w.find("#network-bond-settings-link-down-delay-input");m.change(k);u(c,a.mode);u(l,a.miimon!==0?"mii":"arp");_();b();k();e("#network-bond-settings-body").html(w)},cancel:function(){if(Y.connection)Y.connection.reset();e("#network-bond-settings-dialog").modal("hide")},apply:function(){W(e("#network-bond-settings-body"),Y.model,Y.connection,Y.settings,"bond").done(function(){e("#network-bond-settings-dialog").modal("hide");if(Y.done)Y.done()}).fail(function(t){e("#network-bond-settings-error").text(t.message||t.toString())})}};function Y(){this._init()}q.prototype={_init:function(){this.id="network-bridge-settings-dialog";this.bridge_settings_template=e("#network-bridge-settings-template").html();n.parse(this.bridge_settings_template)},setup:function(){e("#network-bridge-settings-cancel").click(e.proxy(this,"cancel"));e("#network-bridge-settings-apply").click(e.proxy(this,"apply"))},enter:function(){e("#network-bridge-settings-error").text("");if(q.connection)q.connection.freeze();this.update()},show:function(){},leave:function(){},find_slave_con:function(e){if(!q.connection)return null;return B(q.connection.Slaves,function(t){return t.Interfaces.indexOf(e)>=0})||null},update:function(){var t=this;var i=q.model;var o=q.settings;var r=o.bridge;var a,s,c,d,l;function f(){r.stp=a.prop("checked");r.priority=parseInt(s.val(),10);r.forward_delay=parseInt(c.val(),10);r.hello_time=parseInt(d.val(),10);r.max_age=parseInt(l.val(),10);s.parents("tr").toggle(r.stp);c.parents("tr").toggle(r.stp);d.parents("tr").toggle(r.stp);l.parents("tr").toggle(r.stp)}var u=e(n.render(t.bridge_settings_template,{bridge_name:r.interface_name,stp_checked:r.stp,stp_priority:r.priority,stp_forward_delay:r.forward_delay,stp_hello_time:r.hello_time,stp_max_age:r.max_age}));u.find("#network-bridge-settings-name-input").change(function(t){var n=e(t.target).val();r.interface_name=n;o.connection.interface_name=n});u.find("#network-bridge-settings-slave-interfaces").append(F(i,q.connection)).parent().toggle(!q.connection);a=u.find("#network-bridge-settings-stp-enabled-input");a.change(f);s=u.find("#network-bridge-settings-stp-priority-input");s.change(f);c=u.find("#network-bridge-settings-stp-forward-delay-input");c.change(f);d=u.find("#network-bridge-settings-stp-hello-time-input");d.change(f);l=u.find("#network-bridge-settings-stp-max-age-input");l.change(f);f();e("#network-bridge-settings-body").html(u)},cancel:function(){if(q.connection)q.connection.reset();e("#network-bridge-settings-dialog").modal("hide")},apply:function(){W(e("#network-bridge-settings-body"),q.model,q.connection,q.settings,"bridge").done(function(){e("#network-bridge-settings-dialog").modal("hide");if(q.done)q.done()}).fail(function(t){e("#network-bridge-settings-error").text(t.message||t.toString())})}};function q(){this._init()}X.prototype={_init:function(){this.id="network-bridgeport-settings-dialog";this.bridge_port_settings_template=e("#network-bridge-port-settings-template").html();n.parse(this.bridge_port_settings_template)},setup:function(){e("#network-bridgeport-settings-cancel").click(e.proxy(this,"cancel"));e("#network-bridgeport-settings-apply").click(e.proxy(this,"apply"))},enter:function(){e("#network-bridgeport-settings-error").text("");if(X.connection)X.connection.freeze();this.update()},show:function(){},leave:function(){},update:function(){var t=this;var i=X.model;var o=X.settings;var r=o.bridge_port;var a,s,c;function d(){r.priority=parseInt(a.val(),10);r.path_cost=parseInt(s.val(),10);r.hairpin_mode=c.prop("checked")}var l=e(n.render(t.bridge_port_settings_template,{priority:r.priority,path_cost:r.path_cost,hairpin_mode_checked:r.hairpin_mode}));a=l.find("#network-bridge-port-settings-priority-input");a.change(d);s=l.find("#network-bridge-port-settings-path-cost-input");s.change(d);c=l.find("#network-bridge-port-settings-hairpin-mode-input");c.change(d);e("#network-bridgeport-settings-body").html(l)},cancel:function(){if(X.connection)X.connection.reset();e("#network-bridgeport-settings-dialog").modal("hide")},apply:function(){var t=this;var n=X.model;var i=X.settings;var o=n.get_settings();function r(t){e("#network-bridgeport-settings-error").text(t.message||t.toString())}function a(){if(X.connection)return X.connection.apply();else return o.add_connection(i)}a().done(function(){e("#network-bridgeport-settings-dialog").modal("hide");if(X.done)X.done()}).fail(r)}};function X(){this._init()}J.prototype={_init:function(){this.id="network-vlan-settings-dialog";this.vlan_settings_template=e("#network-vlan-settings-template").html();n.parse(this.vlan_settings_template)},setup:function(){e("#network-vlan-settings-cancel").click(e.proxy(this,"cancel"));e("#network-vlan-settings-apply").click(e.proxy(this,"apply"))},enter:function(){e("#network-vlan-settings-error").text("");if(J.connection)J.connection.freeze();this.update()},show:function(){},leave:function(){},update:function(){var t=this;var i=J.model;var o=J.settings;var r=o.vlan;var a=true;var s,c,d;function l(){r.parent=p(s);e("#network-vlan-settings-apply").toggleClass("disabled",!r.parent);r.id=parseInt(c.val(),10);if(a&&r.parent&&r.id)d.val(r.parent+"."+r.id);r.interface_name=d.val();o.connection.interface_name=r.interface_name}function g(){a=false;l()}var v=[];i.list_interfaces().forEach(function(e){if(!O(e,J.connection)&&R(e))v.push({title:e.Name,choice:e.Name})});var h=e(n.render(t.vlan_settings_template,{vlan_id:r.id||"1",interface_name:r.interface_name}));s=f(l,v);h.find("#network-vlan-settings-parent-select").html(s);c=h.find("#network-vlan-settings-vlan-id-input").change(l).on("input",l);d=h.find("#network-vlan-settings-interface-name-input").change(g).on("input",g);u(s,r.parent||(v[0]?v[0].choice:""));l();e("#network-vlan-settings-body").html(h)},cancel:function(){if(J.connection)J.connection.reset();e("#network-vlan-settings-dialog").modal("hide")},apply:function(){var t=this;var n=J.model;var i=J.settings;var o=n.get_settings();function r(t){e("#network-vlan-settings-error").text(t.message||t.toString())}function a(){if(J.connection)return J.connection.apply();else return o.add_connection(i)}a().done(function(){e("#network-vlan-settings-dialog").modal("hide");if(J.done)J.done()}).fail(r)}};function J(){this._init()}function K(t){t.setup();e("#"+t.id).on("show.bs.modal",function(){t.enter()}).on("shown.bs.modal",function(){t.show()}).on("hidden.bs.modal",function(){t.leave()})}function Q(t,n){if(t._entered_)t.leave();t.enter(n);t._entered_=true;e("#"+t.id).show();t.show()}function Z(t){e("#"+t.id).hide();if(t._entered_){t.leave();t._entered_=false}}function ee(){var n;var i;var o;function r(){var n=t.location.path;if(n.length===0){Z(o);Q(i)}else if(n.length===1){Z(i);Q(o,n[0])}else{console.warn("not a networking location: "+n);t.location=""}e("body").show()}t.translate();n=new g;i=new I(n);i.setup();o=new P(n);o.setup();K(new $);K(new Y);K(new q);K(new X);K(new J);e(t).on("locationchanged",r);r()}e(ee)});

//# sourceURL=network/interfaces.min.js
