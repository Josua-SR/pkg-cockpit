define(["jquery","base1/cockpit","base1/mustache","kubernetes/client","base1/patterns"],function(e,a,r,t){"use strict";var n=a.gettext;var i=e.scoped("#adjust-dialog");var l=null;var c=i("#adjust-dialog",document);c.on("show.bs.modal",function(e){l=t.k8client();var a=i(e.relatedTarget).attr("data-id");var n=l.objects[a];if(!n){console.warn("no such service:",a);return}var c=n.metadata||{};var o=n.spec||{};i("#adjust-name").val(c.name).attr("disabled","disabled");var u=l.select("ReplicationController",c.namespace,o.selector||{},true);var s=u.items.map(function(e){var a=e.metadata||{};var r=e.spec||{};return{uid:a.uid,name:a.name,count:r.replicas,link:a.selfLink}});var d=i("#adjust-template").html();i("table.cockpit-form-table").append(r.render(d,{replicas:s}));i(".adjust-replicas-header").toggle(s.length>0)}).on("hide.bs.modal",function(e){i("tr.adjust-replicas").remove();l.close();l=null});function o(e,a){var r=e.spec;if(!r){console.warn("replicationcontroller without spec");return false}if(r.replicas===a)return false;r.replicas=a;return true}function u(){var e=[];var r=[];i("input.adjust-replica").each(function(){var t=i(this);var c,u,s;c=t.attr("id");s=Number(i.trim(t.val()));if(isNaN(s)||s<0)u=new Error(n("Not a valid number of replicas"));else if(s>128)u=new Error(n("The maximum number of replicas is 128"));if(u){u.target="#"+c;e.push(u)}var d=t.attr("data-link");var f=function(){return l.modify(d,function(e){return o(e,s)})};f.label=a.format(n("Updating $0..."),t.attr("data-name"));r.push(f)});if(e.length){c.dialog("failure",e);return null}return r}function s(e){var a=i.Deferred();var r;function t(){var n=e.shift();if(!n){a.resolve();return}a.notify(n.label||null);r=n().done(function(){t()}).fail(function(e){a.reject(e)})}t();var n=a.promise();n.cancel=function l(){if(r&&r.cancel)r.cancel()};return n}i(".btn-primary").on("click",function(){var e=u();if(!e)return;var a=s(e);c.dialog("promise",a)})});
