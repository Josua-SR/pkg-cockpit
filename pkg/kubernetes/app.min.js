define(["jquery","base1/cockpit","base1/angular","kubernetes/client","base1/moment"],function(e,n,t,r,i){"use strict";return t.module("kubernetes",["ngAnimate","ngRoute","ui.bootstrap","kubernetes.containers","kubernetes.dashboard","kubernetes.details","kubernetes.graph","kubernetes.images","kubernetes.topology"]).config(["$routeProvider",function(e){e.otherwise({redirectTo:"/"})}]).controller("MainCtrl",["$scope","$route","$routeParams","$location","kubernetesClient",function(e,n,t,r,i){e.$route=n;e.$location=r;e.$routeParams=t;e.is_active=function o(n){var t=e.$route.current;return t&&t.loadedTemplateUrl===n};e.client=i;e.console=console;e.curtains={state:"silent"};var a=window.setTimeout(function(){e.curtains={state:"connecting"};e.$digest();a=null},1e3);function c(n){n.always(function(){window.clearTimeout(a);a=null}).done(function(){e.curtains=null;e.$digest()}).fail(function(n){e.curtains={state:"failed",failure:n};e.$digest()})}c(i.connect());e.reconnect=function u(){e.curtains={state:"connecting"};c(i.connect(true))}}]).factory("$exceptionHandler",["$log",function(e){return function(t,r){n.oops();e.error.apply(e,arguments)}}]).filter("orderObjectBy",function(){return function(e,n){var r,i=[];for(r in e)i.push(e[r]);if(!t.isArray(n))n=[String(a)];var a=n.map(function(e){return e.split(".")});function c(e,n){return e?e[n]:undefined}i.sort(function(e,n){var t,r,i,o=a.length;for(i=0;i<o;i++){t=a[i].reduce(c,e);r=a[i].reduce(c,n);if(t===r)continue;return t>r?1:-1}return 0});return i}}).filter("timeAgo",function(){return function(e){if(e)return i(e).fromNow();return""}}).filter("formatBytes",function(){return function(e){if(typeof e=="number")return n.format_bytes(e);return e}}).factory("kubernetesClient",function(){return r.k8client()}).directive("listingTable",["kubernetesFilter",function(n){return{restrict:"A",link:function(r,i,a){var c={};r.quiet=false;r.selection=c;r.selected=function o(e){if(t.isUndefined(e)){for(e in c)return true;return false}else{return e in c}};r.select=function u(n,t){var i;if(t&&e(t.target).parents().addBack().filter(".btn, li").length>0)return;if(!n){Object.keys(c).forEach(function(e){delete c[e]});r.quiet=false}else{i=!(n in c);if(i)c[n]=true;else delete c[n]}};r.connect=function s(e){r.$broadcast("connect",e)};n.register_listing(r)}}}]).directive("listingPanel",[function(){return{restrict:"A",scope:true,link:function(e,n,t){var r="main";e.tab=function(e,n){if(n){r=e;n.stopPropagation()}return r===e}},templateUrl:function(e,n){var t=n.kind||"default";return"views/"+t.toLowerCase()+"-panel.html"}}}]).directive("kubernetesFilterBar",["kubernetesClient","kubernetesFilter",function(n,t){return{restrict:"E",scope:true,link:function(r,i,a){r.filter=t;r.namespaces=n.select("Namespace");n.track(r.namespaces);e(r.namespaces).on("changed",function(){r.$digest()});r.$on("$destroy",function(){n.track(r.namespaces,false)});r.filter_click=function c(e){if(!t.listing)return;var n=!t.listing.quiet;if(n&&!t.listing.selected()){e.stopPropagation();i.children().first().addClass("open")}else t.listing.quiet=n}},templateUrl:"views/filter-bar.html"}}]).factory("kubernetesFilter",["kubernetesClient","$location","$rootScope","$timeout",function(n,t,r,i){var a={namespace:"",listing:null,set_namespace:c,register_listing:u};function c(e){var r=t.search().namespace;r=r?r:null;a.namespace=e?e:null;if(r!==a.namespace){i(function(){t.search({namespace:a.namespace})},0)}if(n.namespace()!==a.namespace)n.namespace(a.namespace)}e(n).on("namespace",function(e,n){if(n!=a.namespace)c(n)});r.$on("$routeChangeSuccess",function(e,n,r){c(t.search().namespace)});r.$on("$routeChangeStart",function(e,n){var r=t.search();if(a.namespace&&!r.namespace)t.search({namespace:a.namespace})});var o=null;function u(e){if(o){o();o=null}a.listing=e;if(e){o=e.$on("$destroy",function(){if(a.listing===e){o=null;a.listing=null}})}}return a}])});
