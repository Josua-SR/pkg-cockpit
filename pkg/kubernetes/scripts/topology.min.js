(function(){"use strict";var e={Pod:"#vertex-Pod",ReplicationController:"#vertex-ReplicationController",Node:"#vertex-Node",Service:"#vertex-Service",DeploymentConfig:"#vertex-DeploymentConfig",Route:"#vertex-Route"};angular.module("kubernetes.topology",["ngRoute","kubernetesUI","kubeClient","kubernetes.details"]).config(["$routeProvider",function(e){e.when("/topology",{templateUrl:"views/topology-page.html",controller:"TopologyCtrl"})}]).controller("TopologyCtrl",["$scope","$window","kubeLoader","kubeSelect","KubeDiscoverSettings","itemActions",function(t,n,a,o,i,r){t.items={};t.relations=[];t.selected=null;var c=false;function l(e,t,n){var a=o().kind(e).name(n).namespace(t).one();if(a)return a.metadata.selfLink}function s(e){var t={};var n,a;var i;if(e.kind==="Node"){t=o().kind("Pod").host(e.metadata.name)}else if(e.kind==="Service"){n=o().kind("Endpoints").namespace(e.metadata.namespace).name(e.metadata.name).one()||{};a=n.subsets||[];a.forEach(function(e){var n=e.addresses||[];n.forEach(function(e){if(e.targetRef&&e.targetRef.kind=="Pod")i=l("Pod",e.targetRef.namespace,e.targetRef.name);if(i)t[i]={}})})}else if(e.kind==="ReplicationController"){t=o().kind("Pod").namespace(e.metadata.namespace);if(e.spec.selector)t=t.label(e.spec.selector)}else if(e.kind==="DeploymentConfig"){t=o().kind("ReplicationController").namespace(e.metadata.namespace).label({"openshift.io/deployment-config.name":e.metadata.name})}else if(e.kind==="Route"&&e.spec.to){i=l(e.spec.to.kind,e.metadata.namespace,e.spec.to.name);if(i)t[i]={}}return t}a.watch("Node");a.watch("Pod");a.watch("ReplicationController");a.watch("Service");a.watch("Endpoints");i().then(function(e){if(e.flavor==="openshift"){a.watch("DeploymentConfig");a.watch("Route")}});var d=a.listen(function(e,n){var a;var i=[];var r;var c;t.items=o();if(t.selected){a=t.selected.metadata||{};r=o().kind(t.selected.kind).name(a.name);if(a.namespace)r=r.namespace(a.namespace);t.selected=r.one()}for(c in t.items){var l;var d=s(t.items[c]);for(l in d)i.push({source:c,target:l})}t.relations=i});t.$on("$destroy",function(){d.cancel()});t.$on("select",function(e,n){t.$applyAsync(function(){t.selected=n})});t.kinds=angular.copy(e);angular.extend(t,r);function f(){t.height={height:window.innerHeight-55+"px"};if(c)t.$digest()}angular.element(n).bind("resize",f);f();c=true}])})();
