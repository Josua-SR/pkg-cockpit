(function(){"use strict";function e(e,t){var r=e&&(!t||e.kind===t)&&e.spec&&e.metadata;var n=t?t:"Object";if(!r)console.warn("Invalid "+n,e);return r}function t(e){var t={E:1e18,P:1e15,T:1e12,G:1e9,M:1e6,K:1e3,m:.001,Ei:0x1000000000000000,Pi:0x4000000000000,Ti:1099511627776,Gi:1073741824,Mi:1048576,Ki:1024};for(var r in t){if(e.length>r.length&&e.slice(-r.length)===r){var n=Number(e.slice(0,-r.length));if(!isNaN(n))return n*t[r]}}return e}function r(e,t){var r=e.join(", ");if(t&&t.length){r=r+":"+t.map(function(e){if(e.protocol==="TCP")return e.port;else return e.port+"/"+e.protocol}).join(", ")}return r}angular.module("kubernetes.details",["ngRoute","ui.cockpit","kubernetesUI","kubeClient","kubernetes.listing","kubernetes.date"]).config(["$routeProvider",function(e){e.when("/list",{templateUrl:"views/details-page.html",controller:"DetailsCtrl"})}]).controller("DetailsCtrl",["$scope","KubeContainers","kubeLoader","kubeSelect","KubeDiscoverSettings","ListingState","$routeParams","$location","itemActions",function(e,t,r,n,a,i,o,l,c){var s=r.listen(function(){e.pods=n().kind("Pod");e.services=n().kind("Service");e.nodes=n().kind("Node");e.replicationcontrollers=n().kind("ReplicationController");e.deploymentconfigs=n().kind("DeploymentConfig");e.routes=n().kind("Route")});r.watch("Pod");r.watch("Service");r.watch("Node");r.watch("ReplicationController");r.watch("Endpoints");e.$on("$destroy",function(){s.cancel()});a().then(function(e){if(e.flavor==="openshift"){r.watch("DeploymentConfig");r.watch("Route")}});e.listing=new i(e);e.listing.forceInline=true;e.containers=t;e.itemIdentifier=function u(e){var t=e.metadata||{};var r=e.kind.toLowerCase()+"s/";if(t.namespace)r=r+t.namespace+"/";return r+t.name};e.serviceEndpoint=function f(e){return n().kind("Endpoints").namespace(e.metadata.namespace).name(e.metadata.name).one()};e.replicationcontrollerPods=function m(e){var t=e.metadata||{};var r=e.spec||{};return n().kind("Pod").namespace(t.namespace||"").label(r.selector||{})};e.nodePods=function d(e){var t=e.metadata||{};return n().kind("Pod").host(t.name)};e.nodeReadyCondition=function p(e){var t={};if(e){e.forEach(function(e){if(e.type=="Ready"){t=e;return false}})}return t};e.podStatus=function(e){var t=e.status||{};var r=e.metadata||{};if(r.deletionTimestamp)return"Terminating";else return t.phase};angular.extend(e,c)}]).filter("nodeStatus",["KubeTranslate",function(e){return function(t){var r=false;var n=e.gettext;if(t){t.forEach(function(e){if(e.type=="Ready"){r=e.status=="True";return false}})}return r?n("Ready"):n("Not Ready")}}]).filter("nodeExternalIP",["KubeTranslate",function(e){return function(t){var r=null;var n=e.gettext;if(t){t.forEach(function(e){if(e.type=="LegacyHostIP"||r.type=="ExternalIP"){r=e.address;return false}})}return r?r:n("Unknown")}}]).filter("formatCapacityName",function(){return function(e){var t;if(e=="cpu"){t="CPUs"}else{e=e.replace(/-/g," ");t=e.charAt(0).toUpperCase()+e.substr(1)}return t}}).filter("formatCapacityValue",["KubeFormat",function(e){return function(r,n){var a;if(n=="memory"){var i=t(r);r=e.formatBytes(i)}return r}}]).directive("kubernetesServiceCluster",function(){return{restrict:"E",link:function(e,t,n){e.$watchGroup(["item.spec.clusterIP","item.spec.ports"],function(e){var n=r([e[0]],e[1]);t.text(n)})}}}).factory("itemActions",["$modal",function(e){function t(t){return e.open({animation:false,controller:"ItemDeleteCtrl",templateUrl:"views/item-delete.html",resolve:{dialogData:function(){return{item:t}}}}).result}function r(t){return e.open({animation:false,controller:"RouteModifyCtrl",templateUrl:"views/route-modify.html",resolve:{dialogData:function(){return{item:t}}}}).result}function n(t){return e.open({animation:false,controller:"RCModifyCtrl",templateUrl:"views/replicationcontroller-modify.html",resolve:{dialogData:function(){return{item:t}}}}).result}function a(t){return e.open({animation:false,controller:"ServiceModifyCtrl",templateUrl:"views/service-modify.html",resolve:{dialogData:function(){return{item:t}}}}).result}return{modifyRC:n,modifyRoute:r,deleteItem:t,modifyService:a}}]).controller("ItemDeleteCtrl",["$scope","$modalInstance","dialogData","kubeMethods",function(e,t,r,n){angular.extend(e,r);e.performDelete=function a(){return n.delete(e.item)}}]).controller("RCModifyCtrl",["$q","$scope","$modalInstance","dialogData","kubeMethods","KubeTranslate",function(t,r,n,a,i,o){var l=o.gettext;var c={};if(!e(a.item,"ReplicationController")){r.$applyAsync(function(){r.$dismiss()});return}function s(){var e=t.defer();var r=Number(c.replicas.trim());var n;if(isNaN(r)||r<0)n=new Error(l("Not a valid number of replicas"));else if(r>128)n=new Error(l("The maximum number of replicas is 128"));if(n){n.target="#replicas";e.reject(n)}else{e.resolve({spec:{replicas:r}})}return e.promise}r.fields=c;angular.extend(r,a);r.performModify=function u(){return s().then(function(e){return i.patch(r.item,e)})}}]).controller("RouteModifyCtrl",["$q","$scope","$modalInstance","dialogData","kubeMethods","KubeTranslate",function(t,r,n,a,i,o){var l=o.gettext;var c={};if(!e(a.item,"Route")){r.$applyAsync(function(){r.$dismiss()});return}c.host=a.item.spec.host;function s(){var e=t.defer();var r=c.host.trim();var n;if(!r){n=new Error(l("Not a valid value for Host"));n.target="#host-value";e.reject(n)}else{e.resolve({spec:{host:c.host.trim()}})}return e.promise}r.fields=c;angular.extend(r,a);r.performModify=function u(){return s().then(function(e){return i.patch(r.item,e)})}}]).controller("ServiceModifyCtrl",["$q","$scope","$modalInstance","dialogData","kubeLoader","kubeSelect","KubeRequest","KubeTranslate","KubeFormat",function(t,r,n,a,i,o,l,c,s){var u=c.gettext;var f={};var m;if(!e(a.item,"Service")){r.$applyAsync(function(){r.$dismiss()});return}r.rcs=o().kind("ReplicationController").namespace(a.item.metadata.namespace||"").label(a.item.spec.selector||{});for(m in r.rcs){var d=r.rcs[m];f[m]={name:d.metadata.name,replicas:d.spec.replicas}}r.service=a.item;r.fields=f;angular.extend(r,a);function p(){var e=t.defer();var r;var n=[];var a=[];for(r in f){var i;var o=Number(f[r].replicas);var l=f[r].name;if(isNaN(o)||o<0)i=new Error(u("Not a valid number of replicas"));else if(o>128)i=new Error(u("The maximum number of replicas is 128"));if(i){i.target="#"+l;a.push(i)}else{n.push({link:r,name:l,data:{spec:{replicas:o}}})}}if(a.length>0){e.reject(a)}else e.resolve(n);return e.promise}r.performModify=function v(){var e=t.defer();var r;var n;p().then(function(t){function r(){var n=t.shift();if(!n){e.resolve();return}e.notify(s.format(u("Updating $0..."),n.name));var a={headers:{"Content-Type":"application/strategic-merge-patch+json"}};new l("PATCH",n.link,JSON.stringify(n.data),a).then(function(e){r()},function(t){var r=t.data;return e.reject(r||t)})}r()}).catch(function(t){e.reject(t)});var a=e.promise;a.cancel=function i(){if(n&&n.cancel)n.cancel()};return a}}])})();
