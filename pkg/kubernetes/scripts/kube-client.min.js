(function(){"use strict";var e="/api/v1";var n="/oapi/v1";var t={api:e,create:0};var r=p([{kind:"DeploymentConfig",type:"deploymentconfigs",api:n},{kind:"Endpoints",type:"endpoints",api:e},{kind:"Group",type:"groups",api:n,global:true},{kind:"Image",type:"images",api:n,global:true},{kind:"ImageStream",type:"imagestreams",api:n},{kind:"ImageStreamImage",type:"imagestreamimages",api:n},{kind:"ImageStreamTag",type:"imagestreamtags",api:n},{kind:"Namespace",type:"namespaces",api:e,global:true,create:-100},{kind:"Node",type:"nodes",api:e,global:true},{kind:"Pod",type:"pods",api:e,create:-20},{kind:"PolicyBinding",type:"policybindings",api:n},{kind:"RoleBinding",type:"rolebindings",api:n},{kind:"Route",type:"routes",api:n},{kind:"Project",type:"projects",api:n,global:true,create:-90},{kind:"ProjectRequest",type:"projectrequests",api:n,global:true,create:-90},{kind:"ReplicationController",type:"replicationcontrollers",api:e,create:-60},{kind:"Service",type:"services",api:e,create:-80},{kind:"User",type:"users",api:n,global:true}]);var a=/^[a-z0-9]([-a-z0-9]*[a-z0-9])?$/;var i="120s";function u(){if(window.debugging=="all"||window.debugging=="kube")console.debug.apply(console,arguments)}function o(e){var n,t,r,a;if(e.length===0)return 0;for(n=0,t=0,a=e.length;t<a;t++){r=e.charCodeAt(t);n=(n<<5)-n+r;n|=0}return Math.abs(n)}function l(e,n){var t=0;var r=e.length-1;var a,i;while(t<=r){a=(t+r)/2|0;i=e[a];if(i<n)t=a+1;else if(i>n)r=a-1;else return a}return t}function c(e){var n=this;var t=[];n.add=function r(n,a){var i,u,c,f,s=n.length;for(u=0;u<s;u++){i=o(""+n[u])%e;c=t[i];if(c===undefined)c=t[i]=[];f=l(c,a);if(c[f]!=a)c.splice(f,0,a)}};n.get=function a(n){var r=t[o(""+n)%e];if(!r)return[];return r.slice()};n.all=function i(n){var r,a,i,u,l;var c,f,s,d,p;for(a=0,l=n.length;a<l;a++){r=o(""+n[a])%e;i=t[r];if(!i){u=[];break}if(!u){u=i.slice()}else{for(d=0,p=0,c=u.length;d<c;){f=u[d];s=i[d+p];if(s<f){p+=1}else if(f!==s){u.splice(d,1);c-=1}else{d+=1}}}}return u||[]}}var f=Math.random().toString(36).slice(2);var s=1;function d(){var e="weakmap"+s;s+=1;var n=this;n.delete=function t(n){var t,r=n[f];if(r)delete r[e]};n.has=function r(n){var t=n[f];return t&&e in t};n.get=function a(n){var t=n[f];if(!t)return undefined;return t[e]};n.set=function i(n,t){var r=n[f];if(!r){r=function a(){};Object.defineProperty(n,f,{enumerable:false,configurable:false,writable:false,value:r})}r[e]=t}}function p(e){var n,r,a={"":t};for(n=0,r=e.length;n<r;n++){a[e[n].type]=e[n];a[e[n].kind]=e[n]}return a}function v(e){var n=e[0];if(n&&typeof n==="object"){if(n.metadata){if(n.metadata.selfLink)return n.metadata.selfLink;e=[n.kind,n.metadata.name,n.metadata.namespace]}else if(n.name&&n.kind){e=[n.kind,n.name,n.namespace]}}else if(n&&n[0]=="/"){return n}var t=r[e[0]]||r[""];var a=t.api;if(!t.global&&e[2])a+="/namespaces/"+e[2];a+="/"+t.type;if(e[1])a+="/"+e[1];return a}angular.module("kubeClient",[]).value("KUBE_SCHEMA",r).factory("kubeLoader",["$q","$exceptionHandler","$timeout","KubeWatch","KubeRequest","KUBE_SCHEMA",function(e,n,t,a,i,u){var o=[];var l={namespace:null};var c={};var f={};var s=null;var d=null;function p(e,n){var t=r[e]||r[""];var i=t.api;if(!t.global&&n)i+="/namespaces/"+n;i+="/"+t.type;if(!(e in c)){c[i]=new a(i,m);c[i].params={what:e,global:t.global,namespace:n}}return c[i]}function g(n){var t,r=l.namespace;if(angular.isArray(r)){t=[];angular.forEach(r,function(e){t.push(p(n,e))});return e.all(t)}else{return p(n,r)}}function m(e){if(s===null)s=e;else s.push.apply(s,e);if(e.length>0){if(d===null)d=window.setTimeout(y,150);else return}h(b)}function h(e){var n=s;s=null;if(!n)return;var t={};var r={};var a,i,u,o,l,c;for(a=0,i=n.length;a<i;a++){l=n[a].object;if(l){o=v([l]);if(n[a].type=="DELETED"){delete f[o];r[o]=l}else{t[o]=l;f[o]=l}}}e(t,r)}function b(){var e,t,r;for(e=0,t=o.length;e<t;e++){r=o[e];try{if(r)r.apply(E,arguments)}catch(a){n(a)}}}function y(){d=null;h(b)}function k(){var e,n;window.clearTimeout(d);d=null;s=null;var t=c;c={};angular.forEach(t,function(e){e.cancel()});for(e in f)delete f[e];for(e in l)delete l[e];l.namespace=null;b()}function K(e,n,t){m(e.map(function(e){if(t)e.kind=t;return{type:n?"DELETED":"ADDED",object:e}}));h(b)}function w(){var n=v(arguments);var t=new i("GET",n);var r=t.then(function(e){t=null;var n=e.data;if(!n||!n.kind){return null}else if(n.kind.indexOf("List")===n.kind.length-4){K(n.items,false,n.kind.slice(0,-4));return n.items}else{K([n]);return n}},function(n){t=null;return e.reject(n)});r.cancel=function a(e){t.cancel(e)};return r}function S(e){window.clearTimeout(d);d=null;var n,t,r={};if(e===null){r=null}else if(angular.isArray(e)){angular.forEach(e,function(e){r[e]=true})}else{r[e]=true}l.namespace=e;var a={},i={};h(function(e,n){a=e;i=n});var u,o;for(o in f){u=f[o].metadata;if(r&&u.namespace&&!(u.namespace in r)){i[o]=f[o];delete f[o];delete a[o]}}var s,p,v=[];for(s in c){p=c[s];if(!r&&p.params.namespace||r&&!p.params.global&&!(p.params.namespace in r)){c[s].cancel();v.push(p)}}b(a,i);angular.forEach(v,function(e){g(e.params.what)})}var E={watch:g,load:function j(){return w.apply(this,arguments)},limit:function D(e){if("namespace"in e)S(e.namespace)},reset:k,listen:function T(e,n){if(n)o.unshift(e);else o.push(e);var r=t(function(){r=null;e.call(E,f)},0);return{cancel:function(){var n,a;t.cancel(r);r=null;for(n=0,a=o.length;n<a;n++){if(o[n]===e)o[n]=null}}}},handle:function M(e,n,t){if(!angular.isArray(e))e=[e];K(e,n,t)},resolve:function q(){return v(arguments)},objects:f,limits:l};return E}]).factory("kubeSelect",["kubeLoader",function(e){var n={};var t=null;var r=null;var a=new d;var i=1;e.listen(function(e,n){i+=1;if(!e){t=null}else if(t){o(e)}},true);function u(){var n,r;t=new c(262139);o(e.objects)}function o(e){var r,a,i,u,o,l;for(r in e){a=e[r];for(i in n){l=n[i];if(l.digest){u=l.digest.call(null,a);if(u)t.add([u],r)}else if(l.digests){o=l.digests.call(null,a);if(o.length)t.add(o,r)}}}}function l(e){var n=a.get(e);if(!n||n.version!==i){n={version:i,length:n?n.length:undefined};a.set(e,n)}return n}function f(e){return function(){var n=l(this);var r=Array.prototype.slice.call(arguments);var a=e.name+": "+JSON.stringify(r);if(a in n)return n[a];var i;if(e.filter){i=e.filter.apply(this,r)}else{if(!t)u();if(!n.indexed){o(this);n.indexed=true}if(e.digests){i=g(e,this,r)}else if(e.digest){i=v(e,this,r)}else{console.warn("invalid filter: "+e.name);i={}}}n[a]=i;return i}}function s(){var e,t={length:{enumerable:false,configurable:true,get:function(){return l(this).length}}};for(e in n){t[e]={enumerable:false,configurable:true,value:f(n[e])}}return t}function p(e,n,t){var a,i;if(n===undefined){n=0;for(a in e)n+=1}r=r||s();Object.defineProperties(e,r);i=l(e);i.length=n;i.selection=e;i.indexed=t;return e}function v(e,n,r){var a,i,u,o,l,c,f;var s={},d=0;u=e.digest.apply(null,r);if(u!==null&&u!==undefined){l=t.get(u)}else{l=[]}for(a=0,i=l.length;a<i;a++){c=l[a];f=n[c];if(f){if(u===e.digest.call(null,f)){s[c]=f;d+=1}}}return p(s,d,true)}function g(e,n,r){var a,i,u,o,l,c,f,s;var d,v,g,m;var h={},b=0;a=e.digests.apply(null,r);i=a.length;if(i>0){s=t.all(a);a.sort()}else{s=[]}for(d=0,v=s.length;d<v;d++){l=s[d];f=n[l];if(f){u=e.digests.call(null,f);u.sort();c=false;for(g=0,m=u.length;!c&&g<m;g++){if(a[0]===u[g]){c=true;for(o=0;c&&o<i;o++){if(a[o]!==u[g+o])c=false}}}if(c){h[l]=f;b+=1}}}return p(h,b,true)}function m(e,a){if(typeof a=="function"){e={name:e,filter:a}}n[e.name]=e;t=null;r=null;i+=1}m("one",function(){var e;for(e in this)return this[e];return null});m("extend",function(e){var n;for(n in this)e[n]=this[n];return e});m({name:"label",digests:function(e){var n,t=[],r=e.metadata;var a=r?r.labels:e;for(n in a||[])t.push(n+"="+a[n]);return t}});m({name:"namespace",digest:function(e){if(typeof e==="string")return e;var n=e.metadata;return n?n.namespace:null}});m({name:"name",digest:function(e){if(typeof e==="string")return e;var n=e.metadata;return n?n.name:null}});m({name:"kind",digest:function(e){if(typeof e==="string")return e;return e.kind}});m({name:"host",digest:function(e){if(typeof e==="string")return e;var n=e.spec;return n?n.nodeName:null}});var h={};function b(n){var t,r=false;if(n===undefined){n=e.objects;r=true}else if(!n){n=h}if(typeof n!=="object"){console.warn("Pass resources or resource dicts or null to kubeSelect()");n=h}t=l(n);if(t.selection)return t.selection;var a,i;if(typeof n.kind==="string"){if(!t.single){a=n.meta||{};i={};i[a.selfLink||1]=n;t.single=p(i,undefined,false)}return t.single}return p(n,undefined,r)}b.register=m;return b}]).factory("kubeMethods",["$q","KUBE_SCHEMA","KubeRequest","kubeLoader",function(e,n,t,o){function l(e,t){var r=n[e.kind].create||0;var a=n[t.kind].create||0;return r-a}function c(n,a){var c=e.defer();var f=c.promise;var s=null;if(!angular.isArray(n)){if(n.kind=="List")n=n.items;else n=[n]}var d=false;var p=false;n.forEach(function(e){var n=e.metadata||{};if((e.kind=="Namespace"||e.kind=="Project")&&n.name===a)d=true;var t=r[e.kind]||r[""];if(!t.global)p=true});n=n.slice();if(a&&p&&!d){n.unshift({apiVersion:"v1",kind:"Namespace",metadata:{name:a}})}n.sort(l);function g(){var e=n.shift();if(!e){c.resolve();return}var r=v([e.kind,null,a||"default"]);r+="?timeout="+i;s=new t("POST",r,JSON.stringify(e)).then(function(e){var n;u("created resource:",r,e.data);if(e.data.kind){if(e.data.kind=="Project"){n=e.data.metadata||{};delete n.selfLink}o.handle(e.data)}g()},function(n){var t=n.data;if(e.kind=="Namespace"&&t&&(t.code===409||t.code===403)){u("skipping namespace creation");g()}else{u("create failed:",r,t||n);c.reject(t||n)}})}g();f.cancel=function m(){if(s)s.cancel()};return f}function f(){var n=v(arguments);var r=o.objects[n];n+="?timeout="+i;var a=new t("DELETE",n);return a.then(function(){u("deleted resource:",n,r);if(r)o.handle(r,true)},function(n){var t=n.data;return e.reject(t||n)})}function s(n,r){var a=v([n]);a+="?timeout="+i;var l=JSON.stringify(r);var c={headers:{"Content-Type":"application/strategic-merge-patch+json"}};var f=new t("PATCH",a,l,c);return f.then(function(e){u("patched resource:",a,e.data);if(e.data.kind)o.handle(e.data)},function(n){var t=n.data;return e.reject(t||n)})}function d(n,t){var r=e.defer();var i,u=[];if(!t)t={};var o=n.metadata;if(o){i=null;if(o.name!==undefined){if(!o.name)i=new Error("The name cannot be empty");else if(!a.test(o.name))i=new Error("The name contains invalid characters")}if(i){i.target=t["metadata.name"];u.push(i)}i=null;if(o.namespace!==undefined){if(!o.namespace)i=new Error("The namespace cannot be empty");else if(!a.test(o.namespace))i=new Error("The name contains invalid characters")}if(i){i.target=t["metadata.namespace"];u.push(i)}}if(u.length)r.reject(u);else r.resolve();return r.promise}return{create:c,"delete":f,check:d,patch:s}}]).provider("KubeRequest",[function(){var e=this;e.KubeRequestFactory="MissingKubeRequest";function n(e,n){if(angular.isString(n))return e.get(n,"KubeRequest");else return e.invoke(n)}e.$get=["$injector",function(t){return n(t,e.KubeRequestFactory)}]}]).factory("MissingKubeRequest",[function(){return function e(n,t){throw"no KubeRequestFactory set"}}]).provider("KubeSocket",[function(){var e=this;e.KubeSocketFactory="MissingKubeSocket";function n(e,n){if(angular.isString(n))return e.get(n,"KubeSocket");else return e.invoke(n)}e.$get=["$injector",function(t){return n(t,e.KubeSocketFactory)}]}]).factory("MissingKubeSocket",[function(){return function e(n,t){throw"no KubeSocketFactory set"}}]).provider("KubeWatch",[function(){var e=this;e.KubeWatchFactory="MissingKubeWatch";function n(e,n){if(angular.isString(n))return e.get(n,"KubeWatch");else return e.invoke(n)}e.$get=["$injector",function(t){return n(t,e.KubeWatchFactory)}]}]).factory("MissingKubeWatch",[function(){return function e(n,t){throw"no KubeWatchFactory set"}}]).provider("KubeDiscoverSettings",[function(){var e=this;e.KubeDiscoverSettingsFactory="MissingKubeDiscoverSettings";function n(e,n){if(angular.isString(n))return e.get(n,"KubeDiscoverSettings");else return e.invoke(n)}e.$get=["$injector",function(t){return n(t,e.KubeDiscoverSettingsFactory)}]}]).factory("MissingKubeDiscoverSettings",[function(){return function e(n,t){throw"no KubeDiscoverSettingsFactory set"}}])})();
