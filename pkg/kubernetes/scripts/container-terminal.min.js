(function(e,n){if(typeof define==="function"&&define.amd)define(["base1/angular","base1/term"],n);else n(e.angular,e.Terminal)})(this,function(e,n){"use strict";try{e.module("kubernetesUI")}catch(t){e.module("kubernetesUI",[])}return e.module("kubernetesUI").provider("kubernetesContainerSocket",function(){var n=this;n.WebSocketFactory=function(){return function e(n,t){if(n.indexOf("/")===0){if(window.location.protocol==="http:")n="ws://"+window.location.host+n;else n="wss://"+window.location.host+n}return new window.WebSocket(n,t)}};function t(n,t){if(!t)throw"no WebSocketFactory set";else if(e.isString(t))return n.get(t,"kubernetesContainerSocket");else return n.invoke(t)}n.$get=["$injector",function(e){return t(e,n.WebSocketFactory)}]}).directive("kubernetesContainerTerminal",["$q","kubernetesContainerSocket",function(t,o){return{restrict:"E",scope:{pod:"&",container:"&",command:"@",prevent:"="},link:function(i,r,a){var s=e.element("<div class='terminal-wrapper'>");r.append(s);var c=e.element("<div class='spinner spinner-white hidden'>");var d=e.element("<button class='btn btn-default fa fa-refresh'>");d.on("click",m).attr("title","Connect");r.append(e.element("<div class='terminal-actions'>").append(c).append(d));var f=null;var l=null;var u=new n({cols:80,rows:24,screenKeys:true});s.empty();u.open(s[0]);u.cursorHidden=true;u.refresh(u.x,u.y);u.on("data",function(e){if(l&&l.readyState===1)l.send("0"+window.btoa(e))});function m(){p();u.reset();var e="";var n=i.pod();if(n.metadata)e+=n.metadata.selfLink;else e+=n;e+="/exec";if(e.indexOf("?")===-1)e+="?";e+="stdout=1&stdin=1&stderr=1&tty=1";var r=i.container?i.container():null;if(r)e+="&container="+encodeURIComponent(r);var a=i.command;if(!a)a=["/bin/sh","-i"];if(typeof a==="string")a=[a];a.forEach(function(n){e+="&command="+encodeURIComponent(n)});var s=true;c.removeClass("hidden");d.addClass("hidden");function m(e){if(!e&&s)e="Could not connect to the container. Do you have sufficient privileges?";if(!e)e="disconnected";if(!s)e="\r\n"+e;u.write("[31m"+e+"[m\r\n");i.$apply(p)}t.when(o(e,"base64.channel.k8s.io"),function w(e){l=e;l.onopen=function(e){f=window.setInterval(function(){l.send("0")},30*1e3)};l.onmessage=function(e){var n=e.data.slice(1);switch(e.data[0]){case"1":case"2":case"3":u.write(window.atob(n));break}if(s){s=false;c.addClass("hidden");d.addClass("hidden");u.cursorHidden=false;u.showCursor();u.refresh(u.y,u.y)}};l.onclose=function(e){m(e.reason)}},function h(e){m(e.message)})}function p(){c.addClass("hidden");d.removeClass("hidden");if(u){u.cursorHidden=true;u.refresh(u.x,u.y)}if(l){l.onopen=l.onmessage=l.onerror=l.onclose=null;if(l.readyState<2)l.close();l=null}window.clearInterval(f);f=null}i.$watch("prevent",function(e){if(!e)m()});i.$on("$destroy",function(){if(u)u.destroy();p()})}}}])});
