(function(){"use strict";angular.module("ui.cockpit",["ui.bootstrap"]).directive("modalDialog",["$q",function(e){return{restrict:"E",transclude:true,template:"<ng-transclude></ng-transclude>",link:function(a,t,l){var i=null;function o(){if(i)i.detach();i=null}a.complete=function(n){o();if(!n||!n.then)n=e(n);i=new r(t,n,a)};a.failure=function(){var n;var r=arguments.length;if(r===0){n=null}else if(r===1){n=arguments[0]}else{n=[];n.push.apply(n,arguments)}if(!n){o();return}var t=e.defer();t.reject(n);a.complete(t.promise)};function u(){a.$dismiss()}var f=n(t,".btn-cancel");f.on("click",u);a.$on("$destroy",function(){f.off("click",u);o()})}}}]);function e(e,n){var r,a=[];var t,l,i,o=e.length;for(l=0;l<o;l++){r=e[l].querySelectorAll(n);if(r){for(t=0,i=r.length;t<i;t++)a.push(r[l])}}return angular.element(a)}function n(e,n){var r=null;var a,t=e.length;for(a=0;!r&&a<t;a++)r=e[a].querySelector(n);return angular.element(r)}function r(r,a,t){var l=null;var i=null;var o=false;var u=false;var f=[];var c=angular.element("<div class='dialog-wait pull-left'>");c.append(angular.element("<div class='spinner spinner-sm'>"));var s=angular.element("<span>");c.append(s);this.detach=g;if(!a){g();return}a.then(function(e){i=e;if(a)d(true)},function(e){i=e;if(a)d(false)},function(e){if(a)w(e)});window.setTimeout(function(){if(a&&t&&l===null){d(null);t.$digest()}},0);function d(e){if(u)return;l=e;if(o){t.$dismiss();return}else if(l===null){k();x()}else if(l===true){k();t.$close(i)}else if(l===false){$();p(i)}else{console.warn("invalid dialog state",l)}}function g(){t=null;a=null;k();$()}function p(e){k();if(!angular.isArray(e))e=[e];e.forEach(function(e){var a=null;if(e.target)a=n(r,e.target);if(a&&a[0])m(a,e);else v(e)})}function v(e){var a=angular.element("<div class='alert alert-danger dialog-error'>");a.text(e.message||e.toString());a.prepend(angular.element("<span class='fa fa-exclamation-triangle'>"));var t=n(r,".modal-footer");if(t.length)t.prepend(a);else r.append(a)}function m(e,n){var r=angular.element("<div class='dialog-error help-block'>");r.text(n.message||n.toString());var a=e.parent();a.addClass("has-error");e.after(r);a.on("keypress change",h)}function h(e){var n=e.target;while(n!==this){b(angular.element(n));n=n.parentNode}}function b(n){var r=n.parent();e(r,".dialog-error").remove();r.removeClass("has-error");r.off("keypress change",h)}function k(){var n=e(r,".dialog-error");angular.forEach(n,function(e){b(angular.element(e))})}function y(e){if(a.cancel)a.cancel();o=true;e.stopPropagation();e.preventDefault();return false}function w(e){var n=e.message||e;if(typeof n=="string"||typeof n=="number")s.text(n);else if(!n)s.text("")}function $(){var e;while(true){e=f.pop();if(!e)break;e.removeAttr("disabled")}c.remove();n(r,".btn-cancel").off("click",y)}function x(){$();n(r,".modal-footer").prepend(c);function t(e){var n=angular.element(e);if(n.attr("disabled")||a.cancel&&n.hasClass("btn-cancel"))return;f.push(n);n.attr("disabled","disabled")}angular.forEach(e(r,".form-control"),t);angular.forEach(e(r,".btn"),t);n(r,".btn-cancel").on("click",y)}}})();
