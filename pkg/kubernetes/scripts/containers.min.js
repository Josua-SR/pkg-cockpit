(function(){"use strict";var e=e||function(){};angular.module("kubernetes.containers",["ngRoute","ui.cockpit","kubernetesUI","kubeClient","kubernetes.listing"]).config(["$routeProvider",function(e){e.when("/pods/:pod_namespace?",{templateUrl:"views/containers-page.html",controller:"ContainersCtrl"})}]).controller("ContainersCtrl",["$scope","KubeContainers","kubeLoader","kubeSelect","ListingState","$routeParams","$location",function(e,n,t,r,o,a,i){var l={};var s=i.search();for(var c in s){if(c!=="namespace")l[c]=s[c]}var u=t.listen(function(){var n=r().kind("Pod");if(a.pod_namespace)n.namespace(a.pod_namespace);if(!angular.equals({},l))n.label(l);e.pods=n});e.$on("$destroy",function(){u.cancel()});t.watch("Pod");e.listing=new o(e);e.listing.forceInline=true;e.containers=n;e.should_mask=function(e){return e.toLowerCase().indexOf("password")!==-1}}]).factory("KubeContainers",["kubeSelect",function(e){function n(e){var n={};var t,r;if(e){for(t=0,r=e.length;t<r;t++)n[e[t].name]=e[t]}return n}return function(e){var t,r,o;if(!e.containers){o=e.metadata.namespace+"/pod/"+e.metadata.name;if(e.spec)t=n(e.spec.containers);else t={};if(e.status)r=n(e.status.containerStatuses);else r={};e.containers=Object.keys(t).map(function(e){var n=o+"/"+e;return{spec:t[e],status:r[e],key:n}})}return e.containers}}]).directive("kubeContainerBody",function(){return{restrict:"E",templateUrl:"views/container-body.html"}}).directive("kubePodBody",function(){return{restrict:"E",templateUrl:"views/pod-body.html"}}).directive("kubeConsole",["kubernetesContainerSocket",function(n){return{restrict:"E",scope:{pod:"&",container:"&",command:"@",prevent:"="},link:function(t,r,o){var a=64*1024;var i=angular.element("<div>");i.addClass("console");r.append(i);var l=angular.element("<pre>");l.addClass("logs");i.append(l);var s=null;var c=null;function u(){l.empty();var r="",o=t.pod();if(o.metadata)r+=o.metadata.selfLink;else r+=o;r+="/log";if(r.indexOf("?")===-1)r+="?";r+="follow=1";var i=t.container?t.container():null;if(i)r+="&container="+encodeURIComponent(i);var u=[];var d=0;function p(){s=null;var n=l[0].scrollHeight-l[0].scrollTop<=l[0].offsetHeight;var t=u.join("");d+=t.length;var r,o,i;while(d>a){r=l.children();if(r.length<1)break;o=angular.element(r[0]);i=o.text().length;o.remove();d-=i}var c=angular.element("<span>").text(t);u.length=0;l.append(c);if(n)l[0].scrollTop=l[0].scrollHeight;e()}c=n(r);c.onclose=function(e){u.push(e.reason);p();f();c=null};c.onmessage=function(e){u.push(e.data);if(s===null)s=window.setTimeout(p,50)}}function f(){if(c){c.onopen=c.onmessage=c.onerror=c.onclose=null;if(c.readyState<2)c.close();c=null}window.clearTimeout(s);s=null}t.$watch("prevent",function(e){if(!e&&!c)u()});t.$on("$destroy",f)}}}]).filter("kubeIdentifier",function(){var e=/docker:\/\/([\w]{12})\w+/;return function(n){var t=e.exec(n);if(t)return t[1];return n}})})();
