define(["jquery","base1/angular","kubernetes/app"],function(e,t){"use strict";var a=a||function(){};e("body").on("click","#services-enable-change",function(){e("#service-list").toggleClass("editable");e("#services-enable-change").toggleClass("active")});e("body").on("click",".editable",function(t){var a=e(t.target);if(!a.is("button")){e("#service-list").toggleClass("editable");e("#services-enable-change").toggleClass("active")}});return t.module("kubernetes.dashboard",["ngRoute"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/dashboard-page.html",controller:"DashboardCtrl",reloadOnSearch:false})}]).controller("DashboardCtrl",["$scope","$location","kubernetesClient",function(t,n,r){t.services=r.select("Service");r.track(t.services);e(t.services).on("changed",c);t.serviceContainers=function o(e){var t=e.spec||{};var a=0;var n=0;r.select("Pod",e.metadata.namespace,e.spec.selector||{}).items.forEach(function(e){if(!e.status||!e.status.phase)return;var t=e.spec||{};var r=1;if(t.containers)r=t.containers.length;switch(e.status.phase){case"Pending":n+=r;break;case"Running":a+=r;n+=r;break;case"Succeeded":break;case"Unknown":n+=r;break;case"Failed":default:n+=r;break}});if(a!=n)return a+" of "+n;else return""+a};t.serviceStatus=function l(e){var t=e.spec||{};var a="";r.select("Pod",e.metadata.namespace,e.spec.selector||{}).items.forEach(function(e){if(!e.status||!e.status.phase)return;switch(e.status.phase){case"Pending":if(!a)a="wait";break;case"Running":break;case"Succeeded":break;case"Unknown":break;case"Failed":default:a="fail";break}});return a};t.nodes=r.select("Node");r.track(t.nodes);e(t.nodes).on("changed",c);t.nodeContainers=function u(e){var t=0;var a=e.metadata||{};r.hosting("Pod",a.name).items.forEach(function(e){var a=e.spec||{};var n=1;if(a.containers)n=a.containers.length;t+=n});return t};t.nodeStatus=function f(e){var t=e.status||{};var a=t.conditions;var n="";if(!a){n="wait"}else{a.forEach(function(e){if(e.type=="Ready"){if(e.status!="True")n="fail"}})}return n};t.jumpService=function d(t,a){var r=e(t.target);if(r.parents().is(".editable"))return;var s=a.metadata;var i=a.spec;if(i.selector&&!e.isEmptyObject(i.selector)&&s.namespace)n.path("/pods/"+encodeURIComponent(s.namespace)).search(i.selector)};var s=r.select("Pod");r.track(s);e(s).on("changed",c);t.highlighted=null;t.$on("highlight",function(e,a){t.highlighted=a});t.highlight=function p(e){t.$broadcast("highlight",e)};t.servicesState=function h(){if(t.failure)return"failed";var e;for(e in t.services)break;return e?"ready":"empty"};t.state="loading";t.client.watches.services.wait().fail(function(e){t.failure=e}).always(c);e([t.services]).on("changed",c);var i=null;function c(){if(i===null){i=window.setTimeout(function(){i=null;t.$digest();a()})}}}]).directive("kubernetesStatusIcon",function(){return{restrict:"A",link:function(e,t,a){e.$watch(a["status"],function(e){t.toggleClass("spinner spinner-sm",e=="wait").toggleClass("fa fa-exclamation-triangle fa-failed",e=="fail")})}}}).directive("kubernetesAddress",function(){return{restrict:"E",link:function(t,a,n){t.$watchGroup(["item.spec.clusterIP","item.spec.ports"],function(t){var n=t[0];var r=t[1];var s=null;var i=null;if(!r||!r.length){i=n}else if(r.length==1){i=n+":"+r[0].port;if(r[0].protocol==="TCP"){if(r[0].port===80)s="http://"+encodeURIComponent(n);else if(r[0].port===443)s="https://"+encodeURIComponent(n)}else{i+="/"+r[0].protocol}}else{i=" "+n+" "+r.map(function(e){if(e.protocol==="TCP")return e.port;else return e.port+"/"+e.protocol}).join(" ")}var c;a.empty();if(s){c=e("<a>").attr("href",s).attr("target","_blank").on("click",function(e){e.stopPropagation()});a.append(c)}else{c=a}c.text(i)})}}})});
