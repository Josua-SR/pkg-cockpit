define(["jquery","base1/cockpit","shell/shell"],function(e,t,n){function i(t,n,i,r){var o={colors:["#0099d3"],legend:{show:false},series:{shadowSize:0,lines:{lineWidth:0,fill:1}},xaxis:{tickFormatter:function(){return""}},yaxis:{tickFormatter:function(){return""}},points:{radius:0},grid:{borderWidth:1,aboveData:true,color:"black",borderColor:e.color.parse("black").scale("a",.22).toString(),labelMargin:0}};var a=300;var f;var l=false;var s;e.extend(true,o,r);var u=e(t);var c=e("<div/>");u.empty();u.append(c);function d(){c.width(u.width());c.height(u.height())}function h(e){if(f){f.getAxes().yaxis.options.max=e;g()}else{o.yaxis.max=e}}function m(){l=true;v()}function v(){if(l&&u.width()!==0&&u.height()!==0){if(!f){d();f=e.plot(c,i,o)}else w()}}function p(){l=false}function g(){if(f&&l){f.setData(i);if(r.setup_hook)r.setup_hook(f);f.setupGrid();f.draw()}}function w(){if(f&&l){d();if(c.width()>0&&c.height()>0)f.resize();g()}}function y(){e(s).trigger("destroyed");e(window).off("resize",w);e(u).empty();f=null}e(n).on("notify",g);e(window).on("resize",w);v();s={start:m,stop:p,resize:w,element:c[0],set_yaxis_max:h,destroy:y};return s}function r(t,n,i,r,o){var a={colors:["#0099d3"],legend:{show:false},series:{shadowSize:0,lines:{lineWidth:0,fill:1}},xaxis:{tickFormatter:function(){return""}},yaxis:{tickFormatter:function(){return""}},points:{radius:0},grid:{borderWidth:1,aboveData:true,color:"black",borderColor:e.color.parse("black").scale("a",.22).toString(),labelMargin:0}};var f=i.length;var l;var s=false;var u;var c=false;var d=false;var h;e.extend(true,a,r);var m=e(t);var v=e("<div/>");m.empty();m.append(v);function p(){if(!d&&n.NumSamples!==undefined){l=n.NumSamples;for(var t=0;t<f;t++){var r=[];for(var o=0;o<l;o++){r[o]=[o,0]}i[t].data=r}e(n).on("NewSample",N);n.call("GetSamples",{},function(e,t){if(!e){z(t);s=true;k()}});e(window).on("resize",b);d=true;x()}}function g(){v.width(m.width());v.height(m.height())}function w(e){if(u){u.getAxes().yaxis.options.max=e;k()}else{a.yaxis.max=e}}function y(){c=true;x()}function x(){if(d&&c&&m.width()!==0&&m.height()!==0){if(!u){g();u=e.plot(v,i,a)}else b()}}function _(){c=false}function k(){if(u&&c){u.setData(i);if(r.setup_hook)r.setup_hook(u);u.setupGrid();u.draw()}}function b(){if(u&&c){g();if(v.width()>0&&v.height()>0)u.resize();k()}}function S(e){var t;var n,r,a,f;for(r=0;r<i.length;r++){t=i[r].data;for(a=0;a<t.length-1;a++){t[a][1]=t[a+1][1];t[a][2]=t[a+1][2]}}o(e,i[0].data.length-1)}function z(e){var t,n;n=i[0].data.length-e.length;for(t=0;t<e.length;t++){o(e[t][1],t+n)}}function N(e,t,n){if(s){S(n);k()}}function C(){e(h).trigger("destroyed");e(n).off("notify:NumSamples",p);e(n).off("NewSample",N);e(window).off("resize",b);e(m).empty();u=null}if(n.NumSamples!==undefined)p();else e(n).on("notify:NumSamples",p);h={start:y,stop:_,resize:b,element:v[0],set_yaxis_max:w,destroy:C};return h}n.setup_complicated_plot=function o(e,t,n,r){function o(e,t){return e.add(function(e,n,i){for(var r=0;r<i;r++)e[n+r]=[r,t[n+r]||0]})}function a(e,t,n){return e.add(function(e,i,r){var o,a,f,l;for(o=0;o<r;o++){f=0;if(n){a=n[i+o];f=a?a[1]:0}l=t[i+o]||0;e[i+o]=[o,l+f,f]}})}var f=null;n.forEach(function(e,n){if(r.x_rh_stack_graphs)e.data=a(t,e.row,f);else e.data=o(t,e.row);f=e.data});return i(e,t,n,r)};n.setup_simple_plot=function a(t,n,i,o,f,l){var s=[{}];function u(t,i){var r=s[0].data;r[i][1]=f(t);if(i==r.length-1)e(n).html(l(t))}return r(t,i,s,o,u)};n.setup_multi_plot=function f(t,n,i,o,a,l){var s=this;var u=o.length-1;var c=new Array(u+1);var d=new Array(u);var h;var m;for(m=0;m<c.length;m++)c[m]={};function v(){var e=n.Consumers||[];d.forEach(function(t,n){if(t&&e.indexOf(t)<0||!a(t)){d[n]=null}});e.forEach(function(e){if(!a(e))return;if(d.indexOf(e)<0){for(m=0;m<u;m++){if(!d[m]){d[m]=e;return}}console.warn("Too many consumers")}})}function p(t,r){var o=0;for(var f in t){if(a(f))o+=t[f][i]}function l(e,t){var n=c[e].data;var i=e>0?c[e-1].data[r][2]:0;n[r][1]=i;n[r][2]=i+t}d.forEach(function(e,n){l(n,e&&t[e]?t[e][i]:0)});l(u,o);if(r==n.NumSamples-1)e(h).trigger("update-total",[o])}h=r(t,n,c,{colors:o,grid:{hoverable:true,autoHighlight:false},setup_hook:l},p);e(n).on("notify:Consumers",v);var g=null;function w(t){if(t!=g){g=t;e(h).trigger("highlight",[t])}}function y(e,t,i){var r,o;o=Math.round(t.x);if(o<0)o=0;if(o>n.NumSamples-1)o=n.NumSamples-1;for(r=0;r<u;r++){if(r<u&&c[r].data[o][1]<=t.y&&t.y<=c[r].data[o][2])break}if(r<u)w(d[r]);else w(null)}function x(e){w(null)}e(h.element).on("plothover",y);e(h.element).on("mouseleave",x);e(h).on("destroyed",function(){e(n).off("notify:Consumers",v);e(h.element).off("plothover",y);e(h.element).off("mouseleave",x)});v();return h}});
