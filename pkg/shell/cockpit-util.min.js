define(["jquery","base1/cockpit","shell/shell"],function(t,n,a){a.action_btn=function c(n,a,e){var o,c,i;var l,s;o=t("<button>",{"data-container":"body","class":"btn btn-default"}).text("").addClass(e);c=[];s=[];a.forEach(function(a,o){c[o]=t("<li>",{"class":"presentation"}).append(t("<a>",{role:"menuitem",on:{click:function(e){if(!s[o]&&!t(e.currentTarget).hasClass("disabled"))n(a.action)}}}).addClass(e).addClass(a.btn_classes).append(t("<span>",{"class":a.danger?"text-danger":""}).text(a.title)));s[o]=false});i=t("<div>",{"class":"btn-group"}).append(o,t("<button>",{"class":"btn btn-default dropdown-toggle","data-toggle":"dropdown"}).append(t("<span>",{"class":"caret"})),t("<ul>",{"class":"dropdown-menu",style:"right:0px;left:auto;min-width:0;text-align:left",role:"menu"}).append(c));function r(t){a.forEach(function(a,e){if(a.action==t||t=="default"&&a.is_default){l=a.action;o.text(a.title);o.toggleClass("btn-danger",a.danger);o.toggleClass("btn-default",!a.danger);o.off("click");o.on("click",function(){n(a.action)});o.prop("disabled",s[e])}})}function d(t,n){if(l==t)o.prop("disabled",!n);a.forEach(function(a,e){if(a.action==t){s[e]=!n;c[e].toggleClass("disabled",!n)}})}r("default");t.data(i[0],"cockpit-action-btn-funcs",{select:r,enable:d});return i};a.action_btn_select=function i(n,a){t.data(n[0],"cockpit-action-btn-funcs").select(a)};a.action_btn_enable=function l(n,a,e){t.data(n[0],"cockpit-action-btn-funcs").enable(a,e)};if(!a.util)a.util={};var e={};a.util.machine_info=o;function o(a){var o=e[a];var c;if(!o){c=t.Deferred();e[a]=o=c.promise();n.spawn(["cat","/proc/meminfo","/proc/cpuinfo"],{host:a}).done(function(t){var n={};var a=t.match(/MemTotal:[^0-9]*([0-9]+) [kK]B/);var e=a&&parseInt(a[1],10);if(e)n.memory=e*1024;n.cpus=0;var o=new RegExp("^processor","gm");while(o.test(t))n.cpus+=1;c.resolve(n)}).fail(function(){c.reject()})}return o}});
