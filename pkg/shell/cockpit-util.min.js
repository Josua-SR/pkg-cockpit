define(["jquery","base1/cockpit","shell/shell","base1/bootstrap-select"],function(t,e,n){n.esc=function o(t){if(t===null||t===undefined)return"";var e=document.createElement("pre");var n=document.createTextNode(t);e.appendChild(n);return e.innerHTML.replace(/"/g,"&quot;").replace(/'/g,"&#39;")};n.action_btn=function l(e,n,a){var c,o,l;var i,r;c=t("<button>",{"data-container":"body","class":"btn btn-default"}).text("").addClass(a);o=[];r=[];n.forEach(function(n,c){o[c]=t("<li>",{"class":"presentation"}).append(t("<a>",{role:"menuitem",on:{click:function(a){if(!r[c]&&!t(a.currentTarget).hasClass("disabled"))e(n.action)}}}).addClass(a).addClass(n.btn_classes).append(t("<span>",{"class":n.danger?"text-danger":""}).text(n.title)));r[c]=false});l=t("<div>",{"class":"btn-group"}).append(c,t("<button>",{"class":"btn btn-default dropdown-toggle","data-toggle":"dropdown"}).append(t("<span>",{"class":"caret"})),t("<ul>",{"class":"dropdown-menu",style:"right:0px;left:auto;min-width:0;text-align:left",role:"menu"}).append(o));function s(t){n.forEach(function(n,a){if(n.action==t||t=="default"&&n.is_default){i=n.action;c.text(n.title);c.toggleClass("btn-danger",n.danger);c.toggleClass("btn-default",!n.danger);c.off("click");c.on("click",function(){e(n.action)});c.prop("disabled",r[a])}})}function u(t,e){if(i==t)c.prop("disabled",!e);n.forEach(function(n,a){if(n.action==t){r[a]=!e;o[a].toggleClass("disabled",!e)}})}s("default");t.data(l[0],"cockpit-action-btn-funcs",{select:s,enable:u});return l};n.action_btn_select=function i(e,n){t.data(e[0],"cockpit-action-btn-funcs").select(n)};n.action_btn_enable=function r(e,n,a){t.data(e[0],"cockpit-action-btn-funcs").enable(n,a)};n.select_btn=function s(e,n){var a,c;function o(e){if(e.group&&Array.isArray(e.group)){var n=t("<optgroup>").attr("label",e.title?e.title:"").append(e.group.map(o));return n}else{return t("<option>",{value:e.choice}).text(e.title)}}c=t('<select class="form-control">').append(n.map(o));c.on("change",function(){e(c.val())});function l(t){c.val(t);c.selectpicker("render")}function i(){return c.val()}a=t("<div>").append(c);c.selectpicker();t.data(a[0],"cockpit-select-btn-funcs",{select:l,selected:i});return a};n.select_btn_select=function u(e,n){t.data(e[0],"cockpit-select-btn-funcs").select(n)};n.select_btn_selected=function d(e){return t.data(e[0],"cockpit-select-btn-funcs").selected()};if(!n.util)n.util={};var a={};n.util.machine_info=c;function c(n){var c=a[n];var o;if(!c){o=t.Deferred();a[n]=c=o.promise();e.spawn(["cat","/proc/meminfo","/proc/cpuinfo"],{host:n}).done(function(t){var e={};var n=t.match(/MemTotal:[^0-9]*([0-9]+) [kK]B/);var a=n&&parseInt(n[1],10);if(a)e.memory=a*1024;e.cpus=0;var c=new RegExp("^processor","gm");while(c.test(t))e.cpus+=1;o.resolve(e)}).fail(function(){o.reject()})}return c}});
