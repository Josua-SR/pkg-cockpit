define(["jquery","base1/cockpit","shell/attrchange"],function(t,e){"use strict";var i={};function a(e,i){var a;if(e){var s="div.bar-row[graph='"+e+"']";a=t(s)}else if(i){a=t(i)}else{a=t([])}function r(e){var i=t(e).attr("value");if(i===undefined)return[NaN];var a=i.split("/",2);var s=parseInt(a[0],10);if(a.length==1)return[s];var r=parseInt(a[1],10);if(!isNaN(r)&&s>r)s=r;if(s<0)s=0;return[s,r]}var n=0;a.each(function(){var t=r(this).pop();if(!isNaN(t)&&t>n)n=t});if(e){var l=100*1024*1024;n=n-n%l+l}a.each(function(){var e=r(this);var i=e.shift();var a=e.pop();if(isNaN(i)||a===0){t(this).css("visibility","hidden")}else{var s=t(this).data("bar-progress");if(isNaN(a)){s.addClass("progress-no-limit");a=i}else{s.removeClass("progress-no-limit")}t(this).css("visibility","visible");s.css("width",a/n*100+"%");t(this).data("bar-progress-bar").css("width",i/a*100+"%").toggle(i>0)}})}var s={};function r(e,i){if(e===undefined){if(i)e=t(i).attr("graph")}if(!e){a(undefined,i);return}if(s[e]!=="undefined")window.clearTimeout(s[e]);s[e]=window.setTimeout(function(){delete s[e];a(e)},10)}function n(e){var i=t("<div>").addClass("progress-bar");var s=t("<div>").addClass("progress").append(i);t(e).addClass("bar-row").append(s).data("bar-progress",s).data("bar-progress-bar",i);t(e).attrchange({trackValues:false,callback:function(t){if(t.attributeName=="graph"||t.attributeName=="value"){r(this.getAttribute("graph"),this)}}});e.reflow=function(){a(this.getAttribute("graph"),this)};r(undefined,e)}function l(){t("div.bar-row").each(function(){n(this,false)})}i.BarRow=function h(e){var i=t("<div>").addClass("bar-row").attr("graph",e);n(i);return i};t(document).ready(l);function d(e,i,a,s){var r=0;if(s>a)r=1;else if(s<0||isNaN(s))r=0;else if(!isNaN(a)&&a>0&&s>=0)r=s/a;t(i).css("width",r*100+"%").next("div").css("margin-left",t(i).css("width"));e.value=r}function u(e){d(e,t(e).children("div.slider-bar").first()[0],1,e.value)}function f(e){t(e).toggleClass("slider-warning",e.offsetWidth<e.scrollWidth)}function o(e){t(e).attr("unselectable","on");Object.defineProperty(e,"value",{get:function(){return parseFloat(this.getAttribute("value"))},set:function(t){var e=String(t);if(e!=this.getAttribute("value"))this.setAttribute("value",t)}});Object.defineProperty(e,"disabled",{get:function(){if(!this.hasAttribute("disabled"))return false;return this.getAttribute("disabled").toLowerCase()!="false"},set:function(t){this.setAttribute("disabled",t?"true":"false")}});u(e);f(e);t(e).attrchange({trackValues:true,callback:function(i){if(i.attributeName=="value"&&i.oldValue!==i.newValue)u(e);if(i.attributeName=="disabled")t(e).toggleClass("slider-disabled",e.disabled)}});if(e.disabled)t(e).addClass("slider-disabled");t(e).on("mousedown",function(i){if(e.disabled)return true;var a;var s=t(e).offset().left;if(t(i.target).hasClass("slider-thumb")){var r=i.offsetX||i.clientX-t(i.target).offset().left;s+=r-t(i.target).outerWidth()/2;a=t(i.target).parent()[0]}else{a=t(e).children("div.slider-bar").first()[0];d(e,a,t(e).width(),i.pageX-s);t(e).trigger("change",[e.value]);f(e)}t(document).on("mousemove.slider",function(i){d(e,a,t(e).width(),i.pageX-s);t(e).trigger("change",[e.value]);f(e);return false}).on("mouseup.slider",function(e){t(document).off("mousemove.slider").off("mouseup.slider");return false});return false})}function c(){t("div.slider").each(function(){o(this)})}i.Slider=function v(){var e=t("<div class='slider'>").append(t("<div class='slider-bar'>").append(t("<div class='slider-thumb'>")));o(e);return e};t(document).ready(c);i.update_privileged_ui=function g(e,i,a){var s=e.allowed!==false;t(i).each(function(){var e="allowed-title";if(typeof t(this).data(e)==="undefined"||t(this).data(e)===false)t(this).data(e,t(this).attr("title")||"");t(this).tooltip({html:true});if(t(this).hasClass("disabled")===s){t(this).toggleClass("disabled",!s).attr("data-original-title",null);if(s)t(this).attr("title",t(this).data(e));else t(this).attr("title",a);t(this).tooltip("fixTitle")}})};return i});
