
var phantom_checkpoint=phantom_checkpoint||function(){};define("shell/base_index", ["jquery","base1/cockpit","manifests"],function(e,t,n){"use strict";var o=window.location.pathname.indexOf(".html")!==-1;var r=t.gettext;function i(t){var n=this;var o={};function r(t){e(t.contentWindow).off();e(t).remove()}n.remove=function a(t){var n=t.address;if(!n)n="localhost";var i=o[n];if(i){delete o[n];e.each(i,function(e,t){r(t)})}};function i(n,o){var r=false;window.clearTimeout(n.timer);n.timer=null;try{r=e("body",n.contentWindow.document).is(":visible")}catch(a){r=true}if(!o)o=0;o+=1;if(o>50)r=true;if(r){if(n.getAttribute("data-ready")!="1"){n.setAttribute("data-ready","1");if(o>0)t.navigate()}}else{n.timer=window.setTimeout(function(){i(n,o+1)},100)}}n.lookup_component_hash=function(e,t){var n,r,i,a;if(e)n=e.address;if(!n)n="localhost";r=o[n];if(r)i=r[t];if(i){a=i.getAttribute("src");if(a)return a.split("#")[1]}};n.lookup=function s(t,n,a){var s;var c;var f=false;if(t){s=t.connection_string;c=t.address}if(!s)s="localhost";if(!c)c=s;var u=o[c];if(!u)o[c]=u={};var l="cockpit1:"+s+"/"+n;var h=u[n];if(h&&h.getAttribute("name")!=l){r(h);h=null}var d,p;if(!h){d=window.frames[l];if(d)h=d.frameElement;if(h){p=h.getAttribute("src");h.url=p.split("#")[0];u[n]=h}}if(!h){f=true;h=document.createElement("iframe");h.setAttribute("class","container-frame");h.setAttribute("name",l);h.style.display="none";var v=n.split("/");var m,g;if(t)g=t.checksum;if(s==="localhost")m="..";else if(g)m="../../"+g;else m="../../@"+s;h.url=m+"/"+n;if(n.indexOf("/")===-1)h.url+="/index";h.url+=".html"}if(!a)a="/";p=h.url+"#"+a;if(h.getAttribute("src")!=p)h.setAttribute("src",p);if(f){u[n]=h;e("#content").append(h)}i(h);return h}}function a(n){var o=this;var r=0;var i=t.transport.origin;var a={};var s={};t.transport.filter(function(e,t,n){var o,r,s;if(n){if(n.channel!==undefined){for(o in a)a[o].window.postMessage(e,i)}return true}else if(t){s=t.indexOf("!");if(s!==-1){o=t.substring(0,s+1);r=a[o];if(r){r.window.postMessage(e,i);return false}}return true}});function c(e,t){var o=n.current_frame();if(e!==window){if(!o||o.contentWindow!=e)return}var r=t.location||"";if(r[0]!="/")r="/"+r;if(t.host)r="/@"+encodeURIComponent(t.host)+r;n.jump(r)}function f(e){var t;var o=n.current_frame();if(o&&o.contentWindow===e&&e.name&&e.name.indexOf("/shell/shell")===-1){t=e.location.hash;if(t.indexOf("#")===0)t=t.substring(1);if(t==="/")t="";n.jump({hash:t})}}function u(e){var t=s[e.target.defaultView.name];if(t)d(t)}function l(e){var t=s[e.target.name];if(t)f(t.window)}function h(e){var t=s[e.target.contentWindow.name];if(t)f(t.window)}function d(e){var n=e.window;t.kill(null,n.name);var o=n.frameElement;if(o)o.removeEventListener("load",h);n.removeEventListener("unload",u);n.removeEventListener("hashchange",l);delete a[e.channel_seed];delete s[e.name]}function p(e){var o,i=e.name||"";if(i.indexOf("cockpit1:")===0)o=i.substring(9).split("/")[0];if(!i||!o){console.warn("invalid child window name",e,i);return}r+=1;var c=(t.transport.options["channel-seed"]||"undefined:")+r+"!";var d={name:i,window:e,channel_seed:c,default_host:o};a[c]=d;s[i]=d;var p=e.frameElement;p.addEventListener("load",h);e.addEventListener("unload",u);e.addEventListener("hashchange",l);p.setAttribute("data-loaded","1");f(e);phantom_checkpoint();n.navigate();return d}function v(o){if(o.origin!==i)return;var r=o.data;var a=o.source;if(!a||typeof r!=="string")return;var f=s[a.name];if(r.length===0){if(f)d(f);return}if(r[0]=="\n"){var u=JSON.parse(r.substring(1));if(u.command==="init"){if(f)d(f);f=p(a);if(f){var l=e.extend({},t.transport.options,{command:"init",host:f.default_host,"channel-seed":f.channel_seed});a.postMessage("\n"+JSON.stringify(l),i)}}else if(u.command==="jump"){c(a,u);return}else if(u.command==="hint"){if(u.hint=="restart"&&u.host!=t.transport.host)n.expect_restart(u.host);return}else if(u.command=="oops"){n.show_oops();return}else if(u.channel===undefined){return}else if(u.command=="open"){u.group=a.name;r="\n"+JSON.stringify(u)}}if(!f){console.warn("child frame "+a.name+" sending data without init");return}t.transport.inject(r)}o.start=function m(e){window.addEventListener("message",v,false);for(var t=0,n=e.length;t<n;t++)v(e[t])}}function s(){var s=this;var f;if(typeof s.navigate!=="function")throw"Index requires a prototype with a navigate function";s.frames=new i(s);s.router=new a(s);var u=t.channel({payload:"null"});e(u).on("close",function(t,n){var o=n.problem||"disconnected";console.warn("transport closed: "+o);e(s).triggerHandler("disconnect",o)});e(document).on("click","a[href]",function(e){var t=this;if(window.location.host===t.host){s.jump(t.getAttribute("href"));e.preventDefault();phantom_checkpoint()}});if(window.navigator.userAgent.indexOf("PhantomJS")==-1){var l=window.onerror;window.onerror=function x(e,t,n){s.show_oops();phantom_checkpoint();if(l)return l(e,t,n);return false}}function h(e,n){var o=[];if(e.host&&(n||e.host!=="localhost"))o.push("@"+e.host);if(e.component)o.push.apply(o,e.component.split("/"));var r=t.location.encode(o);if(e.hash&&e.hash!=="/")r+="#"+e.hash;return r}function d(e){var n={version:"v1",hash:""};var o=e.indexOf("#");if(o!==-1){n.hash=e.substring(o+1);e=e.substring(0,o)}if(e[0]!="/")e="/"+e;var r=t.location.decode(e);if(r[0]&&r[0][0]=="@"){n.host=r.shift().substring(1);n.sidebar=true}else{n.host="localhost"}if(r.length&&r[r.length-1]=="index")r.pop();n.component=r.join("/");return n}function p(){var t=e("#content-navbar");function r(t){var n=e("<a>").attr("href",s.href({host:"localhost",component:t.path})).text(t.label);return e("<li class='dashboard-link'>").attr("data-component",t.path).append(n)}var i,a={};if(o){t.hide()}else{var f=new c;f.load(n,"dashboard");t.append(f.ordered("dashboard").map(r))}}s.recalculate_layout=function(){var t=e("#topnav");var n=e("#sidebar");var o=e("#content");var r=e(window).height();var i=t.height();var a=r-i;e(f).height(Math.floor(a));n.height(a);var s=n.is(":visible")?n.outerWidth():0;o.css("margin-left",s+"px")};s.retrieve_state=function(){var e=window.history.state;if(!e||e.version!=="v1"){if(o)e=d("/"+window.location.hash);else e=d(window.location.pathname+window.location.hash)}return e};s.jump=function(e,t){if(typeof e==="string")e=d(e);var n=s.retrieve_state();if(!e.host)e.host=n.host||"localhost";if(!("component"in e))e.component=n.component||"";var r;var i=window.history;var a=e.host!==n.host||e.component!==n.component;if(a&&!e.hash){e.hash=s.frames.lookup_component_hash(e.host,e.component)}if(o)r=window.location;else r=h(e);if(t){i.replaceState(e,"",r);return false}if(a||e.hash!==n.hash){i.pushState(e,"",r);s.navigate(e,true);return true}return false};s.href=function(e,t){return h(e,t)};s.show_oops=function(){if(s.oops_sel)e(s.oops_sel).show()};s.current_frame=function(e){if(e!==undefined)f=e;return f};s.start=function(e){s.router.start(e)};s.ready=function(){e(window).on("popstate",function(e){s.navigate(e.state,true)});e(window).on("resize",function(){s.recalculate_layout()});p();s.navigate();e("body").show()};s.expect_restart=function(t){e(s).triggerHandler("expect_restart",t)};function v(t){var n=e(t);if(!n)return;n.children("a").on("click",function(){e("#error-popup-title").text(r("Unexpected error"));var t=r("Cockpit had an unexpected internal error. <br/><br/>")+r("You can try restarting Cockpit by pressing refresh in your browser. ")+r("The javascript console contains details about this error ")+r("(<b>Ctrl-Shift-J</b> in most browsers).");e("#error-popup-message").html(t);e("#error-popup").modal("show")})}function m(n,o){var r=JSON.parse(window.localStorage["os-release"]||"{}");var i,a=e(n)[0];if(a)i=window.getComputedStyle(a);if(!i)return;var s,c=i.content;if(c&&c!="none"&&c!="normal"){s=c.length;if((c[0]==='"'||c[0]==="'")&&s>2&&c[s-1]===c[0])c=c.substr(1,s-2);a.innerHTML=t.format(c,r)||o;return e(a).text()}}function g(n){e(n).on("click",function(){t.logout()})}function w(o){var r=n["shell"]||{};e(".display-language-menu").toggle(!!r.linguas);e.each(r.linguas||{},function(n,o){var r=e("<option>").text(o).val(n);if(n==t.language)r.attr("selected","true");e("#display-language-list").append(r)});e("#display-language-select-button").on("click",function(t){var n=e("#display-language-list").val();window.localStorage.setItem("cockpit.lang",n);window.location.reload(true);return false});e(o).on("shown.bs.modal",function(){e("display-language-list").focus();phantom_checkpoint()})}function _(n){e(t.info).on("changed",function(){e(n).text(t.info.version);phantom_checkpoint()})}function b(n){e(n).on("click",function(){s.jump({host:"localhost",component:"users",hash:"/"+t.user["user"]})})}function y(n){function o(o){var r=t.user["name"]||t.user["user"];if(!r)r=o?"":"???";e(n).text(r);var i=t.user["user"]=="root";var a=t.user["user"]&&!i;e("#deauthorize-item").toggle(a)}e(t.user).on("changed",o);o(true)}if(s.oops_sel)v(s.oops_sel);if(s.logout_sel)g(s.logout_sel);if(s.language_sel)w(s.language_sel);if(s.brand_sel)s.default_title=m(s.brand_sel);if(s.about_sel)_(s.about_sel);if(s.user_sel)y(s.user_sel);if(s.account_sel)b(s.account_sel)}function c(){var n=this;n.items={};n.load=function(o,r){e.each(o||{},function(o,i){e.each(i[r]||{},function(e,i){var a={section:r,label:t.gettext(i.label)||e,order:i.order===undefined?1e3:i.order,wants:i.wants};if(i.path)a.path=i.path.replace(/\.html$/,"");else a.path=o+"/"+e;if(a.path.indexOf("/")===-1)a.path=o+"/"+a.path;if(a.path.slice(-6)=="/index")a.path=a.path.slice(0,-6);n.items[a.path]=a})})};n.ordered=function(e){var t,o=[];for(t in n.items){if(!e||n.items[t].section===e)o.push(n.items[t])}o.sort(function(e,t){return e.order-t.order});return o};n.search=function(e,t){var o;for(o in n.items){if(n.items[o][e]===t)return n.items[o]}}}return{new_index_from_proto:function(e){var t=new Object(e);s.call(t);return t},new_compiled:function(){return new c}}});

//# sourceURL=shell/base_index.min.js

define("shell/credentials", ["jquery","base1/cockpit","data!shell/ssh-list-private-keys.sh","base1/patterns"],function(e,n,t){"use strict";var a=n.gettext;function i(){var i=this;i.path=n.user["home"]+"/.ssh";i.items={};var r=null;var o=null;var s=null;d();function d(){if(r===null){r=n.channel({payload:"fslist1",path:i.path});e(r).on("close",function(n,t){e(r).off();if(!t.problem||t.problem=="not-found"){r=null}else{console.warn("couldn't watch "+i.path+": "+(t.message||t.problem));r=false}}).on("message",function(e,n){var t=JSON.parse(n);var a=t.path;if(a&&a.indexOf("/")===-1&&a.slice(-4)===".pub"){if(t.event==="present"||t.event==="created"||t.event==="changed"||t.event==="deleted"){window.clearInterval(s);s=window.setTimeout(d,100)}}})}if(o)return;window.clearTimeout(s);s=null;o=n.script(t,[i.path],{err:"message"}).always(function(){o=null;if(!s)s=window.setTimeout(d,5e3)}).done(function(e){l(e)}).fail(function(e){console.warn("failed to list keys in home directory: "+e.message)})}function l(n){var t=n.split("\x0B");var a,r={};t[0].trim().split("\n").forEach(function(e){a=f(e,r);if(a)a.loaded=true});t.slice(1).forEach(function(e,n){switch(n%3){case 0:a=f(e,r);break;case 1:if(a){e=e.trim();if(e.slice(-4)===".pub")a.name=e.slice(0,-4);else a.name=e}break;case 2:if(a)c(e,a);break}});i.items=r;e(i).triggerHandler("changed")}function f(e,n){var t=e.trim().split(" ");var a,i,r;if(!isNaN(parseInt(t[0],10))){a=t[2];i="RSA1";r=t.slice(3).join(" ")}else if(t[0].indexOf("ssh-")===0){a=t[1];i=t[0].substring(4).toUpperCase();r=t.slice(2).join(" ")}else if(t[0].indexOf("ecdsa-")===0){a=t[1];i="ECDSA";r=t.slice(2).join(" ")}else{return}var o=n[a];if(!o)o=n[a]={};o.type=i;o.comment=r;o.data=e;return o}function c(e,n){var t=e.trim().split(" ");n.size=parseInt(t[0],10);if(isNaN(n.size))n.size=null;n.fingerprint=t[1]}i.change=function u(t,r,o,s){var d=[/.*Enter old passphrase: $/];var l=[/.*Enter new passphrase.*/,/.*Enter same passphrase again: $/];var f=[/.*failed: passphrase is too short.*/];var c=e.Deferred();var u="";var p=false;var v=a("No such file or directory");var h;if(o!==s){c.reject(new Error(a("The passwords do not match.")));return c.promise()}var m=window.setTimeout(function(){v=a("Prompting via ssh-keygen timed out");g.close("terminated")},10*1e3);var g=n.spawn(["ssh-keygen","-p","-f",t],{pty:true,environ:["LC_ALL=C"],err:"out",directory:i.path}).always(function(){window.clearInterval(m)}).done(function(){c.resolve()}).fail(function(e){if(e.constructor.name=="ProcessError")e=new Error(v);c.reject(e)}).stream(function(e){u+=e;for(h=0;h<d.length;h++){if(d[h].test(u)){u="";v=a("Old password not accepted");g.input(r+"\n",true);return}}for(h=0;h<l.length;h++){if(l[h].test(u)){u="";g.input(o+"\n",true);v=a("Failed to change password");p=true;return}}for(h=0;p&&h<f.length;h++){if(f[h].test(u)){v=a("New password was not accepted");return}}});return c.promise()};i.load=function(t,r){var o=/.*Enter passphrase for .*/;var s=/.*UNPROTECTED PRIVATE KEY FILE.*/;var l=/.*Bad passphrase.*/;var f=e.Deferred();var c="";var u="";var p=a("Not a valid private key");var v=window.setTimeout(function(){p=a("Prompting via ssh-add timed out");h.close("terminated")},10*1e3);var h=n.spawn(["ssh-add",t],{pty:true,environ:["LC_ALL=C"],err:"out",directory:i.path}).always(function(){window.clearInterval(v)}).done(function(){d();f.resolve()}).fail(function(e){console.log(u);if(e.constructor.name=="ProcessError")e=new Error(p);f.reject(e)}).stream(function(e){c+=e;u+=e;if(s.test(c)){p=a("Invalid file permissions");c=""}else if(o.test(c)){c="";p=a("Password not accepted");h.input(r+"\n",true)}else if(l.test(c)){c="";h.input("\n",true)}});return f.promise()};i.unload=function p(e){return n.spawn(["ssh-add","-d",e],{pty:true,err:"message",directory:i.path}).done(d)};i.close=function v(){if(r)r.close();if(o)o.close();window.clearTimeout(s);s=null}}var r;e("#credential-authorize button").on("click",function(t){e("#credential-authorize").remove();n.drop_privileges(false);t.preventDefault()});e("#credentials-dialog").on("click","tr.listing-item, tr.listing-head",function(n){var t,a;if(e(n.target).parents(".listing-actions, ul").length===0){t=e(this).parents("tbody");t.toggleClass("open").removeClass("unlock");t.find(".alert").hide()}}).on("mouseenter",".listing-head",function(n){e(n.target).parents("tbody").find(".listing-head").addClass("highlight")}).on("mouseleave",".listing-head",function(n){e(n.target).parents("tbody").find(".listing-head").removeClass("highlight")}).on("change",".btn-group",function(n){var t=e(this).parents("tbody");var a=t.attr("data-id");var i=r.items[a];if(!i||!i.name)return;var o=e(this).onoff("value");if(o&&!i.loaded){t.addClass("open").addClass("unlock")}else if(!o&&i.loaded){r.unload(i.name).done(function(e){t.removeClass("open")}).fail(function(e){t.addClass("open").removeClass("unlock");t.find(".alert").show().find(".credential-alert").text(e.message)})}}).on("click",".credential-unlock button",function(n){var t=e(this).parents("tbody");var a=t.attr("data-id");var i=r.items[a];if(!i||!i.name)return;t.find("input button").prop("disabled",true);var o=t.find(".credential-password").val();r.load(i.name,o).always(function(e){t.find("input button").prop("disabled",false)}).done(function(e){t.find(".credential-password").val("");t.removeClass("unlock");t.find(".alert").hide()}).fail(function(e){t.find(".alert").show().find("span").text(e.message);console.warn("loading key failed: ",e.message)})}).on("click",".credential-change",function(n){var t=e(this).parents("tbody");var a=t.attr("data-id");var i=r.items[a];if(!i||!i.name)return;t.find("input button").prop("disabled",true);var o=t.find(".credential-old").val();var s=t.find(".credential-new").val();var d=t.find(".credential-two").val();if(o===undefined||s===undefined||d===undefined)throw"invalid password fields";r.change(i.name,o,s,d).always(function(e){t.find("input button").prop("disabled",false)}).done(function(){t.find(".credential-old").val("");t.find(".credential-new").val("");t.find(".credential-two").val("");t.find("li a").first().click()}).fail(function(e){t.find(".alert").show().find("span").text(e.message)})}).on("change keypress","input",function(n){var t,a=e(this).parents("tbody");if(n.type=="keypress"&&n.keyCode==13)e(this).parents("dl").find(".btn-primary").click();a.find(".alert").hide()}).on("click","tr.listing-head ul > li > a",function(){var n=e(this).parent();var t=n.index();n.parent().children().removeClass("active");n.addClass("active");var a=e(this).parents("tbody");a.find(".credential-tab").hide().eq(t).show();a.find(".alert").hide()}).on("click","[data-toggle='popover']",function(){e(this).popover("toggle")}).on("hide.bs.modal",function(){if(r){e(r).off();r.close();r=null}}).on("show.bs.modal",function(){r=new i;e(r).on("changed",function(){var n,t,a,i={};var o=e("#credentials-dialog table.credential-listing");o.find("tbody[data-id]").each(function(n,t){a=e(t);i[a.attr("data-id")]=a});var s=o.find("tbody").first();for(t in r.items){if(!(t in i)){a=i[t]=s.clone();a.attr("data-id",t).show().onoff();o.append(a)}}function d(e,n,t){var a=e.find(n);t=t||"";if(a.text()!==t)a.text(t)}for(t in i){a=i[t];n=r.items[t];if(n){d(a,".credential-label",n.name);d(a,".credential-type",n.type);d(a,".credential-fingerprint",n.fingerprint);d(a,".credential-comment",n.comment);d(a,".credential-data",n.data);a.attr("data-name",n.name).attr("data-loaded",n.loaded?"1":"0").find(".btn-onoff").onoff("value",n.loaded).onoff("disabled",!n.name)}else{a.remove()}}})});return{keys_instance:function(){return new i}}});

//# sourceURL=shell/credentials.min.js

var phantom_checkpoint=phantom_checkpoint||function(){};define("shell/index", ["jquery","base1/cockpit","shell/base_index","shell/machines","shell/credentials","translated!base1/po","shell/machine-dialogs"],function(e,t,n,a,o,r,s){"use strict";t.locale(r);var i=t.gettext;var l=window.location.pathname.indexOf(".html")!==-1;var c=a.instance();var d=a.loader(c);var u=n.new_index_from_proto({navigate:function(e,t){return v(e,t)},brand_sel:"#index-brand",logout_sel:"#go-logout",oops_sel:"#navbar-oops",language_sel:"#display-language",about_sel:"#about-version",account_sel:"#go-account",user_sel:"#content-user-name",default_title:"Cockpit"});e(u).on("expect_restart",function(e,t){d.expect_restart(t)});var f=null;e(u).on("disconnect",function(e,t){f=t;p()});var h=false;e("#machine-reconnect").on("click",function(e){if(f){window.sessionStorage.clear();window.location.reload(true)}else{v(null,true)}});e("#troubleshoot-dialog").on("show.bs.modal",function(e){h=true});e("#troubleshoot-dialog").on("hide.bs.modal",function(e){h=false;v(null,true)});var m=false;s.setup_machines(c);e(c).on("ready",function(e){m=true;u.ready()}).on("added updated",function(e,t){if(!t.visible)u.frames.remove(t);else if(t.problem)u.frames.remove(t);x();if(m)v()}).on("removed",function(e,t){u.frames.remove(t);x()});e("#machine-link").on("click",function(e){if(c.list.length==1){u.jump({host:c.list[0].address,sidebar:true,component:""});return false}});function p(){var n=u.current_frame();if(n)e(n).hide();e(".curtains .spinner").toggle(false);e("#machine-reconnect").toggle(true);e("#machine-troubleshoot").toggle(false);e(".curtains i").toggle(true);e(".curtains h1").text(i("Disconnected"));e(".curtains p").text(t.message(f));e(".curtains").show();e("#navbar-dropdown").addClass("disabled");phantom_checkpoint()}function v(e,t){var n;if(f||h)return;if(!e)e=u.retrieve_state();n=c.lookup(e.host);if(!n){n={key:e.host,address:e.host,label:e.host,state:"failed",problem:"not-found"}}else if(!n.visible){n.state="failed";n.problem="not-found"}else if(t&&n.state!=="connected"){d.connect(e.host)}var a=C(n);if(n.manifests&&!e.component)e.component=g(e,a);b(n,e,a);_(n,e,a);k(n,e,a);u.recalculate_layout();u.jump(e,true)}function g(t,n){var a;var o=c.list.length<=1;var r=n.ordered("dashboard");if(l)t.sidebar=true;if(!t.sidebar&&r.length>0){a=r[0];if(a&&(!o||a.wants!=="multiple-machines"))return a.path;else a=null}var s=e("#sidebar li.active a").text();if(s){a=n.search("label",s);if(a)return a.path}a=n.ordered("menu")[0];if(a)return a.path;return"system"}function b(t,n,a){e(".dashboard-link").each(function(){var t=e(this);t.toggleClass("active",t.attr("data-component")===n.component)});var o=a.items[n.component];if(o&&o.section=="dashboard"){delete n.sidebar;t=null}e("#machine-avatar").attr("src",t&&t.avatar?encodeURI(t.avatar):"../shell/images/server-small.png");var r;if(t){r=t.label}else if(c.list.length==1){r=c.list[0].label}else{r=i("Machines")}e("#machine-link span").text(r);var s;if(c.list.length==1||!t)s="transparent";else s=t.color||"";e("#machine-color").css("border-left-color",s);e("#machine-dropdown").toggleClass("active",!!t);var l=e("#sidebar");if(t&&t.state=="connected")l.show();else l.hide()}function _(t,n,a){function o(a){return e("<li>").toggleClass("active",n.component===a.path).append(e("<a>").attr("href",u.href({host:t.address,component:a.path})).text(a.label))}var r=a.ordered("menu").map(o);e("#sidebar-menu").empty().append(r);var s=a.ordered("tools").map(o);e("#sidebar-tools").empty().append(s);e("#tools-panel li.active").parents("#tools-panel").collapse("show")}function w(e,t){if(e)e+=" - ";else e="";var n=u.default_title;if(t&&t.label)n=t.label;document.title=e+n}function k(n,a,o){var r,l,c,d;var f=u.current_frame();if(n.state!="connected"){e(f).hide();f=null;u.current_frame(f);c=n.state=="connecting";if(n.restarting){r=i("The machine is restarting");l=""}else if(c){r=i("Connecting to the machine");l=""}else{r=i("Couldn't connect to the machine");if(n.problem=="not-found"){l=i("Cannot connect to an unknown machine")}else{var h=n.problem||n.state;if(h)l=t.message(h);else l=""}}if(!n.restarting&&s.needs_troubleshoot(n)){e("#machine-troubleshoot").off().on("click",function(){s.troubleshoot("troubleshoot-dialog",n)});e("#machine-troubleshoot").show()}else{e("#machine-troubleshoot").hide()}d=!!n.restarting;e(".curtains").show();e(".curtains .spinner").toggle(c||d);e("#machine-reconnect").toggle(!c&&n.problem!="not-found");e(".curtains i").toggle(!c&&!d);e(".curtains h1").text(r);e(".curtains p").text(l);e("#machine-spinner").hide();w(null,n);if(!c)return}var m=a.hash;var p=a.component;var v;if(n&&o.compat){v=o.compat[p];if(v){p="shell/shell";m=v}}var g;if(p)g=u.frames.lookup(n,p,m);if(g!=f){e(f).css("display","none");u.current_frame(g)}var b,_;if(n.state=="connected"){e(".curtains").hide();e("#machine-spinner").toggle(g&&!e(g).attr("data-ready"));e(g).css("display","block");_=o.items[a.component];b=_?_.label:"";w(b,n)}phantom_checkpoint()}function x(){e("#machine-dropdown .caret").toggle(c.list.length>1);var t=e("machine-link");if(c.list.length>1)t.attr("data-toggle","dropdown");else t.removeAttr("data-toggle");var n=e("#machine-dropdown ul");var a=c.list.map(function(t){var n=e("<img>").addClass("machine-avatar").attr("src",encodeURI(t.avatar));var a=e("<span>").text(t.label);return e("<li role='presentation'>").css("border-left-color",t.color||"").append(e("<a>").attr("role","menuitem").attr("tabindex","-1").attr("data-address",t.address).attr("href",u.href({host:t.address},true)).append(n,a))});n.empty().append(a)}function y(e){if(!e.manifests||e.address==="localhost")return null;var t=e.manifests["shell"]||{};var n=t["menu"]||{};var a=t["tools"]||{};var o={};if("_host_"in n)o["system/host"]="/server";if("_init_"in n)o["system/init"]="/services";if("_network_"in n)o["network/interfaces"]="/networking";if("_storage_"in n)o["storage/devices"]="/storage";if("_users_"in a)o["users/local"]="/accounts";if("_storage_"in n||"_init_"in n)o["docker/containers"]="/containers";return o}function C(e){var t=n.new_compiled();t.load(e.manifests,"tools");t.load(e.manifests,"dashboard");t.load(e.manifests,"menu");t.compat=y(e);return t}return u});

//# sourceURL=shell/index.min.js

var phantom_checkpoint=phantom_checkpoint||function(){};define("shell/simple-index", ["jquery","base1/cockpit","shell/base_index","translated!base1/po","manifests"],function(e,n,t,a,o){"use strict";n.locale(a);var i=n.gettext;var r="Cockpit";var c=o["shell"]||{};if(c.title)r=c.title;var s=window.location.pathname.indexOf(".html")!==-1;var l=t.new_index_from_proto({navigate:function(e,n){return h(e,n)},brand_sel:"#index-brand",logout_sel:"#go-logout",oops_sel:"#navbar-oops",language_sel:"#display-language",about_sel:"#about-version",default_title:r});var d=window.sessionStorage.getItem("login-data");if(d){var u=JSON.parse(d);e("#content-user-name").text(u["displayName"])}var p=t.new_compiled();p.load(o,"dashboard");var f=null;e(l).on("disconnect",function(e,n){f=n;m()});e("#machine-reconnect").on("click",function(e){window.sessionStorage.clear();window.location.reload(true)});function m(){var t=l.current_frame();if(t)e(t).hide();e(".curtains .spinner").toggle(false);e("#machine-reconnect").toggle(true);e(".curtains i").toggle(true);e(".curtains h1").text(i("Disconnected"));e(".curtains p").text(n.message(f));e(".curtains").show();e("#navbar-dropdown").addClass("disabled");phantom_checkpoint()}l.ready();function h(e,n){var t=p.ordered("dashboard");if(f)return;if(!e)e=l.retrieve_state();if(!e.component&&t.length>0){e.component=t[0].path}v(e);_(e);l.recalculate_layout();l.jump(e,true)}function v(n){e(".dashboard-link").each(function(){var t=e(this);t.toggleClass("active",t.attr("data-component")===n.component)});var t=p.items[n.component];delete n.sidebar;e("#machine-link span").text(r);if(e(".dashboard-link").length<2)e("#content-navbar").toggleClass("hidden",true)}function g(e){if(e)e+=" - ";else e="";document.title=e+r}function _(n){var t;var a=l.current_frame();var o=n.hash;var i=n.component;var r;if(i)r=l.frames.lookup(null,i,o);if(r!=a){e(a).css("display","none");l.current_frame(r)}var c,s;e(r).css("display","block");s=p.items[n.component];c=s?s.label:"";g(c);phantom_checkpoint()}return l});

//# sourceURL=shell/simple-index.min.js

define("shell/machines", ["jquery","base1/cockpit","manifests"],function(n,e,t){var o={};var r="/var/lib/cockpit/machines.json";var a="/var/lib/cockpit/known_hosts";var i="v2-machines.json";function s(){var s=this;var l=null;var c=false;var f={};var u={content:null,tag:null,overlay:{localhost:{visible:true,manifests:t}}};function d(n){if(n.key===i&&n.storageArea===window.sessionStorage)m(JSON.parse(n.newValue))}window.addEventListener("storage",d);window.setTimeout(function(){var n=window.sessionStorage.getItem(i);if(!c&&n)m(JSON.parse(n))});var v=null;function g(e,t,o){var r=n.extend({},t||{},o||{});var a,i;for(a in r){if(e[a]!==r[a])e[a]=r[a]}for(a in e){if(e[a]!==r[a])delete e[a]}return e}function m(e,t){var o=!c;c=true;u=e;l=null;if(t&&!v){v=window.setTimeout(function(){v=null;window.sessionStorage.setItem(i,JSON.stringify(u))},10)}var r,a={};var d=e.content||{};var m=e.overlay||{};for(r in d)a[r]=true;for(r in m)a[r]=true;var p=[];var h;for(r in a){var y=f[r]||{};var b=y.connection_string;if(d[r]&&d[r].color&&m[r])delete m[r].color;h=g(y,d[r],m[r]);h.key=r;if(!h.address)h.address=r;h.connection_string=s.generate_connection_string(h.user,h.port,h.address);if(!h.label){if(r=="localhost"||r=="localhost.localdomain")h.label=window.location.hostname;else h.label=r}if(!h.avatar)h.avatar="../shell/images/server-small.png";p.push([r in f?"updated":"added",[h,r,b]]);f[r]=h}for(r in f){if(!(r in a)){h=f[r];delete f[r];p.push(["removed",[h,r]])}}var w,_=n(s),k=p.length;for(w=0;w<k;w++)_.triggerHandler(p[w][0],p[w][1]);if(o)n(s).triggerHandler("ready")}s.add_key=function(n){var t=e.file(a,{superuser:"try"});return t.modify(function(e){return e+"\n"+n}).always(function(){t.close()})};s.add=function y(e,t){var o=s.split_connection_string(e);return s.change(o["address"],n.extend({visible:true,color:t||s.unused_color()},o))};s.unused_color=function b(){var n,e=o.colors.length;for(n=0;n<e;n++){if(!p(o.colors[n]))return o.colors[n]}return"gray"};function p(e){var t,o,r=n.color.parse(e).toString();for(t in f){o=f[t];if(o.color&&n.color.parse(o.color).toString()==r)return true}return false}function h(n,e){for(var t in e){if(e[t]===null)delete n[t];else n[t]=e[t]}}s.change=function w(t,o){var a,i;var l=s.lookup(t);if(o.label){var c=t;if(l)c=l.connection_string;if(!l||l.label!==o.label){a=e.dbus("org.freedesktop.hostname1",{host:c});i=a.call("/org/freedesktop/hostname1","org.freedesktop.hostname1","SetPrettyHostname",[o.label,true]).always(function(){a.close()}).fail(function(n){console.warn("couldn't set pretty host name: "+n)})}}function f(n){if(!n)n={};var e=n[t];if(!e)e=n[t]={};h(e,o);return n}var d=e.file(r,{syntax:JSON,superuser:"try"});var v=d.modify(f,u.content,u.tag).done(function(n,e){var r,a={};for(r in o)a[r]=null;s.data(n,e);s.overlay(t,a)}).always(function(){d.close()});if(i)return n.when(i,v);return v};s.data=function _(n,e){m({content:n,tag:e,overlay:u.overlay},true)};s.overlay=function k(e,t){var o={};o[e]=n.extend({},u.overlay[e]||{});h(o[e],t);m({content:u.content,tag:u.tag,overlay:n.extend({},u.overlay,o)},true)};Object.defineProperty(s,"list",{enumerable:true,get:function O(){var n;if(!l){l=[];for(n in f){if(f[n].visible)l.push(f[n])}l.sort(function(n,e){return n.label.localeCompare(e.label)})}return l}});Object.defineProperty(s,"addresses",{enumerable:true,get:function S(){return Object.keys(f)}});s.lookup=function x(n){var e=s.split_connection_string(n);return f[e.address||"localhost"]||null};s.generate_connection_string=function(n,e,t){var o=t;if(n)o=n+"@"+o;if(e)o=o+":"+e;return o};s.split_connection_string=function(n){var e={};var t=-1;var o=-1;if(n){t=n.lastIndexOf("@");o=n.lastIndexOf(":")}if(t>0){e.user=n.substring(0,t);n=n.substring(t+1);o=n.lastIndexOf(":")}if(o>-1){var r=parseInt(n.substring(o+1));if(!isNaN(r)){e.port=r;n=n.substring(0,o)}}e.address=n;return e};s.close=function j(){window.removeEventListener("storage",d)}}function l(t){var o=this;var a;var i={};var s={};a=e.file(r,{syntax:JSON});a.watch(function(n,e,o){if(o)console.warn("couldn't load machines data: "+o);t.data(n,e)});function l(n,e,o){var r={state:e,problem:o};if(e=="connected"){r.restarting=false}else if(o){r.manifests=null;r.checksum=null}t.overlay(n,r)}n(t).on("added",c);n(t).on("updated",c);n(t).on("removed",f);function c(r,a,i,l){if(!a){a=t.lookup(i);if(!a)return}var c=s[i];if(!c||!c.valid)c={};var f={};if(!a.color)f.color=t.unused_color();var u=c.PrettyHostname||c.StaticHostname;if(u&&u!==a.label)f.label=u;var d=c.OperatingSystemPrettyName;if(d&&d!=a.os)f.os=c.OperatingSystemPrettyName;if(!n.isEmptyObject(f))t.overlay(i,f);if(a.visible){if(l&&a.connection_string!=l){e.kill(l);o.disconnect(i);o.connect(i)}else if(!a.problem){o.connect(i)}}else{o.disconnect(i)}}function f(n,e,t){o.disconnect(t)}o.connect=function u(r){var a=t.lookup(r);if(!a)return;var f=i[r];if(f)return;f=e.channel({host:a.connection_string,payload:"echo"});i[r]=f;var u=r==="localhost";var d=null;var v=u;var g=null;function m(){if(!d&&v)l(r,"connected",null);else if(!g)l(r,"connecting",null)}var p;if(!a.manifests){if(a.checksum)p="../../"+a.checksum+"/manifests.json";else p="../../@"+encodeURI(a.connection_string)+"/manifests.json";d=n.ajax({url:p,dataType:"json",cache:true}).done(function(n){var e={manifests:n};var o=d.getResponseHeader("ETag");if(o)e.checksum=o.replace(/^"(.+)"$/,"$1");t.overlay(r,e)}).fail(function(n){console.warn("failed to load manifests from "+a.connection_string+": "+n)}).always(function(){d=null;m()})}if(!u){f.send("x");n(f).on("message",function(){v=true;m()}).on("close",function(n,e){g=e.problem||"disconnected";v=false;l(r,"failed",g);var a=t.lookup(r);if(a&&a.restarting){window.setTimeout(function(){o.connect(r)},1e4)}o.disconnect(r)})}var h=e.dbus("org.freedesktop.hostname1",{host:a.connection_string}).proxy();s[r]=h;h.wait(function(){n(h).on("changed",function(){c(null,null,r)});c(null,null,r)});m()};o.disconnect=function d(e){if(e==="localhost")return;var t=i[e];delete i[e];if(t){t.close();n(t).off()}var o=s[e];delete s[e];if(o){o.client.close();n(o).off()}};o.expect_restart=function v(n){var e=t.split_connection_string(n);t.overlay(e.address,{restarting:true,problem:null})};o.close=function g(){n(t).off("added",c);n(t).off("changed",c);n(t).off("removed",f);t=null;if(a)a.close();a=null;var e=Object.keys(i);e.forEach(o.disconnect)}}o.instance=function c(n){return new s};o.loader=function f(n){return new l(n)};o.colors=["#0099d3","#67d300","#d39e00","#d3007c","#00d39f","#00d1d3","#00618a","#4c8a00","#8a6600","#9b005b","#008a55","#008a8a","#00b9ff","#7dff00","#ffbe00","#ff0096","#00ffc0","#00fdff","#023448","#264802","#483602","#590034","#024830","#024848"];o.known_hosts_path=a;e.transport.wait(function(){var t=e.transport.options.capabilities||[];o.allow_connection_string=n.inArray("connection-string",t)!=-1;o.has_auth_results=n.inArray("auth-method-results",t)!=-1});return o});

//# sourceURL=shell/machines.min.js

define("shell/machine-dialogs", ["jquery","base1/cockpit","base1/mustache","shell/machines","shell/credentials","manifests","data!shell/templates/add-machine.html","data!shell/templates/auth-failed.html","data!shell/templates/change-auth.html","data!shell/templates/change-port.html","data!shell/templates/color-picker.html","data!shell/templates/invalid-hostkey.html","data!shell/templates/not-supported.html","data!shell/templates/sync-users.html","data!shell/templates/unknown-hostkey.html","translated!base1/po","base1/patterns","base1/bootstrap-select"],function(e,n,r,t,o,s,a,i,l,c,u,d,f,h,p,v){"use strict";n.locale(v);var m=n.gettext;var g;var _={"no-cockpit":"not-supported","not-supported":"not-supported","protocol-error":"not-supported","authentication-not-supported":"change-auth","authentication-failed":"change-auth","no-forwarding":"change-auth","unknown-hostkey":"unknown-hostkey","invalid-hostkey":"invalid-hostkey","not-found":"add-machine","no-host":"change-port"};function w(t){var o=e("<div>").append(t);o.find('[translatable="yes"]').each(function(r,o){var s=o.outerHTML;var a=n.gettext(o.getAttribute("context"),e(o).text());e(o).removeAttr("translatable").text(a);t.replace(s,o.outerHTML)});r.parse(t);return t}var k={"add-machine":w(a),"auth-failed":w(i),"change-auth":w(l),"change-port":w(c),"color-picker":w(u),"invalid-hostkey":w(d),"not-supported":w(f),"sync-users":w(h),"unknown-hostkey":w(p)};function b(e){var n=g.lookup(e);if(n&&n.address!="localhost")return n.connection_string;return e}function y(t,o){var s=this;s.address=b(o);var a=null;var i=null;var l=null;var c=null;function u(){var e=g.lookup(s.address);var n=g.split_connection_string(s.address).address;if(e&&e.label)n=e.label;return n}function d(e,n){var r=c;if(l===e)return;if(e=="add-machine")c=new T(s);else if(e=="sync-users")c=new F(s);else if(e=="unknown-hostkey")c=new S(s,e);else if(e=="invalid-hostkey")c=new S(s,e);else if(e=="change-auth")c=new A(s);else if(e=="change-port")c=new I(s);else c=new O(s);l=e;c.load(n);if(r&&r.close)r.close();r=null}s.get_sel=function(n){var r=t;if(n)r=r+" "+n;return e(r)};s.set_on_success=function(e){i=e};s.set_goal=function(e){a=e};s.complete=function(n){if(i)i(n);else e(t).modal("hide")};s.render=function f(n,t){if(!t)t=l;var o=g.split_connection_string(s.address);var a=e.extend({host:u(),full_address:s.address,context_title:s.context_title,strong:function(){return function(e,n){return"<strong>"+n(e)+"</strong>"}}},n,o);var i=r.render(k[t],a);s.get_sel(".modal-content").html(i)};s.render_error=function h(r){var o;if(r.problem&&r.command=="close")o=_[r.problem];if(o&&l!==o)d(o,r);else e(t).dialog("failure",n.message(r))};s.render_template=function p(e){d(e)};s.show=function(){var e=s.get_sel();e.on("hide.bs.modal",function(){s.get_sel(".model-content").empty()});e.modal("show")};s.run=function(n,r){var t=e.Deferred();var o=[];function i(e){o[e]().done(function(n){e=e+1;if(e<o.length){i(e)}else{t.resolve();s.complete(n)}}).fail(function(e){if(r)r(e);else s.render_error(e);t.reject(e)})}o.push(function(){return n});s.get_sel().dialog("wait",t.promise());if(a)o.push(a);i(0)}}function x(r,t){var o=e.Deferred();var s=e.extend({payload:"echo",host:r},t);var a=n.channel(s);a.send("x");e(a).on("message",function(){e(a).off();a.close();o.resolve()}).on("close",function(e,n){o.reject(n)});return o.promise()}function j(e,n){var r=e[n];return r?r!="no-server-support":false}function D(e,n){if(j(e,n))return n=="password"||e[n]!="not-provided";return false}function C(){var n=this;var o=[];for(var s=0;s<t.colors.length;s+=6){var a=t.colors.slice(s,s+6);o.push({list:a})}function i(){var n=e(this).css("background-color");e("#host-edit-color").css("background-color",n)}n.render=function(n,t,s){var a;if(t&&!s){a=g.lookup(t);if(a)s=a.color}if(!s)s=g.unused_color();var l=r.render(k["color-picker"],{colors:o,selected_color:s});e(n).html(l);e("#host-edit-color-popover .popover-content .color-cell").click(i);e("#host-edit-color").parent().on("show.bs.dropdown",function(){var n=e("#host-edit-color");var r=e("#host-edit-color-popover");var t=n.position();var o=n.width();var s=n.height();var a=r.width();var i=r.height();var l=t.top-i+10;if(l<0){l=t.top+s+10;r.addClass("bottom");r.removeClass("top")}else{r.addClass("top");r.removeClass("bottom")}r.css("left",t.left+(o-a)/2);r.css("top",l);r.show()}).on("hide.bs.dropdown",function(){e("#host-edit-color-popover").hide()})}}var E=new C;function O(e){var n=this;n.load=function(){e.render()}}function T(r){var o=this;var a=null;var i=r.get_sel();var l=null;var c=g.addresses.filter(function(e){var n=g.lookup(e);return!n||!n.visible});function u(e){var n=null;var r=g.lookup(e);if(r&&r.visible){n=new Error(m("This machine has already been added."));n.target="#add-machine-address"}return n}function d(n){var o=true;var s=null;var a=e("#add-machine-address").val();var c=r.get_sel(".btn-primary");if(a===""){o=true}else if(!t.allow_connection_string&&(a.indexOf("@")>-1||a.indexOf(":")>-1)){s=new Error(m("This version of cockpit-ws does not support connecting to a host with an alternate user or port"))}else if(a.search(/\s+/)===-1){s=u(a);if(!s)o=false}else{s=new Error(m("The IP address or host name cannot contain whitespace."))}if(s)s.target="#add-machine-address";if(l)i.dialog("failure",l,s);else i.dialog("failure",s);c.prop("disabled",o)}function f(){l=null;r.address=e("#add-machine-address").val();a=e.color.parse(e("#host-edit-color").css("background-color")).toString();if(u(r.address))return;r.set_goal(function(){var t=e.Deferred();g.add(r.address,a).done(t.resolve).fail(function(e){var r=n.format(m("Failed to add machine: $0"),n.message(e));t.reject(r)});return t.promise()});r.run(x(r.address),function(e){if(e.problem=="no-host"){e=n.message(e);l=e}r.render_error(e)})}o.load=function(){var n=s["shell"]||{};var t=parseInt(n["machine-limit"],10);if(!t||isNaN(t))t=20;r.render({nearlimit:t*.75<=g.list.length,limit:t,placeholder:m("Enter IP address or host name"),options:c});var o=r.get_sel(".btn-primary");o.on("click",f);e("#add-machine-address").on("keyup",function(e){if(e.which===13){var n=o.prop("disabled");if(!n)f()}});e("#add-machine-address").on("input focus",d);E.render("#add-machine-color-picker",r.address,a);e("#add-machine-address").focus()}}function I(r){var o=this;function s(){var t=e.Deferred();var o=g.split_connection_string(r.address);o.port=e("#edit-machine-port").val();var s=g.generate_connection_string(o.user,o.port,o.address);function a(){r.address=s;g.change(o.address,{port:o.port}).done(t.resolve).fail(function(e){var r=n.format(m("Failed to edit machine: $0"),n.message(e));t.reject(r)})}x(s).done(a).fail(function(e){if(e.problem!="no-host")a();t.reject(e)});r.run(t.promise())}o.load=function(){var e=g.lookup(r.address);if(!e)r.get_sel().modal("hide");r.render({port:e.port,allow_connection_string:t.allow_connection_string});if(t.allow_connection_string)r.get_sel(".btn-primary").on("click",s)}}function S(n,r){var o=this;var s=null;var a=null;var i=r=="unknown-hostkey";function l(){var r=e.Deferred();g.add_key(a).done(function(){x(n.address).done(r.resolve).fail(r.reject)}).fail(r.reject);n.run(r.promise())}function c(){var e=null;var o;if(s){a=s["host-key"];o=s["host-fingerprint"]}n.render({context_title:n.context_title,path:t.known_hosts_path,key:o,key_host:a?a.split(" ")[0]:null});if(!a){e=x(n.address).fail(function(e){if(e.problem!=r){n.render_error(e)}else{s=e;c()}}).done(function(e){n.complete(e)});n.get_sel().dialog("wait",e)}else if(i){n.get_sel(".btn-primary").on("click",l)}}o.load=function(e){s=e;c()}}function A(r){var s=this;var a=null;var i=false;var l=null;var c=null;var u=null;var d=g.lookup(r.address);function f(){var n=[];var t;var o=r.get_sel(".keys");if(o){o.empty();for(var s in u.items){var a=u.items[s];if(a.loaded)o.append(e("<div>").text(a.name))}}}function h(){var t;var o={};var s=e.Deferred();var a=e("#login-custom-user").val();var i=g.split_connection_string(r.address);i.user=a;t=g.generate_connection_string(i.user,i.port,i.address);if(e("#login-type").val()!="stored"){o["password"]=e("#login-custom-password").val();if(!a){o["user"]=n.user.user;o["temp-session"]=false}}x(t,o).done(function(){r.address=t;if(d){g.change(d.address,{user:a}).done(s.resolve).fail(s.reject)}else{s.resolve()}}).fail(s.reject);r.run(s.promise())}function p(){var n=e("#login-type").val()=="stored";e("#login-available").toggle(n);e("#login-diff-password").toggle(!n)}function v(){var o=null;var s="change-auth";if(!t.allow_connection_string||!t.has_auth_results)s="auth-failed";var l=null;var c=null;var u=null;var m=g.split_connection_string(r.address).user;if(!m&&d)m=d.user;if(a&&t.has_auth_results){u={};c={};l=a["auth-method-results"];if(l){i=j(l,"password");for(var _ in l){if(D(l,_)){c[_]=true}}}if(e.isEmptyObject(c))s="auth-failed"}r.render({supported:l,available:c,machine_user:m,user:n.user.user,allows_password:i,"machines.allow_connection_string":t.allow_connection_string,sync_link:function(){return function(e,n){return'<a id="do-sync-users">'+n(e)+"</a>"}}},s);if(l===null&&t.has_auth_results){o=x(r.address).fail(function(e){a=e;v()}).done(function(e){r.complete(e)});r.get_sel().dialog("wait",o)}else if(!e.isEmptyObject(c)){e("#login-type").selectpicker("refresh");e("#login-type").on("change",p);p();r.get_sel(".btn-primary").on("click",h);r.get_sel("a[data-content]").popover();f()}r.get_sel("#do-sync-users").on("click",function(){r.render_template("sync-users")})}s.load=function(n){a=n;u=o.keys_instance();e(u).on("changed",f);v()};s.close=function(n){e(u).off();u.close();u=null}}function F(r){var o=this;var s={};var a=false;var i=false;var l=null;var c={superuser:true};var u=null;function d(){var r=n.dbus(null,{bus:"internal",host:"localhost",superuser:true});e(r).on("close",function(e,n){u=n;p()});var t=r.proxy("cockpit.Setup","/setup");t.wait(function(){if(t.valid){var n={t:"(asas)",v:[[],[]]};t.Transfer("passwd1",n).done(function(e){var n,r,t;var o=e.v[1];for(n=0;n<e.v[0].length;n++){var a=e.v[0][n];r=a.split(":");t=r[0];s[t]={username:t,name:r[4]||t,raw:a,groups:[]}}for(n=0;n<o.length;n++){r=o[n].split(":");t=r[0];var i=r[r.length-1].split(",");for(var l=0;l<i.length;l++){var c=i[l];if(s[c])s[c].groups.push(t)}}}).fail(function(e){u=e}).always(function(n){e(r).off();r.close();p()})}})}function f(){var t=null;var o=e.Deferred();var i=o.promise();r.run(i);r.set_on_success(null);i.always(function(){if(t){e(t).off();t.close()}});var l={bus:"internal"};if(a){l.user=e("#sync-username").val();l.password=e("#sync-password").val()}e.extend(l,c,{host:r.address});t=n.dbus(null,l);e(t).on("close",function(e,r){o.reject(n.message(r))});var u={t:"(asas)",v:[[]]};var d={};r.get_sel("input:checked").each(function(){var n=s[e(this).attr("name")];if(n){u.v[0].push(n.raw);for(var r=0;r<n.groups.length;r++){var t=n.groups[r];if(!d[t])d[t]=[];d[t].push(n.username)}}});u.v.push(Object.keys(d).map(function(e){return e+":::"+d[e].join()}));var f=t.proxy("cockpit.Setup","/setup");f.wait(function(){if(f.valid){f.Commit("passwd1",u).fail(o.reject).done(o.resolve)}})}function h(){var e=r.get_sel("input:checked").length>0;r.get_sel(".btn-primary").toggleClass("disabled",!e)}function p(){function o(){if(this.groups)return this.groups.join(", ")}var c=true;var d=Object.keys(s).sort().map(function(e){return s[e]});if(t.has_auth_results&&l)c=j(l,"password");var p=r.render({needs_auth:a,needs_root:i,users:d,perm_failed:u?n.message(u):null,allows_password:c,formated_groups:o});r.get_sel(".modal-content").html(p);r.get_sel(".btn-primary").on("click",f);r.get_sel("input:checkbox").on("change",function(){var n=e(this).attr("name");s[n].checked=e(this).is(":checked");h()});h()}o.load=function(e){if(e)l=e["auth-method-results"];p();x(r.address,c).fail(function(e){a=true;if(e.problem=="access-denied"){i=true;if(!l&&t.has_auth_results)x(r.address,{user:"1"}).fail(function(e){l=e["auth-method-results"]}).always(p)}else{l=e["auth-method-results"];p()}});d()}}return{setup_machines:function(e){g=e},troubleshoot:function(e,n){var r="#"+e;if(!n||!n.problem)return;var t=_[n.problem];var o=new y(r,n.address);o.render_template(t);o.show()},needs_troubleshoot:function(e){if(!e||!e.problem)return false;return _[e.problem]?true:false},render_dialog:function(e,n,r){var t="#"+n;var o=new y(t,r);o.render_template(e);o.show()},render_color_picker:function(e,n){E.render(e,n)}}});

//# sourceURL=shell/machine-dialogs.min.js

define("shell/ssh-list-private-keys.sh_text", "#!/bin/sh\n\nset -eu\n\n# The first thing we do is list loaded keys\nssh-add -L || true\n\n# Try to list keys in this directory\ncd \"$1\" || exit 0\n\n# After that each .pub file gets its on set of blocks\nfor file in *.pub; do\n    printf \"\\v\"\n    cat \"$file\"\n    printf \"\\v%s\\v\" \"$file\"\n    ssh-keygen -l -f \"$file\" || true\ndone\n");
//# sourceURL=shell/ssh-list-private-keys.sh

define("shell/templates/add-machine.html_text", "<div class=\"modal-header\">\n    <button type=\"button\" class=\"close\" data-dismiss=\"modal\"\n        aria-hidden=\"true\">&times;</button>\n    <h4 class=\"modal-title\" translatable=\"yes\">Add Machine to Dashboard</h4>\n</div>\n\n<div class=\"modal-body\">\n    <div>\n        <table class=\"cockpit-form-table\">\n            <tr>\n                <td class=\"top\" translatable=\"yes\">Address</td>\n                <td>\n                <div class=\"dialog-wrapper error-keep\">\n                    <input class=\"form-control\" id=\"add-machine-address\"\n                       type=\"test\" value=\"{{ full_address }}\"\n                       list=\"options\"\n                       placeholder=\"{{ placeholder }}\"/>\n                    <datalist id=\"options\">\n                        {{#options}}\n                        <option value=\"{{.}}\">\n                        {{/options}}\n                    </datalist>\n                </div>\n                </td>\n            </tr>\n            <tr>\n                <td translatable=\"yes\">Color</td>\n                <td id=\"add-machine-color-picker\">\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n\n<div class=\"modal-footer\">\n    {{#nearlimit}}\n    <div class=\"alert alert-warning dialog-error dashboard-machine-warning\">\n        <span class=\"pficon pficon-warning-triangle-o\"></span>\n        <span translatable=\"yes\">Connecting simultaneously to more than {{ limit }} machines is unsupported.</span>\n    </div>\n    {{/nearlimit}}\n    <button class=\"btn btn-default\" data-dismiss=\"modal\" translatable=\"yes\">Cancel</button>\n    <button class=\"btn btn-primary\" translatable=\"yes\">Add</button>\n</div>\n");
//# sourceURL=shell/templates/add-machine.html

define("shell/templates/auth-failed.html_text", "<div class=\"modal-header\">\n    <h4 class=\"modal-title\" translatable=\"yes\">Authentication Failed</h4>\n</div>\n<div class=\"modal-body\">\n    {{#supported}}\n    <p translatable=\"yes\">Cockpit was unable to log into {{#strong}}{{host}}{{/strong}}. To use this machine with cockpit you will need to enable one of the following authentication methods in the sshd config on {{#strong}}{{host}}{{/strong}}:</p>\n    <ul>\n        {{#password}}<li translatable=\"yes\">Password</li>{{/password}}\n        {{#public-key}}<li translatable=\"yes\">Public Key</li>{{/public-key}}\n        {{#gssapi-mic}}<li translatable=\"yes\">Kerberos Based SSO</li>{{/gssapi-mic}}\n    </ul>\n    {{/supported}}\n\n    {{^supported}}\n    <p translatable=\"yes\">Cockpit was unable to log in to {{#strong}}{{host}}{{/strong}}. You may want to try to {{#sync_link}}synchronize users{{/sync_link}}. For more authentication options and troubleshooting support please upgrade cockpit-ws to a newer version.</p>\n    {{/supported}}\n\n</div>\n<div class=\"modal-footer\">\n    <button class=\"btn btn-primary\" data-dismiss=\"modal\" translatable=\"yes\">Close</button>\n</div>\n");
//# sourceURL=shell/templates/auth-failed.html

define("shell/templates/change-auth.html_text", "<div class=\"modal-header\">\n    <button type=\"button\" class=\"close\" data-dismiss=\"modal\"\n        aria-hidden=\"true\">&times;</button>\n    <h4 class=\"modal-title\" translatable=\"yes\">Log in to {{host}}</h4>\n</div>\n\n<div class=\"modal-body\">\n    {{^available}}\n    <p translatable=\"yes\">Cockpit was unable to log into {{#strong}}{{host}}{{/strong}}.</p>\n    {{/available}}\n\n    {{#available}}\n    <p translatable=\"yes\">Cockpit was unable to log into {{#strong}}{{host}}{{/strong}} you can change your authentication credentials below. You may prefer to {{#sync_link}}synchronize users{{/sync_link}}.</p>\n\n    <div>\n        <table class=\"cockpit-form-table\">\n            <tr>\n                <td translatable=\"yes\" class=\"top\">User name</td>\n                <td>\n                    <input class=\"form-control\" id=\"login-custom-user\" type=\"text\" value=\"{{machine_user}}\" placeholder=\"{{ user }}\"/>\n                </td>\n                <td>\n                    <a tabindex=\"0\" role=\"button\" data-toggle=\"popover\"\n                        data-trigger=\"focus\" data-placement=\"bottom\"\n                        data-content=\"Leave blank to connect to this machine as the currently logged in user ({{user}}). If you enter a different username, that user will always be used connecting to this machine.\">\n                        <span class=\"fa fa-lg fa-info-circle\"></span>\n                    </a>\n                </td>\n            </tr>\n\n            <tr>\n                <td translatable=\"yes\">Authentication</td>\n                <td>\n                    <select class=\"form-control\" id=\"login-type\" type=\"text\">\n                        {{#allows_password}}\n                        <option value=\"password\" translatable=\"yes\">Type a password</option>\n                        {{/allows_password}}\n                        <option value=\"stored\" translatable=\"yes\">Using available credentials</option>\n                    </select>\n                </td>\n            </tr>\n\n            {{#allows_password}}\n            <tr id=\"login-diff-password\">\n                <td translatable=\"yes\" class=\"top\">Password</td>\n                <td>\n                    <input class=\"form-control\" id=\"login-custom-password\" type=\"password\" />\n                </td>\n                <td>\n                    <a tabindex=\"0\" role=\"button\" data-toggle=\"popover\"\n                        data-trigger=\"focus\" data-placement=\"bottom\"\n                        data-content=\"Entering a different password here means you will need to retype it every time you reconnect to this machine\">\n                        <span class=\"fa fa-lg fa-info-circle\"></span>\n                    </a>\n                </td>\n            </tr>\n            {{/allows_password}}\n            <tr id=\"login-available\">\n                <td translatable=\"yes\" class=\"top\">Available</td>\n                <td class=\"top\">\n                        {{#password}}<div translatable=\"yes\">Login Password</div>{{/password}}\n                        {{#gssapi-mic}}<div translatable=\"yes\">Kerberos Ticket</div>{{/gssapi-mic}}\n                        {{#public-key}}<div class=\"keys\"><div class='dialog-wait pull-left'><div class='spinner spinner-sm'></div><span translatable=\"yes\">Checking for public keys</span></div></div>{{/public-key}}\n                </td>\n            </tr>\n        </table>\n    </div>\n    {{/available}}\n</div>\n\n<div class=\"modal-footer\">\n    <button class=\"btn btn-default\" data-dismiss=\"modal\" translatable=\"yes\">Cancel</button>\n    <button class=\"btn btn-primary\" translatable=\"yes\">Log In</button>\n</div>\n");
//# sourceURL=shell/templates/change-auth.html

define("shell/templates/change-port.html_text", "<div class=\"modal-header\">\n    <button type=\"button\" class=\"close\" data-dismiss=\"modal\"\n        aria-hidden=\"true\">&times;</button>\n    <h4 class=\"modal-title\" translatable=\"yes\">Could not contact {{host}}</h4>\n</div>\n\n<div class=\"modal-body\">\n    <p>\n        <span translatable=\"yes\">Cockpit was unable to contact {{#strong}}{{host}}{{/strong}}.</span>\n        {{^allow_connection_string}}\n        <span translatable=\"yes\">To try a different port you will need to upgrade cockpit-ws to a newer version.</span>\n        {{/allow_connection_string}}\n\n        {{#allow_connection_string}}\n        <span translatable=\"yes\">Is sshd running on a different port?</span>\n        {{/allow_connection_string}}\n    </p>\n\n    {{#allow_connection_string}}\n    <div>\n        <table class=\"cockpit-form-table\">\n            <tr>\n                <td class=\"top\" translatable=\"yes\">Port</td>\n                <td>\n                <div class=\"dialog-wrapper error-keep\">\n                    <input id=\"edit-machine-port\"\n                       type=\"test\" value=\"{{ port }}\"\n                       list=\"options\"\n                       placeholder=\"22\"/>\n                </div>\n                </td>\n            </tr>\n        </table>\n    </div>\n    {{/allow_connection_string}}\n</div>\n\n<div class=\"modal-footer\">\n    {{#allow_connection_string}}\n    <button class=\"btn btn-default\" data-dismiss=\"modal\" translatable=\"yes\">Cancel</button>\n    <button class=\"btn btn-primary\" translatable=\"yes\">Update</button>\n    {{/allow_connection_string}}\n\n    {{^allow_connection_string}}\n    <button class=\"btn btn-default\" data-dismiss=\"modal\" translatable=\"yes\">Close</button>\n    {{/allow_connection_string}}\n</div>\n");
//# sourceURL=shell/templates/change-port.html

define("shell/templates/color-picker.html_text", "<div>\n    <div id=\"host-edit-color\" data-toggle=\"dropdown\"\n        style=\"width:100px; height:26px; background-color: {{ selected_color }}\">\n    </div>\n    <div id=\"host-edit-color-popover\" class=\"popover in\" tabindex=\"-1\">\n        <div class=\"arrow\"></div>\n        <div class=\"popover-content\">\n            {{#colors}}\n            <div>\n                {{#list}}\n                <div class=\"color-cell\" style=\"background-color: {{.}}\"></div>\n                {{/list}}\n            </div>\n            {{/colors}}\n        </div>\n        <div class=\"arrow\"></div>\n    </div>\n</div>\n");
//# sourceURL=shell/templates/color-picker.html

define("shell/templates/invalid-hostkey.html_text", "<div class=\"modal-header\">\n    <h4 class=\"modal-title\" translatable=\"yes\">Incorrect Host Key</h4>\n</div>\n<div class=\"modal-body\">\n    <div class=\"banned\">\n        <i class=\"fa fa-ban\"></i>\n    </div>\n    <p translatable=\"yes\">The key of {{#strong}}{{host}}{{/strong}} does not match the key previously in use. Unless this machine was recently replaced, it is likely that someone is trying to attack your connection to this machine.</p>\n\n    {{#key_host}}\n    <p translatable=\"yes\">You can remove the previously stored key by running the following command</p>\n\n    <pre class=\"center\">ssh-keygen -R {{ key_host }} -f {{ path }}</pre>\n    {{/key_host}}\n\n</div>\n\n<div class=\"modal-footer\">\n    <button class=\"btn btn-default\" data-dismiss=\"modal\" translatable=\"yes\">Close</button>\n</div>\n");
//# sourceURL=shell/templates/invalid-hostkey.html

define("shell/templates/not-supported.html_text", "<div class=\"modal-header\">\n    <h4 class=\"modal-title\" translatable=\"yes\">Cockpit is not installed</h4>\n</div>\n<div class=\"modal-body\">\n    <p translatable=\"yes\">A compatible version of Cockpit is not installed on {{#strong}}{{host}}{{/strong}}.</p>\n</div>\n<div class=\"modal-footer\">\n    <button class=\"btn btn-default\" data-dismiss=\"modal\" translatable=\"yes\">Close</button>\n</div>\n");
//# sourceURL=shell/templates/not-supported.html

define("shell/templates/sync-users.html_text", "<div class=\"modal-header\">\n    <button type=\"button\" class=\"close\" data-dismiss=\"modal\"\n        aria-hidden=\"true\">&times;</button>\n    <h4 class=\"modal-title\" translatable=\"yes\">Synchronize users</h4>\n</div>\n\n<div class=\"modal-body\">\n    <p translatable=\"yes\">Select the users that you would like to be synchronized with {{#strong}}{{host}}{{/strong}}</p>\n\n{{#perm_failed}}\n    <div class=\"alert alert-danger dialog-error\">\n        <span class=\"fa fa-exclamation-triangle\"></span>\n        <span translatable=\"yes\">Error loading users: {{perm_failed}}</span>\n    </div>\n{{/perm_failed}}\n\n{{^perm_failed}}\n    <div id=\"sync-users\">\n        <table class=\"table\">\n        <tbody>\n        {{^users}}\n            <tr>\n                  <td>\n                    <div class=\"center-spinner\">\n                        <div class=\"spinner spinner-lg\"></div>\n                    </div>\n                  </td>\n            </tr>\n        {{/users}}\n\n        {{#users}}\n              <tr>\n                  <td><input type=\"checkbox\" name=\"{{username}}\" {{#checked}}checked=checked{{/checked}} /></td>\n                  <td>{{username}}</td>\n                  <td>{{name}}</td>\n                  <td>&#8226;&#8226;&#8226;&#8226;&#8226;</td>\n                  <td>{{formated_groups}}</td>\n              </tr>\n        {{/users}}\n        </tbody>\n        </table>\n    </div>\n\n    {{#needs_auth}}\n    <div>\n        {{#needs_root}}\n        <p translatable=\"yes\">You are connected to {{#strong}}{{host}}{{/strong}}, however in order to synchronize users, a user with superuser privileges is required.</p>\n        {{/needs_root}}\n        {{^needs_root}}\n        <p translatable=\"yes\">In order to synchronize users, you need to log in to {{#strong}}{{host}}{{/strong}}.</strong>\n        {{/needs_root}}\n        <table class=\"cockpit-form-table\">\n            <tr>\n                <td translatable=\"yes\">User name</td>\n                <td>\n                    <input class=\"form-control\" id=\"sync-username\" type=\"text\" />\n                </td>\n            </tr>\n            {{#allows_password}}\n            <tr>\n                <td translatable=\"yes\">Password</td>\n                <td>\n                    <input class=\"form-control\" id=\"sync-password\" type=\"password\" />\n                </td>\n            </tr>\n            {{/allows_password}}\n        </table>\n    </div>\n    {{/needs_auth}}\n{{/perm_failed}}\n</div>\n\n<div class=\"modal-footer\">\n    <button class=\"btn btn-default\" data-dismiss=\"modal\" translatable=\"yes\">Cancel</button>\n    <button class=\"btn btn-primary disabled\" translatable=\"yes\">Synchronize</button>\n</div>\n");
//# sourceURL=shell/templates/sync-users.html

define("shell/templates/unknown-hostkey.html_text", "<div class=\"modal-header\">\n    <h4 class=\"modal-title\" translatable=\"yes\">Unknown Host Key</h4>\n</div>\n<div id=\"add-unknown-host\" class=\"modal-body\">\n    {{#key}}\n        <p translatable=\"yes\">The authenticity of host {{#strong}}{{host}}{{/strong}} can't be established. Are you sure you want to continue connecting?</p>\n        <div>\n        <table class=\"cockpit-form-table\">\n            <tr>\n                <td translatable=\"yes\">Fingerprint</td>\n                <td><pre class=\"machine-key\">{{key}} </pre></td>\n            </tr>\n        </table>\n        </div>\n    {{/key}}\n</div>\n\n<div class=\"modal-footer\">\n    <button class=\"btn btn-default\" data-dismiss=\"modal\" translatable=\"yes\">Close</button>\n\n    {{#key}}\n        <button class=\"btn btn-primary\" translatable=\"yes\">Connect</button>\n    {{/key}}\n</div>\n");
//# sourceURL=shell/templates/unknown-hostkey.html
