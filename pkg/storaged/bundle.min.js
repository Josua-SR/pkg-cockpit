
define("storage/details", ["jquery","base1/cockpit","base1/mustache","system/server","shell/shell","storage/utils","storage/dialog","storage/permissions"],function(e,t,i,a,n,r,o,l){var s=t.gettext;var c=t.gettext;function u(n,u){var p,d;var f=r.get_multipathd_service();function m(e){var t=[];if(n.blocks_cleartext[e]){t.push(n.blocks_cleartext[e].path)}if(n.blocks_ptable[e]){n.blocks_partitions[e].forEach(function(e){if(!e.IsContainer)t.push(e.path)})}if(n.blocks_part[e]&&n.blocks_part[e].IsContainer){n.blocks_partitions[e].forEach(function(e){if(e.IsContained)t.push(e.path)})}if(n.vgroups[e]){n.vgroups_lvols[e].forEach(function(e){if(n.lvols_block[e.path])t.push(n.lvols_block[e.path].path)})}return t}function v(e){var i=n.blocks[e];var a=n.blocks_fsys[e];var o=n.blocks_pvol[e];var l=r.flatten(m(e).map(v));if(a&&a.MountPoints.length>0)l.push({usage:"mounted",Message:t.format(s("Device $0 is mounted on $1"),r.block_name(i),r.decode_filename(a.MountPoints[0]))});if(i&&n.mdraids[i.MDRaidMember])l.push({usage:"mdraid-member",Message:t.format(s("Device $0 is a member of RAID Array $1"),r.block_name(i),r.mdraid_name(n.mdraids[i.MDRaidMember]))});if(o&&n.vgroups[o.VolumeGroup])l.push({usage:"pvol",Message:t.format(s("Device $0 is a physical volume of $1"),r.block_name(i),n.vgroups[o.VolumeGroup].Name)});return l}function _(e,i,a,l){var c=n.blocks[e];var u=n.blocks_ptable[e];var p=i!==undefined;var d;if(p)d=t.format(s("Create partition on $0"),r.block_name(c));else d=t.format(s("Format $0"),r.block_name(c));function f(e){return e.type=="luks+xfs"||e.type=="luks+ext4"}function m(e){return e.type!="empty"&&e.type!="dos-extended"}o.open({Title:d,Alerts:v(e),Fields:[{SizeInput:"size",Title:s("Size"),Value:a,Max:a,visible:function(){return p},validate:function(e){if(isNaN(e))return s("Size must be specified.");if(e===0)return s("Size can not be zero.")}},{SelectOne:"erase",Title:s("Erase"),Options:[{value:"no",Title:s("Don't overwrite existing data")},{value:"zero",Title:s("Overwrite existing data with zeros")}]},{SelectOne:"type",Title:s("Type"),Options:[{value:"xfs",Title:s("XFS - Red Hat Enterprise Linux 7 default")},{value:"ext4",Title:s("ext4 - Red Hat Enterprise Linux 6 default")},{value:"luks+xfs",Title:s("Encrypted XFS (LUKS)")},{value:"luks+ext4",Title:s("Encrypted EXT4 (LUKS)")},{value:"vfat",Title:s("VFAT - Compatible with all systems and devices")},{value:"ntfs",Title:s("NTFS - Compatible with most systems")},{value:"dos-extended",Title:s("Extended Partition"),disabled:!(p&&l)},{value:"empty",Title:s("No Filesystem")},{value:"custom",Title:s("Custom (Enter filesystem type)")}]},{TextInput:"name",Title:s("Name"),visible:m},{TextInput:"custom",Title:s("Filesystem type"),visible:function(e){return e.type=="custom"}},{PassInput:"passphrase",Title:s("Passphrase"),validate:function(e){if(e==="")return s("Passphrase can not be empty")},visible:f},{PassInput:"passphrase2",Title:s("Confirm passphrase"),validate:function(e,t){if(e!=t.passphrase)return s("Passphrases do not match")},visible:f},{CheckBox:"store_passphrase",Title:s("Store passphrase"),visible:f},{TextInput:"crypto_options",Title:s("Encryption Options"),visible:f},{SelectOne:"mounting",Title:s("Mounting"),Options:[{value:"default",Title:s("Default")},{value:"custom",Title:s("Custom")}],visible:m},{TextInput:"mount_point",Title:s("Mount Point"),visible:function(e){return m(e)&&e.mounting=="custom"}},{TextInput:"mount_options",Title:s("Mount Options"),visible:function(e){return m(e)&&e.mounting=="custom"}}],Action:{Title:p?s("Create partition"):s("Format"),Danger:p?null:s("Formatting a storage device will erase all data on it."),action:function(e){if(e.type=="custom")e.type=e.custom;var t={"no-block":{t:"b",v:true},"tear-down":{t:"b",v:true}};if(e.erase!="no")t.erase={t:"s",v:e.erase};if(e.name)t.label={t:"s",v:e.name};var a=[];if(e.mounting=="custom")a.push(["fstab",{dir:{t:"ay",v:r.encode_filename(e.mount_point)},type:{t:"ay",v:r.encode_filename("auto")},opts:{t:"ay",v:r.encode_filename(e.mount_options||"defaults")},freq:{t:"i",v:0},passno:{t:"i",v:0},"track-parents":{t:"b",v:true}}]);if(f(e)){e.type=e.type.replace("luks+","");t["encrypt.passphrase"]={t:"s",v:e.passphrase};var n={options:{t:"ay",v:r.encode_filename(e.crypto_options)},"track-parents":{t:"b",v:true}};if(e.store_passphrase){n["passphrase-contents"]={t:"ay",v:r.encode_filename(e.passphrase)}}else{n["passphrase-contents"]={t:"ay",v:r.encode_filename("")}}a.push(["crypttab",n])}if(a.length>0)t["config-items"]={t:"a(sa{sv})",v:a};if(p){if(e.type=="dos-extended")return u.CreatePartition(i,e.size,"0x05","",{});else if(e.type=="empty")return u.CreatePartition(i,e.size,"","",{});else return u.CreatePartitionAndFormat(i,e.size,"","",{},e.type,t)}else return c.Format(e.type,t)}}})}var g={format_disk:function O(e){var i=n.blocks[e];o.open({Title:t.format(s("Format Disk $0"),r.block_name(i)),Alerts:v(e),Fields:[{SelectOne:"erase",Title:s("Erase"),Options:[{value:"no",Title:s("Don't overwrite existing data")},{value:"zero",Title:s("Overwrite existing data with zeros")}]},{SelectOne:"type",Title:s("Partitioning"),Options:[{value:"dos",Title:s("Compatible with all systems and devices (MBR)")},{value:"gpt",Title:s("Compatible with modern system and hard disks > 2TB (GPT)"),selected:true},{value:"empty",Title:s("No partitioning")}]}],Action:{Title:s("Format"),Danger:s("Formatting a disk will erase all data on it."),action:function(e){var t={"no-block":{t:"b",v:true},"tear-down":{t:"b",v:true}};if(e.erase!="no")t.erase={t:"s",v:e.erase};return i.Format(e.type,t)}}})},create_partition:function U(e,t,i,a){_(e,t,i,a)},mount:function B(e){return n.blocks_fsys[e].Mount({})},unmount:function G(e){return n.blocks_fsys[e].Unmount({})},fsys_options:function j(t){var i=n.blocks[t];var a=n.blocks_fsys[t];var l=null;var c,u;if(!i||!a)return;l=r.array_find(i.Configuration,function(e){return e[0]=="fstab"});if(l){c=r.decode_filename(l[1].dir.v);u=r.decode_filename(l[1].opts.v).split(",").filter(function(e){return e.indexOf("x-parent")!==0}).join(",")}function p(e){if(e!=i.IdLabel)return a.SetLabel(e,{})}function d(e,t,a){var n=null;if(e){n=["fstab",{dir:{t:"ay",v:r.encode_filename(t)},type:{t:"ay",v:r.encode_filename("auto")},opts:{t:"ay",v:r.encode_filename(a||"defaults")},freq:{t:"i",v:0},passno:{t:"i",v:0},"track-parents":{t:"b",v:true}}]}if(!l&&n)return i.AddConfigurationItem(n,{});else if(l&&!n)return i.RemoveConfigurationItem(l,{});else if(l&&n&&(t!=c||a!=u))return i.UpdateConfigurationItem(l,n,{})}o.open({Title:s("Filesystem Options"),Fields:[{TextInput:"name",Title:s("Name"),Value:i.IdLabel},{SelectOne:"mounting",Title:s("Mounting"),Options:[{value:"default",Title:s("Default"),selected:!l},{value:"custom",Title:s("Custom"),selected:!!l}]},{TextInput:"mount_point",Title:s("Mount Point"),Value:c,visible:function(e){return e.mounting=="custom"}},{TextInput:"mount_options",Title:s("Mount Options"),Value:u,visible:function(e){return e.mounting=="custom"}}],Action:{Title:s("Apply"),action:function(t){return e.when(p(t.name),d(t.mounting=="custom",t.mount_point,t.mount_options))}}})},lock:function X(e){return n.blocks_crypto[e].Lock({})},unlock:function q(e){var t=n.blocks_crypto[e];if(!t)return;o.open({Title:s("Unlock"),Fields:[{PassInput:"passphrase",Title:s("Passphrase")}],Action:{Title:s("Unlock"),action:function(e){return t.Unlock(e.passphrase,{})}}})},crypto_options:function Y(e){var t=n.blocks[e];var i=null;var a,l;if(!t)return;t.GetSecretConfiguration({}).done(function(e){i=r.array_find(e,function(e){return e[0]=="crypttab"});if(i){if(i[1]["passphrase-contents"])a=r.decode_filename(i[1]["passphrase-contents"].v);l=r.decode_filename(i[1].options.v).split(",").filter(function(e){return e.indexOf("x-parent")!==0}).join(",")}function n(e,n){if(e!=a||n!=l){var o=["crypttab",{options:{t:"ay",v:r.encode_filename(n)},"track-parents":{t:"b",v:true},"passphrase-contents":{t:"ay",v:r.encode_filename(e)}}];if(i)return t.UpdateConfigurationItem(i,o,{});else return t.AddConfigurationItem(o,{})}}o.open({Title:s("Encryption Options"),Fields:[{PassInput:"passphrase",Title:s("Stored Passphrase"),Value:a},{TextInput:"options",Title:s("Options"),Value:l}],Action:{Title:s("Apply"),action:function(e){return n(e.passphrase,e.options)}}})})},mdraid_start:function K(e){return n.mdraids[e].Start({"start-degraded":{t:"b",v:true}})},mdraid_stop:function H(e){return n.mdraids[e].Stop({})},mdraid_start_scrub:function J(e){return n.mdraids[e].RequestSyncAction("repair",{})},mdraid_stop_scrub:function W(e){return n.mdraids[e].RequestSyncAction("idle",{})},mdraid_toggle_bitmap:function Q(e){var t=r.decode_filename(n.mdraids[e].BitmapLocation);return n.mdraids[e].SetBitmapLocation(r.encode_filename(t=="none"?"internal":"none"),{})},mdraid_add_disk:function Z(t){var i=n.mdraids[t];o.open({Title:s("Add Disks"),Fields:[{SelectMany:"disks",Title:s("Disks"),Options:r.get_free_blockdevs(n).filter(function(e){if(n.blocks_part[e.path])e=n.blocks[n.blocks_part[e.path].PartitionTable];return e&&n.blocks[e.path].MDRaid!=t}).map(function(e){return{value:e.path,Title:e.Name+" "+e.Description}}),validate:function(e){if(e.length===0)return s("At least one disk is needed.")}}],Action:{Title:s("Add"),action:function(t){return e.when.apply(null,t.disks.map(function(e){return i.AddDevice(e,{})}))}}})},mdraid_remove_disk:function ee(e){var t=n.blocks[e];var i=n.mdraids[t.MDRaidMember];return i.RemoveDevice(e,{wipe:{t:"b",v:true}})},mdraid_delete:function te(e){var i=t.location;var a=n.mdraids[e];if(!a)return;var l=n.mdraids_block[e];o.open({Title:t.format(s("Please confirm deletion of $0"),r.mdraid_name(a)),Alerts:l&&v(l.path),Fields:[],Action:{Title:s("Delete"),Danger:s("Deleting a RAID device will erase all data on it."),action:function(t){return n.mdraids[e].Delete({"tear-down":{t:"b",v:true}}).done(function(){i.go("/")})}}})},resize:function ie(e){var t=n.lvols[e];if(!t)return;var i=n.lvols_block[e];o.open({Title:s("Resize Logical Volume"),Fields:[{SizeInput:"size",Title:s("Size"),Value:t.Size,Max:"XXX"},{CheckBox:"fsys",Title:s("Resize Filesystem"),Value:i&&i.IdUsage=="filesystem",visible:function(){return t.Type=="block"}}],Action:{Title:s("Resize"),action:function(e){var i={};if(e.fsys!==undefined)i.resize_fsys={t:"b",v:e.fsys};return t.Resize(e.size,i)}}})},rename:function ae(e){var t=n.lvols[e];if(!t)return;o.open({Title:s("Renamee Logical Volume"),Fields:[{TextInput:"name",Title:s("Name"),Value:t.Name}],Action:{Title:s("Rename"),action:function(e){return t.Rename(e.name,{})}}})},create_snapshot:function ne(e){var t=n.lvols[e];if(!t)return;o.open({Title:s("Create Snapshot"),Fields:[{TextInput:"name",Title:s("Name"),validate:r.validate_lvm2_name},{SizeInput:"size",Title:s("Size"),Max:"XXX",visible:function(){return t.ThinPool=="/"}}],Action:{Title:s("Create"),action:function(e){return t.CreateSnapshot(e.name,e.size||0,{})}}})},activate:function re(e){if(n.lvols[e])return n.lvols[e].Activate({})},deactivate:function oe(e){if(n.lvols[e])return n.lvols[e].Deactivate({})},create_thin:function le(e){var t=n.lvols[e];var i=t&&n.vgroups[t.VolumeGroup];if(!t||!i)return;o.open({Title:s("Create Thin Volume"),Fields:[{TextInput:"name",Title:s("Name"),validate:r.validate_lvm2_name},{SizeInput:"size",Title:s("Size"),Max:undefined}],Action:{Title:s("Create"),action:function(e){return i.CreateThinVolume(e.name,e.size,t.path,{})}}})},vgroup_rename:function se(e){var i=t.location;var a=n.vgroups[e];if(!a)return;o.open({Title:s("Rename Volume Group"),Fields:[{TextInput:"name",Title:s("Name"),Value:a.Name,validate:r.validate_lvm2_name}],Action:{Title:s("Create"),action:function(e){return a.Rename(e.name,{}).done(function(){i.go(["vg",e.name])})}}})},vgroup_delete:function ce(e){var i=t.location;var a=n.vgroups[e];if(!a)return;o.open({Title:t.format(s("Please confirm deletion of $0"),a.Name),Alerts:v(e),Fields:[],Action:{Danger:s("Deleting a volume group will erase all data on it."),Title:s("Delete"),action:function(){return a.Delete(true,{"tear-down":{t:"b",v:true}}).done(function(){i.go("/")})}}})},vgroup_create_plain:function ue(e){var t=n.vgroups[e];if(!t)return;o.open({Title:s("Create Plain Volume"),Fields:[{TextInput:"name",Title:s("Name"),validate:r.validate_lvm2_name},{SizeInput:"size",Title:s("Size"),Max:t.FreeSize}],Action:{Title:s("Create"),action:function(e){return t.CreatePlainVolume(e.name,e.size,{})}}})},vgroup_create_raid:function pe(t){e("#error-popup-title").text(s("Sorry"));e("#error-popup-message").text("Not yet.");e("#error-popup").modal("show")},vgroup_create_thinpool:function de(e){var t=n.vgroups[e];if(!t)return;o.open({Title:s("Create Pool for Thin Logical Volumes"),Fields:[{TextInput:"name",Title:s("Name"),validate:r.validate_lvm2_name},{SizeInput:"size",Title:s("Size"),Max:t.FreeSize}],Action:{Title:s("Create"),action:function(e){return t.CreateThinPoolVolume(e.name,e.size,{})}}})},vgroup_add_disk:function fe(t){var i=n.vgroups[t];if(!i)return;o.open({Title:s("Add Disks"),Fields:[{SelectMany:"disks",Title:s("Disks"),Options:r.get_free_blockdevs(n).filter(function(e){if(n.blocks_part[e.path])e=n.blocks[n.blocks_part[e.path].PartitionTable];var i=e&&n.blocks_lvm2[e.path]&&n.lvols[n.blocks_lvm2[e.path].LogicalVolume];return!i||i.VolumeGroup!=t}).map(function(e){return{value:e.path,Title:e.Name+" "+e.Description}}),validate:function(e){if(e.length===0)return s("At least one disk is needed.")}}],Action:{Title:s("Add"),action:function(t){return e.when.apply(null,t.disks.map(function(e){return i.AddDevice(e,{})}))}}})},pvol_empty:function me(e){var t=n.blocks_pvol[e];var i=t&&n.vgroups[t.VolumeGroup];if(!i)return;return i.EmptyDevice(e,{})},pvol_remove:function ve(e){var t=n.blocks_pvol[e];var i=t&&n.vgroups[t.VolumeGroup];if(!i)return;return i.RemoveDevice(e,true,{})},format:function _e(e){if(n.blocks[e])_(e);else if(n.lvols_block[e])_(n.lvols_block[e].path)},"delete":function ge(e){var i,a,l;i=n.blocks[e];if(i){a=n.blocks_part[e];l=n.blocks_lvm2[e]&&n.lvols[n.blocks_lvm2[e].LogicalVolume]}else{l=n.lvols[e]}var c,u;if(l){c=r.lvol_name(l);u=s("Deleting a logical volume will delete all data in it.")}else if(a){c=r.block_name(i);u=s("Deleting a partition will delete all data in it.")}if(c){o.open({Title:t.format(s("Please confirm deletion of $0"),c),Alerts:v(e),Fields:[],Action:{Danger:u,Title:s("Delete"),action:function(){if(l)return l.Delete({"tear-down":{t:"b",v:true}});else if(a)return a.Delete({"tear-down":{t:"b",v:true}})}}})}},job_cancel:function be(e){var t=n.storaged_jobs[e]||n.udisks_jobs[e];if(t)return t.Cancel({})}};e("#storage-detail").on("click","[data-action]",function(){var t=e(this).attr("data-action");var i=[];if(e(this).attr("data-args"))i=JSON.parse(e(this).attr("data-args"));else if(e(this).attr("data-arg"))i=[e(this).attr("data-arg")];var a=g[t].apply(this,i);if(a)a.fail(function(t){e("#error-popup-title").text(s("Error"));e("#error-popup-message").text(t.toString());e("#error-popup").modal("show")})});function b(e,t,a){return i.render('<button class="btn btn-default storage-privileged" data-action="{{Action}}" data-args="{{Args}}">{{Title}}</button>',{Title:e,Action:t,Args:JSON.stringify(a)})}var h=e("#action-btn-tmpl").html();i.parse(h);function T(e,t,a){var r=e.iface=="org.storaged.Storaged.Block"?e:null;var o=r&&n.blocks_fsys[r.path];var l=r&&n.blocks_lvm2[r.path];var c=e.iface=="org.storaged.Storaged.LogicalVolume"?e:null;var u=r&&r.IdUsage=="filesystem";var p=o&&o.MountPoints.length>0;var d=r&&r.IdUsage=="crypto";var f=c||l&&l.LogicalVolume!="/";var m=c&&c.Type=="pool";var v=r||c&&c.Active;var _=r&&!r.ReadOnly;var g;if(c)g=c.path;else if(l)g=l.LogicalVolume;var b=[{title:s("Mount"),action:"mount",disabled:p},{title:s("Unmount"),action:"unmount",disabled:!p},{title:s("Filesystem Options"),action:"fsys_options"}];var T=[{title:s("Lock"),action:"lock",disabled:t},{title:s("Unlock"),action:"unlock",disabled:!t},{title:s("Encryption Options"),action:"crypto_options"}];var y=[{title:s("Resize"),action:"resize",arg:g},{title:s("Rename"),action:"rename",arg:g}];var k=[{title:s("Create Snapshot"),action:"create_snapshot",arg:g},{title:s("Activate"),action:"activate",disabled:v,arg:g},{title:s("Deactivate"),action:"deactivate",disabled:!v,arg:g}];var S=[{title:s("Create Thin Volume"),action:"create_thin",arg:g}];var z=[{title:s("Format"),action:"format"}];var D=[{title:s("Delete"),action:"delete"}];var x=null;var I=[];if(u){I=I.concat(b);if(p)x=b[1];else x=b[0]}else if(d){I=I.concat(T);if(t)x=T[1];else x=T[0]}if(_){I=I.concat(z);if(!x)x=z[0]}if(f){I=I.concat(y);if(m){I=I.concat(S);x=S[0]}else{I=I.concat(k);if(!x){if(v)x=k[2];else x=k[1]}}}if(a||f){I=I.concat(D);if(!x)x=D[0]}return i.render(h,{arg:e.path,def:x,actions:I})}function y(i,a,o){var l,u,p;var d=n.blocks_pvol[i.path];var f=n.blocks_lvm2[i.path];if(i.IdUsage=="filesystem"){l=e("<span>").text(t.format(c("storage-id-desc","$0 File System"),i.IdType))}else if(i.IdUsage=="raid"){if(i.IdType=="linux_raid_member"){l=e("<span>").text(c("storage-id-desc","Linux MD-RAID Component"))}else if(i.IdType=="LVM2_member"){l=e("<span>").text(c("storage-id-desc","LVM2 Physical Volume"))}else{l=e("<span>").text(c("storage-id-desc","RAID Member"))}if(d&&n.vgroups[d.VolumeGroup]){var m=n.vgroups[d.VolumeGroup];l.append(" of ",e("<a>",{"data-goto-vgroup":m.Name}).text(m.Name))}else if(n.mdraids[i.MDRaidMember]){var v=n.mdraids[i.MDRaidMember];l.append(" of ",e("<a>",{"data-goto-mdraid":v.UUID}).text(r.mdraid_name(v)))}}else if(i.IdUsage=="crypto"){if(i.IdType=="crypto_LUKS"){l=e("<span>").text(c("storage-id-desc","LUKS Encrypted"))}else{l=e("<span>").text(c("storage-id-desc","Encrypted"))}}else if(i.IdUsage=="other"){if(i.IdType=="swap"){l=e("<span>").text(c("storage-id-desc","Swap Space"))}else{l=e("<span>").text(c("storage-id-desc","Other Data"))}}else{l=e("<span>").text(c("storage-id-desc","Unrecognized Data"))}if(a){u=e("<span>").append(t.format(s("$size $partition"),{size:r.fmt_size(i.Size),partition:a})," (",l,")")}else if(f&&n.lvols[f.LogicalVolume]){var _=n.lvols[f.LogicalVolume];u=e("<span>").append(t.format(s("$size $partition"),{size:r.fmt_size(i.Size),partition:r.lvol_name(_)})," (",l,")")}else u=l;p=r.block_name(i);if(i.IdUsage=="filesystem"){var g=n.blocks_fsys[i.path];p+=", ";if(g&&g.MountPoints.length>0)p+=t.format(s("mounted on $0"),r.decode_filename(g.MountPoints[0]));else p+=s("not mounted")}else if(i.IdUsage=="crypto"){p+=", ";if(o)p+=s("unlocked");else p+=s("locked")}return e("<div>").append(e("<div>").html(u),e("<div>").text(p)).html()}var k=e("#content-tmpl").html();i.parse(k);var S=[];function z(e,t,i,a,n){S.push({LevelWidth:30*e,Name:t,Description:i,Button:a,job_object:n})}function D(e,t,i){var a,r,o,l;var s;if(t.IdUsage=="crypto")s=n.blocks_cleartext[t.path];l=T(t,!s,!!i);if(t.IdLabel.length>0)r=t.IdLabel;else if(!l)r=null;else r="—";o=y(t,i,s);z(e,r,o,l,t.path);if(s)I(e+1,s)}function x(e,i){var a=n.blocks_ptable[i.path];var o=e;var l=a.Type=="dos";var c=n.blocks_partitions[i.path];function u(e,a,n){var c;var u=(Math.floor(a/(1024*1024))+1)*1024*1024;var p=false;if(a+n-u>=1024*1024){if(l){if(e>o){c=t.format(s("$0 Free Space for Logical Partitions"),r.fmt_size(n))}else{c=t.format(s("$0 Free Space for Primary Partitions"),r.fmt_size(n));p=true}}else{c=t.format(s("$0 Free Space"),r.fmt_size(n))}z(e,null,c,b(s("Create Partition"),"create_partition",[i.path,a,n,p]),null)}}function p(e,i,a,n){var o=t.format(s("$0 Extended Partition"),r.fmt_size(n));var l=T(i,false,true);z(e,null,o,l,i.path);d(e+1,a,n)}function d(e,t,i){var a;var r=t;var d=t+i;var f,m,v,_,g,b;for(a=0;a<c.length;a++){f=n.blocks[c[a].path];m=c[a].Offset;v=c[a].Size;_=c[a].Type;g=c[a].IsContainer;if(f===null)continue;if(e===o&&_=="l")continue;if(e==o+1&&_!="l")continue;if(m<t||m+v>t+i)continue;u(e,r,m-r);if(g)p(e,f,m,v);else{if(l){if(e>o)b=s("Logical Partition");else b=s("Primary Partition")}else b=s("Partition");D(e,f,b)}r=m+v}u(e,r,d-r)}d(o,0,i.Size)}function I(e,t){if(n.blocks_ptable[t.path])x(e,t);else D(e,t,null)}function A(e,t){S=[];I(t||0,e);return S}var C=e("#block-detail-tmpl").html();i.parse(C);function M(){e("#storage-detail .breadcrumb .active").text(d);var t=n.slashdevs_block[d];if(!t)return;var a={dbus:t,Name:r.block_name(t),Size:r.fmt_size_long(t.Size)};var o=n.drives[t.Drive];var l=n.drives_ata[t.Drive];var c=null;if(l){c={Failing:n.drives_ata.SmartFailing,Temperature:l.SmartTemperature>0&&r.format_temperature(l.SmartTemperature)}}var u=null;var p=t;if(o){var m=n.drives_block[o.path];var v=n.drives_multipath_blocks[o.path];var _=null;if(v.length>0){_={Devices:v.map(r.block_name)}}u={dbus:o,Size:o.Size>0&&r.fmt_size_long(o.Size),Assessment:c,Device:m&&r.block_name(m),Multipath:_,MultipathActive:f.state=="running"};p=m}return i.render(C,{Block:a,Drive:u,Content:p&&i.render(k,{Title:s("Content"),path:p.path,Entries:A(p)})})}var R=e("#mdraid-detail-tmpl").html();i.parse(R);function P(){var e=n.uuids_mdraid[d];if(!e)return;var a=n.mdraids_block[e.path];function o(e){return{raid0:s("RAID 0"),raid1:s("RAID 1"),raid4:s("RAID 4"),raid5:s("RAID 5"),raid6:s("RAID 6"),raid10:s("RAID 10")}[e]||t.format(s("RAID ($0)"),e)}var l=o(e.Level);if(e.NumDevices>0)l+=", "+t.format(s("$0 Disks"),e.NumDevices);if(e.ChunkSize>0)l+=", "+t.format(s("$0 Chunk Size"),r.fmt_size(e.ChunkSize));var c=null;if(e.BitmapLocation)c={Value:r.decode_filename(e.BitmapLocation)!="none"};var u=null;if(e.SyncAction){var p={idle:"",check:s("Data Scrubbing"),repair:s("Data Scrubbing and Repair"),resync:s("Resyncing"),recover:s("Recovering "),frozen:s("Frozen")}[e.SyncAction]||e.SyncAction;var f=null;if(p&&p!="idle"){var m=Math.round(e.SyncCompleted*100).toString();if(e.SyncRate>0){f=t.format(s("$action, ${percent}% complete at $rate"),{action:p,percent:m,rate:r.fmt_rate(e.SyncRate)})}else{f=t.format(s("$action, ${percent}% complete"),{action:p,percent:m})}if(e.SyncRemainingTime>0){f+=t.format(s(", $0 remaining"),r.format_delay(e.SyncRemainingTime/1e3))}}u={Name:d,Progress:f}}var v={dbus:e,Name:r.mdraid_name(e),Size:r.fmt_size_long(e.Size),Level:l,Bitmap:c,Degraded:e.Degraded>0&&t.format(s("$0 disks are missing"),e.Degraded),State:e.Running?s("Running"):s("Not running"),SyncAction:u};var _=null;if(a){_={dbus:a,Device:r.decode_filename(a.PreferredDevice)}}function g(i){var a=r.array_find(e.ActiveDevices,function(e){return e[0]==i.path});function o(e){return{Description:{faulty:s("FAILED"),in_sync:s("In Sync"),spare:a[1]<0?s("Spare"):s("Recovering"),write_mostly:s("Write-mostly"),blocked:s("Blocked")}[e]||t.format(s("Unknown ($0)"),e),Danger:e=="faulty"}}return{path:i.path,LinkTarget:r.get_block_link_target(n,i.path),Description:r.decode_filename(i.PreferredDevice),Slot:a&&a[1]>=0&&a[1].toString(),States:a&&a[2].map(o)}}var b=[{title:s("Start"),action:"mdraid_start"},{title:s("Stop"),action:"mdraid_stop"},{title:s("Start Scrubbing"),action:"mdraid_start_scrub"},{title:s("Stop Scrubbing"),action:"mdraid_stop_scrub"},{title:s("Delete"),action:"mdraid_delete"}];var T;if(e.Running)T=b[1];else T=b[0];return i.render(R,{MDRaid:v,MDRaidButton:i.render(h,{arg:e.path,def:T,actions:b}),Block:_,Members:n.mdraids_members[e.path].map(g),DynamicMembers:e.Level!="raid0",Content:a&&i.render(k,{Title:s("Content"),path:a.path,Entries:A(a)})})}function F(a,o){function l(i,a,o){var l,c;if(n.blocks_ptable[a.path]){c=t.format(s("$size $desc"),{desc:o.Name,size:r.fmt_size(a.Size)});c+="<br/>"+e("<span>").text(r.decode_filename(a.PreferredDevice));l=T(a,false,false);z(i,null,c,l,a.path);x(i+1,a)}else D(i,a,null)}function c(e,i){var a,o,u,p;if(i.Type=="pool"){u=Math.max(i.DataAllocatedRatio,i.MetadataAllocatedRatio);o=t.format(s("$size $desc<br/>${percent}% full"),{size:r.fmt_size(i.Size),desc:r.lvol_name(i),percent:(u*100).toFixed(0)});a=T(i,false,false);z(e,null,o,a);n.lvols_pool_members[i.path].forEach(function(t){c(e+1,t)})}else{p=n.lvols_block[i.path];if(p)l(e,p,i);else{o=t.format(s("$size $desc<br/>($state)"),{size:r.fmt_size(i.Size),desc:r.lvol_name(i),state:i.Active?s("active, but unsupported"):s("inactive")});a=T(i,false,false);z(e,null,o,a,null)}}}S=[];o=o||0;n.vgroups_lvols[a.path].forEach(function(e){if(e.ThinPool=="/")c(o,e)});if(a.FreeSize>0){var u,p,d;d=t.format(s("$0 Free Space for Logical Volumes"),r.fmt_size(a.FreeSize));p=[{title:s("Create Plain Logical Volume"),action:"vgroup_create_plain"},{title:s("Create RAID Logical Volume"),action:"vgroup_create_raid"},{title:s("Create Pool for Thin Logical Volumes"),action:"vgroup_create_thinpool"}];u=i.render(h,{arg:a.path,def:p[0],actions:p});z(o,null,d,u,null)}return S}var V=e("#vgroup-detail-tmpl").html();i.parse(V);var L;function $(){var e=n.vgnames_vgroup[d];if(!e)return;if(e.NeedsPolling&&L===null){L=window.setInterval(function(){e.Poll()},2e3)}else if(!e.NeedsPolling&&L!==null){window.clearInterval(L);L=null}var a={dbus:e,Size:r.fmt_size_long(e.Size)};function o(e){var a=n.blocks[e.path];var o=[{action:"pvol_remove",title:s("Remove")},{action:"pvol_empty",title:s("Empty")}];return{dbus:a,LinkTarget:r.get_block_link_target(n,e.path),Device:r.decode_filename(a.PreferredDevice),Sizes:t.format(s("$0, $1 free"),r.fmt_size(e.Size),r.fmt_size(e.FreeSize)),Button:i.render(h,{arg:e.path,def:o[0],actions:o})}}var l=[{action:"vgroup_rename",title:s("Rename")},{action:"vgroup_delete",title:s("Delete")}];return i.render(V,{VGroup:a,VGroupButton:i.render(h,{arg:e.path,def:l[0],actions:l}),PVols:n.vgroups_pvols[e.path].map(o),Content:i.render(k,{Title:s("Logical Volumes"),Entries:F(e)})})}function w(){e("#storage-detail .breadcrumb .active").text(d);var t;if(p=="block")t=M();else if(p=="mdraid")t=P();else if(p=="vgroup")t=$();if(t)e("#detail").amend(t);else e("#detail").text(s("Not found"));u.update("#storage-detail");e("#detail-jobs").amend(u.render());l.update()}e(f).on("changed",w);e(n).on("changed",w);e("#storage-detail-log").append(a.logbox(["_SYSTEMD_UNIT=storaged.service","+","_SYSTEMD_UNIT=udisks2.service","+","_SYSTEMD_UNIT=dm-event.service","+","_SYSTEMD_UNIT=smartd.service","+","_SYSTEMD_UNIT=multipathd.service"],10));e("#storage-detail .breadcrumb a").on("click",function(){t.location.go("/")});function N(){d=null;e("#storage-detail").hide()}function E(t,i){if(L!==null){window.clearInterval(L);L=null}p=t;d=i;w();e("#storage-detail").show()}return{show:E,hide:N}}return{init:u}});

//# sourceURL=storage/details.min.js

define("storage/devices", ["jquery","base1/cockpit","storage/client","storage/jobs","storage/overview","storage/details","storage/utils","translated!base1/po"],function(t,o,a,e,i,n,r,l){o.locale(l);var s=o.gettext;var c=o.gettext;function d(){var l;var c;var d;t("body").on("click","[data-goto-block]",function(){o.location.go([t(this).attr("data-goto-block")])});t("body").on("click","[data-goto-mdraid]",function(){o.location.go(["mdraid",t(this).attr("data-goto-mdraid")])});t("body").on("click","[data-goto-vgroup]",function(){o.location.go(["vg",t(this).attr("data-goto-vgroup")])});function g(){var a=o.location.path;if(a.length===0){d.hide();c.show()}else if(a.length==1){c.hide();d.show("block",a[0])}else if(a.length==2&&a[0]=="mdraid"){c.hide();d.show("mdraid",a[1])}else if(a.length==2&&a[0]=="vg"){c.hide();d.show("vgroup",a[1])}else{console.warn("not a init location: "+a);o.location=""}t("body").show()}a.init(function(){o.translate();if(a.features===false){t("#unsupported").show();t("body").show()}else{l=e.init(a);c=i.init(a,l);d=n.init(a,l);t(o).on("locationchanged",g);g()}});var u=r.get_multipathd_service();function h(){var o=!u.state||u.state==="running";var e=a.broken_multipath_present===true;t("#multipath-broken").toggle(e&&!o)}t(u).on("changed",h);t(a).on("changed",h);h();t("#activate-multipath").on("click",function(){o.spawn(["mpathconf","--enable","--with_multipathd","y"],{superuser:"try"}).fail(function(o){t("#error-popup-title").text(s("Error"));t("#error-popup-message").text(o.toString());t("#error-popup").modal("show")})})}return d});

//# sourceURL=storage/devices.min.js

define("storage/dialog", ["jquery","base1/mustache","base1/patterns"],function(e,n){var i;function a(){i=e("#storage-dialog-tmpl").html();n.parse(i)}function t(a){a.Fields.forEach(function(e){if(e.SizeInput&&e.Value)e.ValueMB=(e.Value/(1024*1024)).toFixed(0)});var t=e(n.render(i,a));e("body").append(t);t.find(".selectpicker").selectpicker();var l={};function r(){t.dialog("failure",null)}function o(e){return e.TextInput||e.PassInput||e.SelectOne||e.SelectMany||e.SizeInput||e.CheckBox}function f(){var e={};a.Fields.forEach(function(n){var i=o(n);var a=t.find('[data-field="'+i+'"]');if(n.TextInput)e[i]=a.val();else if(n.PassInput)e[i]=a.val();else if(n.SelectOne)e[i]=a.val();else if(n.SizeInput)e[i]=parseInt(a.val())*1024*1024;else if(n.CheckBox)e[i]=a.prop("checked");else if(n.SelectMany){e[i]=[];a.find("input").each(function(a,t){if(t.checked)e[i].push(n.Options[a].value)})}});return e}function u(){var e=f();a.Fields.forEach(function(n){if(n.visible){var i=o(n);l[i]=!n.visible(e);t.find('[data-field="'+i+'"]').parents("tr").toggle(!l[i])}})}function c(){var e=f();var n=[];a.Fields.forEach(function(i){var a=o(i);if(l[a])e[a]=undefined;else{if(i.validate){var t=i.validate(e[a],e);if(t){var r=new Error(t);r.target='[data-field="'+a+'"]';n.push(r)}}}});t.dialog("failure",n);return n.length===0?e:null}t.on("change input",function(){r();u()});t.on("hidden.bs.modal",function(){t.remove()});t.find('button[data-action="apply"]').on("click",function(){var e=c();if(e!==null){var n=a.Action.action(e);t.dialog("promise",n)}});u();t.modal("show")}e(a);return{open:t}});

//# sourceURL=storage/dialog.min.js

define("storage/client", ["jquery","base1/cockpit","storage/utils"],function(o,e,r){var s={};function l(r){var s;var l={data:{},close:n};function a(o){l.data={};s=[];for(var e=0;e<o.metrics.length;e++){s[e]=o.metrics[e].instances;for(var r=0;r<s[e].length;r++)l.data[s[e][r]]=[]}}function t(e){var r=false;for(var a=0;a<e.length;a++){var t=e[a];for(var i=0;i<t.length;i++){var n=t[i];for(var d=0;d<n.length;d++){if(n[d]!==null){r=true;l.data[s[i][d]][i]=n[d]}}}}if(r)o(l).triggerHandler("changed")}var i=e.channel({payload:"metrics1",source:"internal",metrics:r});o(i).on("closed",function(o,e){console.log("closed",e)});o(i).on("message",function(o,e){var r=JSON.parse(e);if(r.length)t(r);else a(r)});function n(){i.close()}return l}s.time_offset=undefined;s.storaged_features=undefined;s.storaged_client=e.dbus("org.storaged.Storaged");function a(o,e){return s.storaged_client.proxy(o,e,{watch:true})}function t(o){return s.storaged_client.proxies(o,"/org/storaged/Storaged",{watch:false})}s.storaged_client.watch({path_namespace:"/org/storaged/Storaged"});s.manager=a("org.storaged.Storaged.Manager","/org/storaged/Storaged/Manager");s.manager_lvm2=a("org.storaged.Storaged.Manager.LVM2","/org/storaged/Storaged/Manager");s.mdraids=t("org.storaged.Storaged.MDRaid");s.vgroups=t("org.storaged.Storaged.VolumeGroup");s.lvols=t("org.storaged.Storaged.LogicalVolume");s.drives=t("org.storaged.Storaged.Drive");s.drives_ata=t("org.storaged.Storaged.Drive.Ata");s.blocks=t("org.storaged.Storaged.Block");s.blocks_ptable=t("org.storaged.Storaged.PartitionTable");s.blocks_part=t("org.storaged.Storaged.Partition");s.blocks_lvm2=t("org.storaged.Storaged.Block.LVM2");s.blocks_pvol=t("org.storaged.Storaged.PhysicalVolume");s.blocks_fsys=t("org.storaged.Storaged.Filesystem");s.blocks_crypto=t("org.storaged.Storaged.Encrypted");s.storaged_jobs=t("org.storaged.Storaged.Job");s.udisks_client=e.dbus("org.freedesktop.UDisks2");s.udisks_jobs=s.udisks_client.proxies("org.freedesktop.UDisks2.Job","/org/freedesktop/UDisks2");s.fsys_sizes=l([{name:"mount.used"},{name:"mount.total"}]);s.blockdev_io=l([{name:"block.device.read",derive:"rate"},{name:"block.device.written",derive:"rate"}]);function i(o){if(o.Symlinks&&o.Symlinks.length){for(var e=0;e<o.Symlinks.length;e++)if(r.decode_filename(o.Symlinks[e]).indexOf("/dev/disk/by-id/dm-uuid-mpath-")===0)return true}return false}function n(){var o,e,l,a,t,n,d,c,g;s.broken_multipath_present=false;s.drives_multipath_blocks={};s.drives_block={};for(o in s.drives){s.drives_multipath_blocks[o]=[]}for(o in s.blocks){e=s.blocks[o];if(!s.blocks_part[o]&&s.drives_multipath_blocks[e.Drive]!==undefined){if(i(e))s.drives_block[e.Drive]=e;else s.drives_multipath_blocks[e.Drive].push(e)}}for(o in s.drives_multipath_blocks){if(!s.drives_block[o]&&s.drives_multipath_blocks[o].length==1){s.drives_block[o]=s.drives_multipath_blocks[o][0];s.drives_multipath_blocks[o]=[]}else{s.drives_multipath_blocks[o].sort(r.block_cmp);if(!s.drives_block[o])s.broken_multipath_present=true}}s.mdraids_block={};for(o in s.blocks){e=s.blocks[o];if(e.MDRaid!="/")s.mdraids_block[e.MDRaid]=e}s.mdraids_members={};for(o in s.mdraids){s.mdraids_members[o]=[]}for(o in s.blocks){e=s.blocks[o];if(s.mdraids_members[e.MDRaidMember]!==undefined)s.mdraids_members[e.MDRaidMember].push(e)}for(o in s.mdraids_members){s.mdraids_members[o].sort(r.block_cmp)}s.slashdevs_block={};function u(o,e){s.slashdevs_block[r.decode_filename(e).replace(/^\/dev\//,"")]=o}for(o in s.blocks){e=s.blocks[o];u(e,e.Device);u(e,e.PreferredDevice);for(g=0;g<e.Symlinks.length;g++)u(e,e.Symlinks[g])}s.uuids_mdraid={};for(o in s.mdraids){a=s.mdraids[o];s.uuids_mdraid[a.UUID]=a}s.vgnames_vgroup={};for(o in s.vgroups){t=s.vgroups[o];s.vgnames_vgroup[t.Name]=t}s.vgroups_pvols={};for(o in s.vgroups){s.vgroups_pvols[o]=[]}for(o in s.blocks_pvol){n=s.blocks_pvol[o];if(s.vgroups_pvols[n.VolumeGroup]!==undefined)s.vgroups_pvols[n.VolumeGroup].push(n)}function m(o,e){return r.block_cmp(s.blocks[o.path],s.blocks[e.path])}for(o in s.vgroups_pvols){s.vgroups_pvols[o].sort(m)}s.vgroups_lvols={};for(o in s.vgroups){s.vgroups_lvols[o]=[]}for(o in s.lvols){d=s.lvols[o];if(s.vgroups_lvols[d.VolumeGroup]!==undefined)s.vgroups_lvols[d.VolumeGroup].push(d)}for(o in s.vgroups_lvols){s.vgroups_lvols[o].sort(function(o,e){return o.Name.localeCompare(e.Name)})}s.lvols_block={};for(o in s.blocks_lvm2){s.lvols_block[s.blocks_lvm2[o].LogicalVolume]=s.blocks[o]}s.lvols_pool_members={};for(o in s.lvols){if(s.lvols[o].Type=="pool")s.lvols_pool_members[o]=[]}for(o in s.lvols){d=s.lvols[o];if(s.lvols_pool_members[d.ThinPool]!==undefined)s.lvols_pool_members[d.ThinPool].push(d)}for(o in s.lvols_pool_members){s.lvols_pool_members[o].sort(function(o,e){return o.Name.localeCompare(e.Name)})}s.blocks_cleartext={};for(o in s.blocks){e=s.blocks[o];if(e.CryptoBackingDevice!="/")s.blocks_cleartext[e.CryptoBackingDevice]=e}s.blocks_partitions={};for(o in s.blocks_ptable){s.blocks_partitions[o]=[]}for(o in s.blocks_part){c=s.blocks_part[o];if(s.blocks_partitions[c.Table]!==undefined)s.blocks_partitions[c.Table].push(c)}for(o in s.blocks_partitions){s.blocks_partitions[o].sort(function(o,e){return o.Offset-e.Offset})}}function d(r){function l(o,e){var r=o.pop();if(r){r.wait(function(){l(o,e)})}else e()}l([s.manager,s.mdraids,s.vgroups,s.drives,s.blocks,s.blocks_ptable,s.blocks_lvm2,s.blocks_fsys],function(){if(!s.manager.valid){s.features=false;r()}else{s.features={lvm2:s.manager_lvm2.valid};o(s.manager_lvm2).on("changed",function(){s.features.lvm2=s.manager_lvm2.valid;o(s.features).triggerHandler("changed")});e.spawn(["date","+%s"]).done(function(o){s.time_offset=parseInt(o)*1e3-(new Date).getTime()}).always(function(){s.manager.EnableModules(true).fail(function(o){console.warn("Can't enable storaged modules",o.toString())});o(s.storaged_client).on("notify",function(){n();o(s).triggerHandler("changed")});o(s.udisks_jobs).on("added removed changed",function(){o(s).triggerHandler("changed")});n();r()})}})}s.init=d;return s});

//# sourceURL=storage/client.min.js

define("storage/jobs", ["jquery","base1/cockpit","base1/mustache","system/server","shell/shell","storage/utils"],function(e,t,r,a,o,i){var n=t.gettext;var s=t.gettext;function l(a){l=e("#jobs-tmpl").html();r.parse(l);function o(e){return e.replace("/org/freedesktop/UDisks2/","/org/storaged/Storaged/")}function s(t){var r;e(t).find("[data-job-object]").css("visibility","hidden");function i(e){if(a.blocks_part[e]&&a.blocks[a.blocks_part[e].Table])return a.blocks_part[e].Table;if(a.blocks_crypto[e]&&a.blocks[a.blocks_crypto[e].CryptoBackingDevice])return a.blocks_crypto[e].CryptoBackingDevice;if(a.blocks[e]&&a.drives[a.blocks[e].Drive])return a.blocks[e].Drive;if(a.blocks[e]&&a.mdraids[a.blocks[e].MDRaid])return a.blocks[e].MDRaid;if(a.blocks_lvm2[e]&&a.lvols[a.blocks_lvm2[e].LogicalVolume])return a.blocks_lvm2[e].LogicalVolume;if(a.lvols[e]&&a.vgroups[a.lvols[e].VolumeGroup])return a.lvols[e].VolumeGroup}function n(r){e(t).find('[data-job-object="'+r+'"]').css("visibility","visible")}function s(e){n(e);var t=i(e);if(t)s(t)}function l(e){for(var t=0;t<e.length;t++)s(e[t])}for(r in a.storaged_jobs)l(a.storaged_jobs[r].Objects);for(r in a.udisks_jobs){l(a.udisks_jobs[r].Objects.map(o))}}e(a.storaged_jobs).on("added removed changed",function(){s("body")});e(a.udisks_jobs).on("added removed changed",function(){s("body")});var l;function g(){var e={"ata-smart-selftest":n("SMART self-test of $target"),"drive-eject":n("Ejecting $target"),"encrypted-unlock":n("Unlocking $target"),"encrypted-lock":n("Locking $target"),"encrypted-modify":n("Modifying $target"),"swapspace-start":n("Starting swapspace $target"),"swapspace-stop":n("Stopping swapspace $target"),"filesystem-mount":n("Mounting $target"),"filesystem-unmount":n("Unmounting $target"),"filesystem-modify":n("Modifying $target"),"format-erase":n("Erasing $target"),"format-mkfs":n("Creating filesystem on $target"),"loop-setup":n("Setting up loop device $target"),"partition-modify":n("Modifying $target"),"partition-delete":n("Deleting $target"),"partition-create":n("Creating partition $target"),cleanup:n("Cleaning up for $target"),"ata-secure-erase":n("Securely erasing $target"),"ata-enhanced-secure-erase":n("Very securely erasing $target"),"md-raid-stop":n("Stopping RAID Device $target"),"md-raid-start":n("Starting RAID Device $target"),"md-raid-fault-device":n("Marking $target as faulty"),"md-raid-remove-device":n("Removing $target from RAID Device"),"md-raid-create":n("Creating RAID Device $target"),"lvm-lvol-delete":n("Deleting $target"),"lvm-lvol-activate":n("Activating $target"),"lvm-lvol-deactivate":n("Deactivating $target"),"lvm-lvol-snapshot":n("Creating snapshot of $target"),"lvm-vg-create":n("Creating volume group $target"),"lvm-vg-delete":n("Deleting volume group $target"),"lvm-vg-add-device":n("Adding physical volume to $target"),"lvm-vg-rem-device":n("Removing physical volume from $target"),"lvm-vg-empty-device":n("Emptying $target"),"lvm-vg-create-volume":n("Creating logical volume $target"),"lvm-vg-rename":n("Renaming $target"),"lvm-vg-resize":n("Resizing $target")};function s(r){var s=e[r.Operation];if(!s)s=n("Operation '$operation' on $target");var l=r.Objects.map(function(e){var t=o(e);if(a.blocks[t])return i.block_name(a.blocks[t]);else if(a.mdraids[t])return i.mdraid_name(a.mdraids[t]);else if(a.vgroups[t])return a.vgroups[t].Name;else if(a.lvols[t])return i.lvol_name(a.lvols[t]);else return n("unknown target")}).join(", ");return t.format(s,{operation:r.Operation,target:l})}function g(e){return a.storaged_jobs[e]||a.udisks_jobs[e]}function c(e,t){return g(e).StartTime-g(t).StartTime}function d(e){var t=g(e);var r=null;if(t.ExpectedEndTime>0){var o=g.ExpectedEndTime/1e3-(new Date).getTime()-a.time_offset;if(o>0)r=i.format_delay(o)}return{path:e,Description:s(t),Progress:t.ProgressValid&&(t.Progress*100).toFixed()+"%",RemainingTime:r,Cancelable:t.Cancelable}}var v=Object.keys(a.storaged_jobs).concat(Object.keys(a.udisks_jobs)).sort(c).map(d);return r.render(l,{Jobs:v,HasJobs:v.length>0})}return{update:s,render:g}}return{init:l}});

//# sourceURL=storage/jobs.min.js

define("storage/overview", ["jquery","base1/cockpit","base1/mustache","system/server","shell/shell","storage/utils","storage/dialog","storage/permissions","shell/plot"],function(e,t,a,r,i,s,n,o){var l=t.gettext;var d=t.gettext;function c(c,u){function v(){e("#vgroups").toggle(c.features.lvm2)}e(c.features).on("changed",v);v();var m=e("#mdraids-tmpl").html();a.parse(m);function p(){function t(e,t){return c.mdraids[e].Name.localeCompare(c.mdraids[t].Name)}function r(e){var t=c.mdraids[e];return{path:e,UUID:t.UUID,Size:s.fmt_size(t.Size),Name:s.mdraid_name(t)}}var i=Object.keys(c.mdraids).sort(t).map(r);e("#mdraids").amend(a.render(m,{MDRaids:i,HasMDRaids:i.length>0}));o.update();u.update("#mdraids")}e(c).on("changed",p);var _=e("#vgroups-tmpl").html();a.parse(_);function g(){function t(e,t){return c.vgroups[e].Name.localeCompare(c.vgroups[t].Name)}function r(e){var t=c.vgroups[e];return{path:e,Size:s.fmt_size(t.Size),Name:t.Name}}var i=Object.keys(c.vgroups).sort(t).map(r);e("#vgroups").amend(a.render(_,{VGroups:i,HasVGroups:i.length>0}));o.update();u.update("#vgroups")}e(c).on("changed",g);var f=e("#drives-tmpl").html();a.parse(f);var h;function k(){function r(e,t){return c.drives[e].SortKey.localeCompare(c.drives[t].SortKey)}function i(e){if(e.MediaRemovable||e.Media){for(var t=0;t<e.MediaCompatibility.length;t++)if(e.MediaCompatibility[t].indexOf("optical")===0)return"optical";return"removable"}return e.RotationRate===0?"ssd":"hdd"}function n(e){var a=c.drives[e];var r=c.drives_block[e];if(!r){r=c.drives_multipath_blocks[e][0]}if(!r)return;var n=s.decode_filename(r.Device).replace(/^\/dev\//,"");var o=c.blockdev_io.data[n];var l=s.drive_name(a);var u=i(a);var v=s.fmt_size(a.Size);var m;if(u=="hdd"){m=v+" "+d("storage","Hard Disk")}else if(u=="ssd"){m=v+" "+d("storage","Solid-State Disk")}else if(u=="removable"){if(a.Size===0)m=d("storage","Removable Drive");else m=v+" "+d("storage","Removable Drive")}else if(u=="optical"){m=d("storage","Optical Drive")}else{if(a.Size===0)m=d("storage","Drive");else m=v+" "+d("storage","Drive")}return{path:e,dev:n,Name:l,Classification:u,Description:m,ReadRate:o&&t.format_bytes_per_sec(o[0]),WriteRate:o&&t.format_bytes_per_sec(o[1]),Highlight:n==h}}var l=Object.keys(c.drives).sort(r).map(n);e("#drives").amend(a.render(f,{Drives:l,HasDrives:l.length>0}));o.update();u.update("#drives");for(var v in l){if(l[v]&&l[v].dev){N.add_instance(l[v].dev);U.add_instance(l[v].dev)}}}e(c).on("changed",k);e(c.blockdev_io).on("changed",k);var b=e("#others-tmpl").html();a.parse(b);function D(){function r(e){var t=c.blocks[e];var a=c.blocks_part[e];var r=c.blocks_lvm2[e];return(!a||a.Table=="/")&&t.Drive=="/"&&t.CryptoBackingDevice=="/"&&t.MDRaid=="/"&&(!r||r.LogicalVolume=="/")&&!t.HintIgnore}function i(e){var a=c.blocks[e];var r=s.block_name(a);return{path:e,dev:r.replace(/^\/dev\//,""),Name:r,Description:t.format(l("$0 Block Device"),s.fmt_size(a.Size))}}var n=Object.keys(c.blocks).filter(r).sort(s.make_block_path_cmp(c)).map(i);e("#others").amend(a.render(b,{Others:n,HasOthers:n.length>0}));o.update()}e(c).on("changed",D);var T=e("#mounts-tmpl").html();a.parse(T);function y(){function t(e){var t=c.blocks[e];var a=c.blocks_fsys[e];return a&&t.IdUsage=="filesystem"&&t.IdType!="mpath_member"&&!t.HintIgnore}function r(e,t){return c.blocks[e].IdLabel.localeCompare(c.blocks[t]).IdLabel}function i(e){var t=c.blocks[e];var a=c.blocks_fsys[e];var r=a.MountPoints.map(s.decode_filename);var i;for(var n=0;n<r.length&&!i;n++)i=c.fsys_sizes.data[r[n]];return{LinkTarget:s.get_block_link_target(c,e),Name:t.IdLabel||s.block_name(t),DeviceSize:s.fmt_size(t.Size),UsageText:i?s.format_fsys_usage(i[0],i[1]):null,UsagePercent:i?i[0]/i[1]*100:null,UsageCritical:i&&i[0]>.95*i[1],MountPoints:a.MountPoints.map(s.decode_filename),IsMounted:a.MountPoints.length>0}}var n=Object.keys(c.blocks).filter(t).sort(r).map(i);e("#mounts").amend(a.render(T,{Mounts:n,HasMounts:n.length>0}));o.update();u.update("#mounts")}e(c).on("changed",y);e(c.fsys_sizes).on("changed",y);function S(){e("#jobs").amend(u.render());o.update()}e(c).on("changed",S);function M(t){return function a(r){var s=r.getAxes();if(s.yaxis.datamax<1e5)s.yaxis.options.max=1e5;else s.yaxis.options.max=null;s.yaxis.options.min=0;e(t).text(i.bytes_per_sec_tick_unit(s.yaxis))}}function I(e,t){h=t;k()}var x={direct:"disk.dev.read_bytes",internal:"block.device.read",units:"bytes",derive:"rate",threshold:1e3};var z=i.plot_simple_template();e.extend(z.yaxis,{ticks:i.memory_ticks,tickFormatter:i.format_bytes_per_sec_tick_no_unit});e.extend(z.grid,{hoverable:true,autoHighlight:false});z.setup_hook=M("#storage-reading-unit");var R=i.plot(e("#storage-reading-graph"),300);R.set_options(z);var N=R.add_metrics_stacked_instances_series(x,{});R.start_walking();e(N).on("hover",I);var C={direct:"disk.dev.write_bytes",internal:"block.device.written",units:"bytes",derive:"rate",threshold:1e3};var O=i.plot_simple_template();e.extend(O.yaxis,{ticks:i.memory_ticks,tickFormatter:i.format_bytes_per_sec_tick_no_unit});e.extend(O.grid,{hoverable:true,autoHighlight:false});O.setup_hook=M("#storage-writing-unit");var A=i.plot(e("#storage-writing-graph"),300);A.set_options(O);var U=A.add_metrics_stacked_instances_series(C,{});A.start_walking();e(U).on("hover",I);e(window).on("resize",function(){R.resize();A.resize()});var B=i.setup_plot_controls(e("#storage"),e("#storage-graph-toolbar"));B.reset([R,A]);p();g();k();D();y();S();e("#storage-log").append(r.logbox(["_SYSTEMD_UNIT=storaged.service","+","_SYSTEMD_UNIT=udisks2.service","+","_SYSTEMD_UNIT=dm-event.service","+","_SYSTEMD_UNIT=smartd.service","+","_SYSTEMD_UNIT=multipathd.service"],10));e("#create-mdraid").on("click",function(){n.open({Title:l("Create RAID Device"),Fields:[{TextInput:"name",Title:l("Name")},{SelectOne:"level",Title:l("RAID Level"),Options:[{value:"raid0",Title:l("RAID 0 (Stripe)")},{value:"raid1",Title:l("RAID 1 (Mirror)")},{value:"raid4",Title:l("RAID 4 (Dedicated Parity)")},{value:"raid5",Title:l("RAID 5 (Distributed Parity)"),selected:true},{value:"raid6",Title:l("RAID 6 (Double Distributed Parity)")},{value:"raid10",Title:l("RAID 10 (Stripe of Mirrors)")}]},{SelectOne:"chunk",Title:l("Chunk Size"),Options:[{value:"4",Title:l("4 KB")},{value:"8",Title:l("8 KB")},{value:"16",Title:l("16 KB")},{value:"32",Title:l("32 KB")},{value:"64",Title:l("64 KB")},{value:"128",Title:l("128 KB")},{value:"512",Title:l("512 KB"),selected:true},{value:"1024",Title:l("1 MB")},{value:"2048",Title:l("2 MB")}],visible:function(e){return e.level!="raid1"}},{SelectMany:"disks",Title:l("Disks"),Options:s.get_free_blockdevs(c).map(function(e){return{value:e.path,Title:e.Name+" "+e.Description}}),validate:function(e,a){var r=a.level=="raid6"?4:2;if(e.length<r)return t.format(l("At least $0 disks are needed."),r)}}],Action:{Title:l("Create"),action:function(e){return c.manager.MDRaidCreate(e.disks,e.level,e.name,(e.chunk||0)*1024,{})}}})});e("#create-volume-group").on("click",function(){n.open({Title:l("Create Volume Group"),Fields:[{TextInput:"name",Title:l("Name"),validate:s.validate_lvm2_name},{SelectMany:"disks",Title:l("Disks"),Options:s.get_free_blockdevs(c).map(function(e){return{value:e.path,Title:e.Name+" "+e.Description}}),validate:function(e){if(e.length===0)return l("At least one disk is needed.")}}],Action:{Title:l("Create"),action:function(e,t){return c.manager_lvm2.VolumeGroupCreate(e.name,e.disks,{})}}})});function H(){e("#storage").hide()}function w(){e("#storage").show();R.resize();A.resize()}return{show:w,hide:H}}return{init:c}});

//# sourceURL=storage/overview.min.js

define("storage/permissions", ["jquery","base1/cockpit"],function(t,e){var i=e.gettext;var a=e.gettext;function s(e,i,a){var s=e.allowed!==false;t(i).each(function(){var e="allowed-title";if(typeof t(this).data(e)==="undefined"||t(this).data(e)===false)t(this).data(e,t(this).attr("title")||"");t(this).tooltip({html:true});if(t(this).hasClass("disabled")===s){t(this).toggleClass("disabled",!s).attr("data-original-title",null);if(s)t(this).attr("title",t(this).data(e));else t(this).attr("title",a);t(this).tooltip("fixTitle")}})}var l=e.permission({group:"wheel"});function r(){s(l,".storage-privileged",e.format(i("The user <b>$0</b> is not permitted to manage storage"),e.user.name))}t(l).on("changed",r);return{update:r}});

//# sourceURL=storage/permissions.min.js

define("storage/utils", ["jquery","base1/cockpit","base1/mustache","system/service"],function(e,r,t,o){var a=r.gettext;var n=r.gettext;var i={};var l=r.dbus("org.freedesktop.hostname1").proxy();i.array_find=function u(e,r){for(var t=0;t<e.length;t++)if(r(e[t]))return e[t];return undefined};i.flatten=function s(e){if(e.length>0)return Array.prototype.concat.apply([],e);else return[]};i.decode_filename=function f(e){return r.utf8_decoder().decode(r.base64_decode(e).slice(0,-1))};i.encode_filename=function m(e){return r.base64_encode(r.utf8_encoder().encode(e).concat([0]))};i.fmt_size=function _(e){return r.format_bytes(e,1024)};i.fmt_size_long=function p(e){var t=r.format_bytes(e,1024);return t+" ("+e+" "+n("format-bytes","bytes")+")"};i.fmt_rate=function v(e){return r.format_bytes_per_sec(e,1024)};i.format_temperature=function d(e){var r=e-273.15;var t=9*r/5+32;return r.toFixed(1)+"° C / "+t.toFixed(1)+"° F"};i.format_fsys_usage=function b(e,t){var o="";var a=1024;var n=r.format_bytes(t,a,true);o=" / "+n.join(" ");a=n[1];n=r.format_bytes(e,a,true);return n[0]+o};i.format_delay=function k(e){var r=Math.round(e/1e3);var t=Math.floor(r/60);var o=Math.floor(t/60);r=r-t*60;t=t-o*60;var a=r+" seconds";if(t>0)a=t+" minutes, "+a;if(o>0)a=o+" hours, "+a;return a};i.validate_lvm2_name=function g(e){if(e==="")return a("Name can not be empty.");if(e.length>127)return a("Name can not be longer than 127 characters.");var t=e.match(/[^a-zA-Z0-9+._-]/);if(t){if(t[0].search(/\s+/)===-1)return r.format(a("Name can not contain the character '$0'."),t[0]);else return r.format(a("Name can not contain whitespace."),t[0])}};i.block_name=function h(e){return i.decode_filename(e.PreferredDevice)};i.mdraid_name=function y(e){if(!e.Name)return"";var t=e.Name.split(":");if(t.length!=2)return e.Name;if(t[0]==l.StaticHostname)return t[1];else return r.format(a("$name (from $host)"),{name:t[1],host:t[0]})};i.lvol_name=function V(e){var r;if(e.Type=="pool")r=a("Pool for Thin Logical Volumes");else if(e.ThinPool!="/")r=a("Thin Logical Volume");else if(e.Origin!="/")r=a("Logical Volume (Snapshot)");else r=a("Logical Volume");return t.render('{{Type}} "{{Name}}"',{Type:r,Name:e.Name})};i.drive_name=function D(e){var r=[];if(e.Vendor)r.push(e.Vendor);if(e.Model)r.push(e.Model);var t=r.join(" ");if(e.Serial)t+=" ("+e.Serial+")";else if(e.WWN)t+=" ("+e.WWN+")";return t};i.get_block_link_target=function N(e,o){var n,l,c;while(true){if(e.blocks_part[o]&&e.blocks_ptable[e.blocks_part[o].Table]){n=true;o=e.blocks_part[o].Table}else if(e.blocks_crypto[o]&&e.blocks[e.blocks_crypto[o].CryptoBackingDevice]){l=true;o=e.blocks_crypto[o].CryptoBackingDevice}else break}if(e.blocks_lvm2[o]&&e.lvols[e.blocks_lvm2[o].LogicalVolume])c=true;function u(e){if(c&&l)return r.format(a("<span>Encrypted Logical Volume of $0</span>"),e);else if(n&&l)return r.format(a("<span>Encrypted Partition of $0</span>"),e);else if(c)return r.format(a("<span>Logical Volume of $0</span>"),e);else if(n)return r.format(a("<span>Partition of $0</span>"),e);else if(l)return r.format(a("<span>Encrypted $0</span>"),e);else return e}var s=e.blocks[o];if(!s)return;var f,m,_;if(e.mdraids[s.MDRaid]){f="mdraid";m=e.mdraids[s.MDRaid].UUID;_=r.format(a("RAID Device $0"),i.mdraid_name(e.mdraids[s.MDRaid]))}else if(e.blocks_lvm2[o]&&e.lvols[e.blocks_lvm2[o].LogicalVolume]&&e.vgroups[e.lvols[e.blocks_lvm2[o].LogicalVolume].VolumeGroup]){f="vgroup";m=e.vgroups[e.lvols[e.blocks_lvm2[o].LogicalVolume].VolumeGroup].Name;_=r.format(a("Volume Group $0"),m)}else{f="block";m=i.block_name(s).replace(/^\/dev\//,"");if(e.drives[s.Drive])_=i.drive_name(e.drives[s.Drive]);else _=i.block_name(s)}return{type:f,target:m,html:u(t.render('<a data-goto-{{type}}="{{target}}">{{name}}</a>',{type:f,target:m,name:_}))}};i.get_free_blockdevs=function L(r){function t(e){var t=r.blocks[e];var o=r.blocks_ptable[e];var a=r.blocks_part[e];var n=r.blocks_pvol[e];function i(){if(!t.IdUsage)return false;if(t.IdType=="LVM2_member"&&(!n||!r.vgroups[n.VolumeGroup]))return false;return true}function l(){return t.IdType=="mpath_member"||r.drives[t.Drive]&&!r.drives_block[t.Drive]}return!t.HintIgnore&&t.Size>0&&!i()&&!l()&&!o&&!(a&&a.IsContainer)}function o(t){var o=r.blocks[t];var a=i.get_block_link_target(r,t);var n=e("<div>").html(a.html).text();return{path:t,Name:i.block_name(o),Description:i.fmt_size(o.Size)+" "+n}}return Object.keys(r.blocks).filter(t).sort(i.make_block_path_cmp(r)).map(o)};i.block_cmp=function T(e,r){return e.DeviceNumber-r.DeviceNumber};i.make_block_path_cmp=function(e){return function(r,t){return i.block_cmp(e.blocks[r],e.blocks[t])}};var c;i.get_multipathd_service=function(){if(!c)c=o.proxy("multipathd");return c};return i});

//# sourceURL=storage/utils.min.js
