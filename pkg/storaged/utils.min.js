define(["jquery","base1/cockpit","base1/mustache","system/service"],function(e,r,t,o){var a=r.gettext;var n=r.gettext;var i={};var l=r.dbus("org.freedesktop.hostname1").proxy();i.array_find=function u(e,r){for(var t=0;t<e.length;t++)if(r(e[t]))return e[t];return undefined};i.flatten=function s(e){if(e.length>0)return Array.prototype.concat.apply([],e);else return[]};i.decode_filename=function f(e){return r.utf8_decoder().decode(r.base64_decode(e).slice(0,-1))};i.encode_filename=function m(e){return r.base64_encode(r.utf8_encoder().encode(e).concat([0]))};i.fmt_size=function _(e){return r.format_bytes(e,1024)};i.fmt_size_long=function p(e){var t=r.format_bytes(e,1024);return t+" ("+e+" "+n("format-bytes","bytes")+")"};i.fmt_rate=function v(e){return r.format_bytes_per_sec(e,1024)};i.format_temperature=function d(e){var r=e-273.15;var t=9*r/5+32;return r.toFixed(1)+"° C / "+t.toFixed(1)+"° F"};i.format_fsys_usage=function b(e,t){var o="";var a=1024;var n=r.format_bytes(t,a,true);o=" / "+n.join(" ");a=n[1];n=r.format_bytes(e,a,true);return n[0]+o};i.format_delay=function k(e){var r=Math.round(e/1e3);var t=Math.floor(r/60);var o=Math.floor(t/60);r=r-t*60;t=t-o*60;var a=r+" seconds";if(t>0)a=t+" minutes, "+a;if(o>0)a=o+" hours, "+a;return a};i.validate_lvm2_name=function g(e){if(e==="")return a("Name can not be empty.");if(e.length>127)return a("Name can not be longer than 127 characters.");var t=e.match(/[^a-zA-Z0-9+._-]/);if(t){if(t[0].search(/\s+/)===-1)return r.format(a("Name can not contain the character '$0'."),t[0]);else return r.format(a("Name can not contain whitespace."),t[0])}};i.block_name=function h(e){return i.decode_filename(e.PreferredDevice)};i.mdraid_name=function y(e){if(!e.Name)return"";var t=e.Name.split(":");if(t.length!=2)return e.Name;if(t[0]==l.StaticHostname)return t[1];else return r.format(a("$name (from $host)"),{name:t[1],host:t[0]})};i.lvol_name=function V(e){var r;if(e.Type=="pool")r=a("Pool for Thin Logical Volumes");else if(e.ThinPool!="/")r=a("Thin Logical Volume");else if(e.Origin!="/")r=a("Logical Volume (Snapshot)");else r=a("Logical Volume");return t.render('{{Type}} "{{Name}}"',{Type:r,Name:e.Name})};i.drive_name=function D(e){var r=[];if(e.Vendor)r.push(e.Vendor);if(e.Model)r.push(e.Model);var t=r.join(" ");if(e.Serial)t+=" ("+e.Serial+")";else if(e.WWN)t+=" ("+e.WWN+")";return t};i.get_block_link_target=function N(e,o){var n,l,c;while(true){if(e.blocks_part[o]&&e.blocks_ptable[e.blocks_part[o].Table]){n=true;o=e.blocks_part[o].Table}else if(e.blocks_crypto[o]&&e.blocks[e.blocks_crypto[o].CryptoBackingDevice]){l=true;o=e.blocks_crypto[o].CryptoBackingDevice}else break}if(e.blocks_lvm2[o]&&e.lvols[e.blocks_lvm2[o].LogicalVolume])c=true;function u(e){if(c&&l)return r.format(a("<span>Encrypted Logical Volume of $0</span>"),e);else if(n&&l)return r.format(a("<span>Encrypted Partition of $0</span>"),e);else if(c)return r.format(a("<span>Logical Volume of $0</span>"),e);else if(n)return r.format(a("<span>Partition of $0</span>"),e);else if(l)return r.format(a("<span>Encrypted $0</span>"),e);else return e}var s=e.blocks[o];if(!s)return;var f,m,_;if(e.mdraids[s.MDRaid]){f="mdraid";m=e.mdraids[s.MDRaid].UUID;_=r.format(a("RAID Device $0"),i.mdraid_name(e.mdraids[s.MDRaid]))}else if(e.blocks_lvm2[o]&&e.lvols[e.blocks_lvm2[o].LogicalVolume]&&e.vgroups[e.lvols[e.blocks_lvm2[o].LogicalVolume].VolumeGroup]){f="vgroup";m=e.vgroups[e.lvols[e.blocks_lvm2[o].LogicalVolume].VolumeGroup].Name;_=r.format(a("Volume Group $0"),m)}else{f="block";m=i.block_name(s).replace(/^\/dev\//,"");if(e.drives[s.Drive])_=i.drive_name(e.drives[s.Drive]);else _=i.block_name(s)}return{type:f,target:m,html:u(t.render('<a data-goto-{{type}}="{{target}}">{{name}}</a>',{type:f,target:m,name:_}))}};i.get_free_blockdevs=function L(r){function t(e){var t=r.blocks[e];var o=r.blocks_ptable[e];var a=r.blocks_part[e];var n=r.blocks_pvol[e];function i(){if(!t.IdUsage)return false;if(t.IdType=="LVM2_member"&&(!n||!r.vgroups[n.VolumeGroup]))return false;return true}function l(){return t.IdType=="mpath_member"||r.drives[t.Drive]&&!r.drives_block[t.Drive]}return!t.HintIgnore&&t.Size>0&&!i()&&!l()&&!o&&!(a&&a.IsContainer)}function o(t){var o=r.blocks[t];var a=i.get_block_link_target(r,t);var n=e("<div>").html(a.html).text();return{path:t,Name:i.block_name(o),Description:i.fmt_size(o.Size)+" "+n}}return Object.keys(r.blocks).filter(t).sort(i.make_block_path_cmp(r)).map(o)};i.block_cmp=function T(e,r){return e.DeviceNumber-r.DeviceNumber};i.make_block_path_cmp=function(e){return function(r,t){return i.block_cmp(e.blocks[r],e.blocks[t])}};var c;i.get_multipathd_service=function(){if(!c)c=o.proxy("multipathd");return c};return i});
